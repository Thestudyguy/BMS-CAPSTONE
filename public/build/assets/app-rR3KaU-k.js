function pe(i,r,c,u){$.ajax({url:i,type:"POST",data:r,success:function(o){c(o)},error:function(o,l,a){u(o,l,a)}})}function $e(i,r,c,u){$.ajax({url:i,type:"POST",headers:r,success:function(o){c(o)},error:function(o,l,a){u(o,l,a)}})}function he(i,r,c,u,o,l){$.ajax({url:i,type:"POST",data:{...r,id:c},headers:u,success:function(a){o(a)},error:function(a,e,t){l(a,e,t)}}),console.log(r),console.log(c)}function ge(i,r,c,u,o){$.ajax({url:i,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,a,e){o(l,a,e)}})}function xe(i,r,c,u,o,l){var a=new FormData;for(var e in r)r.hasOwnProperty(e)&&a.append(e,r[e]);c&&a.append("profile",c),$.ajax({url:i,type:"POST",data:a,headers:u,processData:!1,contentType:!1,success:function(t){o(t)},error:function(t,n,s){l(t,n,s)}})}function be(i,r,c,u){$.ajax({url:i,type:"POST",headers:r,success:function(o){c(o)},error:function(o,l,a){u(o,l,a)}})}function ye(i,r,c,u,o){$.ajax({url:i,type:"POST",data:r,headers:c,processData:!1,contentType:!1,success:function(l){u(l)},error:function(l,a,e){o(l,a,e)}})}function Se(i,r,c,u,o){$.ajax({url:i,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,a,e){o(l,a,e)}})}function we(i,r,c,u,o){$.ajax({url:i,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,a,e){o(l,a,e)}})}function Ce(i,r,c,u,o){$.ajax({url:i,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,a,e){o(l,a,e)}})}function Fe(i,r,c,u,o){$.ajax({url:i,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,a,e){o(l,a,e)}})}function je(i,r,c,u,o){$.ajax({url:i,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,a,e){o(l,a,e)}})}function Te(i,r,c,u,o){$.ajax({url:i,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,a,e){o(l,a,e)}})}function Oe(i,r,c,u,o){$.ajax({url:i,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,a,e){o(l,a,e)}})}var ee=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),Z=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".search-coa").on("keyup",function(){var e=$(this).val().toLowerCase();$("#coa-table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(e)>-1)})}),$("#filter-coa").on("change",function(){var e=$(this).val();$(".coa-table tbody tr").each(function(){var t=$(this).data("category");e==="clear"?$(this).show():e===""||t===e?$(this).show():$(this).hide()})}),$(".client-table-data").hover(function(){$(this).find(".action-icons").removeClass("visually-hidden")},function(){$(this).find(".action-icons").addClass("visually-hidden")}),$(".new-sub-service-icon").on("click",function(e){e.stopPropagation()}),$(".edit-service-icon").on("click",function(e){e.stopPropagation()}),$(".view-service-details").on("click",function(e){e.stopPropagation()}),$(".remove-service-icon").on("click",function(e){e.stopPropagation()});function i(e){localStorage.setItem("transaction-status",e),location.reload()}$(".client-sub-table").on("click",function(){console.log($(this).attr("id")),$(this).closest("tr").next(".expandable-body").find(".loader-td")}),$(".external-service").on("click",function(){var e=$(this).next(".expandable-body").find(".loader");e.removeClass("visually-hidden");var t=$(this).attr("id");$.ajax({type:"POST",url:`sub-services-${t}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){e.addClass("visually-hidden");var s=n.services,v='<table class="table table-hover float-left append-sub-services">';v+=`
                <thead class="text-left">
                    <tr>
                        <td>Requirements</td>
                        <td>Price</td>
                    </tr>
                </thead> 
                `,$.each(s,(f,g)=>{var w=parseFloat(g.ServiceRequirementPrice).toFixed(2).toLocaleString(),T=Number(w).toLocaleString();v+=`
                    <tbody class="text-left">
                        <tr class='sub-service' id='${g.id}'>
                            <td>${g.ServiceRequirements}</td>
                            <td>${T}
                            <span id='${g.id}' class="badge mx-2 bg-warning float-right text-sm sub-service-action-icons-remove" data-bs-target='#remove-sub-service' data-bs-toggle='modal' >
                                <i class="fas fa-trash" style="font-size: .8em;"></i>
                            </span>
                            <span id='${g.id}' data-bs-target='#edit-sub-service-modal' data-bs-toggle='modal' class="badge bg-warning float-right text-sm sub-service-action-icons-edit">
                                <i class="fas fa-pen" style="font-size: .8em;"></i>
                            </span>
                            <span id='${g.id}' data-bs-target='#add-sub-service-req' data-bs-toggle='modal' class="mx-2 badge bg-warning float-right text-sm sub-service-action-icons-req">
                                <i class="fas fa-file" style="font-size: .8em;"></i>
                            </span>
                            </td>
                        </tr>
                    </tbody>                    
                    `}),v+="</table>",$(`.append-sub-services-${t}`).html(v)},error:function(n,s,v){Z.fire({icon:"error",title:"Fatal Error",text:n})}})}),$(document).on("click",".sub-service-action-icons-req",function(){var e=$(this).attr("id");$.ajax({type:"POST",url:`retrieve-sub-service-data-${e}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){console.log(t.sub_service),$("#sub_service_id").attr("id",t.sub_service.id),$("#sub_service_id").val(t.sub_service.id),$(".sub-service-req-service-name").text(t.sub_service.ServiceRequirements)},error:function(t,n,s){Z.fire({icon:"error",title:"Something went wrong",text:`Translated: ${t}`})}})}),$(document).on("click",".sub-service-action-icons-edit",function(e){$(".sub-service-loader").removeClass("visually-hidden");var t=$(this).attr("id");$.ajax({type:"POST",url:`retrieve-sub-service-data-${t}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){$(".sub-service-loader").addClass("visually-hidden"),console.log(n.sub_service.ServiceRequirementPrice),$("#service-edit-field").val(n.sub_service.ServiceRequirements),$("#serviceprice-edit-field").val(n.sub_service.ServiceRequirementPrice),$("#sub-service-edit-id").val(n.sub_service.id)},error:function(n,s,v){Z.fire({icon:"error",title:"Something went wrong",text:`Translated: ${n}`})}})}),$(document).on("click",".sub-service-action-icons-remove",function(e){e.preventDefault();var t=$(this).attr("id"),n=$(this).closest("tr").find("td:eq(0)").text().trim();console.log(n),$(".sub-service-app").text(n),$(".remove-sub-service").attr("id",t)}),$(document).on("click",".remove-sub-service",function(){$.ajax({type:"POST",url:`remove-sub-service/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){localStorage.setItem("sub-service","removed"),location.reload()},error:function(e,t,n){Z.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+e})}})}),$("#edit-sub-service").on("click",function(e){e.preventDefault();var t=$("#edit-sub-service-form").serializeArray(),n=!0,s={};if($.each(t,(g,w)=>{w.value===""?(n=!1,$(`[name='${w.name}']`).addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"})):($(`[name='${w.name}']`).removeClass("is-invalid"),s[w.name]=w.value)}),n){let g=function(T){console.log(T),localStorage.setItem("sub_service","updated"),location.reload()},w=function(T,X,K){var B=JSON.parse(T.responseText),j=B.error;if(j==="Service already exists"){$(".conflict-warning").removeClass("visually-hidden"),$("#new-service-form [name='Service']").addClass("is-invalid"),$(".conflict-text").text("Service already exists");return}else Z.fire({icon:"error",title:"Fatal Error",text:`Translated: ${j}`}),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid")};var v=g,f=w;je("edit-sub-service",s,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},g,w)}}),$("#new-service-form").on("submit",function(e){e.preventDefault(),$(".conflict-text").text("Service already exists"),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid");var t={},n=$(this).serializeArray(),s=!1;if($.each(n,(g,w)=>{if(w.value==="")return $(`#new-service-form [name='${w.name}']`).addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),s=!0,!1;t[w.name]=w.value}),s)return;pe("new-service",t,v,f);function v(g){i("created")}function f(g,w,T){var X=JSON.parse(g.responseText),K=X.error;if(K==="Service already exists"){$(".conflict-warning").removeClass("visually-hidden"),$("#new-service-form [name='Service']").addClass("is-invalid"),$(".conflict-text").text("Service already exists");return}else Z.fire({icon:"error",title:"Fatal Error",text:`Translated: ${K}`}),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid")}}),$(".remove-service").on("click",function(){$e(`remove-service-${$(this).attr("id")}`,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t);function e(n){i("removed")}function t(n,s,v){Z.fire({icon:"error",title:"Fatal Error",text:n})}}),$(".edit-service").on("click",function(e){e.preventDefault();var t=$(this).attr("id"),n="#edit-service-form-"+t,s=$(n).serializeArray();console.log(s);var v={},f=!1;if($.each(s,(T,X)=>{if(X.value==="")return $(n+" [name='"+X.name+"']").addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),f=!0,!1;v[X.name]=X.value}),f)return;he("update-service",v,t,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},g,w);function g(T){i("updated")}function w(T,X,K){var B=JSON.parse(T.responseText),j=B.error;Z.fire({icon:"error",title:"Fatal Error",text:`Translated: ${j}`})}}),$(".submit-new-sub-service").on("click",function(e){e.preventDefault();var t=!0,n={},s=$(this).attr("id"),v=$(`#new-sub-service-${s}`).serializeArray();if(console.log(v),$.each(v,(w,T)=>{T.value===""?($(`[name='${T.name}']`).addClass("is-invalid"),t=!1):(n[T.name]=T.value,$(`[name='${T.name}']`).removeClass("is-invalid"))}),!t){ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}ge("new-sub-service",n,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},f,g);function f(w){console.log(w),localStorage.setItem("sub_service","created"),location.reload()}function g(w,T,X){console.log(w),w.responseJSON&&w.responseJSON.message?(Z.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${w.responseJSON.message}`}),console.log(w.responseJSON.errors)):Z.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${w.responseJSON.error}`})}});var r={},c=document.getElementById("fileInput");$(".next-form").on("click",function(){var e=$(".multi-step:visible"),t=e.serializeArray(),n=!1,s=!1;if(e.find(".form-control").removeClass("is-invalid"),$.each(t,(w,T)=>{T.value===""&&($(`[name='${T.name}']`).addClass("is-invalid"),n=!0),r[T.name]=T.value}),e.hasClass("client-profile")&&(!c.files||c.files.length===0?($("#fileInput").addClass("is-invalid"),s=!0):$("#fileInput").removeClass("is-invalid")),n)ee.fire({icon:"warning",title:"Missing Fields",text:"Fill all fields to proceed"});else if(s)ee.fire({icon:"warning",title:"Missing File",text:"Please upload a profile picture before proceeding."});else{var v=e.next(".multi-step");if(v.hasClass("data-entry-preview")){$(".companyName").text($("[name='CompanyName']").val()),$(".companyEmail").text($("[name='CompanyEmail']").val()),$(".companyAddress").text($("[name='CompanyAddress']").val()),$(".companyCEO").text($("[name='CEO']").val()),$(".companyCEODob").text($("[name='CEODateOfBirth']").val()),$(".companyCEOContact").text($("[name='CEOContactInformation']").val()),$(".representativeName").text($("[name='RepresentativeName']").val()),$(".representativeContact").text($("[name='RepresentativeContactInformation']").val()),$(".representativeDob").text($("[name='RepresentativeDateOfBirth']").val()),$(".representativePosition").text($("[name='RepresentativePosition']").val()),$(".representativeAddress").text($("[name='RepresentativeAddress']").val());var f=document.getElementById("fileInput");if(f.files&&f.files[0]){var g=new FileReader;g.onload=function(w){$("#previewImage").attr("src",w.target.result).show()},g.readAsDataURL(f.files[0])}}v.length&&e.fadeOut(300,function(){$(this).hide(),v.fadeIn(200,function(){$(this).show()})}),$(".previous-form").removeClass("visually-hidden"),e.next(".multi-step").next(".multi-step").length||($(".next-form").addClass("visually-hidden"),$(".save").removeClass("visually-hidden"))}}),$(".previous-form").on("click",function(){var e=$(".multi-step:visible"),t=e.prev(".multi-step");e.fadeOut(300,function(){$(this).hide(),t.fadeIn(300,function(){$(this).show()})}),$(".next-form").removeClass("visually-hidden"),$(".save").addClass("visually-hidden"),t.prev(".multi-step").length===0&&$(".previous-form").addClass("visually-hidden")}),$(".save").on("click",function(){new FormData,console.log(r),xe("new-client-record",r,fileInput.files[0],{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},function(t){console.log("Success:",t),i("created"),window.location.href="clients"},function(t,n,s){t.responseJSON&&t.responseJSON.message&&(Z.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${t.responseJSON.message}`}),console.log(t.responseJSON.errors))})}),$("#fileInput").on("change",function(e){var t=this.files[0];if(t){var n=new FileReader;n.onload=function(s){$("#imagePreview").attr("src",s.target.result).show(),console.log(s.target.result)},n.readAsDataURL(t)}else $("#imagePreview").attr("src","#").hide()}),$(".pdf-services").on("click",function(e){e.preventDefault();var t=$(this).data("url");window.open(t,"services/pdf")});var u=localStorage.getItem("activeNavItem");u&&$('.nav-item a[href="'+u+'"]').addClass("active"),$(".nav-item a").on("click",function(){$(".nav-item a").removeClass("active"),$(this).addClass("active"),localStorage.setItem("activeNavItem",$(this).attr("href"))});const o=localStorage.getItem("transaction-status");if(o){localStorage.removeItem("transaction-status");const e={created:{icon:"success",title:"New Record",text:"New record added successfully"},removed:{icon:"success",title:"Record Removed!",text:"Record removed successfully"},updated:{icon:"success",title:"Record Updated!",text:"Record updated successfully"}};e[o]&&ee.fire(e[o])}var l=localStorage.getItem("sub_service"),a=localStorage.getItem("sub-service");l==="created"&&(ee.fire({icon:"success",title:"New Requirement added"}),localStorage.removeItem("sub_service")),l==="updated"&&(ee.fire({icon:"success",title:"Service Updated!"}),localStorage.removeItem("sub_service")),a==="removed"&&(ee.fire({icon:"success",title:"Service Removed!"}),localStorage.removeItem("sub-service"))});var Ae=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),fe=Swal.mixin({toast:!1,position:"bottom-end"}),se=0,re=0,Y=[];$(document).ready(function(){$(".services").on("change",function(){var a=$(this).attr("id"),e=$(this).val().split("_"),t=e[0],n=$(this).val(),s=parseFloat(e[1]);Y=[],$(".sub-services-append").html(""),$(".service-input").html(""),$(".sub-services").find(".loader").removeClass("visually-hidden"),$(".services-total").show(),re=s,se=1,u(t,s),c(),be(`fetch-sub-services-${a}`,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},i,r),Y.push({serviceName:n,servicePrice:s,serviceFile:null}),console.log(Y)});function i(a){$(".sub-services").find(".loader").addClass("visually-hidden"),$.each(a.subServices,(e,t)=>{t!=="id"&&$(".sub-services-append").append(`<li>
                    <input class='sub-service-item' type='checkbox' name='SubService' id='${t.id}' 
                    value='${t.ServiceRequirements}_${t.ServiceRequirementPrice}_subservice_${t.id}' 
                    style='font-size: 5px;'>${t.ServiceRequirements}
                </li>`)})}function r(a,e,t){console.log(a),fe.fire({icon:"error",title:"Fatal Error",text:`Translated: ${a}`})}$(document).on("click",".sub-service-item",function(){var a=$(this).val().split("_"),e=$(this).val(),t=$(this).attr("id"),n=a[0],s=parseFloat(a[1]);if($(this).is(":checked"))$(".client-service-input").append(`<tr id='row-${t}'>
                    <td>${n}</td>
                    <td>${s.toLocaleString()}</td>
                    <td>
                        <input type="file" class="clientDocument" name="clientDocument-${t}" accept='file/*'>
                    </td>
                </tr>`),re+=s,se++,Y.push({serviceName:e,servicePrice:s,serviceFile:null});else{const v=Y.findIndex(f=>f.serviceName===e);console.log(e,"unchecked"),$(`#row-${t}`).remove(),re-=s,se--,v!==-1&&Y.splice(v,1)}console.log(Y),c()});function c(){$(".totalAmount").text(`Total Amount: ${re.toLocaleString()}`),$(".totalServices").text(`Total Services: ${se}`)}function u(a,e,t){const n=a.replace(/\s+/g,"_");$(".service-input").append(`
            <div class="row">
                <div class="col-sm-12">
                    <div class="row">
                        <table style='font-size: 10px;' class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <td>Service</td>
                                    <td>Amount</td>
                                    <td>Document</td>
                                </tr>
                            </thead>
                            <tbody class='client-service-input'>
                                <tr>
                                    <td>${a}</td>
                                    <td>${e.toLocaleString()}</td>
                                    <td>No file required</td>
                                    <td><span class="badge fw-bold text-light bg-danger rounded-1 remove-parent-service" id=${n}><i class="fas fa-trash"></i></span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `)}$(document).on("change",".clientDocument",function(){var a=$(this),e=a.closest("tr"),t=e.find("td").first().text(),n=Array.from(a[0].files);Y=Y.map(s=>s.serviceName===t?{...s,serviceFile:n.length>0?n[0]:null}:s)}),$(document).on("click",".remove-parent-service",function(){var a=$(this).attr("id"),e=a.replace(/_/g," "),t=Y.findIndex(n=>n.serviceName==e);t>-1&&Y.splice(t,1),$(this).closest("tr").remove(),console.log(Y)});function o(){$(".add-client-service-loader").removeClass("visually-hidden");var a=$(".hidden-client-id").attr("id"),e=new FormData;e.append("client_id",a),Y.forEach((s,v)=>{e.append(`services[${v}][serviceName]`,s.serviceName),e.append(`services[${v}][servicePrice]`,s.servicePrice),s.serviceFile&&e.append(`services[${v}][serviceFile]`,s.serviceFile)});for(const[s,v]of e.entries())console.log(s,v);ye(`client-services-${a}`,e,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},t,n);function t(s){$(".add-client-service-loader").addClass("visually-hidden"),console.log(s),window.location.href="clients",localStorage.setItem("services",!0)}function n(s,v,f){$(".add-client-service-loader").addClass("visually-hidden");try{const g=JSON.parse(s.responseText);console.log("Parsed Response:",g),fe.fire({icon:"warning",title:"Conflict",text:g.Conflict})}catch(g){console.log("Could not parse JSON response:",g)}}}$(".submit-services").on("click",function(){o()});var l=localStorage.getItem("services");l&&(Ae.fire({icon:"success",title:"Services Added to Client"}),localStorage.removeItem("services"))});$(document).ready(function(){let i=1;var r=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),c=Swal.mixin({toast:!1,position:"bottom-end"});let u="",o={},l="",a={},e={},t={},n={},s={};$("#expense-category").on("change",function(){u=$("#expense-category").val(),$(".expense-form").removeClass("visually-hidden"),$(".months-container").empty(),$(".save-expense").addClass("visually-hidden")}),$(".start-date, .end-date").on("change",function(){const j=$(".start-date").val(),h=$(".end-date").val();if($("#expense-category").val()===""){r.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(j&&h){const y=new Date(j),C=new Date(h),O=$(".months-container");var S='<div class="row">';if((C.getFullYear()-y.getFullYear())*12+(C.getMonth()-y.getMonth())>12){c.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const N=new Date(y);if(N.setMonth(N.getMonth()+11),C>N){c.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}O.empty(),S+="";let p=new Date(y);for(;p<=C;){const d=p.toLocaleString("default",{month:"long",year:"numeric"});S+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control month-input" name="${d}" id="" placeholder='${d}' value="">
                    </div>
                    </div>`,p.setMonth(p.getMonth()+1)}S+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-months form-control">Save</button>
            </div>`,S+="</div>",O.html(S)}$(".months-container").on("input",".month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-months",function(j){j.preventDefault();let h=[],S=!0;if(o.hasOwnProperty(u))return r.fire({icon:"warning",title:"Account Already Added",text:"You have already added this account."}),$(".end-date").val(""),$(".start-date").val(""),$(".months-container").empty(),!1;if($(".month-input").each(function(){var y=$(this).attr("name"),C=$(this).val();C!==""&&(S=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),h.push({monthName:y,value:$(this).val(),account:u,startDate:$(".start-date").val(),endDate:$(".end-date").val()}))}),S){$(".month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),r.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}o[u]={months:h,startDate:$(".start-date").val(),endDate:$(".end-date").val()},$("#saved-months").empty(),$.each(o,(y,C)=>{var O='<table class="table table-hover client-journal-accounts">',D=y.split("_");O+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${D[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${y}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(C.months,(N,p)=>{O+=`
                    <tr>
                        <td class='text-left'>${p.monthName}</td>
                        <td class='text-left'>${p.value}</td>
                    </tr>
                `}),O+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,O+="</table>",$("#saved-months").append(O)}),$(".months-container").empty(),$("#expense-category").val(""),$(".end-date").val(""),$(".start-date").val(""),u="",S=!0,console.log(o)}),$(document).on("click",".remove-saved-account",function(j){const h=$(this).attr("id");delete o[h],$("#saved-months").empty(),$.each(o,(S,y)=>{var C='<table class="table table-hover client-journal-accounts">',O=S.split("_");C+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${O[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${S}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(y.months,(D,N)=>{C+=`
                    <tr>
                        <td>${N.monthName}</td>
                        <td>${N.value}</td>
                    </tr>
                `}),C+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,C+="</table>",$("#saved-months").append(C)}),console.log(o)}),$("#income-category").on("change",function(){$(".income-form").removeClass("visually-hidden"),l=$("#income-category").val(),$(".income-months-container").empty()}),$(".income-start-date, .income-end-date").on("change",function(){const j=$(".income-start-date").val(),h=$(".income-end-date").val();if($("#income-category").val()===""){r.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(j&&h){const y=new Date(j),C=new Date(h),O=$(".income-months-container");var S='<div class="row">';if((C.getFullYear()-y.getFullYear())*12+(C.getMonth()-y.getMonth())>12){c.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const N=new Date(y);if(N.setMonth(N.getMonth()+11),C>N){c.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}O.empty(),S+="";let p=new Date(y);for(;p<=C;){const d=p.toLocaleString("default",{month:"long",year:"numeric"});S+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control income-month-input" name="${d}" id="" placeholder='${d}' value="">
                    </div>
                    </div>`,p.setMonth(p.getMonth()+1)}S+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-expense-months form-control">Save</button>
            </div>`,S+="</div>",O.html(S)}$(".income-months-container").on("input",".income-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-expense-months",function(j){j.preventDefault();let h=[],S=!0;if(a.hasOwnProperty(l)){r.fire({icon:"warning",title:"Account Already Added",text:"You have already added this account."}),$(".income-end-date").val(""),$(".income-start-date").val(""),$(".income-months-container").empty();return}if($(".income-month-input").each(function(){var y=$(this).attr("name"),C=$(this).val();C!==""&&(S=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),h.push({incomeMonthName:y,value:$(this).val(),account:l,startDate:$(".income-start-date").val(),endDate:$(".income-end-date").val()}))}),S){$(".income-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),r.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}a[l]={months:h,startDate:$(".income-start-date").val(),endDate:$(".income-end-date").val()},console.log(a),$("#saved-income-months").empty(),$.each(a,(y,C)=>{var O='<table class="table table-hover client-journal-accounts">',D=y.split("_");O+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${D[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${y}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(C.months,(N,p)=>{O+=`
                    <tr>
                        <td class='text-left'>${p.incomeMonthName}</td>
                        <td class='text-left'>${p.value}</td>
                    </tr>
                `}),O+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,O+="</table>",$("#saved-income-months").append(O)}),$(".income-months-container").empty(),$("#income-category").val(""),$(".income-end-date").val(""),$(".income-start-date").val(""),u="",S=!0}),$(document).on("click",".remove-saved-account",function(j){const h=$(this).attr("id");delete a[h],$("#saved-income-months").empty(),$.each(a,(S,y)=>{var C='<table class="table table-hover client-journal-accounts">',O=S.split("_");C+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${O[1]} - ${y.startDate} - ${y.endDate}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${S}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(y.months,(D,N)=>{C+=`
                    <tr>
                        <td>${N.incomeMonthName}</td>
                        <td>${N.value}</td>
                    </tr>
                `}),C+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,C+="</table>",$("#saved-income-months").append(C)}),console.log(a)}),$(document).on("change","#asset_account",function(){let j=$(this).val();console.log(j),$.ajax({type:"POST",url:`get-accounts-${j}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(h){console.log(h);let S="";$.each(h,(y,C)=>{$.each(C,(O,D)=>{console.log(D),S+=`
                            <option value="${D.AccountName}_${D.id}">${D.AccountName}</option>
                        `})}),$("#asset_account_name").html(S)},error:function(h,S,y){console.error(h)}})}),$(document).on("change","#liability_account",function(){let j=$(this).val();$.ajax({type:"POST",url:`get-accounts-${j}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(h){let S="";$.each(h,(y,C)=>{$.each(C,(O,D)=>{S+=`
                            <option value="${D.AccountName}_${D.id}">${D.AccountName}</option>
                        `})}),$("#liability_account_name").html(S)},error:function(h,S,y){console.error(h)}})}),$(document).on("change","#oe_account",function(){let j=$(this).val();$.ajax({type:"POST",url:`get-accounts-${j}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(h){let S="";$.each(h,(y,C)=>{$.each(C,(O,D)=>{S+=`
                            <option value="${D.AccountName}_${D.id}">${D.AccountName}</option>
                        `})}),$("#oe_account_name").html(S)},error:function(h,S,y){console.error(h)}})}),$(".save-asset-info").on("click",function(j){j.preventDefault();var h=!1,S=$(".journal-asset-form").serializeArray(),y="",C="",O="";let D=!1;if($(".journal-asset-form input, .journal-asset-form select").removeClass("is-invalid"),$.each(S,function(p,d){d.value===""&&($(`.journal-asset-form [name='${d.name}']`).addClass("is-invalid"),h=!0),d.name==="assetType"?y=d.value:d.name==="assetAccount"?C=d.value:d.name==="assetAmount"&&(O=d.value)}),$.each(e,(p,d)=>{if($.each(d.accounts,(x,m)=>{if(m.assetAccount===C)return D=!0,!1}),D)return!1}),D)return r.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(h){r.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}e[y]||(e[y]={accounts:[]}),e[y].accounts.push({assetAccount:C,amount:O}),console.log("Asset Object:",e);var N="";$.each(e,function(p,d){$.each(d.accounts,function(x,m){N+=`
                <tr>
                    <td style="font-size: 0.8em;">${p.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${m.assetAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${m.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-asset" id="${m.assetAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-asset-accounts").html(N),$(".journal-asset-form")[0].reset(),$("#asset_account_name").html('<option value="" selected hidden>Select an asset type first</option>')}),$(document).on("click",".remove-asset",function(j){j.preventDefault(),$(this).closest("tr").remove();for(let h in e)e[h].accounts&&(e[h].accounts=e[h].accounts.filter(S=>S.assetAccount!==$(this).attr("id"))),e[h].accounts.length===0&&delete e[h];console.log(e)}),$(".save-liability-info").on("click",function(j){j.preventDefault();var h=!1,S=$(".journal-liability-form").serializeArray(),y="",C="",O="";let D=!1;if($(".journal-liability-form input, .journal-liability-form select").removeClass("is-invalid"),$.each(S,function(p,d){d.value===""&&($(`.journal-liability-form [name='${d.name}']`).addClass("is-invalid"),h=!0),d.name==="liability-account"?y=d.value:d.name==="liability-account-name"?C=d.value:d.name==="liability-amount"&&(O=d.value)}),$.each(t,(p,d)=>{if($.each(d.accounts,(x,m)=>{if(m.liabilityAccount===C)return D=!0,!1}),D)return!1}),D)return r.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(h){r.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}t[y]||(t[y]={accounts:[]}),t[y].accounts.push({liabilityAccount:C,amount:O}),console.log("liability Object:",t);var N="";$.each(t,function(p,d){$.each(d.accounts,function(x,m){N+=`
                <tr>
                    <td style="font-size: 0.8em;">${m.liabilityAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${m.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-liability" id="${m.liabilityAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-liability-accounts").html(N),$(".journal-liability-form")[0].reset(),$("#liability_account_name").html('<option value="" selected hidden>Select an asset type first</option>')}),$(document).on("click",".remove-liability",function(j){j.preventDefault(),$(this).closest("tr").remove();for(let h in t)t[h].accounts&&(t[h].accounts=t[h].accounts.filter(S=>S.liabilityAccount!==$(this).attr("id")),t[h].accounts.length===0&&delete t[h]);console.log(t)}),$(".save-oe-info").on("click",function(j){j.preventDefault();var h=!1,S=$(".journal-oe-form").serializeArray(),y="",C="",O="",D=!1;if($(".journal-oe-form input, .journal-oe-form select").removeClass("is-invalid"),$.each(S,function(p,d){d.value===""&&($(`.journal-oe-form [name='${d.name}']`).addClass("is-invalid"),h=!0),d.name==="oe-account"?y=d.value:d.name==="oe-account-name"?C=d.value:d.name==="oe-amount"&&(O=d.value)}),$.each(n,(p,d)=>{if($.each(d.accounts,(x,m)=>{if(m.oeAccount===C)return D=!0,!1}),D)return!1}),D)return r.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(h){r.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}n[y]||(n[y]={accounts:[]}),n[y].accounts.push({oeAccount:C,amount:O}),console.log("Asset Object:",n);var N="";$.each(n,function(p,d){$.each(d.accounts,function(x,m){N+=`
                <tr>
                    <td style="font-size: 0.8em;">${m.oeAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${m.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-oe" id="${m.oeAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-oe-accounts").html(N),$(".journal-oe-form")[0].reset(),$("#oe_account_name").html('<option value="" selected hidden>Select an account type first</option>'),console.log("oeObj Object:",n)}),$(document).on("click",".remove-oe",function(j){j.preventDefault(),$(this).closest("tr").remove();for(let h in n)n[h].accounts&&(n[h].accounts=n[h].accounts.filter(S=>S.oeAccount!==$(this).attr("id"))),n[h].accounts.length===0&&delete n[h];console.log(n)});var v=0,f=0,g=0,w=0,T=0;$(".next-btn").on("click",function(){if(i===1){if(Object.keys(a).length===0){r.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}$("#append-expenses-choy").empty(),v=0;var j="";$.each(a,function(q,z){var k=q.split("_"),b=0;$.each(z.months,function(I,U){var V=U.value.replace(/,/g,""),M=parseFloat(V);b+=M});var P=b.toLocaleString();v+=b,j+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${k[1]}</div>
                        <div class="col-sm-6 text-right">${P}</div>
                    </div>`});var h=parseFloat(v);console.log(typeof h),$("#append-expenses-choy").append(j);var S=`
                <div class="row mt-3">
                    <div class="col-sm-6 text-left"><strong>Total:</strong></div>
                    <div class="col-sm-6 text-right"><strong>${h.toLocaleString()}</strong></div>
                </div>`;$(".append-expense-total").html(S)}if(i===2){$(".append-ldc").empty(),$(".expenses-total").text(""),$(".append-oe").empty(""),$(".oe-total").text("");var y="",C="";if(f=0,g=0,Object.keys(o).length===0){r.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var O=!1,D=!1;if($.each(o,(q,z)=>{var k=q.split("_"),b=k[2];b==="Less Direct Cost"?O=!0:b==="Operating Expenses"&&(D=!0)}),!O||!D){r.fire({icon:"warning",title:"Missing Data",text:'Both "Less Direct Cost" and "Operating Expenses" entries are required.'});return}$.each(o,(q,z)=>{var k=q.split("_"),b=k[2],P=0,I=0;if(b==="Less Direct Cost"){$.each(z.months,(M,ie)=>{var ae=ie.value.replace(/,/g,""),ue=parseFloat(ae);P+=ue});var U=P.toLocaleString();f+=P,y+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${k[1]}</div>
                        <div class="col-sm-6 text-right">${U}</div>
                    </div>
                    `}else if(b==="Operating Expenses"){$.each(z.months,(M,ie)=>{var ae=ie.value.replace(/,/g,""),ue=parseFloat(ae);I+=ue});var V=I.toLocaleString();g+=I,C+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${k[1]}</div>
                        <div class="col-sm-6 text-right">${V}</div>
                    </div>
                    `}});var N=v-f,p=N-g;w=p,$(".gries-total").text(N.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".tgi").text(N.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".expenses-total").text(f.toLocaleString()),$(".append-ldc").append(y),$(".append-oe").append(C),$(".oe-total").text(g.toLocaleString()),$(".net-amount").text(p.toLocaleString())}if(i===3){var d=0,x=0,m=0,R=0;if($(".append-ca").html(""),$(".append-nca").html(""),$(".append-fa").html(""),Object.keys(e).length===0){r.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(e,(q,z)=>{q.split("_")[0]==="Current Asset"&&$.each(z.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),I=parseFloat(P);m+=I,$(".total-ca").text(m.toLocaleString()),$(".append-ca").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)}),q.split("_")[0]==="Non-Current Assets"&&$.each(z.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),I=parseFloat(P);x+=I,$(".tnca-amount").text(x.toLocaleString()),$(".append-nca").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)}),q.split("_")[0]==="Fixed Assets"&&$.each(z.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),I=parseFloat(P);R+=I,$(".append-fa").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)})}),d=m+x+R,$(".total-assets").text(d.toLocaleString())}if(i===4){console.log(t);var A="",E=0;if(Object.keys(t).length===0){r.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(t,(q,z)=>{$.each(z.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),I=parseFloat(P);E+=I,console.log(E),A+=`
                    <div class="d-flex justify-content-between">
                        <span class="fw-normal">${b.liabilityAccount.split("_")[0]}</span>
                        <span class="fw-normal">${b.amount}</span>
                    </div>
                    `})}),T+=E,$(".append-cl").html(A)}if(i===5){var L="",_=0;if(Object.keys(n).length===0){r.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(n,(q,z)=>{$.each(z.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),I=parseFloat(P);_+=I,console.log(_),L+=`
                <div class="d-flex justify-content-between">
                <span class="fw-normal">${b.oeAccount.split("_")[0]}</span>
                <span class="fw-normal">${b.amount}</span>
            </div>
                `})}),T+=_,$(".append-oenw").html(L)}if(i===6){$(".tlc").text(T.toLocaleString());var F=0,Q=!0,J=$(".journal-adjustments-form").serializeArray();if($.each(J,(q,z)=>{var k=$(`.journal-adjustments-form [name='${z.name}']`);z.value.trim()===""?(Q=!1,k.addClass("is-invalid")):(k.removeClass("is-invalid"),s[z.name]=z.value)}),!Q){r.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}$.each(s,(q,z)=>{var k=z.replace(/,/g,""),b=parseFloat(k);q==="owners_withdrawal"&&$(".less-drawings").text(b.toLocaleString()),q==="owners_capital"&&(F+=b),q!=="owners_withdrawal"&&q!=="owners_capital"&&(F+=b)}),$(".additional-capital").text(F.toLocaleString()),$(".fp-nc").text(w.toLocaleString());var W=F+w;$(".appraisal-capital").text(W.toLocaleString());var G=W-parseFloat($(".less-drawings").text().replace(/[^0-9.-]+/g,""));$(".capital-end").text(G.toLocaleString())}i<7&&($(".multi-step-journal").hide(),i++,X(i)),K(i),i===7?($(".next-btn").hide(),$(".save-btn").show()):($(".next-btn").show(),$(".save-btn").hide()),i===1?$(".prev-btn").hide():$(".prev-btn").show()}),$(".prev-btn").on("click",function(){i>1&&($(".multi-step-journal").hide(),i--,X(i)),K(i),$(".next-btn").show(),$(".save-btn").hide(),i===1?$(".prev-btn").hide():$(".prev-btn").show()});function X(j){$(".multi-step-journal").hide(),$(".multi-step-journal").eq(j-1).show()}function K(j){$(".step").removeClass("active"),$(".indicator-line").removeClass("active"),$(".step").each(function(h){h<j&&($(this).addClass("active"),$(this).next(".indicator-line").addClass("active"))})}X(i),K(i),i===1&&$(".prev-btn").hide(),$(".save-journal-btn").click(function(){var j={incomeObj:a,expensesObj:o,assetObj:e,liabilityObj:t,oeObj:n,adjustmentObj:s,client_id:$(this).attr("id").split("_")[1]};Oe("new-client-journal-entry",j,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},h,S);function h(y){console.log(y),localStorage.setItem("journal","created"),location.reload()}function S(y,C,O){console.log(y)}});var B=localStorage.getItem("journal");B==="created"&&(r.fire({icon:"success",title:"Journal Entry",text:"New Journal Entry Saved"}),localStorage.removeItem("journal"))});var ne=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),me=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".save-account-type").on("click",function(){var c=$(".new-account-type-form").serializeArray(),u={},o=!0;if($.each(c,(e,t)=>{if(t.value===""){o=!1,$(`.new-account-type-form [name='${t.name}']`).addClass("is-invalid"),ne.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"});return}else u[t.name]=t.value,$(`.new-account-type-form [name='${t.name}']`).removeClass("is-invalid"),console.log(u)}),o){let e=function(n){console.log(n),localStorage.setItem("account-type","created"),location.reload()},t=function(n,s,v){$(".loader-container").addClass("visually-hidden");try{const f=JSON.parse(n.responseText);console.log("Parsed Response:",f),me.fire({icon:"warning",title:"Conflict",text:f.error})}catch(f){console.log("Could not parse JSON response:",f)}};var l=e,a=t;$(".loader-container").removeClass("visually-hidden"),Se("new-account-type",u,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t)}}),$(".save-account").on("click",function(){var c=$("#account-form").serializeArray(),u={},o=!0;if(console.log(c),$.each(c,(e,t)=>{if($(`#account-form [name='${t.name}']`).addClass("is-invalid"),t.value===""){ne.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"}),o=!1;return}else $(`#account-form [name='${t.name}']`).removeClass("is-invalid"),u[t.name]=t.value}),o){let e=function(n){localStorage.setItem("account","created"),location.reload()},t=function(n,s,v){$(".loader-container").addClass("visually-hidden");try{const f=JSON.parse(n.responseText);console.log("Parsed Response:",f),me.fire({icon:"warning",title:"Conflict",text:f.error})}catch(f){console.log("Could not parse JSON response:",f)}};var l=e,a=t;$(".loader-container").removeClass("visually-hidden"),we("new-account",u,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t)}}),$(".edit-coa").click(function(c){c.preventDefault();var u=$(this).attr("id"),o=$(`#edit-coa-form-${u}`).serializeArray(),l=!0,a={};$.each(o,(e,t)=>{if(t.value===""){$(`.edit-coa-form-${u} [name='${t.name}']`).addClass("is-invalild"),l=!1,ne.fire({icon:"warning",title:"Missing Field!",text:"Please fill all fields"});return}$(`.edit-coa-form-${u} [name='${t.name}']`).removeClass("is-invalild"),a[t.name]=t.value}),l&&$.ajax({type:"POST",url:"edit-coa",data:a,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){localStorage.setItem("account","updated"),location.reload()},error:function(e,t,n){try{const s=JSON.parse(e.responseText);console.log("Parsed Response:",s),me.fire({icon:"warning",title:"Conflict",text:s.message})}catch(s){console.log("Could not parse JSON response:",s)}}})});var i=localStorage.getItem("account-type"),r=localStorage.getItem("account");if(i==="created"){ne.fire({icon:"success",title:"New Account Type created!"}),localStorage.removeItem("account-type");return}if(r==="created"){localStorage.removeItem("account"),ne.fire({icon:"success",title:"New Account created!"}),localStorage.removeItem("account-type");return}if(r==="updated"){localStorage.removeItem("account"),ne.fire({icon:"success",title:"Account updated!"}),localStorage.removeItem("account-type");return}});$(document).ready(function(){var i=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),r=Swal.mixin({toast:!1,position:"bottom-end"});$(".new-user-save").on("click",function(u){var o=$(".new-user-form").serializeArray(),l={},a=!0;if($.each(o,(n,s)=>{if(s.value===""){a=!1,$(`.new-user-form [name='${s.name}']`).addClass("is-invalid"),i.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}else l[s.name]=s.value,$(`.new-user-form [name='${s.name}']`).removeClass("is-invalid")}),a){let n=function(v){localStorage.setItem("user","created"),location.reload()},s=function(v,f,g){try{const w=JSON.parse(v.responseText);console.log("Parsed Response:",w),r.fire({icon:"warning",title:"Conflict",text:w.message})}catch(w){console.log("Could not parse JSON response:",w)}};var e=n,t=s;Ce("new-user",l,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},n,s)}}),$(".remove-user").on("click",function(){var u=$(this).attr("id");$.ajax({url:`remove-user-${u}`,type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(o){console.log(o),localStorage.setItem("user","removed"),location.reload()},error:function(o,l,a){console.log(o)}})}),$(".edit-user-button").on("click",function(){var u=$(".edit-user-form").serializeArray(),o=!0,l={};$.each(u,(a,e)=>{if(e.value===""){o=!1,$(`[name='${e.name}']`).addClass("is-invalid"),i.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}else l[e.name]=e.value,$(`[name='${e.name}']`).removeClass("is-invalid")}),o&&$.ajax({url:"update-user",type:"POST",data:l,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){localStorage.setItem("user","updated"),location.reload()},error:function(a,e,t){r.fire({icon:"error",title:"Fatal Error!",text:"Try reloading the page, if issue persist contact developer"})}})});var c=localStorage.getItem("user");c==="created"&&(i.fire({icon:"success",title:"User Created!",text:"User created successfuly"}),localStorage.removeItem("user")),c==="removed"&&(i.fire({icon:"success",title:"User Removed!",text:"User removed successfuly"}),localStorage.removeItem("user")),c==="updated"&&(i.fire({icon:"success",title:"User Updated!",text:"User Updated successfuly"}),localStorage.removeItem("user")),$(".search-users").on("keyup",function(){var u=$(this).val().toLowerCase();$(".users-table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(u)>-1)})}),$("#filter-users").on("change",function(){var u=$(this).val();$(".users-table tbody tr").each(function(){var o=$(this).data("category");u==="clear"?$(this).show():u===""||o===u?$(this).show():$(this).hide()})})});$(document).ready(function(){var i=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),r=Swal.mixin({toast:!1,position:"bottom-end"});$("#account-category").on("change",function(a){$("#billing-account-type").prop("disabled",!1),$.ajax({type:"POST",url:`get-account-types-${$(this).val()}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){console.log(e);let t='<option value="" selected hidden>Select Type</option>',n=!1;$.each(e,(s,v)=>{$.each(v,(f,g)=>{Object.keys(g).length>0&&(t+=`<option value="${g.id}">${g.ServiceRequirements}</option>`,n=!0)})}),n||(t='<option value="" selected hidden>Category has no type</option>'),$("#billing-account-type").html(t)},error:function(e){console.error(e),r.fire({icon:"error",title:"Error",text:`Could not load account types: ${e.responseText||e.statusText}`})}})}),$(document).on("change",'[id^="edit-account-category-"]',function(a){let e=$(this).attr("id").split("-").pop(),t=`#edit-billing-account-type-${e}`;console.log($(this).val()),console.log("Fetching types for modal:",e),$.ajax({type:"POST",url:`get-account-types-${$(this).val()}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){console.log(n);let s='<option value="" selected hidden>Select Type</option>',v=!1;$.each(n,(f,g)=>{$.each(g,(w,T)=>{Object.keys(T).length>0&&(s+=`<option value="${T.id}">${T.ServiceRequirements}</option>`,v=!0)})}),v||(s='<option value="" selected hidden>Category has no type</option>'),$(t).html(s)},error:function(n){console.error(n),r.fire({icon:"error",title:"Error",text:`Could not load account types: ${n.responseText||n.statusText}`})}})}),$(".edit-description").on("click",function(a){var e=$(this).attr("id").split("-").pop();a.preventDefault();var t={},n=$(`.update-description-form-${e}`).serializeArray(),s=!0;$.each(n,(v,f)=>{f.value===""&&(s=!1,i.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"}),$(`.update-description-form-${e} [name='${f.name}']`).addClass("is-invalid")),$(`.update-description-form-${e} [name='${f.name}']`).removeClass("is-invalid"),t[f.name]=f.value}),console.log(t),s&&$.ajax({type:"POST",url:"update/account-description",data:t,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(v){localStorage.setItem("account_description","updated"),location.reload()},error:function(v,f,g){r.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+v.responseText})}})}),$(".remove-description").on("click",function(){$.ajax({type:"POST",url:`remove/account-description/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){localStorage.setItem("account_description","removed"),location.reload()},error:function(a,e,t){r.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+a.responseText})}})}),$(".remove-coa").on("click",function(){$.ajax({type:"POST",url:`remove/coa/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){localStorage.setItem("coa","removed"),location.reload()},error:function(a,e,t){r.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+a.responseText})}})}),$(".save-account-description").on("click",function(a){var e=$(".account-description-form").serializeArray(),t={},n=!0;if($.each(e,(f,g)=>{if(g.value===""){$(`.account-description-form [name="${g.name}"]`).addClass("is-invalid"),i.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),n=!1;return}else t[g.name]=g.value,console.log(t),$(`.account-description-form [name="${g.name}"]`).removeClass("is-invalid")}),n){let f=function(w){localStorage.setItem("account_description","created"),location.reload()},g=function(w,T,X){try{const K=JSON.parse(w.responseText);console.log("Parsed Response:",K),r.fire({icon:"error",title:"Error",text:K.message})}catch(K){console.log("Could not parse JSON response:",K)}};var s=f,v=g;Fe("new-account-description",t,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},f,g)}}),$(".edit-sys-profile").on("click",function(a){a.preventDefault();var e=!0,t={},n=$("#sys-profile-form").serializeArray();$.each(n,(s,v)=>{v.value.trim()===""?(e=!1,$(`.sys-profile-form [name='${v.name}']`).addClass("is-invalid"),i.fire({icon:"warning",title:"Missing fields",text:"Please fill all fields"})):$(`.sys-profile-form [name='${v.name}']`).removeClass("is-invalid"),t[v.name]=v.value}),e&&$.ajax({type:"POST",url:"edit-sys-info",data:t,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(s){localStorage.setItem("system-profile","updated"),location.reload()},error:function(s,v,f){try{const g=JSON.parse(s.responseText);console.log("Parsed Response:",g),r.fire({icon:"error",title:"Error",text:g.message})}catch(g){console.log("Could not parse JSON response:",g)}}})}),$(".edit-user-privilege").on("click",function(a){a.preventDefault();var e=$(this).attr("id");console.log(e),$.ajax({url:`/users/toggle-privilege/${e}`,type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(t){localStorage.setItem("user_privilege_updated",t.message),location.reload()},error:function(t){i.fire({icon:"error",title:"An error occurred while updating the privilege."})}})});var c=localStorage.getItem("account_description"),u=localStorage.getItem("system-profile"),o=localStorage.getItem("coa"),l=localStorage.getItem("user_privilege_updated");c==="created"&&(i.fire({icon:"success",title:"Account Description Created!"}),localStorage.removeItem("account_description")),c==="removed"&&(i.fire({icon:"success",title:"Account Description Removed!"}),localStorage.removeItem("account_description")),c==="updated"&&(i.fire({icon:"success",title:"Account Description Updated!"}),localStorage.removeItem("account_description")),u==="updated"&&(i.fire({icon:"success",title:"System Profile Updated"}),localStorage.removeItem("system-profile")),o==="removed"&&(i.fire({icon:"success",title:"Account Removed"}),localStorage.removeItem("coa")),l&&(i.fire({icon:"success",title:l}),localStorage.removeItem("user_privilege_updated"))});var ce=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),ve=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".update-client-service-progress-btn").on("click",function(){var c=$(this).attr("id"),u=$(`.update-service-progress-${c}`).serializeArray();console.log(u),$.ajax({type:"POST",url:"update-client-service",data:{serviceId:c,serviceVal:u},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(o){localStorage.setItem("service","updated"),location.reload()},error:function(o,l,a){try{const e=JSON.parse(o.responseText);console.log("Parsed Response:",e),ve.fire({icon:"warning",title:"Conflict",text:e.Conflict})}catch(e){console.log("Could not parse JSON response:",e)}}})}),$(".edit-company-info").on("click",function(c){var u=$(`.edit-company-info-${$(this).attr("id")}`).serializeArray(),o=!0,l={};$.each(u,(a,e)=>{e.value===""&&(o=!1,$(`.edit-company-info-${$(this).attr("id")} [name='${e.name}']`).addClass("is-invalid"),ce.fire({icon:"warning",title:"Missingg Fields",text:"Please fill all fields"})),l[e.name]=e.value}),o&&$.ajax({type:"POST",url:"update-company-info",data:l,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){localStorage.setItem("company-info","updated"),location.reload()},error:function(a,e,t){ve.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+a})}})}),$(".remove-client-service").on("click",function(){$.ajax({type:"POST",url:`client-profile/service/remove/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(c){localStorage.setItem("service","removed"),location.reload()},error:function(c,u,o){ve.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+c})}})});var i=localStorage.getItem("company-info"),r=localStorage.getItem("service");r==="updated"&&(ce.fire({icon:"success",text:"Client Service Updated"}),localStorage.removeItem("service")),r==="removed"&&(ce.fire({icon:"success",text:"Client Service Removed"}),localStorage.removeItem("service")),i==="updated"&&(localStorage.removeItem("company-info"),ce.fire({icon:"success",text:"Company Info Updated"}))});$(document).ready(function(){var i=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),r=Swal.mixin({toast:!1,position:"bottom-end"}),c=0,u=window.servicesData;console.log(u);var o={Service:[]},l={SubService:[]},a={accounts:[]};$.each(u,(e,t)=>{$.each(t.Service,(n,s)=>{o.Service.push({Service:{service_name:n,service_id:Object.keys(s.parent_service_id)[0],service_price:s.parent_service_id[Object.keys(s.parent_service_id)[0]].parentServicePrice}}),s.sub_service&&$.each(s.sub_service,(v,f)=>{$.each(f,(g,w)=>{$.each(w,(T,X)=>{$.each(X.account_descriptions,(K,B)=>{a.accounts.push({Accounts:{Account:B.Description,account_id:B.adID.toLocaleString(),price:B.Price}})})})}),$.each(f.sub_service_id,g=>{let w=Object.keys(f.sub_service_id)[0],T=f.sub_service_id[w].sub_service_price;l.SubService.push({SubService:{sub_service_name:v,sub_service_id:g,sub_service_price:T}})})})})}),$(".price").each(function(){var e=$(this).text(),t=e.replace(/[^\d.-]/g,""),n=parseFloat(t);c+=n}),$(".remove-parent-service-billing-action").click(function(){var e=$(this).attr("id").split("_")[1],t=$(this).closest("tr").find("td:nth-last-child(2)").text(),n=t.replace(/[^\d.-]/g,""),s=parseFloat(n);c-=s,$(".overall-due").text(c.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(c.toLocaleString(void 0,{minimumFractionDigits:2}));var v=o.Service.findIndex(f=>f.Service.service_id===e);console.log("Service ID to remove:",e),v!==-1?(o.Service.splice(v,1),$(this).closest("tr").remove()):console.log("Service not found")}),$(".remove-sub-service-billing-action").click(function(){var e=$(this).attr("id").split("_")[1],t=$(this).closest("tr").find("td:nth-last-child(2)").text(),n=t.replace(/[^\d.-]/g,""),s=parseFloat(n);c-=s,$(".overall-due").text(c.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(c.toLocaleString(void 0,{minimumFractionDigits:2}));var v=l.SubService.findIndex(f=>f.SubService.sub_service_id===e);v!==-1&&(l.SubService.splice(v,1),$(this).closest("tr").remove())}),$(document).on("click",".remove-account-description-billing-action",function(){var e=$(this).attr("id").split("_")[1],t=$(this).closest("tr").find("td:nth-last-child(2)").text(),n=t.replace(/[^\d.-]/g,""),s=parseFloat(n),v=0;v=s-s,c-=s,$("#additional-description-subtotal").text(v.toLocaleString(void 0,{minimumFractionDigits:2})),$(".overall-due").text(c.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(c.toLocaleString(void 0,{minimumFractionDigits:2}));var f=a.accounts.findIndex(g=>g.Accounts.account_id===e);f!==-1?(a.accounts.splice(f,1),$(this).closest("tr").remove(),console.log(a)):console.log("Account not found")}),console.log(a),$(".add-description").on("click",function(){var e=0,t=$(this).closest("tr"),n=t.data("service"),s=t.data("requirements"),v=t.data("category"),f=t.data("description"),g=t.data("taxtype"),w=t.data("formtype"),T=t.data("price"),X=t.data("id"),K=T.replace(/[^\d.-]/g,""),B=parseFloat(K),j=B.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"),h=a.accounts.some(y=>y.Accounts.Account===f);if(h)i.fire({icon:"warning",title:"Conflict",text:"Account Description already exists!"});else{a.accounts.push({Accounts:{Account:f,account_id:t.attr("id").toLocaleString(),price:T,isAdded:!0}}),c+=B,e+=B,$("#additional-description-subtotal").text(e.toLocaleString(void 0,{minimumFractionDigits:2})),$(".overall-due").text(c.toLocaleString(void 0,{minimumFractionDigits:2}));var S=`
            <tr>
                <td>${n}</td>
                <td>${s}</td>
                <td>${v}</td>
                <td>${f}</td>
                <td>${g}</td>
                <td>${w}</td>
                <td>${j}</td>
                <td>
                    <span class="badge fw-bold text-light bg-danger remove-account-description-billing-action" id='${X}'><i class="fas fa-trash"></i></span>
                </td>
            </tr>
        `;$(".append-ad").append(S)}}),$(".mail-client-bs").click(function(){var e=$("#dd").val(),t=$(".billing-id").text(),n=$(".date").text(),s=$(this).attr("id");if(console.log(o),e===""||e===void 0){$("#dd").addClass("is-invalid"),i.fire({icon:"warning",title:"Missing Field",text:"Please add due date before proceeding"});return}$("#dd").removeClass("is-invalid");var v={dueDate:e,date:n,serviceObj:o,subServiceObj:l,accountDescriptions:a,refID:s,billingId:t};Te("mail-client-billing",v,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},function(f){i.fire({icon:"success",title:"Billing Created",text:"Billing successfully created"})},function(f,g,w){try{const T=JSON.parse(f.responseText);r.fire({icon:"warning",title:"Conflict",text:T.Message})}catch(T){console.log("Could not parse JSON response:",T)}})})});var le=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),De=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".view-journal-btn").on("click",function(i){var r=$(this).attr("id");$.ajax({type:"POST",url:`view-client-journal-${r}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(c){console.log(c);var u=new Blob([c],{type:"application/pdf"}),o=URL.createObjectURL(u);window.open(o,"_blank")},error:function(c,u,o){De.fire({icon:"error",title:"Oops Something went wrong!",text:c.responseJSON?c.responseJSON.error:"Unknown error"})}})}),$(".gen-client-billing-pdf").click(function(){$.ajax({type:"POST",url:`client-billing-data_${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(i){var r=new Blob([i],{type:"application/pdf"}),c=URL.createObjectURL(r);window.open(c,"_blank")},error:function(i,r,c){le.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".gen-expense-pdf").on("click",function(){$.ajax({type:"POST",url:"expense/pdf/expense",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(i){var r=new Blob([i],{type:"application/pdf"}),c=URL.createObjectURL(r);window.open(c,"_blank")},error:function(i,r,c){le.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".income-gen-pdf").on("click",function(){$.ajax({type:"POST",url:"income/pdf/income",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(i){var r=new Blob([i],{type:"application/pdf"}),c=URL.createObjectURL(r);window.open(c,"_blank")},error:function(i,r,c){le.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".generate-client-billing-pdf").on("click",function(){$.ajax({type:"POST",url:`client/billing/pdf/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(i){var r=new Blob([i],{type:"application/pdf"}),c=URL.createObjectURL(r);window.open(c,"_blank")},error:function(i,r,c){le.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})})});var de=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),Re=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".journal-pin-entry").on("submit",function(r){r.preventDefault();var c=$(this).serializeArray(),u=!0;$.each(c,(o,l)=>{l.value===""?(de.fire({icon:"warning",title:"Missing PIN",text:"Please enter PIN"}),u=!1,$(`[name='${l.name}']`).addClass("is-invalid")):$(`[name='${l.name}']`).remove("is-invalid")}),u&&$.ajax({type:"POST",url:"journal-pin-entry",data:c,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var l=new Blob([o],{type:"application/pdf"}),a=URL.createObjectURL(l);window.open(a,"_blank"),console.log("asdasd")},error:function(o,l,a){o.status===400?de.fire({icon:"error",title:o.statusText,text:"Incorrect PIN"}):de.fire({icon:"error",title:"Something went wrong",text:"Fatal error. Translated: "+l})}})}),$(".request-journal-pin").click(function(){$.ajax({type:"POST",url:`request-journal-pin_${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){console.log(r)},error:function(r,c,u){console.log(r)}})}),$(".remove-journal-entry").click(function(){$.ajax({type:"POST",url:`archive-journal-entry-${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){localStorage.setItem("journal","Removed"),location.reload()},error:function(r,c,u){Re.fire({icon:"error",title:"Oops! Something went wrong",text:"Error Translated: "+r})}})});var i=localStorage.getItem("journal");i==="Removed"&&(localStorage.removeItem("journal"),de.fire({icon:"success",title:"Journal Update",text:"Journal Successfully removed"}))});var _e=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});$(document).ready(function(){$('select[name="JournalStatus"]').on("change",function(){var i=$(this).closest(".modal"),r=i.find(".journal-draft-note");$(this).val()==="Rejected"||$(this).val()==="Canceled"?r.removeClass("visually-hidden"):r.addClass("visually-hidden").val("")}),$(".update-journal-status").on("click",function(){var i=$(this).attr("id");console.log(i);var r=$(`#update-journal-status-${i}`),c=r.find(`#serviceprogress-${i}`).val(),u=r.find(`#note-${i}`);if((c==="Canceled"||c==="Rejected")&&u.val().trim()===""){Swal.fire({icon:"error",title:"Validation Error",text:'Please provide a note when the status is "Canceled" or "Rejected".'}),u.addClass("is-invalid");return}var o=$(`.update-journal-status-form-${i}`).serializeArray();$.ajax({type:"POST",url:"/update-journal-status",data:o,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(l){localStorage.setItem("journal-status","updated"),location.reload()},error:function(l){console.error(l)}})}),localStorage.getItem("journal-status")==="updated"&&(_e.fire({icon:"success",title:"Journal Status Updated",text:"Journal status updated successfully"}),localStorage.removeItem("journal-status"))});var H=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),oe=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){let i=1;var r=window.journalIncome,c=window.journalExpense,u=window.journalAssets,o=window.journalLiability,l=window.journalOE,a=r,e=c,t={},n={},s={},v={};$.each(u,(p,d)=>{const x=[];x.push({assetAccount:d.account,amount:d.amount}),t[d.asset_category]={accounts:x}}),$.each(o,(p,d)=>{const x=[];var m=d.AccountType;x.push({liabilityAccount:d.account,amount:d.amount}),n[m]={accounts:x}}),$.each(l,(p,d)=>{const x=[];var m=d.AccountType;x.push({oeAccount:d.account,amount:d.amount}),s[m]={accounts:x}});let f="";$("#audit-income-category").on("change",function(){f=$(this).val(),$(".audit-income-form").removeClass("visually-hidden"),$(".saved-audited-income-months").empty()}),$("#audit-expense-category").on("change",function(){f=$(this).val(),$(".audit-expense-form").removeClass("visually-hidden"),$(".saved-audited-expense-months").empty()}),$(".audit-income-start-date, .audit-income-end-date").on("change",function(){const p=$(".audit-income-start-date").val(),d=$(".audit-income-end-date").val();if($("#audit-income-category").val()===""){H.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(p&&d){const m=new Date(p),R=new Date(d),A=$(".audit-income-months-container");var x='<div class="row">';if((R.getFullYear()-m.getFullYear())*12+(R.getMonth()-m.getMonth())>12){oe.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const L=new Date(m);if(L.setMonth(L.getMonth()+11),R>L){oe.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}A.empty(),x+="";let _=new Date(m);for(;_<=R;){const F=_.toLocaleString("default",{month:"long",year:"numeric"});x+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control audit-income-month-input" name="${F}" id="" placeholder='${F}' value="">
                    </div>
                    </div>`,_.setMonth(_.getMonth()+1)}x+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-income-audit-months form-control">Save</button>
            </div>`,x+="</div>",A.html(x)}$(document).on("input",".audit-income-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-income-audit-months",function(p){p.preventDefault();let d=[],x=!0;if(a.hasOwnProperty(f)){H.fire({icon:"warning",title:"Account Already Exists!",text:"You have already added this account."}),$(".audit-income-end-date").val(""),$(".audit-income-start-date").val(""),$(".audit-income-months-container").empty(),console.log(!0);return}if($(".audit-income-month-input").each(function(){var m=$(this).attr("name");console.log(m);var R=$(this).val();R!==""&&(x=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),d.push({incomeMonthName:m,value:$(this).val(),startDate:$(".audit-income-start-date").val(),endDate:$(".audit-income-end-date").val()}))}),x){$(".audit-income-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),H.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}a[f]={months:d,startDate:$(".audit-income-start-date").val(),endDate:$(".audit-income-end-date").val()},$("#saved-audited-income-months").empty(),$.each(a,(m,R)=>{var A='<table class="table table-hover client-journal-accounts">',E=m.split("_");A+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${E[1]}
                        <span class="text-sm fw-bold float-right remove-audit-income" id="${m}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(R.months,(L,_)=>{A+=`
                    <tr>
                        <td class='text-left'>${_.incomeMonthName}</td>
                        <td class='text-left'>${_.value}</td>
                    </tr>
                `}),A+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,A+="</table>",$("#saved-audited-income-months").append(A)}),$(".audit-income-months-container").empty(),$("#audit-income-category").val(""),$(".audit-income-end-date").val(""),$(".audit-income-start-date").val(""),f="",x=!0,console.log(a)}),$(".audit-expense-start-date, .audit-expense-end-date").on("change",function(){const p=$(".audit-expense-start-date").val(),d=$(".audit-expense-end-date").val();if($("#audit-expense-category").val()===""){H.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(p&&d){const m=new Date(p),R=new Date(d),A=$(".audit-expense-months-container");var x='<div class="row">';if((R.getFullYear()-m.getFullYear())*12+(R.getMonth()-m.getMonth())>12){oe.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const L=new Date(m);if(L.setMonth(L.getMonth()+11),R>L){oe.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}A.empty(),x+="";let _=new Date(m);for(;_<=R;){const F=_.toLocaleString("default",{month:"long",year:"numeric"});x+=`<div class="col-sm-6 my-2">
                <div class="input-group">
                <input type="text" class="form-control audit-expense-month-input" name="${F}" id="" placeholder='${F}' value="">
                </div>
                </div>`,_.setMonth(_.getMonth()+1)}x+=`
        <div class="col-sm-6 my-2 text-right">
            <button type='button' class="btn btn-primary save-expense-audit-months form-control">Save</button>
        </div>`,x+="</div>",A.html(x)}$(".audit-expense-months-container").on("input",".audit-expense-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-expense-audit-months",function(p){p.preventDefault();let d=[],x=!0;if(e.hasOwnProperty(f)){H.fire({icon:"warning",title:"Account Already Exists!",text:"You have already added this account."}),$(".audit-iexpensencome-end-date").val(""),$(".audit-expense-start-date").val(""),$(".audit-expense-months-container").empty();return}if($(".audit-expense-month-input").each(function(){var m=$(this).attr("name"),R=$(this).val();R!==""&&(x=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),d.push({expenseMonthName:m,value:$(this).val(),startDate:$(".audit-expense-start-date").val(),endDate:$(".audit-expense-end-date").val()}))}),x){$(".audit-expense-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),H.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}e[f]={months:d,startDate:$(".audit-expense-start-date").val(),endDate:$(".audit-expense-end-date").val()},$("#saved-audited-expense-months").empty(),$.each(e,(m,R)=>{var A='<table class="table table-hover client-journal-accounts">',E=m.split("_");A+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${E[1]}
                        <span class="text-sm fw-bold float-right remove-audit-expense" id="${m}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(R.months,(L,_)=>{A+=`
                    <tr>
                        <td class='text-left'>${_.expenseMonthName}</td>
                        <td class='text-left'>${_.value}</td>
                    </tr>
                `}),A+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,A+="</table>",$("#saved-audited-expense-months").append(A)}),$(".audit-expense-months-container").empty(),$("#audit-expense-category").val(""),$(".audit-expense-end-date").val(""),$(".audit-expense-start-date").val(""),f="",x=!0}),$(".save-audit-asset-info").on("click",function(p){p.preventDefault();var d=$(".journal-audit-asset-form").serializeArray(),x="",m="",R="";let A=!1;if($.each(d,(_,F)=>{if(F.value==="")return $(`[name='${F.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${F.name}']`).removeClass("is-invalid"),F.name==="assetType"?x=F.value:F.name==="assetAccount"?m=F.value:F.name==="assetAmount"&&(R=F.value)}),!x||!m||!R){console.error("Required fields are missing.");return}if($.each(t,(_,F)=>{if($.each(F.accounts,(Q,J)=>{if(J.assetAccount===m.split("_")[0])return A=!0,!1}),A)return!1}),A)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var E=x.split("_");t[E[0]]||(t[E[0]]={accounts:[]}),t[E[0]].accounts.push({assetAccount:m.split("_")[0],amount:R}),$(".append-audit-asset-accounts").empty();let L="";$.each(t,(_,F)=>{$.each(F.accounts,(Q,J)=>{var W=J.amount,G=W.toString().replace(/,/g,""),q=parseFloat(G).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});L+=`
            <tr id="${_}">
                <td class='text-sm'>${_}</td>
                <td class='text-sm'>${J.assetAccount}</td>
                <td class='text-sm'>
                    ${q}
                    <span class="badge fw-bold text-dark float-right remove-audited-asset" id="${J.assetAccount}">
                        <i class="fas fa-times"></i>
                    </span>
                </td>
            </tr>`})}),$(".append-audit-asset-accounts").append(L),$("#asset_account").val(""),$("#asset_account_name  option:first").text("Select Account"),$("#assetAmount").val(""),A=!1}),$(".save-audit-liability-info").on("click",function(p){p.preventDefault();var d=$(".journal-audit-liability-form").serializeArray(),x="",m="",R="";let A=!1;if($.each(d,(_,F)=>{if(F.value==="")return $(`[name='${F.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${F.name}']`).removeClass("is-invalid"),F.name==="audit-liability-account"?x=F.value:F.name==="audit-liability-account-name"?m=F.value:F.name==="liability-amount"&&(R=F.value)}),!x||!m||!R){console.error("Required fields are missing.");return}if($.each(n,(_,F)=>{if($.each(F.accounts,(Q,J)=>{if(J.liabilityAccount===m.split("_")[0])return A=!0,!1}),A)return!1}),A)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var E=x.split("_");n[E[0]]||(n[E[0]]={accounts:[]}),n[E[0]].accounts.push({liabilityAccount:m.split("_")[0],amount:R}),$(".append-audit-liability-accounts").empty();let L="";$.each(n,(_,F)=>{$.each(F.accounts,(Q,J)=>{var W=J.amount,G=W.toString().replace(/,/g,""),q=parseFloat(G).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});L+=`
                <tr id="${_}">
                    <td class='text-sm'>${_}</td>
                    <td class='text-sm'>${J.liabilityAccount}</td>
                    <td class='text-sm'>
                        ${q}
                        <span class="badge fw-bold text-dark float-right remove-audit-liability" id="${J.liabilityAccount}">
                            <i class="fas fa-times"></i>
                        </span>
                    </td>
                </tr>`})}),$(".append-audit-liability-accounts").append(L),$("#liability_account").val(""),$("#liability_account_name  option:first").text("Select Account"),$("#liabilityAmount").val(""),A=!1}),$(".save-audit-oe-info").on("click",function(p){p.preventDefault();var d=$(".journal-audit-oe-form").serializeArray(),x="",m="",R="";let A=!1;if($.each(d,(_,F)=>{if(F.value==="")return $(`[name='${F.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${F.name}']`).removeClass("is-invalid"),F.name==="oe-account"?x=F.value:F.name==="oe-account-name"?m=F.value:F.name==="oe-amount"&&(R=F.value)}),!x||!m||!m){console.error("Required fields are missing.");return}if($.each(s,(_,F)=>{if($.each(F.accounts,(Q,J)=>{if(J.oeAccount===m.split("_")[0])return A=!0,!1}),A)return!1}),A)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var E=x.split("_");s[E[0]]||(s[E[0]]={accounts:[]}),s[E[0]].accounts.push({oeAccount:m.split("_")[0],amount:R}),$(".append-audit-oe-accounts").empty();let L="";$.each(s,(_,F)=>{$.each(F.accounts,(Q,J)=>{var W=J.amount,G=W.toString().replace(/,/g,""),q=parseFloat(G).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});L+=`
            <tr id="${_}">
                <td class='text-sm'>${_}</td>
                <td class='text-sm'>${J.oeAccount}</td>
                <td class='text-sm'>
                    ${q}
                    <span class="badge fw-bold text-dark float-right remove-audit-oe" id="${_}">
                        <i class="fas fa-times"></i>
                    </span>
                </td>
            </tr>`})}),$(".append-audit-oe-accounts").append(L),$("#oe-account").val(""),$("#oe-account-name  option:first").text("Select Account"),$("#oeAmount").val(""),A=!1}),$(document).on("click",".remove-audit-income",function(){$(this).closest("tr").remove();var p=$(this).attr("id");delete a[p],$("#saved-audited-income-months").empty(),$.each(a,(d,x)=>{var m='<table class="table table-hover client-journal-accounts">',R=d.split("_");m+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${R[1]}
                        <span class="text-sm fw-bold float-right remove-audit-income" id="${d}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(x.months,(A,E)=>{m+=`
                    <tr>
                        <td>${E.incomeMonthName}</td>
                        <td>${E.value}</td>
                    </tr>
                `}),m+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,m+="</table>",$("#saved-audited-income-months").append(m)}),console.log(a)}),$(document).on("click",".remove-audit-expense",function(p){delete e[$(this).attr("id")],$(this).closest("tr").remove(),$("#saved-audited-expense-months").empty(),$.each(e,(d,x)=>{var m='<table class="table table-hover client-journal-accounts">',R=d.split("_");m+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${R[1]}
                        <span class="text-sm fw-bold float-right remove-audit-expense" id="${d}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(x.months,(A,E)=>{m+=`
                    <tr>
                        <td class='text-left'>${E.expenseMonthName}</td>
                        <td class='text-left'>${E.value}</td>
                    </tr>
                `}),m+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,m+="</table>",$("#saved-audited-expense-months").append(m)})}),$(document).on("click",".remove-audited-asset",function(p){p.preventDefault(),$(this).closest("tr").remove();for(let d in t)t[d].accounts&&(t[d].accounts=t[d].accounts.filter(x=>x.assetAccount!==$(this).attr("id"))),t[d].accounts.length===0&&delete t[d]}),$(document).on("click",".remove-audit-liability",function(p){p.preventDefault(),$(this).closest("tr").remove();for(let d in n)n[d].accounts&&(n[d].accounts=n[d].accounts.filter(x=>x.liabilityAccount!==$(this).attr("id"))),n[d].accounts.length===0&&delete n[d]}),$(document).on("click",".remove-audit-oe",function(p){p.preventDefault(),$(this).closest("tr").remove();for(let d in s)s[d].accounts&&(s[d].accounts=s[d].accounts.filter(x=>x.oeAccount!==$(this).attr("id"))),s[d].accounts.length===0&&delete s[d]});var g=0,w=0,T=0,X=0,K=0,B=0,j=0,h=0,S=0,y=0,C=0;console.log(e),$(".audit-next-btn").on("click",function(){if(i===1){if($("#append-audit-expenses-choy").empty(),$(".revenue-audit-income-total").empty(),Object.keys(a).length===0){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var p='<div class="col-sm-12 ml-3 text-dark" id="append-audit-expenses-choy">',d=0;$.each(a,(k,b)=>{p+='<div class="row mb-2">';const P=k.includes("_")?k.split("_")[1]:k;p+=`<div class="col-6 revenue-audit-accounts">${P}</div>`,console.log(k),$.each(b.months,(I,U)=>{var V=U.value.replace(/,/g,""),M=parseFloat(V);g+=M,d+=M}),p+=`<div class="col-6 text-right revenue-audit-amount">${d.toLocaleString()}</div>`,p+="</div>"}),p+="</div>",$("#append-audit-expenses-choy").html(p),$(".revenue-audit-income-total").text(g.toLocaleString())}if(i===2){if($(".append-audit-oe").empty(),$(".append-audit-ldc").empty(),Object.keys(e).length===0){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var x=!1,m=!1;if($.each(e,(k,b)=>{var P=k.split("_"),I=P[2];I==="Less Direct Cost"?x=!0:I==="Operating Expenses"&&(m=!0)}),!x||!m){H.fire({icon:"warning",title:"Missing Data",text:'Both "Less Direct Cost" and "Operating Expenses" entries are required.'});return}K=0,$.each(e,(k,b)=>{var P=k.split("_")[1];if(k.split("_")[2]==="Less Direct Cost"){var I="";$.each(b.months,(V,M)=>{var ie=M.value.replace(/,/g,""),ae=parseFloat(ie);T+=ae,I+=`
                        <div class="row">
                            <div class="col-sm-6 text-left">${P}</div>
                            <div class="col-sm-6 text-right">${ae.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</div>
                        </div>
                        `}),$(".append-audit-ldc").append(I)}if(k.split("_")[2]==="Operating Expenses"){var U="";$.each(b.months,(V,M)=>{var ie=M.value.replace(/,/g,""),ae=parseFloat(ie);K+=ae,U+=`
                        <div class="row">
                            <div class="col-sm-6 text-left">${P}</div>
                            <div class="col-sm-6 text-right">${ae.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</div>
                        </div>
                        `}),$(".append-audit-oe").append(U)}}),X=g-T,w=X-K,$(".expenses-ldc-audit-total").text(T.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".gries-audit-total").text(X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".tgi-audit").text(X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".oe-audit-total").text(K.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".net-audit-amount").text(w.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))}if(i===3){if($(".append-ca-audit").empty(),$(".append-audit-nca").empty(),$(".append-audit-fa").empty(),!Object.keys(t).some(b=>t[b].accounts&&t[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var R="",A="",E="";$.each(t,(b,P)=>{b==="Current Asset"&&$.each(P.accounts,(I,U)=>{var V=U.amount.replace(/,/g,""),M=parseFloat(V);j+=M,R+=`
                                <div class="row">
                                    <span class="col-sm-6 text-sm text-left">${U.assetAccount}</span>
                                    <span class="col-sm-6 text-sm text-right">${M.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                                </div>
                            `}),b==="Non-Current Assets"&&$.each(P.accounts,(I,U)=>{var V=U.amount.replace(/,/g,""),M=parseFloat(V);B+=M,A+=`
                            <div class="row">
                                <span class="col-sm-6 text-sm text-left">${U.assetAccount}</span>
                                <span class="col-sm-6 text-sm text-right">${M.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                            </div>
                        `}),b==="Fixed Assets"&&$.each(P.accounts,(I,U)=>{var V=U.amount.replace(/,/g,""),M=parseFloat(V);h+=M,E+=`
                        <div class="row">
                            <span class="col-sm-6 text-sm text-left">${U.assetAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${M.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `}),$(".append-ca-audit").html(R),$(".append-audit-nca").html(A),$(".append-audit-fa").html(E),$(".tnca-audit-amount").text(B.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".total-audit-ca").text(j.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),S=j+B+h,$(".total-audit-assets").text(S.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))})}if(i===4){if(y=0,$(".append-audit-cl").empty(),!Object.keys(n).some(b=>n[b].accounts&&n[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var L="";$.each(n,(b,P)=>{$.each(P.accounts,(I,U)=>{var V=U.amount.replace(/,/g,""),M=parseFloat(V);y+=M,L+=`
                        <div class="row">
                            <span class="col-sm-6 text-sm text-left">${U.liabilityAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${M.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `})}),$(".append-audit-cl").html(L)}if(i===5){C=0,$(".append-audit-oenw").empty();var _="";if(!Object.keys(s).some(b=>s[b].accounts&&s[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}$.each(s,(b,P)=>{$.each(P.accounts,(I,U)=>{var V=U.amount.replace(/,/g,""),M=parseFloat(V);C+=M,_+=`<div class="row">
                            <span class="col-sm-6 text-sm text-left">${U.oeAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${M.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `})}),$(".append-audit-oenw").html(_)}if(i===6){var F=$(".journal-audit-adjustments-form").serializeArray(),Q=!0;if($.each(F,(k,b)=>{if(b.value===""){Q=!1,$(`[name='${b.name}']`).addClass("is-invalid");return}v[b.name]=b.value,$(`[name='${b.name}']`).removeClass("is-invalid")}),!Q){H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}var J=0,W=0;$.each(v,(k,b)=>{if(k==="audit-owners_contribution"){var P=b.replace(/,/g,""),I=parseFloat(P);J+=I}if(k==="audit-owners_withdrawal"){var P=b.replace(/,/g,""),I=parseFloat(P);W+=I}});var G=W+w;$(".additional-audit-capital").text(J.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".audit-less-drawings").text(W.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".fp-audit-nc").text(w.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".appraisal-audit-capital").text(G.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));var q=G-parseFloat($(".audit-less-drawings").text().replace(/[^0-9.-]+/g,""));$(".audit-capital-end").text(q.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));var z=y+C;$(".tlc-audit").text(z.toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}))}i<7&&($(".multi-step-journal-audit").hide(),i++,O(i)),D(i),i===7?($(".audit-next-btn").hide(),$(".audit-save-btn").show()):($(".audit-next-btn").show(),$(".audit-save-btn").hide()),i===1?$(".audit-prev-btn").hide():$(".audit-prev-btn").show()}),$(".audit-prev-btn").on("click",function(){i>1&&($(".multi-step-journal-audit").hide(),i--,O(i)),D(i),$(".audit-next-btn").show(),$(".audit-save-btn").hide(),i===1?$(".audit-prev-btn").hide():$(".audit-prev-btn").show()});function O(p){$(".multi-step-journal-audit").hide(),$(".multi-step-journal-audit").eq(p-1).show()}function D(p){$(".audit-step").removeClass("active"),$(".audit-indicator-line").removeClass("active"),$(".audit-step").each(function(d){d<p&&($(this).addClass("active"),$(this).next(".audit-indicator-line").addClass("active"))})}O(i),D(i),i===1&&$(".audit-prev-btn").hide(),$(".save-audit-journal-btn").on("click",function(){$(".audit-client-journal-loader").removeClass("visually-hidden");var p={incomeObj:a,expenseObj:e,assetObj:t,liabilityObj:n,oeObj:s,adjustmentObj:v,references:$(this).attr("id")};$.ajax({type:"POST",url:"client/journal/audit",data:p,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(d){$(".audit-client-journal-loader").addClass("visually-hidden"),localStorage.setItem("journal","updated"),window.location.href="clients"},error:function(d,x,m){$(".audit-client-journal-loader").addClass("visually-hidden"),oe.fire({icon:"error",title:"Something went wrong",text:`Translated: ${d} 
 if issue persist try reloading the page or contact developer`})}})});var N=localStorage.getItem("journal");N==="updated"&&(H.fire({icon:"success",title:"Journal Update",text:"Journal Updated Successfully"}),localStorage.removeItem("journal"))});var te=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){var i="";$(".add-new-service-req").on("click",function(u){console.log($(this).attr("id"));var o=$(this).attr("id").split("_"),l=o[1],a=$(`.service-req-${o[1]}`).serializeArray(),e=!0;$.each(a,(t,n)=>{if(n.value===""){te.fire({icon:"warning",title:"Missing Entry!",text:"Please Enter Requirement Name"}),e=!1,$('[name="req-name"]').addClass("is-invalid");return}$('[name="req-name"]').removeClass("is-invalid")}),e&&$.ajax({type:"POST",url:"service/requirement/",data:{form:a,idref:l},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){console.log(t),localStorage.setItem("req","added"),location.reload()},error:function(t,n,s){te.fire({icon:"error",title:"Oops! Something Went wrong",text:"Translated: "+t})}})}),$(".add-new-sub-service-req").on("click",function(u){var o=$("#sub_service_id").val(),l=$("#sub-service-req-id").val();if((o===""||l==="")&&te.fire({icon:"warning",title:"Missing Entry!",text:"Please Enter Requirement Name"}),l===""){$("#sub-service-req-id").addClass("is-invalid");return}else $("#sub-service-req-id").removeClass("is-invalid"),$.ajax({type:"POST",url:"sub-service/requirement/",data:{reqName:l,idRef:o},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){console.log(a),localStorage.setItem("req","added"),location.reload()},error:function(a,e,t){te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+a})}})}),$(".get-client-service-req").on("click",function(){i="",$(".append-service-req").empty(),console.log($(this).attr("id")),$(".service-reqs-loader").removeClass("visually-hidden");var u="";$.ajax({type:"POST",url:`client/service/requirements/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(o){i=o.category,console.log(o),$(".service-reqs-loader").addClass("visually-hidden"),$.each(o.serviceReqs,(l,a)=>{u+=`
                         <tr>
                            <td>${a.req_name}</td>
                            <td><input type="file" class="req-file" data-id="${a.req_name}_${a.id}" name="${a.req_name}_${a.id}"></td>
                        </tr>
                        `}),$(".append-service-req").append(u)},error:function(o,l,a){$(".service-reqs-loader").addClass("visually-hidden"),te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+o})}})}),$(".save-req-files").on("click",function(){let u=!1,o=new FormData;if($(".req-file").each(function(){if(this.files.length){u=!0;const l=$(this).data("id"),a=i;o.append("files[]",this.files[0]),o.append("file_ids[]",l),o.append("category",a)}}),!u){te.fire({icon:"error",title:"Please upload at least one file."});return}$.ajax({type:"POST",url:"/service/requirement/document",data:o,processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(l){console.log(l),localStorage.setItem("req-docs","added"),location.reload()},error:function(l,a,e){te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+l})}})}),$(".view-client-service-doc").on("click",function(){$(".service-docs-loader").removeClass("visually-hidden"),console.log($(this).attr("id")),$(".append-service-docs").empty();let u="";$.ajax({type:"POST",url:`/service/requirement/documents/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(o){$(".service-docs-loader").addClass("visually-hidden"),$.each(o.docsData,(l,a)=>{console.log(a);let e="";a.getRealPath&&a.getRealPath.trim()!==""&&(e=`
                            <a href="storage/${a.getRealPath}" 
                               download="${a.getClientOriginalName}" 
                               class="badge bg-warning text-dark" 
                               style="font-size: 10px;">
                                <i class="fas fa-cloud-download-alt"></i> Download
                            </a>
                        `),u+=`
                        <tr>
                            <td>${a.req_name}</td>
                            <td>${a.getClientOriginalName||"No file name"}</td>
                            <td>${a.getClientMimeType}</td>
                            <td>${e}</td>
                        </tr>
                    `}),$(".append-service-docs").html(u)},error:function(o,l,a){$(".service-docs-loader").addClass("visually-hidden"),te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+o})}})});var r=localStorage.getItem("req-docs"),c=localStorage.getItem("req");c==="added"&&(te.fire({icon:"success",title:"Service Requirement",text:"New requirement added"}),localStorage.removeItem("req")),r==="added"&&(te.fire({icon:"success",title:"Service Requirement",text:"New requirement document is added"}),localStorage.removeItem("req-docs"))});$(document).ready(function(){window.formatValueInput=function(i){var r=i.value.replace(/[^0-9\.]/g,""),c=r.split(".");c[0]=c[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),c.length>1?i.value=c[0]+"."+c[1]:i.value=c[0]},window.previewImage=function(i,r){const u=i.target.files[0];if(u){const o=new FileReader;o.onload=function(l){const a=document.getElementById(r);a?a.src=l.target.result:console.error(`Preview element with ID ${r} not found.`)},o.readAsDataURL(u)}else console.warn("No file selected.")}});
