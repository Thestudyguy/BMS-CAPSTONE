function pe(o,a,n,c){$.ajax({url:o,type:"POST",data:a,success:function(s){n(s)},error:function(s,d,r){c(s,d,r)}})}function $e(o,a,n,c){$.ajax({url:o,type:"POST",headers:a,success:function(s){n(s)},error:function(s,d,r){c(s,d,r)}})}function he(o,a,n,c,s,d){$.ajax({url:o,type:"POST",data:{...a,id:n},headers:c,success:function(r){s(r)},error:function(r,e,t){d(r,e,t)}}),console.log(a),console.log(n)}function ge(o,a,n,c,s){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,r,e){s(d,r,e)}})}function xe(o,a,n,c,s,d){var r=new FormData;for(var e in a)a.hasOwnProperty(e)&&r.append(e,a[e]);n&&r.append("profile",n),$.ajax({url:o,type:"POST",data:r,headers:c,processData:!1,contentType:!1,success:function(t){s(t)},error:function(t,i,l){d(t,i,l)}})}function ye(o,a,n,c){$.ajax({url:o,type:"POST",headers:a,success:function(s){n(s)},error:function(s,d,r){c(s,d,r)}})}function be(o,a,n,c,s){$.ajax({url:o,type:"POST",data:a,headers:n,processData:!1,contentType:!1,success:function(d){c(d)},error:function(d,r,e){s(d,r,e)}})}function Se(o,a,n,c,s){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,r,e){s(d,r,e)}})}function we(o,a,n,c,s){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,r,e){s(d,r,e)}})}function Ce(o,a,n,c,s){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,r,e){s(d,r,e)}})}function Fe(o,a,n,c,s){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,r,e){s(d,r,e)}})}function je(o,a,n,c,s){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,r,e){s(d,r,e)}})}function Oe(o,a,n,c,s){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,r,e){s(d,r,e)}})}function Te(o,a,n,c,s){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,r,e){s(d,r,e)}})}var ee=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),Z=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".search-coa").on("keyup",function(){var e=$(this).val().toLowerCase();$("#coa-table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(e)>-1)})}),$("#filter-coa").on("change",function(){var e=$(this).val();$(".coa-table tbody tr").each(function(){var t=$(this).data("category");e==="clear"?$(this).show():e===""||t===e?$(this).show():$(this).hide()})}),$(".client-table-data").hover(function(){$(this).find(".action-icons").removeClass("visually-hidden")},function(){$(this).find(".action-icons").addClass("visually-hidden")}),$(".new-sub-service-icon").on("click",function(e){e.stopPropagation()}),$(".edit-service-icon").on("click",function(e){e.stopPropagation()}),$(".view-service-details").on("click",function(e){e.stopPropagation()}),$(".remove-service-icon").on("click",function(e){e.stopPropagation()});function o(e){localStorage.setItem("transaction-status",e),location.reload()}$(".client-sub-table").on("click",function(){console.log($(this).attr("id")),$(this).closest("tr").next(".expandable-body").find(".loader-td")}),$(".external-service").on("click",function(){var e=$(this).next(".expandable-body").find(".loader");e.removeClass("visually-hidden");var t=$(this).attr("id");$.ajax({type:"POST",url:`sub-services-${t}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){e.addClass("visually-hidden");var l=i.services,m='<table class="table table-hover float-left append-sub-services">';m+=`
                <thead class="text-left">
                    <tr>
                        <td>Requirements</td>
                        <td>Price</td>
                    </tr>
                </thead> 
                `,$.each(l,(v,x)=>{var g=parseFloat(x.ServiceRequirementPrice).toFixed(2).toLocaleString(),T=Number(g).toLocaleString();m+=`
                    <tbody class="text-left">
                        <tr class='sub-service' id='${x.id}'>
                            <td>${x.ServiceRequirements}</td>
                            <td>${T}
                            <span id='${x.id}' class="badge mx-2 bg-warning float-right text-sm sub-service-action-icons-remove" data-bs-target='#remove-sub-service' data-bs-toggle='modal' >
                                <i class="fas fa-trash" style="font-size: .8em;"></i>
                            </span>
                            <span id='${x.id}' data-bs-target='#edit-sub-service-modal' data-bs-toggle='modal' class="badge bg-warning float-right text-sm sub-service-action-icons-edit">
                                <i class="fas fa-pen" style="font-size: .8em;"></i>
                            </span>
                            <span id='${x.id}' data-bs-target='#add-sub-service-req' data-bs-toggle='modal' class="mx-2 badge bg-warning float-right text-sm sub-service-action-icons-req">
                                <i class="fas fa-file" style="font-size: .8em;"></i>
                            </span>
                            </td>
                        </tr>
                    </tbody>                    
                    `}),m+="</table>",$(`.append-sub-services-${t}`).html(m)},error:function(i,l,m){Z.fire({icon:"error",title:"Fatal Error",text:i})}})}),$(document).on("click",".sub-service-action-icons-req",function(){var e=$(this).attr("id");$.ajax({type:"POST",url:`retrieve-sub-service-data-${e}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){console.log(t.sub_service),$("#sub_service_id").attr("id",t.sub_service.id),$("#sub_service_id").val(t.sub_service.id),$(".sub-service-req-service-name").text(t.sub_service.ServiceRequirements)},error:function(t,i,l){Z.fire({icon:"error",title:"Something went wrong",text:`Translated: ${t}`})}})}),$(document).on("click",".sub-service-action-icons-edit",function(e){$(".sub-service-loader").removeClass("visually-hidden");var t=$(this).attr("id");$.ajax({type:"POST",url:`retrieve-sub-service-data-${t}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){$(".sub-service-loader").addClass("visually-hidden"),console.log(i.sub_service.ServiceRequirementPrice),$("#service-edit-field").val(i.sub_service.ServiceRequirements),$("#serviceprice-edit-field").val(i.sub_service.ServiceRequirementPrice),$("#sub-service-edit-id").val(i.sub_service.id)},error:function(i,l,m){Z.fire({icon:"error",title:"Something went wrong",text:`Translated: ${i}`})}})}),$(document).on("click",".sub-service-action-icons-remove",function(e){e.preventDefault();var t=$(this).attr("id"),i=$(this).closest("tr").find("td:eq(0)").text().trim();console.log(i),$(".sub-service-app").text(i),$(".remove-sub-service").attr("id",t)}),$(document).on("click",".remove-sub-service",function(){$.ajax({type:"POST",url:`remove-sub-service/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){localStorage.setItem("sub-service","removed"),location.reload()},error:function(e,t,i){Z.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+e})}})}),$("#edit-sub-service").on("click",function(e){e.preventDefault();var t=$("#edit-sub-service-form").serializeArray(),i=!0,l={};if($.each(t,(x,g)=>{g.value===""?(i=!1,$(`[name='${g.name}']`).addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"})):($(`[name='${g.name}']`).removeClass("is-invalid"),l[g.name]=g.value)}),i){let x=function(T){console.log(T),localStorage.setItem("sub_service","updated"),location.reload()},g=function(T,O,X){var B=JSON.parse(T.responseText),C=B.error;if(C==="Service already exists"){$(".conflict-warning").removeClass("visually-hidden"),$("#new-service-form [name='Service']").addClass("is-invalid"),$(".conflict-text").text("Service already exists");return}else Z.fire({icon:"error",title:"Fatal Error",text:`Translated: ${C}`}),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid")};var m=x,v=g;je("edit-sub-service",l,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},x,g)}}),$("#new-service-form").on("submit",function(e){e.preventDefault(),$(".conflict-text").text("Service already exists"),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid");var t={},i=$(this).serializeArray(),l=!1;if($.each(i,(x,g)=>{if(g.value==="")return $(`#new-service-form [name='${g.name}']`).addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),l=!0,!1;t[g.name]=g.value}),l)return;pe("new-service",t,m,v);function m(x){o("created")}function v(x,g,T){var O=JSON.parse(x.responseText),X=O.error;if(X==="Service already exists"){$(".conflict-warning").removeClass("visually-hidden"),$("#new-service-form [name='Service']").addClass("is-invalid"),$(".conflict-text").text("Service already exists");return}else Z.fire({icon:"error",title:"Fatal Error",text:`Translated: ${X}`}),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid")}}),$(".remove-service").on("click",function(){$e(`remove-service-${$(this).attr("id")}`,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t);function e(i){o("removed")}function t(i,l,m){Z.fire({icon:"error",title:"Fatal Error",text:i})}}),$(".edit-service").on("click",function(e){e.preventDefault();var t=$(this).attr("id"),i="#edit-service-form-"+t,l=$(i).serializeArray();console.log(l);var m={},v=!1;if($.each(l,(T,O)=>{if(O.value==="")return $(i+" [name='"+O.name+"']").addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),v=!0,!1;m[O.name]=O.value}),v)return;he("update-service",m,t,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},x,g);function x(T){o("updated")}function g(T,O,X){var B=JSON.parse(T.responseText),C=B.error;Z.fire({icon:"error",title:"Fatal Error",text:`Translated: ${C}`})}}),$(".submit-new-sub-service").on("click",function(e){e.preventDefault();var t=!0,i={},l=$(this).attr("id"),m=$(`#new-sub-service-${l}`).serializeArray();if(console.log(m),$.each(m,(g,T)=>{T.value===""?($(`[name='${T.name}']`).addClass("is-invalid"),t=!1):(i[T.name]=T.value,$(`[name='${T.name}']`).removeClass("is-invalid"))}),!t){ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}ge("new-sub-service",i,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},v,x);function v(g){console.log(g),localStorage.setItem("sub_service","created"),location.reload()}function x(g,T,O){console.log(g),g.responseJSON&&g.responseJSON.message?(Z.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${g.responseJSON.message}`}),console.log(g.responseJSON.errors)):Z.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${g.responseJSON.error}`})}});var a={},n=document.getElementById("fileInput");$(".next-form").on("click",function(){var e=$(".multi-step:visible"),t=e.serializeArray(),i=!1,l=!1;if(e.find(".form-control").removeClass("is-invalid"),$.each(t,(O,X)=>{X.value===""&&($(`[name='${X.name}']`).addClass("is-invalid"),i=!0),a[X.name]=X.value}),e.hasClass("client-profile")&&(!n.files||n.files.length===0?($("#fileInput").addClass("is-invalid"),l=!0):$("#fileInput").removeClass("is-invalid")),i)ee.fire({icon:"warning",title:"Missing Fields",text:"Fill all fields to proceed"});else if(l)ee.fire({icon:"warning",title:"Missing File",text:"Please upload a profile picture before proceeding."});else{var m=e.next(".multi-step");if(m.hasClass("data-entry-preview")){$(".companyName").text($("[name='CompanyName']").val()),$(".companyEmail").text($("[name='CompanyEmail']").val()),$(".companyAddress").text($("[name='CompanyAddress']").val()),$(".companyCEO").text($("[name='CEO']").val()),$(".companyCEODob").text($("[name='CEODateOfBirth']").val()),$(".companyCEOContact").text($("[name='CEOContactInformation']").val()),$(".representativeName").text($("[name='RepresentativeName']").val()),$(".representativeContact").text($("[name='RepresentativeContactInformation']").val()),$(".representativeDob").text($("[name='RepresentativeDateOfBirth']").val()),$(".representativePosition").text($("[name='RepresentativePosition']").val()),$(".representativeAddress").text($("[name='RepresentativeAddress']").val());var v=document.getElementById("fileInput");if(v.files&&v.files[0]){var x=new FileReader;x.onload=function(O){$("#previewImage").attr("src",O.target.result).show()},x.readAsDataURL(v.files[0])}}m.length&&e.fadeOut(300,function(){$(this).hide(),m.fadeIn(200,function(){$(this).show()})});var g=$(".client-step.active"),T=g.next(".client-form-indicator-line");T.addClass("active"),T.next(".client-step").addClass("active"),$(".previous-form").removeClass("visually-hidden"),e.next(".multi-step").next(".multi-step").length||($(".next-form").addClass("visually-hidden"),$(".save").removeClass("visually-hidden"))}}),$(".previous-form").on("click",function(){var e=$(".multi-step:visible"),t=e.prev(".multi-step");if(t.length){e.fadeOut(300,function(){$(this).hide(),t.fadeIn(300,function(){$(this).show()})});var i=$(".client-step.active"),l=i.prev(".client-form-indicator-line");i.removeClass("active"),l.prev(".client-step").addClass("active"),$(".next-form").removeClass("visually-hidden"),$(".save").addClass("visually-hidden"),t.prev(".multi-step").length||$(".previous-form").addClass("visually-hidden")}}),$(".get-ceo-info").click(function(){$("#repName").val(a.CEO),$("#repcontact").val(a.CEOContactInformation),$("#repdob").val(a.CEODateOfBirth),$("#position").val("CEO"),$("#repaddress").val(a.CompanyAddress)}),$(".save").on("click",function(){new FormData,console.log(a),xe("new-client-record",a,fileInput.files[0],{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},function(t){console.log("Success:",t),o("created"),window.location.href="clients"},function(t,i,l){t.responseJSON&&t.responseJSON.message&&(Z.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${t.responseJSON.message}`}),console.log(t.responseJSON.errors))})}),$("#fileInput").on("change",function(e){var t=this.files[0];if(t){var i=new FileReader;i.onload=function(l){$("#imagePreview").attr("src",l.target.result).show(),console.log(l.target.result)},i.readAsDataURL(t)}else $("#imagePreview").attr("src","#").hide()}),$(".pdf-services").on("click",function(e){e.preventDefault();var t=$(this).data("url");window.open(t,"services/pdf")});var c=localStorage.getItem("activeNavItem");c&&$('.nav-item a[href="'+c+'"]').addClass("active"),$(".nav-item a").on("click",function(){$(".nav-item a").removeClass("active"),$(this).addClass("active"),localStorage.setItem("activeNavItem",$(this).attr("href"))});const s=localStorage.getItem("transaction-status");if(s){localStorage.removeItem("transaction-status");const e={created:{icon:"success",title:"New Record",text:"New record added successfully"},removed:{icon:"success",title:"Record Removed!",text:"Record removed successfully"},updated:{icon:"success",title:"Record Updated!",text:"Record updated successfully"}};e[s]&&ee.fire(e[s])}var d=localStorage.getItem("sub_service"),r=localStorage.getItem("sub-service");d==="created"&&(ee.fire({icon:"success",title:"New Requirement added"}),localStorage.removeItem("sub_service")),d==="updated"&&(ee.fire({icon:"success",title:"Service Updated!"}),localStorage.removeItem("sub_service")),r==="removed"&&(ee.fire({icon:"success",title:"Service Removed!"}),localStorage.removeItem("sub-service"))});var Ae=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),ve=Swal.mixin({toast:!1,position:"bottom-end"}),se=0,le=0,V=[];$(document).ready(function(){$(".services").on("change",function(){var r=$(this).attr("id"),e=$(this).val().split("_"),t=e[0],i=$(this).val(),l=parseFloat(e[1]);V=[],$(".sub-services-append").html(""),$(".service-input").html(""),$(".sub-services").find(".loader").removeClass("visually-hidden"),$(".services-total").show(),le=l,se=1,c(t,l),n(),ye(`fetch-sub-services-${r}`,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},o,a),V.push({serviceName:i,servicePrice:l,serviceFile:null}),console.log(V)});function o(r){$(".sub-services").find(".loader").addClass("visually-hidden"),$.each(r.subServices,(e,t)=>{t!=="id"&&$(".sub-services-append").append(`<li>
                    <input class='sub-service-item' type='checkbox' name='SubService' id='${t.id}' 
                    value='${t.ServiceRequirements}_${t.ServiceRequirementPrice}_subservice_${t.id}' 
                    style='font-size: 5px;'>${t.ServiceRequirements}
                </li>`)})}function a(r,e,t){console.log(r),ve.fire({icon:"error",title:"Fatal Error",text:`Translated: ${r}`})}$(document).on("click",".sub-service-item",function(){var r=$(this).val().split("_"),e=$(this).val(),t=$(this).attr("id"),i=r[0],l=parseFloat(r[1]);if($(this).is(":checked"))$(".client-service-input").append(`<tr id='row-${t}'>
                    <td>${i}</td>
                    <td>${l.toLocaleString()}</td>
                </tr>`),le+=l,se++,V.push({serviceName:e,servicePrice:l,serviceFile:null});else{const m=V.findIndex(v=>v.serviceName===e);console.log(e,"unchecked"),$(`#row-${t}`).remove(),le-=l,se--,m!==-1&&V.splice(m,1)}console.log(V),n()});function n(){$(".totalAmount").text(`Total Amount: ${le.toLocaleString()}`),$(".totalServices").text(`Total Services: ${se}`)}function c(r,e,t){const i=r.replace(/\s+/g,"_");$(".service-input").append(`
            <div class="row">
                <div class="col-sm-12">
                    <div class="row">
                        <table style='font-size: 10px;' class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <td>Service</td>
                                    <td>Amount</td>
                                </tr>
                            </thead>
                            <tbody class='client-service-input'>
                                <tr>
                                    <td>${r}</td>
                                    <td>${e.toLocaleString()}</td>
                                    <td><span class="badge fw-bold text-light bg-danger rounded-1 remove-parent-service" id=${i}><i class="fas fa-trash"></i></span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `)}$(document).on("change",".clientDocument",function(){var r=$(this),e=r.closest("tr"),t=e.find("td").first().text(),i=Array.from(r[0].files);V=V.map(l=>l.serviceName===t?{...l,serviceFile:i.length>0?i[0]:null}:l)}),$(document).on("click",".remove-parent-service",function(){var r=$(this).attr("id");console.log(r);var e=r.replace(/_/g," ");console.log("Prepared Service Ref:",r);var t=V.findIndex(i=>i.serviceName===e);console.log("Service to remove index:",t),t>-1?(console.log("Service to remove:",V[t]),V.splice(t,1)):console.log("Service not found in the array!"),$(this).closest("tr").remove(),console.log("Updated Services Data:",V)});function s(){$(".add-client-service-loader").removeClass("visually-hidden");var r=$(".hidden-client-id").attr("id"),e=new FormData;e.append("client_id",r),V.forEach((l,m)=>{e.append(`services[${m}][serviceName]`,l.serviceName),e.append(`services[${m}][servicePrice]`,l.servicePrice),l.serviceFile&&e.append(`services[${m}][serviceFile]`,l.serviceFile)});for(const[l,m]of e.entries())console.log(l,m);be(`client-services-${r}`,e,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},t,i);function t(l){$(".add-client-service-loader").addClass("visually-hidden"),console.log(l),window.location.href="clients",localStorage.setItem("services",!0)}function i(l,m,v){$(".add-client-service-loader").addClass("visually-hidden");try{const x=JSON.parse(l.responseText);console.log("Parsed Response:",x),ve.fire({icon:"warning",title:"Conflict",text:x.Conflict})}catch(x){console.log("Could not parse JSON response:",x)}}}$(".submit-services").on("click",function(){s()});var d=localStorage.getItem("services");d&&(Ae.fire({icon:"success",title:"Services Added to Client"}),localStorage.removeItem("services"))});$(document).ready(function(){let o=1;var a=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),n=Swal.mixin({toast:!1,position:"bottom-end"});let c="",s={},d="",r={},e={},t={},i={},l={};$("#expense-category").on("change",function(){c=$("#expense-category").val(),$(".expense-form").removeClass("visually-hidden"),$(".months-container").empty(),$(".save-expense").addClass("visually-hidden")}),$(".start-date, .end-date").on("change",function(){const C=$(".start-date").val(),p=$(".end-date").val();if($("#expense-category").val()===""){a.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(C&&p){const S=new Date(C),F=new Date(p),A=$(".months-container");var w='<div class="row">';if((F.getFullYear()-S.getFullYear())*12+(F.getMonth()-S.getMonth())>12){n.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const P=new Date(S);if(P.setMonth(P.getMonth()+11),F>P){n.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}A.empty(),w+="";let h=new Date(S);for(;h<=F;){const u=h.toLocaleString("default",{month:"long",year:"numeric"});w+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control month-input" name="${u}" id="" placeholder='${u}' value="">
                    </div>
                    </div>`,h.setMonth(h.getMonth()+1)}w+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-months form-control">Save</button>
            </div>`,w+="</div>",A.html(w)}$(".months-container").on("input",".month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-months",function(C){C.preventDefault();let p=[],w=!0;if(s.hasOwnProperty(c))return a.fire({icon:"warning",title:"Account Already Added",text:"You have already added this account."}),$(".end-date").val(""),$(".start-date").val(""),$(".months-container").empty(),!1;if($(".month-input").each(function(){var S=$(this).attr("name"),F=$(this).val();F!==""&&(w=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),p.push({monthName:S,value:$(this).val(),account:c,startDate:$(".start-date").val(),endDate:$(".end-date").val()}))}),w){$(".month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),a.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}s[c]={months:p,startDate:$(".start-date").val(),endDate:$(".end-date").val()},$("#saved-months").empty(),$.each(s,(S,F)=>{var A='<table class="table table-hover client-journal-accounts">',R=S.split("_");A+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${R[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${S}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(F.months,(P,h)=>{A+=`
                    <tr>
                        <td class='text-left'>${h.monthName}</td>
                        <td class='text-left'>${h.value}</td>
                    </tr>
                `}),A+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,A+="</table>",$("#saved-months").append(A)}),$(".months-container").empty(),$("#expense-category").val(""),$(".end-date").val(""),$(".start-date").val(""),c="",w=!0,console.log(s)}),$(document).on("click",".remove-saved-account",function(C){const p=$(this).attr("id");delete s[p],$("#saved-months").empty(),$.each(s,(w,S)=>{var F='<table class="table table-hover client-journal-accounts">',A=w.split("_");F+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${A[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${w}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(S.months,(R,P)=>{F+=`
                    <tr>
                        <td>${P.monthName}</td>
                        <td>${P.value}</td>
                    </tr>
                `}),F+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,F+="</table>",$("#saved-months").append(F)}),console.log(s)}),$("#income-category").on("change",function(){$(".income-form").removeClass("visually-hidden"),d=$("#income-category").val(),$(".income-months-container").empty()}),$(".income-start-date, .income-end-date").on("change",function(){const C=$(".income-start-date").val(),p=$(".income-end-date").val();if($("#income-category").val()===""){a.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(C&&p){const S=new Date(C),F=new Date(p),A=$(".income-months-container");var w='<div class="row">';if((F.getFullYear()-S.getFullYear())*12+(F.getMonth()-S.getMonth())>12){n.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const P=new Date(S);if(P.setMonth(P.getMonth()+11),F>P){n.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}A.empty(),w+="";let h=new Date(S);for(;h<=F;){const u=h.toLocaleString("default",{month:"long",year:"numeric"});w+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control income-month-input" name="${u}" id="" placeholder='${u}' value="">
                    </div>
                    </div>`,h.setMonth(h.getMonth()+1)}w+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-expense-months form-control">Save</button>
            </div>`,w+="</div>",A.html(w)}$(".income-months-container").on("input",".income-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-expense-months",function(C){C.preventDefault();let p=[],w=!0;if(r.hasOwnProperty(d)){a.fire({icon:"warning",title:"Account Already Added",text:"You have already added this account."}),$(".income-end-date").val(""),$(".income-start-date").val(""),$(".income-months-container").empty();return}if($(".income-month-input").each(function(){var S=$(this).attr("name"),F=$(this).val();F!==""&&(w=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),p.push({incomeMonthName:S,value:$(this).val(),account:d,startDate:$(".income-start-date").val(),endDate:$(".income-end-date").val()}))}),w){$(".income-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),a.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}r[d]={months:p,startDate:$(".income-start-date").val(),endDate:$(".income-end-date").val()},console.log(r),$("#saved-income-months").empty(),$.each(r,(S,F)=>{var A='<table class="table table-hover client-journal-accounts">',R=S.split("_");A+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${R[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${S}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(F.months,(P,h)=>{A+=`
                    <tr>
                        <td class='text-left'>${h.incomeMonthName}</td>
                        <td class='text-left'>${h.value}</td>
                    </tr>
                `}),A+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,A+="</table>",$("#saved-income-months").append(A)}),$(".income-months-container").empty(),$("#income-category").val(""),$(".income-end-date").val(""),$(".income-start-date").val(""),c="",w=!0}),$(document).on("click",".remove-saved-account",function(C){const p=$(this).attr("id");delete r[p],$("#saved-income-months").empty(),$.each(r,(w,S)=>{var F='<table class="table table-hover client-journal-accounts">',A=w.split("_");F+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${A[1]} - ${S.startDate} - ${S.endDate}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${w}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(S.months,(R,P)=>{F+=`
                    <tr>
                        <td>${P.incomeMonthName}</td>
                        <td>${P.value}</td>
                    </tr>
                `}),F+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,F+="</table>",$("#saved-income-months").append(F)}),console.log(r)}),$(document).on("change","#asset_account",function(){let C=$(this).val();console.log(C),$.ajax({type:"POST",url:`get-accounts-${C}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(p){console.log(p);let w="";$.each(p,(S,F)=>{$.each(F,(A,R)=>{console.log(R),w+=`
                            <option value="${R.AccountName}_${R.id}">${R.AccountName}</option>
                        `})}),$("#asset_account_name").html(w)},error:function(p,w,S){console.error(p)}})}),$(document).on("change","#liability_account",function(){let C=$(this).val();$.ajax({type:"POST",url:`get-accounts-${C}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(p){let w="";$.each(p,(S,F)=>{$.each(F,(A,R)=>{w+=`
                            <option value="${R.AccountName}_${R.id}">${R.AccountName}</option>
                        `})}),$("#liability_account_name").html(w)},error:function(p,w,S){console.error(p)}})}),$(document).on("change","#oe_account",function(){let C=$(this).val();$.ajax({type:"POST",url:`get-accounts-${C}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(p){let w="";$.each(p,(S,F)=>{$.each(F,(A,R)=>{w+=`
                            <option value="${R.AccountName}_${R.id}">${R.AccountName}</option>
                        `})}),$("#oe_account_name").html(w)},error:function(p,w,S){console.error(p)}})}),$(".save-asset-info").on("click",function(C){C.preventDefault();var p=!1,w=$(".journal-asset-form").serializeArray(),S="",F="",A="";let R=!1;if($(".journal-asset-form input, .journal-asset-form select").removeClass("is-invalid"),$.each(w,function(h,u){u.value===""&&($(`.journal-asset-form [name='${u.name}']`).addClass("is-invalid"),p=!0),u.name==="assetType"?S=u.value:u.name==="assetAccount"?F=u.value:u.name==="assetAmount"&&(A=u.value)}),$.each(e,(h,u)=>{if($.each(u.accounts,(y,f)=>{if(f.assetAccount===F)return R=!0,!1}),R)return!1}),R)return a.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(p){a.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}e[S]||(e[S]={accounts:[]}),e[S].accounts.push({assetAccount:F,amount:A}),console.log("Asset Object:",e);var P="";$.each(e,function(h,u){$.each(u.accounts,function(y,f){P+=`
                <tr>
                    <td style="font-size: 0.8em;">${h.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.assetAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-asset" id="${f.assetAccount}" data-type="${h}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-asset-accounts").html(P),$(".journal-asset-form")[0].reset(),$("#asset_account_name").html('<option value="" selected hidden>Select an asset type first</option>')}),$(document).on("click",".remove-asset",function(C){C.preventDefault(),$(this).closest("tr").remove();for(let p in e)e[p].accounts&&(e[p].accounts=e[p].accounts.filter(w=>w.assetAccount!==$(this).attr("id"))),e[p].accounts.length===0&&delete e[p];console.log(e)}),$(".save-liability-info").on("click",function(C){C.preventDefault();var p=!1,w=$(".journal-liability-form").serializeArray(),S="",F="",A="";let R=!1;if($(".journal-liability-form input, .journal-liability-form select").removeClass("is-invalid"),$.each(w,function(h,u){u.value===""&&($(`.journal-liability-form [name='${u.name}']`).addClass("is-invalid"),p=!0),u.name==="liability-account"?S=u.value:u.name==="liability-account-name"?F=u.value:u.name==="liability-amount"&&(A=u.value)}),$.each(t,(h,u)=>{if($.each(u.accounts,(y,f)=>{if(f.liabilityAccount===F)return R=!0,!1}),R)return!1}),R)return a.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(p){a.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}t[S]||(t[S]={accounts:[]}),t[S].accounts.push({liabilityAccount:F,amount:A}),console.log("liability Object:",t);var P="";$.each(t,function(h,u){$.each(u.accounts,function(y,f){P+=`
                <tr>
                    <td style="font-size: 0.8em;">${f.liabilityAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-liability" id="${f.liabilityAccount}" data-type="${h}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-liability-accounts").html(P),$(".journal-liability-form")[0].reset(),$("#liability_account_name").html('<option value="" selected hidden>Select an asset type first</option>')}),$(document).on("click",".remove-liability",function(C){C.preventDefault(),$(this).closest("tr").remove();for(let p in t)t[p].accounts&&(t[p].accounts=t[p].accounts.filter(w=>w.liabilityAccount!==$(this).attr("id")),t[p].accounts.length===0&&delete t[p]);console.log(t)}),$(".save-oe-info").on("click",function(C){C.preventDefault();var p=!1,w=$(".journal-oe-form").serializeArray(),S="",F="",A="",R=!1;if($(".journal-oe-form input, .journal-oe-form select").removeClass("is-invalid"),$.each(w,function(h,u){u.value===""&&($(`.journal-oe-form [name='${u.name}']`).addClass("is-invalid"),p=!0),u.name==="oe-account"?S=u.value:u.name==="oe-account-name"?F=u.value:u.name==="oe-amount"&&(A=u.value)}),$.each(i,(h,u)=>{if($.each(u.accounts,(y,f)=>{if(f.oeAccount===F)return R=!0,!1}),R)return!1}),R)return a.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(p){a.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}i[S]||(i[S]={accounts:[]}),i[S].accounts.push({oeAccount:F,amount:A}),console.log("Asset Object:",i);var P="";$.each(i,function(h,u){$.each(u.accounts,function(y,f){P+=`
                <tr>
                    <td style="font-size: 0.8em;">${f.oeAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-oe" id="${f.oeAccount}" data-type="${h}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-oe-accounts").html(P),$(".journal-oe-form")[0].reset(),$("#oe_account_name").html('<option value="" selected hidden>Select an account type first</option>'),console.log("oeObj Object:",i)}),$(document).on("click",".remove-oe",function(C){C.preventDefault(),$(this).closest("tr").remove();for(let p in i)i[p].accounts&&(i[p].accounts=i[p].accounts.filter(w=>w.oeAccount!==$(this).attr("id"))),i[p].accounts.length===0&&delete i[p];console.log(i)});var m=0,v=0,x=0,g=0,T=0;$(".next-btn").on("click",function(){if(o===1){if(Object.keys(r).length===0){a.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}$("#append-expenses-choy").empty(),m=0;var C="";$.each(r,function(M,z){var E=M.split("_"),b=0;$.each(z.months,function(q,K){var Y=K.value.replace(/,/g,""),L=parseFloat(Y);b+=L});var N=b.toLocaleString();m+=b,C+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${E[1]}</div>
                        <div class="col-sm-6 text-right">${N}</div>
                    </div>`});var p=parseFloat(m);console.log(typeof p),$("#append-expenses-choy").append(C);var w=`
                <div class="row mt-3">
                    <div class="col-sm-6 text-left"><strong>Total:</strong></div>
                    <div class="col-sm-6 text-right"><strong>${p.toLocaleString()}</strong></div>
                </div>`;$(".append-expense-total").html(w)}if(o===2){$(".append-ldc").empty(),$(".expenses-total").text(""),$(".append-oe").empty(""),$(".oe-total").text("");var S="",F="";if(v=0,x=0,Object.keys(s).length===0){a.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var A=!1,R=!1;if($.each(s,(M,z)=>{var E=M.split("_"),b=E[2];b==="Less Direct Cost"?A=!0:b==="Operating Expenses"&&(R=!0)}),!A||!R){a.fire({icon:"warning",title:"Missing Data",text:'Both "Less Direct Cost" and "Operating Expenses" entries are required.'});return}$.each(s,(M,z)=>{var E=M.split("_"),b=E[2],N=0,q=0;if(b==="Less Direct Cost"){$.each(z.months,(L,ne)=>{var ae=ne.value.replace(/,/g,""),ue=parseFloat(ae);N+=ue});var K=N.toLocaleString();v+=N,S+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${E[1]}</div>
                        <div class="col-sm-6 text-right">${K}</div>
                    </div>
                    `}else if(b==="Operating Expenses"){$.each(z.months,(L,ne)=>{var ae=ne.value.replace(/,/g,""),ue=parseFloat(ae);q+=ue});var Y=q.toLocaleString();x+=q,F+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${E[1]}</div>
                        <div class="col-sm-6 text-right">${Y}</div>
                    </div>
                    `}});var P=m-v,h=P-x;g=h,$(".gries-total").text(P.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".tgi").text(P.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".expenses-total").text(v.toLocaleString()),$(".append-ldc").append(S),$(".append-oe").append(F),$(".oe-total").text(x.toLocaleString()),$(".net-amount").text(h.toLocaleString())}if(o===3){var u=0,y=0,f=0,k=0;if($(".append-ca").html(""),$(".append-nca").html(""),$(".append-fa").html(""),Object.keys(e).length===0){a.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(e,(M,z)=>{M.split("_")[0]==="Current Asset"&&$.each(z.accounts,(E,b)=>{var N=b.amount.replace(/,/g,""),q=parseFloat(N);f+=q,$(".total-ca").text(f.toLocaleString()),$(".append-ca").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)}),M.split("_")[0]==="Non-Current Assets"&&$.each(z.accounts,(E,b)=>{var N=b.amount.replace(/,/g,""),q=parseFloat(N);y+=q,$(".tnca-amount").text(y.toLocaleString()),$(".append-nca").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)}),M.split("_")[0]==="Fixed Assets"&&$.each(z.accounts,(E,b)=>{var N=b.amount.replace(/,/g,""),q=parseFloat(N);k+=q,$(".append-fa").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)})}),u=f+y+k,$(".total-assets").text(u.toLocaleString())}if(o===4){console.log(t);var D="",I=0;if(Object.keys(t).length===0){a.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(t,(M,z)=>{$.each(z.accounts,(E,b)=>{var N=b.amount.replace(/,/g,""),q=parseFloat(N);I+=q,console.log(I),D+=`
                    <div class="d-flex justify-content-between">
                        <span class="fw-normal">${b.liabilityAccount.split("_")[0]}</span>
                        <span class="fw-normal">${b.amount}</span>
                    </div>
                    `})}),T+=I,$(".append-cl").html(D)}if(o===5){var U="",_=0;if(Object.keys(i).length===0){a.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(i,(M,z)=>{$.each(z.accounts,(E,b)=>{var N=b.amount.replace(/,/g,""),q=parseFloat(N);_+=q,console.log(_),U+=`
                <div class="d-flex justify-content-between">
                <span class="fw-normal">${b.oeAccount.split("_")[0]}</span>
                <span class="fw-normal">${b.amount}</span>
            </div>
                `})}),T+=_,$(".append-oenw").html(U)}if(o===6){$(".tlc").text(T.toLocaleString());var j=0,W=!0,J=$(".journal-adjustments-form").serializeArray();if($.each(J,(M,z)=>{var E=$(`.journal-adjustments-form [name='${z.name}']`);z.value.trim()===""?(W=!1,E.addClass("is-invalid")):(E.removeClass("is-invalid"),l[z.name]=z.value)}),!W){a.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}$.each(l,(M,z)=>{var E=z.replace(/,/g,""),b=parseFloat(E);M==="owners_withdrawal"&&$(".less-drawings").text(b.toLocaleString()),M==="owners_capital"&&(j+=b),M!=="owners_withdrawal"&&M!=="owners_capital"&&(j+=b)}),$(".additional-capital").text(j.toLocaleString()),$(".fp-nc").text(g.toLocaleString());var Q=j+g;$(".appraisal-capital").text(Q.toLocaleString());var G=Q-parseFloat($(".less-drawings").text().replace(/[^0-9.-]+/g,""));$(".capital-end").text(G.toLocaleString())}o<7&&($(".multi-step-journal").hide(),o++,O(o)),X(o),o===7?($(".next-btn").hide(),$(".save-btn").show()):($(".next-btn").show(),$(".save-btn").hide()),o===1?$(".prev-btn").hide():$(".prev-btn").show()}),$(".prev-btn").on("click",function(){o>1&&($(".multi-step-journal").hide(),o--,O(o)),X(o),$(".next-btn").show(),$(".save-btn").hide(),o===1?$(".prev-btn").hide():$(".prev-btn").show()});function O(C){$(".multi-step-journal").hide(),$(".multi-step-journal").eq(C-1).show()}function X(C){$(".step").removeClass("active"),$(".indicator-line").removeClass("active"),$(".step").each(function(p){p<C&&($(this).addClass("active"),$(this).next(".indicator-line").addClass("active"))})}O(o),X(o),o===1&&$(".prev-btn").hide(),$(".save-journal-btn").click(function(){var C={incomeObj:r,expensesObj:s,assetObj:e,liabilityObj:t,oeObj:i,adjustmentObj:l,client_id:$(this).attr("id").split("_")[1]};Te("new-client-journal-entry",C,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},p,w);function p(S){console.log(S),localStorage.setItem("journal","created"),window.location.href="clients"}function w(S,F,A){console.log(S)}});var B=localStorage.getItem("journal");B==="created"&&(a.fire({icon:"success",title:"Journal Entry",text:"New Journal Entry Saved"}),localStorage.removeItem("journal"))});var ie=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),me=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".save-account-type").on("click",function(){var n=$(".new-account-type-form").serializeArray(),c={},s=!0;if($.each(n,(e,t)=>{if(t.value===""){s=!1,$(`.new-account-type-form [name='${t.name}']`).addClass("is-invalid"),ie.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"});return}else c[t.name]=t.value,$(`.new-account-type-form [name='${t.name}']`).removeClass("is-invalid"),console.log(c)}),s){let e=function(i){console.log(i),localStorage.setItem("account-type","created"),location.reload()},t=function(i,l,m){$(".loader-container").addClass("visually-hidden");try{const v=JSON.parse(i.responseText);console.log("Parsed Response:",v),me.fire({icon:"warning",title:"Conflict",text:v.error})}catch(v){console.log("Could not parse JSON response:",v)}};var d=e,r=t;$(".loader-container").removeClass("visually-hidden"),Se("new-account-type",c,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t)}}),$(".save-account").on("click",function(){var n=$("#account-form").serializeArray(),c={},s=!0;if(console.log(n),$.each(n,(e,t)=>{if($(`#account-form [name='${t.name}']`).addClass("is-invalid"),t.value===""){ie.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"}),s=!1;return}else $(`#account-form [name='${t.name}']`).removeClass("is-invalid"),c[t.name]=t.value}),s){let e=function(i){localStorage.setItem("account","created"),location.reload()},t=function(i,l,m){$(".loader-container").addClass("visually-hidden");try{const v=JSON.parse(i.responseText);console.log("Parsed Response:",v),me.fire({icon:"warning",title:"Conflict",text:v.error})}catch(v){console.log("Could not parse JSON response:",v)}};var d=e,r=t;$(".loader-container").removeClass("visually-hidden"),we("new-account",c,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t)}}),$(".edit-coa").click(function(n){n.preventDefault();var c=$(this).attr("id"),s=$(`#edit-coa-form-${c}`).serializeArray(),d=!0,r={};$.each(s,(e,t)=>{if(t.value===""){$(`.edit-coa-form-${c} [name='${t.name}']`).addClass("is-invalild"),d=!1,ie.fire({icon:"warning",title:"Missing Field!",text:"Please fill all fields"});return}$(`.edit-coa-form-${c} [name='${t.name}']`).removeClass("is-invalild"),r[t.name]=t.value}),d&&$.ajax({type:"POST",url:"edit-coa",data:r,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){localStorage.setItem("account","updated"),location.reload()},error:function(e,t,i){try{const l=JSON.parse(e.responseText);console.log("Parsed Response:",l),me.fire({icon:"warning",title:"Conflict",text:l.message})}catch(l){console.log("Could not parse JSON response:",l)}}})});var o=localStorage.getItem("account-type"),a=localStorage.getItem("account");if(o==="created"){ie.fire({icon:"success",title:"New Account Type created!"}),localStorage.removeItem("account-type");return}if(a==="created"){localStorage.removeItem("account"),ie.fire({icon:"success",title:"New Account created!"}),localStorage.removeItem("account-type");return}if(a==="updated"){localStorage.removeItem("account"),ie.fire({icon:"success",title:"Account updated!"}),localStorage.removeItem("account-type");return}});$(document).ready(function(){var o=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),a=Swal.mixin({toast:!1,position:"bottom-end"});$(".new-user-save").on("click",function(c){var s=$(".new-user-form").serializeArray(),d={},r=!0;if($.each(s,(i,l)=>{if(l.value===""){r=!1,$(`.new-user-form [name='${l.name}']`).addClass("is-invalid"),o.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}else d[l.name]=l.value,$(`.new-user-form [name='${l.name}']`).removeClass("is-invalid")}),r){let i=function(m){localStorage.setItem("user","created"),location.reload()},l=function(m,v,x){try{const g=JSON.parse(m.responseText);console.log("Parsed Response:",g),a.fire({icon:"warning",title:"Conflict",text:g.message})}catch(g){console.log("Could not parse JSON response:",g)}};var e=i,t=l;Ce("new-user",d,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},i,l)}}),$(".remove-user").on("click",function(){var c=$(this).attr("id");$.ajax({url:`remove-user-${c}`,type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(s){console.log(s),localStorage.setItem("user","removed"),location.reload()},error:function(s,d,r){console.log(s)}})}),$(".edit-user-button").on("click",function(){var c=$(this).closest(".modal").find("form").serializeArray();console.log(c);var s=!0,d={};$.each(c,(r,e)=>{if(e.value===""){s=!1,$(`[name='${e.name}']`).addClass("is-invalid"),o.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}else d[e.name]=e.value,$(`[name='${e.name}']`).removeClass("is-invalid")}),s&&$.ajax({url:"update-user",type:"POST",data:d,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){localStorage.setItem("user","updated"),location.reload()},error:function(r,e,t){a.fire({icon:"error",title:"Fatal Error!",text:"Try reloading the page, if issue persist contact developer"})}})});var n=localStorage.getItem("user");n==="created"&&(o.fire({icon:"success",title:"User Created!",text:"User created successfuly"}),localStorage.removeItem("user")),n==="removed"&&(o.fire({icon:"success",title:"User Removed!",text:"User removed successfuly"}),localStorage.removeItem("user")),n==="updated"&&(o.fire({icon:"success",title:"User Updated!",text:"User Updated successfuly"}),localStorage.removeItem("user")),$(".search-users").on("keyup",function(){var c=$(this).val().toLowerCase();$(".users-table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(c)>-1)})}),$("#filter-users").on("change",function(){var c=$(this).val();$(".users-table tbody tr").each(function(){var s=$(this).data("category");c==="clear"?$(this).show():c===""||s===c?$(this).show():$(this).hide()})})});$(document).ready(function(){var o=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),a=Swal.mixin({toast:!1,position:"bottom-end"});$("#account-category").on("change",function(i){$("#billing-account-type").prop("disabled",!1),$.ajax({type:"POST",url:`get-account-types-${$(this).val()}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(l){console.log(l);let m='<option value="" selected hidden>Select Type</option>',v=!1;$.each(l,(x,g)=>{$.each(g,(T,O)=>{Object.keys(O).length>0&&(m+=`<option value="${O.id}">${O.ServiceRequirements}</option>`,v=!0)})}),v||(m='<option value="" selected hidden>Category has no type</option>'),$("#billing-account-type").html(m)},error:function(l){console.error(l),a.fire({icon:"error",title:"Error",text:`Could not load account types: ${l.responseText||l.statusText}`})}})}),$(document).on("change",'[id^="edit-account-category-"]',function(i){let l=$(this).attr("id").split("-").pop(),m=`#edit-billing-account-type-${l}`;console.log($(this).val()),console.log("Fetching types for modal:",l),$.ajax({type:"POST",url:`get-account-types-${$(this).val()}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(v){console.log(v);let x='<option value="" selected hidden>Select Type</option>',g=!1;$.each(v,(T,O)=>{$.each(O,(X,B)=>{Object.keys(B).length>0&&(x+=`<option value="${B.id}">${B.ServiceRequirements}</option>`,g=!0)})}),g||(x='<option value="" selected hidden>Category has no type</option>'),$(m).html(x)},error:function(v){console.error(v),a.fire({icon:"error",title:"Error",text:`Could not load account types: ${v.responseText||v.statusText}`})}})}),$(".edit-description").on("click",function(i){var l=$(this).attr("id").split("-").pop();i.preventDefault();var m={},v=$(`.update-description-form-${l}`).serializeArray(),x=!0;$.each(v,(g,T)=>{T.value===""&&(x=!1,o.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"}),$(`.update-description-form-${l} [name='${T.name}']`).addClass("is-invalid")),$(`.update-description-form-${l} [name='${T.name}']`).removeClass("is-invalid"),m[T.name]=T.value}),console.log(m),x&&$.ajax({type:"POST",url:"update/account-description",data:m,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(g){localStorage.setItem("account_description","updated"),location.reload()},error:function(g,T,O){a.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+g.responseText})}})}),$(".remove-description").on("click",function(){$.ajax({type:"POST",url:`remove/account-description/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){localStorage.setItem("account_description","removed"),location.reload()},error:function(i,l,m){a.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+i.responseText})}})}),$(".remove-coa").on("click",function(){$.ajax({type:"POST",url:`remove/coa/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){localStorage.setItem("coa","removed"),location.reload()},error:function(i,l,m){a.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+i.responseText})}})}),$(".save-account-description").on("click",function(i){var l=$(".account-description-form").serializeArray(),m={},v=!0;if($.each(l,(T,O)=>{if(O.value===""){$(`.account-description-form [name="${O.name}"]`).addClass("is-invalid"),o.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),v=!1;return}else m[O.name]=O.value,console.log(m),$(`.account-description-form [name="${O.name}"]`).removeClass("is-invalid")}),v){let T=function(X){localStorage.setItem("account_description","created"),location.reload()},O=function(X,B,C){try{const p=JSON.parse(X.responseText);console.log("Parsed Response:",p),a.fire({icon:"error",title:"Error",text:p.message})}catch(p){console.log("Could not parse JSON response:",p)}};var x=T,g=O;Fe("new-account-description",m,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},T,O)}}),$(".edit-sys-profile").on("click",function(i){i.preventDefault();var l=!0,m={},v=$("#sys-profile-form").serializeArray();$.each(v,(x,g)=>{g.value.trim()===""?(l=!1,$(`.sys-profile-form [name='${g.name}']`).addClass("is-invalid"),o.fire({icon:"warning",title:"Missing fields",text:"Please fill all fields"})):$(`.sys-profile-form [name='${g.name}']`).removeClass("is-invalid"),m[g.name]=g.value}),l&&$.ajax({type:"POST",url:"edit-sys-info",data:m,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(x){localStorage.setItem("system-profile","updated"),location.reload()},error:function(x,g,T){try{const O=JSON.parse(x.responseText);console.log("Parsed Response:",O),a.fire({icon:"error",title:"Error",text:O.message})}catch(O){console.log("Could not parse JSON response:",O)}}})}),$(".edit-user-privilege").on("click",function(i){i.preventDefault();var l=$(this).attr("id");console.log(l),$.ajax({url:`/users/toggle-privilege/${l}`,type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(m){localStorage.setItem("user_privilege_updated",m.message),location.reload()},error:function(m){o.fire({icon:"error",title:"An error occurred while updating the privilege."})}})}),$(".reset-expense").on("click",function(i){i.preventDefault(),$.ajax({type:"POST",url:"reset-expense",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(l){localStorage.setItem("expense","reset"),location.reload()},error:function(l,m,v){a.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+l.responseText})}})}),$(".reset-income").on("click",function(i){i.preventDefault(),$.ajax({type:"POST",url:"reset-income",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(l){localStorage.setItem("income","reset"),location.reload()},error:function(l,m,v){a.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+l.responseText})}})});var n=localStorage.getItem("account_description"),c=localStorage.getItem("system-profile"),s=localStorage.getItem("coa"),d=localStorage.getItem("expense"),r=localStorage.getItem("income"),e=localStorage.getItem("sales"),t=localStorage.getItem("user_privilege_updated");d&&(o.fire({icon:"success",title:"Expense Reset"}),localStorage.removeItem("expense")),r&&(o.fire({icon:"success",title:"Income Reset"}),localStorage.removeItem("income")),e&&(o.fire({icon:"success",title:"Sales Reset"}),localStorage.removeItem("sales")),n==="created"&&(o.fire({icon:"success",title:"Account Description Created!"}),localStorage.removeItem("account_description")),n==="removed"&&(o.fire({icon:"success",title:"Account Description Removed!"}),localStorage.removeItem("account_description")),n==="updated"&&(o.fire({icon:"success",title:"Account Description Updated!"}),localStorage.removeItem("account_description")),c==="updated"&&(o.fire({icon:"success",title:"System Profile Updated"}),localStorage.removeItem("system-profile")),s==="removed"&&(o.fire({icon:"success",title:"Account Removed"}),localStorage.removeItem("coa")),t&&(o.fire({icon:"success",title:t}),localStorage.removeItem("user_privilege_updated"))});var ce=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),fe=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".update-client-service-progress-btn").on("click",function(){var n=$(this).attr("id"),c=$(`.update-service-progress-${n}`).serializeArray();console.log(c),$.ajax({type:"POST",url:"update-client-service",data:{serviceId:n,serviceVal:c},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(s){localStorage.setItem("service","updated"),location.reload()},error:function(s,d,r){try{const e=JSON.parse(s.responseText);console.log("Parsed Response:",e),fe.fire({icon:"warning",title:"Conflict",text:e.Conflict})}catch(e){console.log("Could not parse JSON response:",e)}}})}),$(".edit-company-info").on("click",function(n){var c=$(`.edit-company-info-${$(this).attr("id")}`).serializeArray(),s=!0,d={};$.each(c,(r,e)=>{e.value===""&&(s=!1,$(`.edit-company-info-${$(this).attr("id")} [name='${e.name}']`).addClass("is-invalid"),ce.fire({icon:"warning",title:"Missingg Fields",text:"Please fill all fields"})),d[e.name]=e.value}),s&&$.ajax({type:"POST",url:"update-company-info",data:d,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){localStorage.setItem("company-info","updated"),location.reload()},error:function(r,e,t){fe.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+r})}})}),$(".remove-client-service").on("click",function(){$.ajax({type:"POST",url:`client-profile/service/remove/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){localStorage.setItem("service","removed"),location.reload()},error:function(n,c,s){fe.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+n})}})});var o=localStorage.getItem("company-info"),a=localStorage.getItem("service");a==="updated"&&(ce.fire({icon:"success",text:"Client Service Updated"}),localStorage.removeItem("service")),a==="removed"&&(ce.fire({icon:"success",text:"Client Service Removed"}),localStorage.removeItem("service")),o==="updated"&&(localStorage.removeItem("company-info"),ce.fire({icon:"success",text:"Company Info Updated"}))});$(document).ready(function(){var o=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),a=Swal.mixin({toast:!1,position:"bottom-end"}),n=0,c=window.servicesData;console.log(c);var s={Service:[]},d={SubService:[]},r={accounts:[]};$.each(c,(t,i)=>{$.each(i.Service,(l,m)=>{s.Service.push({Service:{service_name:l,service_id:Object.keys(m.parent_service_id)[0],service_price:m.parent_service_id[Object.keys(m.parent_service_id)[0]].parentServicePrice}}),m.sub_service&&$.each(m.sub_service,(v,x)=>{$.each(x,(g,T)=>{$.each(T,(O,X)=>{$.each(X.account_descriptions,(B,C)=>{r.accounts.push({Accounts:{Account:C.Description,account_id:C.adID.toLocaleString(),price:C.Price}})})})}),$.each(x.sub_service_id,g=>{let T=Object.keys(x.sub_service_id)[0],O=x.sub_service_id[T].sub_service_price;d.SubService.push({SubService:{sub_service_name:v,sub_service_id:g,sub_service_price:O}})})})})}),$(".price").each(function(){var t=$(this).text(),i=t.replace(/[^\d.-]/g,""),l=parseFloat(i);n+=l}),$(".remove-parent-service-billing-action").click(function(){var t=$(this).attr("id").split("_")[1],i=$(this).closest("tr").find("td:nth-last-child(2)").text(),l=i.replace(/[^\d.-]/g,""),m=parseFloat(l);n-=m,$(".overall-due").text(n.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(n.toLocaleString(void 0,{minimumFractionDigits:2}));var v=s.Service.findIndex(x=>x.Service.service_id===t);console.log("Service ID to remove:",t),v!==-1?(s.Service.splice(v,1),$(this).closest("tr").remove()):console.log("Service not found")}),$(".remove-sub-service-billing-action").click(function(){var t=$(this).attr("id").split("_")[1],i=$(this).closest("tr").find("td:nth-last-child(2)").text(),l=i.replace(/[^\d.-]/g,""),m=parseFloat(l);n-=m,$(".overall-due").text(n.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(n.toLocaleString(void 0,{minimumFractionDigits:2}));var v=d.SubService.findIndex(x=>x.SubService.sub_service_id===t);v!==-1&&(d.SubService.splice(v,1),$(this).closest("tr").remove())}),$(document).on("click",".remove-account-description-billing-action",function(){var t=$(this).attr("id").split("_")[1],i=$(this).closest("tr").find("td:nth-last-child(2)").text(),l=i.replace(/[^\d.-]/g,""),m=parseFloat(l),v=0;v=m-m,n-=m,$("#additional-description-subtotal").text(v.toLocaleString(void 0,{minimumFractionDigits:2})),$(".overall-due").text(n.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(n.toLocaleString(void 0,{minimumFractionDigits:2}));var x=r.accounts.findIndex(g=>g.Accounts.account_id===t);x!==-1?(r.accounts.splice(x,1),$(this).closest("tr").remove(),console.log(r)):console.log("Account not found")}),console.log(r),$(".add-description").on("click",function(){var t=0,i=$(this).closest("tr"),l=i.data("service"),m=i.data("requirements"),v=i.data("category"),x=i.data("description"),g=i.data("taxtype"),T=i.data("formtype"),O=i.data("price"),X=i.data("id"),B=O.replace(/[^\d.-]/g,""),C=parseFloat(B),p=C.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"),w=r.accounts.some(F=>F.Accounts.Account===x);if(w)o.fire({icon:"warning",title:"Conflict",text:"Account Description already exists!"});else{r.accounts.push({Accounts:{Account:x,account_id:i.attr("id").toLocaleString(),price:O,isAdded:!0}}),n+=C,t+=C,$("#additional-description-subtotal").text(t.toLocaleString(void 0,{minimumFractionDigits:2})),$(".overall-due").text(n.toLocaleString(void 0,{minimumFractionDigits:2}));var S=`
            <tr>
                <td>${l}</td>
                <td>${m}</td>
                <td>${v}</td>
                <td>${x}</td>
                <td>${g}</td>
                <td>${T}</td>
                <td>${p}</td>
                <td>
                    <span class="badge fw-bold text-light bg-danger remove-account-description-billing-action" id='${X}'><i class="fas fa-trash"></i></span>
                </td>
            </tr>
        `;$(".append-ad").append(S)}}),$(".mail-client-bs").click(function(){var t=$("#dd").val(),i=$(".billing-id").text(),l=$(".date").text(),m=$(this).attr("id");if(console.log(s),t===""||t===void 0){$("#dd").addClass("is-invalid"),o.fire({icon:"warning",title:"Missing Field",text:"Please add due date before proceeding"});return}$("#dd").removeClass("is-invalid");var v={dueDate:t,date:l,serviceObj:s,subServiceObj:d,accountDescriptions:r,refID:m,billingId:i};Oe("mail-client-billing",v,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},function(x){window.location.href="clients",localStorage.setItem("billing","created")},function(x,g,T){try{const O=JSON.parse(x.responseText);a.fire({icon:"warning",title:"Conflict",text:O.Message})}catch(O){console.log("Could not parse JSON response:",O)}})});var e=localStorage.getItem("billing");e==="created"&&(o.fire({icon:"success",title:"Billing Created",text:"Billing successfully created"}),localStorage.removeItem("billing"))});var de=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),De=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".view-journal-btn").on("click",function(o){var a=$(this).attr("id");$.ajax({type:"POST",url:`view-client-journal-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(n){console.log(n);var c=new Blob([n],{type:"application/pdf"}),s=URL.createObjectURL(c);window.open(s,"_blank")},error:function(n,c,s){De.fire({icon:"error",title:"Oops Something went wrong!",text:n.responseJSON?n.responseJSON.error:"Unknown error"})}})}),$(".gen-client-billing-pdf").click(function(){$.ajax({type:"POST",url:`client-billing-data_${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var a=new Blob([o],{type:"application/pdf"}),n=URL.createObjectURL(a);window.open(n,"_blank")},error:function(o,a,n){de.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".gen-expense-pdf").on("click",function(){$.ajax({type:"POST",url:"expense/pdf/expense",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var a=new Blob([o],{type:"application/pdf"}),n=URL.createObjectURL(a);window.open(n,"_blank")},error:function(o,a,n){de.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".income-gen-pdf").on("click",function(){$.ajax({type:"POST",url:"income/pdf/income",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var a=new Blob([o],{type:"application/pdf"}),n=URL.createObjectURL(a);window.open(n,"_blank")},error:function(o,a,n){de.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".generate-client-billing-pdf").on("click",function(){$.ajax({type:"POST",url:`client/billing/pdf/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var a=new Blob([o],{type:"application/pdf"}),n=URL.createObjectURL(a);window.open(n,"_blank")},error:function(o,a,n){de.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})})});var re=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),Re=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".journal-pin-entry").on("submit",function(a){a.preventDefault();var n=$(this).serializeArray(),c=!0;$.each(n,(s,d)=>{d.value===""?(re.fire({icon:"warning",title:"Missing PIN",text:"Please enter PIN"}),c=!1,$(`[name='${d.name}']`).addClass("is-invalid")):$(`[name='${d.name}']`).remove("is-invalid")}),c&&$.ajax({type:"POST",url:"journal-pin-entry",data:n,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(s){var d=new Blob([s],{type:"application/pdf"}),r=URL.createObjectURL(d);window.open(r,"_blank"),console.log("asdasd")},error:function(s,d,r){s.status===400?re.fire({icon:"error",title:s.statusText,text:"Incorrect PIN"}):re.fire({icon:"error",title:"Something went wrong",text:"Fatal error. Translated: "+d})}})}),$(".request-journal-pin").click(function(){$.ajax({type:"POST",url:`request-journal-pin_${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){re.fire({icon:"success",title:"User Notified",text:"Email has been successfully sent to the user."})},error:function(a,n,c){console.error("Error:",c),re.fire({icon:"error",title:"Notification Failed",text:"Failed to send the email to the user. Please try again later."})}})}),$(".remove-journal-entry").click(function(){$.ajax({type:"POST",url:`archive-journal-entry-${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){localStorage.setItem("journal","Removed"),location.reload()},error:function(a,n,c){Re.fire({icon:"error",title:"Oops! Something went wrong",text:"Error Translated: "+a})}})});var o=localStorage.getItem("journal");o==="Removed"&&(localStorage.removeItem("journal"),re.fire({icon:"success",title:"Journal Update",text:"Journal Successfully removed"}))});var ke=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});$(document).ready(function(){$('select[name="JournalStatus"]').on("change",function(){var o=$(this).closest(".modal"),a=o.find(".journal-draft-note");$(this).val()==="Rejected"||$(this).val()==="Canceled"?a.removeClass("visually-hidden"):a.addClass("visually-hidden").val("")}),$(".update-journal-status").on("click",function(){$(".update-journal-status-loader").removeClass("visually-hidden");var o=$(this).attr("id");console.log(o);var a=$(`#update-journal-status-${o}`),n=a.find(`#serviceprogress-${o}`).val(),c=a.find(`#note-${o}`);if((n==="Canceled"||n==="Rejected")&&c.val().trim()===""){Swal.fire({icon:"error",title:"Validation Error",text:'Please provide a note when the status is "Canceled" or "Rejected".'}),c.addClass("is-invalid");return}var s=$(`.update-journal-status-form-${o}`).serializeArray();$.ajax({type:"POST",url:"/update-journal-status",data:s,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(d){$(".update-journal-status-loader").addClass("visually-hidden"),localStorage.setItem("journal-status","updated"),location.reload()},error:function(d){$(".update-journal-status-loader").addClass("visually-hidden"),console.error(d)}})}),localStorage.getItem("journal-status")==="updated"&&(ke.fire({icon:"success",title:"Journal Status Updated",text:"Journal status updated successfully"}),localStorage.removeItem("journal-status"))});var H=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),oe=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){let o=1;var a=window.journalIncome,n=window.journalExpense,c=window.journalAssets,s=window.journalLiability,d=window.journalOE,r=a,e=n,t={},i={},l={},m={};$.each(c,(h,u)=>{const y=[];y.push({assetAccount:u.account,amount:u.amount}),t[u.asset_category]={accounts:y}}),$.each(s,(h,u)=>{const y=[];var f=u.AccountType;y.push({liabilityAccount:u.account,amount:u.amount}),i[f]={accounts:y}}),$.each(d,(h,u)=>{const y=[];var f=u.AccountType;y.push({oeAccount:u.account,amount:u.amount}),l[f]={accounts:y}});let v="";$("#audit-income-category").on("change",function(){v=$(this).val(),$(".audit-income-form").removeClass("visually-hidden"),$(".saved-audited-income-months").empty()}),$("#audit-expense-category").on("change",function(){v=$(this).val(),$(".audit-expense-form").removeClass("visually-hidden"),$(".saved-audited-expense-months").empty()}),$(".audit-income-start-date, .audit-income-end-date").on("change",function(){const h=$(".audit-income-start-date").val(),u=$(".audit-income-end-date").val();if($("#audit-income-category").val()===""){H.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(h&&u){const f=new Date(h),k=new Date(u),D=$(".audit-income-months-container");var y='<div class="row">';if((k.getFullYear()-f.getFullYear())*12+(k.getMonth()-f.getMonth())>12){oe.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const U=new Date(f);if(U.setMonth(U.getMonth()+11),k>U){oe.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}D.empty(),y+="";let _=new Date(f);for(;_<=k;){const j=_.toLocaleString("default",{month:"long",year:"numeric"});y+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control audit-income-month-input" name="${j}" id="" placeholder='${j}' value="">
                    </div>
                    </div>`,_.setMonth(_.getMonth()+1)}y+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-income-audit-months form-control">Save</button>
            </div>`,y+="</div>",D.html(y)}$(document).on("input",".audit-income-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-income-audit-months",function(h){h.preventDefault();let u=[],y=!0;if(r.hasOwnProperty(v)){H.fire({icon:"warning",title:"Account Already Exists!",text:"You have already added this account."}),$(".audit-income-end-date").val(""),$(".audit-income-start-date").val(""),$(".audit-income-months-container").empty(),console.log(!0);return}if($(".audit-income-month-input").each(function(){var f=$(this).attr("name");console.log(f);var k=$(this).val();k!==""&&(y=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),u.push({incomeMonthName:f,value:$(this).val(),startDate:$(".audit-income-start-date").val(),endDate:$(".audit-income-end-date").val()}))}),y){$(".audit-income-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),H.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}r[v]={months:u,startDate:$(".audit-income-start-date").val(),endDate:$(".audit-income-end-date").val()},$("#saved-audited-income-months").empty(),$.each(r,(f,k)=>{var D='<table class="table table-hover client-journal-accounts">',I=f.split("_");D+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${I[1]}
                        <span class="text-sm fw-bold float-right remove-audit-income" id="${f}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(k.months,(U,_)=>{D+=`
                    <tr>
                        <td class='text-left'>${_.incomeMonthName}</td>
                        <td class='text-left'>${_.value}</td>
                    </tr>
                `}),D+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,D+="</table>",$("#saved-audited-income-months").append(D)}),$(".audit-income-months-container").empty(),$("#audit-income-category").val(""),$(".audit-income-end-date").val(""),$(".audit-income-start-date").val(""),v="",y=!0,console.log(r)}),$(".audit-expense-start-date, .audit-expense-end-date").on("change",function(){const h=$(".audit-expense-start-date").val(),u=$(".audit-expense-end-date").val();if($("#audit-expense-category").val()===""){H.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(h&&u){const f=new Date(h),k=new Date(u),D=$(".audit-expense-months-container");var y='<div class="row">';if((k.getFullYear()-f.getFullYear())*12+(k.getMonth()-f.getMonth())>12){oe.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const U=new Date(f);if(U.setMonth(U.getMonth()+11),k>U){oe.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}D.empty(),y+="";let _=new Date(f);for(;_<=k;){const j=_.toLocaleString("default",{month:"long",year:"numeric"});y+=`<div class="col-sm-6 my-2">
                <div class="input-group">
                <input type="text" class="form-control audit-expense-month-input" name="${j}" id="" placeholder='${j}' value="">
                </div>
                </div>`,_.setMonth(_.getMonth()+1)}y+=`
        <div class="col-sm-6 my-2 text-right">
            <button type='button' class="btn btn-primary save-expense-audit-months form-control">Save</button>
        </div>`,y+="</div>",D.html(y)}$(".audit-expense-months-container").on("input",".audit-expense-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-expense-audit-months",function(h){h.preventDefault();let u=[],y=!0;if(e.hasOwnProperty(v)){H.fire({icon:"warning",title:"Account Already Exists!",text:"You have already added this account."}),$(".audit-iexpensencome-end-date").val(""),$(".audit-expense-start-date").val(""),$(".audit-expense-months-container").empty();return}if($(".audit-expense-month-input").each(function(){var f=$(this).attr("name"),k=$(this).val();k!==""&&(y=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),u.push({expenseMonthName:f,value:$(this).val(),startDate:$(".audit-expense-start-date").val(),endDate:$(".audit-expense-end-date").val()}))}),y){$(".audit-expense-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),H.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}e[v]={months:u,startDate:$(".audit-expense-start-date").val(),endDate:$(".audit-expense-end-date").val()},$("#saved-audited-expense-months").empty(),$.each(e,(f,k)=>{var D='<table class="table table-hover client-journal-accounts">',I=f.split("_");D+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${I[1]}
                        <span class="text-sm fw-bold float-right remove-audit-expense" id="${f}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(k.months,(U,_)=>{D+=`
                    <tr>
                        <td class='text-left'>${_.expenseMonthName}</td>
                        <td class='text-left'>${_.value}</td>
                    </tr>
                `}),D+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,D+="</table>",$("#saved-audited-expense-months").append(D)}),$(".audit-expense-months-container").empty(),$("#audit-expense-category").val(""),$(".audit-expense-end-date").val(""),$(".audit-expense-start-date").val(""),v="",y=!0}),$(".save-audit-asset-info").on("click",function(h){h.preventDefault();var u=$(".journal-audit-asset-form").serializeArray(),y="",f="",k="";let D=!1;if($.each(u,(_,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="assetType"?y=j.value:j.name==="assetAccount"?f=j.value:j.name==="assetAmount"&&(k=j.value)}),!y||!f||!k){console.error("Required fields are missing.");return}if($.each(t,(_,j)=>{if($.each(j.accounts,(W,J)=>{if(J.assetAccount===f.split("_")[0])return D=!0,!1}),D)return!1}),D)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var I=y.split("_");t[I[0]]||(t[I[0]]={accounts:[]}),t[I[0]].accounts.push({assetAccount:f.split("_")[0],amount:k}),$(".append-audit-asset-accounts").empty();let U="";$.each(t,(_,j)=>{$.each(j.accounts,(W,J)=>{var Q=J.amount,G=Q.toString().replace(/,/g,""),M=parseFloat(G).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});U+=`
            <tr id="${_}">
                <td class='text-sm'>${_}</td>
                <td class='text-sm'>${J.assetAccount}</td>
                <td class='text-sm'>
                    ${M}
                    <span class="badge fw-bold text-dark float-right remove-audited-asset" id="${J.assetAccount}">
                        <i class="fas fa-times"></i>
                    </span>
                </td>
            </tr>`})}),$(".append-audit-asset-accounts").append(U),$("#asset_account").val(""),$("#asset_account_name  option:first").text("Select Account"),$("#assetAmount").val(""),D=!1}),$(".save-audit-liability-info").on("click",function(h){h.preventDefault();var u=$(".journal-audit-liability-form").serializeArray(),y="",f="",k="";let D=!1;if($.each(u,(_,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="audit-liability-account"?y=j.value:j.name==="audit-liability-account-name"?f=j.value:j.name==="liability-amount"&&(k=j.value)}),!y||!f||!k){console.error("Required fields are missing.");return}if($.each(i,(_,j)=>{if($.each(j.accounts,(W,J)=>{if(J.liabilityAccount===f.split("_")[0])return D=!0,!1}),D)return!1}),D)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var I=y.split("_");i[I[0]]||(i[I[0]]={accounts:[]}),i[I[0]].accounts.push({liabilityAccount:f.split("_")[0],amount:k}),$(".append-audit-liability-accounts").empty();let U="";$.each(i,(_,j)=>{$.each(j.accounts,(W,J)=>{var Q=J.amount,G=Q.toString().replace(/,/g,""),M=parseFloat(G).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});U+=`
                <tr id="${_}">
                    <td class='text-sm'>${_}</td>
                    <td class='text-sm'>${J.liabilityAccount}</td>
                    <td class='text-sm'>
                        ${M}
                        <span class="badge fw-bold text-dark float-right remove-audit-liability" id="${J.liabilityAccount}">
                            <i class="fas fa-times"></i>
                        </span>
                    </td>
                </tr>`})}),$(".append-audit-liability-accounts").append(U),$("#liability_account").val(""),$("#liability_account_name  option:first").text("Select Account"),$("#liabilityAmount").val(""),D=!1}),$(".save-audit-oe-info").on("click",function(h){h.preventDefault();var u=$(".journal-audit-oe-form").serializeArray(),y="",f="",k="";let D=!1;if($.each(u,(_,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="oe-account"?y=j.value:j.name==="oe-account-name"?f=j.value:j.name==="oe-amount"&&(k=j.value)}),!y||!f||!f){console.error("Required fields are missing.");return}if($.each(l,(_,j)=>{if($.each(j.accounts,(W,J)=>{if(J.oeAccount===f.split("_")[0])return D=!0,!1}),D)return!1}),D)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var I=y.split("_");l[I[0]]||(l[I[0]]={accounts:[]}),l[I[0]].accounts.push({oeAccount:f.split("_")[0],amount:k}),$(".append-audit-oe-accounts").empty();let U="";$.each(l,(_,j)=>{$.each(j.accounts,(W,J)=>{var Q=J.amount,G=Q.toString().replace(/,/g,""),M=parseFloat(G).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});U+=`
            <tr id="${_}">
                <td class='text-sm'>${_}</td>
                <td class='text-sm'>${J.oeAccount}</td>
                <td class='text-sm'>
                    ${M}
                    <span class="badge fw-bold text-dark float-right remove-audit-oe" id="${_}">
                        <i class="fas fa-times"></i>
                    </span>
                </td>
            </tr>`})}),$(".append-audit-oe-accounts").append(U),$("#oe-account").val(""),$("#oe-account-name  option:first").text("Select Account"),$("#oeAmount").val(""),D=!1}),$(document).on("click",".remove-audit-income",function(){$(this).closest("tr").remove();var h=$(this).attr("id");delete r[h],$("#saved-audited-income-months").empty(),$.each(r,(u,y)=>{var f='<table class="table table-hover client-journal-accounts">',k=u.split("_");f+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${k[1]}
                        <span class="text-sm fw-bold float-right remove-audit-income" id="${u}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(y.months,(D,I)=>{f+=`
                    <tr>
                        <td>${I.incomeMonthName}</td>
                        <td>${I.value}</td>
                    </tr>
                `}),f+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,f+="</table>",$("#saved-audited-income-months").append(f)}),console.log(r)}),$(document).on("click",".remove-audit-expense",function(h){delete e[$(this).attr("id")],$(this).closest("tr").remove(),$("#saved-audited-expense-months").empty(),$.each(e,(u,y)=>{var f='<table class="table table-hover client-journal-accounts">',k=u.split("_");f+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${k[1]}
                        <span class="text-sm fw-bold float-right remove-audit-expense" id="${u}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(y.months,(D,I)=>{f+=`
                    <tr>
                        <td class='text-left'>${I.expenseMonthName}</td>
                        <td class='text-left'>${I.value}</td>
                    </tr>
                `}),f+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,f+="</table>",$("#saved-audited-expense-months").append(f)})}),$(document).on("click",".remove-audited-asset",function(h){h.preventDefault(),$(this).closest("tr").remove();for(let u in t)t[u].accounts&&(t[u].accounts=t[u].accounts.filter(y=>y.assetAccount!==$(this).attr("id"))),t[u].accounts.length===0&&delete t[u]}),$(document).on("click",".remove-audit-liability",function(h){h.preventDefault(),$(this).closest("tr").remove();for(let u in i)i[u].accounts&&(i[u].accounts=i[u].accounts.filter(y=>y.liabilityAccount!==$(this).attr("id"))),i[u].accounts.length===0&&delete i[u]}),$(document).on("click",".remove-audit-oe",function(h){h.preventDefault(),$(this).closest("tr").remove();for(let u in l)l[u].accounts&&(l[u].accounts=l[u].accounts.filter(y=>y.oeAccount!==$(this).attr("id"))),l[u].accounts.length===0&&delete l[u]});var x=0,g=0,T=0,O=0,X=0,B=0,C=0,p=0,w=0,S=0,F=0;console.log(e),$(".audit-next-btn").on("click",function(){if(o===1){if($("#append-audit-expenses-choy").empty(),$(".revenue-audit-income-total").empty(),Object.keys(r).length===0){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var h='<div class="col-sm-12 ml-3 text-dark" id="append-audit-expenses-choy">',u=0;$.each(r,(E,b)=>{h+='<div class="row mb-2">';const N=E.includes("_")?E.split("_")[1]:E;h+=`<div class="col-6 revenue-audit-accounts">${N}</div>`,console.log(E),$.each(b.months,(q,K)=>{var Y=K.value.replace(/,/g,""),L=parseFloat(Y);x+=L,u+=L}),h+=`<div class="col-6 text-right revenue-audit-amount">${u.toLocaleString()}</div>`,h+="</div>"}),h+="</div>",$("#append-audit-expenses-choy").html(h),$(".revenue-audit-income-total").text(x.toLocaleString())}if(o===2){if($(".append-audit-oe").empty(),$(".append-audit-ldc").empty(),Object.keys(e).length===0){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var y=!1,f=!1;if($.each(e,(E,b)=>{var N=E.split("_"),q=N[2];q==="Less Direct Cost"?y=!0:q==="Operating Expenses"&&(f=!0)}),!y||!f){H.fire({icon:"warning",title:"Missing Data",text:'Both "Less Direct Cost" and "Operating Expenses" entries are required.'});return}X=0,$.each(e,(E,b)=>{var N=E.split("_")[1];if(E.split("_")[2]==="Less Direct Cost"){var q="";$.each(b.months,(Y,L)=>{var ne=L.value.replace(/,/g,""),ae=parseFloat(ne);T+=ae,q+=`
                        <div class="row">
                            <div class="col-sm-6 text-left">${N}</div>
                            <div class="col-sm-6 text-right">${ae.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</div>
                        </div>
                        `}),$(".append-audit-ldc").append(q)}if(E.split("_")[2]==="Operating Expenses"){var K="";$.each(b.months,(Y,L)=>{var ne=L.value.replace(/,/g,""),ae=parseFloat(ne);X+=ae,K+=`
                        <div class="row">
                            <div class="col-sm-6 text-left">${N}</div>
                            <div class="col-sm-6 text-right">${ae.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</div>
                        </div>
                        `}),$(".append-audit-oe").append(K)}}),O=x-T,g=O-X,$(".expenses-ldc-audit-total").text(T.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".gries-audit-total").text(O.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".tgi-audit").text(O.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".oe-audit-total").text(X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".net-audit-amount").text(g.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))}if(o===3){if($(".append-ca-audit").empty(),$(".append-audit-nca").empty(),$(".append-audit-fa").empty(),!Object.keys(t).some(b=>t[b].accounts&&t[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var k="",D="",I="";$.each(t,(b,N)=>{b==="Current Asset"&&$.each(N.accounts,(q,K)=>{var Y=K.amount.replace(/,/g,""),L=parseFloat(Y);C+=L,k+=`
                                <div class="row">
                                    <span class="col-sm-6 text-sm text-left">${K.assetAccount}</span>
                                    <span class="col-sm-6 text-sm text-right">${L.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                                </div>
                            `}),b==="Non-Current Assets"&&$.each(N.accounts,(q,K)=>{var Y=K.amount.replace(/,/g,""),L=parseFloat(Y);B+=L,D+=`
                            <div class="row">
                                <span class="col-sm-6 text-sm text-left">${K.assetAccount}</span>
                                <span class="col-sm-6 text-sm text-right">${L.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                            </div>
                        `}),b==="Fixed Assets"&&$.each(N.accounts,(q,K)=>{var Y=K.amount.replace(/,/g,""),L=parseFloat(Y);p+=L,I+=`
                        <div class="row">
                            <span class="col-sm-6 text-sm text-left">${K.assetAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${L.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `}),$(".append-ca-audit").html(k),$(".append-audit-nca").html(D),$(".append-audit-fa").html(I),$(".tnca-audit-amount").text(B.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".total-audit-ca").text(C.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),w=C+B+p,$(".total-audit-assets").text(w.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))})}if(o===4){if(S=0,$(".append-audit-cl").empty(),!Object.keys(i).some(b=>i[b].accounts&&i[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var U="";$.each(i,(b,N)=>{$.each(N.accounts,(q,K)=>{var Y=K.amount.replace(/,/g,""),L=parseFloat(Y);S+=L,U+=`
                        <div class="row">
                            <span class="col-sm-6 text-sm text-left">${K.liabilityAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${L.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `})}),$(".append-audit-cl").html(U)}if(o===5){F=0,$(".append-audit-oenw").empty();var _="";if(!Object.keys(l).some(b=>l[b].accounts&&l[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}$.each(l,(b,N)=>{$.each(N.accounts,(q,K)=>{var Y=K.amount.replace(/,/g,""),L=parseFloat(Y);F+=L,_+=`<div class="row">
                            <span class="col-sm-6 text-sm text-left">${K.oeAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${L.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `})}),$(".append-audit-oenw").html(_)}if(o===6){var j=$(".journal-audit-adjustments-form").serializeArray(),W=!0;if($.each(j,(E,b)=>{if(b.value===""){W=!1,$(`[name='${b.name}']`).addClass("is-invalid");return}m[b.name]=b.value,$(`[name='${b.name}']`).removeClass("is-invalid")}),!W){H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}var J=0,Q=0;$.each(m,(E,b)=>{if(E==="audit-owners_contribution"){var N=b.replace(/,/g,""),q=parseFloat(N);J+=q}if(E==="audit-owners_withdrawal"){var N=b.replace(/,/g,""),q=parseFloat(N);Q+=q}});var G=Q+g;$(".additional-audit-capital").text(J.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".audit-less-drawings").text(Q.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".fp-audit-nc").text(g.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".appraisal-audit-capital").text(G.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));var M=G-parseFloat($(".audit-less-drawings").text().replace(/[^0-9.-]+/g,""));$(".audit-capital-end").text(M.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));var z=S+F;$(".tlc-audit").text(z.toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}))}o<7&&($(".multi-step-journal-audit").hide(),o++,A(o)),R(o),o===7?($(".audit-next-btn").hide(),$(".audit-save-btn").show()):($(".audit-next-btn").show(),$(".audit-save-btn").hide()),o===1?$(".audit-prev-btn").hide():$(".audit-prev-btn").show()}),$(".audit-prev-btn").on("click",function(){o>1&&($(".multi-step-journal-audit").hide(),o--,A(o)),R(o),$(".audit-next-btn").show(),$(".audit-save-btn").hide(),o===1?$(".audit-prev-btn").hide():$(".audit-prev-btn").show()});function A(h){$(".multi-step-journal-audit").hide(),$(".multi-step-journal-audit").eq(h-1).show()}function R(h){$(".audit-step").removeClass("active"),$(".audit-indicator-line").removeClass("active"),$(".audit-step").each(function(u){u<h&&($(this).addClass("active"),$(this).next(".audit-indicator-line").addClass("active"))})}A(o),R(o),o===1&&$(".audit-prev-btn").hide(),$(".save-audit-journal-btn").on("click",function(){$(".audit-client-journal-loader").removeClass("visually-hidden");var h={incomeObj:r,expenseObj:e,assetObj:t,liabilityObj:i,oeObj:l,adjustmentObj:m,references:$(this).attr("id")};$.ajax({type:"POST",url:"client/journal/audit",data:h,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(u){$(".audit-client-journal-loader").addClass("visually-hidden"),localStorage.setItem("journal","updated"),window.location.href="clients"},error:function(u,y,f){$(".audit-client-journal-loader").addClass("visually-hidden"),oe.fire({icon:"error",title:"Something went wrong",text:`Translated: ${u} 
 if issue persist try reloading the page or contact developer`})}})});var P=localStorage.getItem("journal");P==="updated"&&(H.fire({icon:"success",title:"Journal Update",text:"Journal Updated Successfully"}),localStorage.removeItem("journal"))});var te=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){var o="";$(".add-new-service-req").on("click",function(c){console.log($(this).attr("id")),console.log("this sum bulshit");var s=$(this).attr("id").split("_"),d=s[1],r=$(`.service-req-${s[1]}`).serializeArray(),e=!0;$.each(r,(t,i)=>{if(i.value===""){te.fire({icon:"warning",title:"Missing Entry!",text:"Please Enter Requirement Name"}),e=!1,$('[name="req-name"]').addClass("is-invalid");return}$('[name="req-name"]').removeClass("is-invalid")}),e&&$.ajax({type:"POST",url:"requirement-for-service",data:{form:r,idref:d},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){console.log(t),localStorage.setItem("req","added"),location.reload()},error:function(t,i,l){te.fire({icon:"error",title:"Oops! Something Went wrong",text:"Translated: "+t})}})}),$(".add-new-sub-service-req").on("click",function(c){var s=$("#sub_service_id").val(),d=$("#sub-service-req-id").val();if((s===""||d==="")&&te.fire({icon:"warning",title:"Missing Entry!",text:"Please Enter Requirement Name"}),d===""){$("#sub-service-req-id").addClass("is-invalid");return}else $("#sub-service-req-id").removeClass("is-invalid"),$.ajax({type:"POST",url:"sub-service-requirement",data:{reqName:d,idRef:s},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){console.log(r),localStorage.setItem("req","added"),location.reload()},error:function(r,e,t){te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+r})}})}),$(".get-client-service-req").on("click",function(){o="",$(".append-service-req").empty(),console.log($(this).attr("id"));let c=$(this).attr("id");$(".service-reqs-loader").removeClass("visually-hidden");var s="";$.ajax({type:"POST",url:`client/service/requirements/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(d){o=d.category,console.log(d),console.log("this"),$(".service-reqs-loader").addClass("visually-hidden"),$.each(d.serviceReqs,(r,e)=>{let t="";e.gcon?t=`<td>${e.gcon}</td>`:t=`
                        <td><input type="file" class="req-file" id="${e.id}_${c}" data-id="${e.req_name}_${e.id}" name="${e.req_name}_${e.id}"></td>
                    `,s+=`
                        <tr>
                            <td>${e.req_name}</td>
                            ${t}
                        </tr>
                    `}),$(".append-service-req").append(s)},error:function(d,r,e){$(".service-reqs-loader").addClass("visually-hidden"),te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+d})}})}),$(".save-req-files").on("click",function(){let c=[],s=!1,d=new FormData;const r=$(this).attr("id");if($(".req-file").each(function(){if(this.files.length){s=!0;const e=$(this).attr("id"),t=o,i=this.files[0];c.push({service_id:r,sub_service_req_id:e,category:t,file:i.name}),d.append(`files[${e}]`,i)}}),!s){te.fire({icon:"error",title:"Please upload at least one file."});return}d.append("metadata",JSON.stringify(c)),$.ajax({type:"POST",url:"/service/requirement/document",data:d,processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){console.log(e),localStorage.setItem("req-docs","added"),location.reload()},error:function(e,t,i){te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+e})}})}),$(".view-client-service-doc").on("click",function(){$(".service-docs-loader").removeClass("visually-hidden"),console.log($(this).attr("id")),$(".append-service-docs").empty();let c="";$.ajax({type:"POST",url:`/service/requirement/documents/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(s){$(".service-docs-loader").addClass("visually-hidden"),console.log(s),$.each(s.docsData,(d,r)=>{console.log(r);let e="";r.grp&&r.grp.trim()!==""&&(e=`
                            <a href="storage/${r.grp}" 
                               download="${r.gcon}" 
                               class="badge bg-warning text-dark" 
                               style="font-size: 10px;">
                                <i class="fas fa-cloud-download-alt"></i> Download
                            </a>
                        `),c+=`
                        <tr>
                            <td>${r.req_name}</td>
                            <td>${r.gcon||"No file name"}</td>
                            <td>${r.gcmt}</td>
                            <td>${e}</td>
                        </tr>
                    `}),$(".append-service-docs").html(c)},error:function(s,d,r){$(".service-docs-loader").addClass("visually-hidden"),te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+s})}})});var a=localStorage.getItem("req-docs"),n=localStorage.getItem("req");n==="added"&&(te.fire({icon:"success",title:"Service Requirement",text:"New requirement added"}),localStorage.removeItem("req")),a==="added"&&(te.fire({icon:"success",title:"Service Requirement",text:"New requirement document is added"}),localStorage.removeItem("req-docs"))});$(document).ready(function(){Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});var o=Swal.mixin({toast:!1,position:"bottom-end"});$(".expense-quarter").change(function(){var a=$(this).val();if(!a||!["Q1","Q2","Q3","Q4"].includes(a)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`quarterly-expense-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){var c=n[a];if(c){let s=[],d=[];$.each(c.details,function(r,e){s.push(r),d.push(e.total)}),expenseChart.data.labels=s,expenseChart.data.datasets[0].data=d,expenseChart.update()}else console.error("No data found for quarter: "+a)},error:function(n,c,s){o.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+n})}})}),$(".income-quarter").change(function(){var a=$(this).val();if(!a||!["Q1","Q2","Q3","Q4"].includes(a)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`quarterly-income-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){var c=n[a];if(c){let s=[],d=[];$.each(c.details,function(r,e){s.push(r),d.push(e.total)}),lineChart.data.labels=s,lineChart.data.datasets[0].data=d,lineChart.update()}else console.error("No data found for quarter: "+a)},error:function(n,c,s){o.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+n})}})}),$(".sales-quarter").change(function(){var a=$(this).val();if(!a||!["Q1","Q2","Q3","Q4"].includes(a)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`quarterly-sales-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){var c=n[a];if(c){let s=[],d=[];$.each(c.details,function(r,e){s.push(r),d.push(e.total)}),salesChart.data.labels=s,salesChart.data.datasets[0].data=d,salesChart.update()}else console.error("No data found for quarter: "+a)},error:function(n,c,s){o.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+n})}})}),$(".client-quarter").change(function(){var a=$(this).val();if(!a||!["Q1","Q2","Q3","Q4"].includes(a)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`/quarterly-client-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){var c=n[a];if(c){let s=c.months,d=[];for(let r of s)d.push(c.details[r]?c.details[r].total:0);clientsChart.data.labels=s,clientsChart.data.datasets[0].data=d,clientsChart.update()}else console.error("No data found for quarter: "+a)},error:function(n){o.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+n})}})}),$("#yearInput").change(function(){var a=$(this).val();if(!a||isNaN(a)){console.error("Invalid year entered.");return}$.ajax({method:"POST",url:"filter-by-year-income",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{year:a},success:function(n){console.log("Year Data:",n);let c=Object.keys(n),s=Object.values(n);lineChart.data.labels=c,lineChart.data.datasets[0].data=s,lineChart.update()},error:function(n){console.error("AJAX Error:",n.responseText)}})}),$("#yearInputExpense").change(function(){var a=$(this).val();if(!a||isNaN(a)){console.error("Invalid year entered.");return}$.ajax({method:"POST",url:"filter-by-year-expense",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{year:a},success:function(n){console.log("Year Data:",n);let c=Object.keys(n),s=Object.values(n);expenseChart.data.labels=c,expenseChart.data.datasets[0].data=s,expenseChart.update()},error:function(n){console.error("AJAX Error:",n.responseText)}})}),$("#yearInputClient").change(function(){var a=$(this).val();if(!a||isNaN(a)){console.error("Invalid year entered.");return}$.ajax({method:"POST",url:"filter-by-year-client",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{year:a},success:function(n){console.log("Year Data:",n);let c=Object.keys(n),s=Object.values(n);clientsChart.data.labels=c,clientsChart.data.datasets[0].data=s,clientsChart.update()},error:function(n){console.error("AJAX Error:",n.responseText)}})}),$("#yearlySales").change(function(){var a=$(this).val();if(!a||isNaN(a)){console.error("Invalid year entered.");return}$.ajax({method:"POST",url:"yearly-sales",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{year:a},success:function(n){console.log("success");var c=n.details;if(c){let s=[],d=[];$.each(c,function(r,e){s.push(r),d.push(e.total)}),salesChart.data.labels=s,salesChart.data.datasets[0].data=d,salesChart.update()}else console.error("No data found for year: "+a)},error:function(n,c,s){o.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+n.responseText})}})})});$(document).ready(function(){window.formatValueInput=function(o){var a=o.value.replace(/[^0-9\.]/g,""),n=a.split(".");n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),n.length>1?o.value=n[0]+"."+n[1]:o.value=n[0]},window.previewImage=function(o,a){const c=o.target.files[0];if(c){const s=new FileReader;s.onload=function(d){const r=document.getElementById(a);r?r.src=d.target.result:console.error(`Preview element with ID ${a} not found.`)},s.readAsDataURL(c)}else console.warn("No file selected.")},$(".settings-info-box").hover(function(){$(this).find(".fa-trash").removeClass("visually-hidden")},function(){$(this).find(".fa-trash").addClass("visually-hidden")})});
