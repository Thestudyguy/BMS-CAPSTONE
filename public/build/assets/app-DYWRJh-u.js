function ve(o,a,n,c){$.ajax({url:o,type:"POST",data:a,success:function(r){n(r)},error:function(r,d,s){c(r,d,s)}})}function pe(o,a,n,c){$.ajax({url:o,type:"POST",headers:a,success:function(r){n(r)},error:function(r,d,s){c(r,d,s)}})}function $e(o,a,n,c,r,d){$.ajax({url:o,type:"POST",data:{...a,id:n},headers:c,success:function(s){r(s)},error:function(s,e,t){d(s,e,t)}}),console.log(a),console.log(n)}function he(o,a,n,c,r){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,s,e){r(d,s,e)}})}function ge(o,a,n,c,r,d){var s=new FormData;for(var e in a)a.hasOwnProperty(e)&&s.append(e,a[e]);n&&s.append("profile",n),$.ajax({url:o,type:"POST",data:s,headers:c,processData:!1,contentType:!1,success:function(t){r(t)},error:function(t,i,l){d(t,i,l)}})}function xe(o,a,n,c){$.ajax({url:o,type:"POST",headers:a,success:function(r){n(r)},error:function(r,d,s){c(r,d,s)}})}function be(o,a,n,c,r){$.ajax({url:o,type:"POST",data:a,headers:n,processData:!1,contentType:!1,success:function(d){c(d)},error:function(d,s,e){r(d,s,e)}})}function ye(o,a,n,c,r){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,s,e){r(d,s,e)}})}function Se(o,a,n,c,r){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,s,e){r(d,s,e)}})}function we(o,a,n,c,r){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,s,e){r(d,s,e)}})}function Ce(o,a,n,c,r){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,s,e){r(d,s,e)}})}function Fe(o,a,n,c,r){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,s,e){r(d,s,e)}})}function je(o,a,n,c,r){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,s,e){r(d,s,e)}})}function Oe(o,a,n,c,r){$.ajax({url:o,type:"POST",data:a,headers:n,success:function(d){c(d)},error:function(d,s,e){r(d,s,e)}})}var ee=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),G=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".search-coa").on("keyup",function(){var e=$(this).val().toLowerCase();$("#coa-table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(e)>-1)})}),$("#filter-coa").on("change",function(){var e=$(this).val();$(".coa-table tbody tr").each(function(){var t=$(this).data("category");e==="clear"?$(this).show():e===""||t===e?$(this).show():$(this).hide()})}),$(".client-table-data").hover(function(){$(this).find(".action-icons").removeClass("visually-hidden")},function(){$(this).find(".action-icons").addClass("visually-hidden")}),$(".new-sub-service-icon").on("click",function(e){e.stopPropagation()}),$(".edit-service-icon").on("click",function(e){e.stopPropagation()}),$(".view-service-details").on("click",function(e){e.stopPropagation()}),$(".remove-service-icon").on("click",function(e){e.stopPropagation()});function o(e){localStorage.setItem("transaction-status",e),location.reload()}$(".client-sub-table").on("click",function(){console.log($(this).attr("id")),$(this).closest("tr").next(".expandable-body").find(".loader-td")}),$(".external-service").on("click",function(){var e=$(this).next(".expandable-body").find(".loader");e.removeClass("visually-hidden");var t=$(this).attr("id");$.ajax({type:"POST",url:`sub-services-${t}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){e.addClass("visually-hidden");var l=i.services,m='<table class="table table-hover float-left append-sub-services">';m+=`
                <thead class="text-left">
                    <tr>
                        <td>Requirements</td>
                        <td>Price</td>
                    </tr>
                </thead> 
                `,$.each(l,(v,x)=>{var g=parseFloat(x.ServiceRequirementPrice).toFixed(2).toLocaleString(),O=Number(g).toLocaleString();m+=`
                    <tbody class="text-left">
                        <tr class='sub-service' id='${x.id}'>
                            <td>${x.ServiceRequirements}</td>
                            <td>${O}
                            <span id='${x.id}' class="badge mx-2 bg-warning float-right text-sm sub-service-action-icons-remove" data-bs-target='#remove-sub-service' data-bs-toggle='modal' >
                                <i class="fas fa-trash" style="font-size: .8em;"></i>
                            </span>
                            <span id='${x.id}' data-bs-target='#edit-sub-service-modal' data-bs-toggle='modal' class="badge bg-warning float-right text-sm sub-service-action-icons-edit">
                                <i class="fas fa-pen" style="font-size: .8em;"></i>
                            </span>
                            <span id='${x.id}' data-bs-target='#add-sub-service-req' data-bs-toggle='modal' class="mx-2 badge bg-warning float-right text-sm sub-service-action-icons-req">
                                <i class="fas fa-file" style="font-size: .8em;"></i>
                            </span>
                            </td>
                        </tr>
                    </tbody>                    
                    `}),m+="</table>",$(`.append-sub-services-${t}`).html(m)},error:function(i,l,m){G.fire({icon:"error",title:"Fatal Error",text:i})}})}),$(document).on("click",".sub-service-action-icons-req",function(){var e=$(this).attr("id");$.ajax({type:"POST",url:`retrieve-sub-service-data-${e}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){console.log(t.sub_service),$("#sub_service_id").attr("id",t.sub_service.id),$("#sub_service_id").val(t.sub_service.id),$(".sub-service-req-service-name").text(t.sub_service.ServiceRequirements)},error:function(t,i,l){G.fire({icon:"error",title:"Something went wrong",text:`Translated: ${t}`})}})}),$(document).on("click",".sub-service-action-icons-edit",function(e){$(".sub-service-loader").removeClass("visually-hidden");var t=$(this).attr("id");$.ajax({type:"POST",url:`retrieve-sub-service-data-${t}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){$(".sub-service-loader").addClass("visually-hidden"),console.log(i.sub_service.ServiceRequirementPrice),$("#service-edit-field").val(i.sub_service.ServiceRequirements),$("#serviceprice-edit-field").val(i.sub_service.ServiceRequirementPrice),$("#sub-service-edit-id").val(i.sub_service.id)},error:function(i,l,m){G.fire({icon:"error",title:"Something went wrong",text:`Translated: ${i}`})}})}),$(document).on("click",".sub-service-action-icons-remove",function(e){e.preventDefault();var t=$(this).attr("id"),i=$(this).closest("tr").find("td:eq(0)").text().trim();console.log(i),$(".sub-service-app").text(i),$(".remove-sub-service").attr("id",t)}),$(document).on("click",".remove-sub-service",function(){$.ajax({type:"POST",url:`remove-sub-service/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){localStorage.setItem("sub-service","removed"),location.reload()},error:function(e,t,i){G.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+e})}})}),$("#edit-sub-service").on("click",function(e){e.preventDefault();var t=$("#edit-sub-service-form").serializeArray(),i=!0,l={};if($.each(t,(x,g)=>{g.value===""?(i=!1,$(`[name='${g.name}']`).addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"})):($(`[name='${g.name}']`).removeClass("is-invalid"),l[g.name]=g.value)}),i){let x=function(O){console.log(O),localStorage.setItem("sub_service","updated"),location.reload()},g=function(O,F,X){var V=JSON.parse(O.responseText),w=V.error;if(w==="Service already exists"){$(".conflict-warning").removeClass("visually-hidden"),$("#new-service-form [name='Service']").addClass("is-invalid"),$(".conflict-text").text("Service already exists");return}else G.fire({icon:"error",title:"Fatal Error",text:`Translated: ${w}`}),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid")};var m=x,v=g;Fe("edit-sub-service",l,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},x,g)}}),$("#new-service-form").on("submit",function(e){e.preventDefault(),$(".conflict-text").text("Service already exists"),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid");var t={},i=$(this).serializeArray(),l=!1;if($.each(i,(x,g)=>{if(g.value==="")return $(`#new-service-form [name='${g.name}']`).addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),l=!0,!1;t[g.name]=g.value}),l)return;ve("new-service",t,m,v);function m(x){o("created")}function v(x,g,O){var F=JSON.parse(x.responseText),X=F.error;if(X==="Service already exists"){$(".conflict-warning").removeClass("visually-hidden"),$("#new-service-form [name='Service']").addClass("is-invalid"),$(".conflict-text").text("Service already exists");return}else G.fire({icon:"error",title:"Fatal Error",text:`Translated: ${X}`}),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid")}}),$(".remove-service").on("click",function(){pe(`remove-service-${$(this).attr("id")}`,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t);function e(i){o("removed")}function t(i,l,m){G.fire({icon:"error",title:"Fatal Error",text:i})}}),$(".edit-service").on("click",function(e){e.preventDefault();var t=$(this).attr("id"),i="#edit-service-form-"+t,l=$(i).serializeArray();console.log(l);var m={},v=!1;if($.each(l,(O,F)=>{if(F.value==="")return $(i+" [name='"+F.name+"']").addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),v=!0,!1;m[F.name]=F.value}),v)return;$e("update-service",m,t,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},x,g);function x(O){o("updated")}function g(O,F,X){var V=JSON.parse(O.responseText),w=V.error;G.fire({icon:"error",title:"Fatal Error",text:`Translated: ${w}`})}}),$(".submit-new-sub-service").on("click",function(e){e.preventDefault();var t=!0,i={},l=$(this).attr("id"),m=$(`#new-sub-service-${l}`).serializeArray();if(console.log(m),$.each(m,(g,O)=>{O.value===""?($(`[name='${O.name}']`).addClass("is-invalid"),t=!1):(i[O.name]=O.value,$(`[name='${O.name}']`).removeClass("is-invalid"))}),!t){ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}he("new-sub-service",i,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},v,x);function v(g){console.log(g),localStorage.setItem("sub_service","created"),location.reload()}function x(g,O,F){console.log(g),g.responseJSON&&g.responseJSON.message?(G.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${g.responseJSON.message}`}),console.log(g.responseJSON.errors)):G.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${g.responseJSON.error}`})}});var a={},n=document.getElementById("fileInput");$(".next-form").on("click",function(){var e=$(".multi-step:visible"),t=e.serializeArray(),i=!1,l=!1;if(e.find(".form-control").removeClass("is-invalid"),$.each(t,(F,X)=>{X.value===""&&($(`[name='${X.name}']`).addClass("is-invalid"),i=!0),a[X.name]=X.value}),e.hasClass("client-profile")&&(!n.files||n.files.length===0?($("#fileInput").addClass("is-invalid"),l=!0):$("#fileInput").removeClass("is-invalid")),i)ee.fire({icon:"warning",title:"Missing Fields",text:"Fill all fields to proceed"});else if(l)ee.fire({icon:"warning",title:"Missing File",text:"Please upload a profile picture before proceeding."});else{var m=e.next(".multi-step");if(m.hasClass("data-entry-preview")){$(".companyName").text($("[name='CompanyName']").val()),$(".companyEmail").text($("[name='CompanyEmail']").val()),$(".companyAddress").text($("[name='CompanyAddress']").val()),$(".companyCEO").text($("[name='CEO']").val()),$(".companyCEODob").text($("[name='CEODateOfBirth']").val()),$(".companyCEOContact").text($("[name='CEOContactInformation']").val()),$(".representativeName").text($("[name='RepresentativeName']").val()),$(".representativeContact").text($("[name='RepresentativeContactInformation']").val()),$(".representativeDob").text($("[name='RepresentativeDateOfBirth']").val()),$(".representativePosition").text($("[name='RepresentativePosition']").val()),$(".representativeAddress").text($("[name='RepresentativeAddress']").val());var v=document.getElementById("fileInput");if(v.files&&v.files[0]){var x=new FileReader;x.onload=function(F){$("#previewImage").attr("src",F.target.result).show()},x.readAsDataURL(v.files[0])}}m.length&&e.fadeOut(300,function(){$(this).hide(),m.fadeIn(200,function(){$(this).show()})});var g=$(".client-step.active"),O=g.next(".client-form-indicator-line");O.addClass("active"),O.next(".client-step").addClass("active"),$(".previous-form").removeClass("visually-hidden"),e.next(".multi-step").next(".multi-step").length||($(".next-form").addClass("visually-hidden"),$(".save").removeClass("visually-hidden"))}}),$(".previous-form").on("click",function(){var e=$(".multi-step:visible"),t=e.prev(".multi-step");if(t.length){e.fadeOut(300,function(){$(this).hide(),t.fadeIn(300,function(){$(this).show()})});var i=$(".client-step.active"),l=i.prev(".client-form-indicator-line");i.removeClass("active"),l.prev(".client-step").addClass("active"),$(".next-form").removeClass("visually-hidden"),$(".save").addClass("visually-hidden"),t.prev(".multi-step").length||$(".previous-form").addClass("visually-hidden")}}),$(".get-ceo-info").click(function(){$("#repName").val(a.CEO),$("#repcontact").val(a.CEOContactInformation),$("#repdob").val(a.CEODateOfBirth),$("#position").val("CEO"),$("#repaddress").val(a.CompanyAddress)}),$(".save").on("click",function(){new FormData,console.log(a),ge("new-client-record",a,fileInput.files[0],{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},function(t){console.log("Success:",t),o("created"),window.location.href="clients"},function(t,i,l){t.responseJSON&&t.responseJSON.message&&(G.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${t.responseJSON.message}`}),console.log(t.responseJSON.errors))})}),$("#fileInput").on("change",function(e){var t=this.files[0];if(t){var i=new FileReader;i.onload=function(l){$("#imagePreview").attr("src",l.target.result).show(),console.log(l.target.result)},i.readAsDataURL(t)}else $("#imagePreview").attr("src","#").hide()}),$(".pdf-services").on("click",function(e){e.preventDefault();var t=$(this).data("url");window.open(t,"services/pdf")});var c=localStorage.getItem("activeNavItem");c&&$('.nav-item a[href="'+c+'"]').addClass("active"),$(".nav-item a").on("click",function(){$(".nav-item a").removeClass("active"),$(this).addClass("active"),localStorage.setItem("activeNavItem",$(this).attr("href"))});const r=localStorage.getItem("transaction-status");if(r){localStorage.removeItem("transaction-status");const e={created:{icon:"success",title:"New Record",text:"New record added successfully"},removed:{icon:"success",title:"Record Removed!",text:"Record removed successfully"},updated:{icon:"success",title:"Record Updated!",text:"Record updated successfully"}};e[r]&&ee.fire(e[r])}var d=localStorage.getItem("sub_service"),s=localStorage.getItem("sub-service");d==="created"&&(ee.fire({icon:"success",title:"New Requirement added"}),localStorage.removeItem("sub_service")),d==="updated"&&(ee.fire({icon:"success",title:"Service Updated!"}),localStorage.removeItem("sub_service")),s==="removed"&&(ee.fire({icon:"success",title:"Service Removed!"}),localStorage.removeItem("sub-service"))});var Te=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),fe=Swal.mixin({toast:!1,position:"bottom-end"}),se=0,re=0,W=[];$(document).ready(function(){$(".services").on("change",function(){var s=$(this).attr("id"),e=$(this).val().split("_"),t=$(this).val(),i=$(this).val(),l=parseFloat(e[1]);W=[],$(".sub-services-append").html(""),$(".service-input").html(""),$(".sub-services").find(".loader").removeClass("visually-hidden"),$(".services-total").show(),re=l,se=1,c(t,l),n(),xe(`fetch-sub-services-${s}`,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},o,a),W.push({serviceName:i,servicePrice:l,serviceFile:null}),console.log(W)});function o(s){$(".sub-services").find(".loader").addClass("visually-hidden"),$.each(s.subServices,(e,t)=>{t!=="id"&&$(".sub-services-append").append(`<li>
                    <input class='sub-service-item' type='checkbox' name='SubService' id='${t.id}' 
                    value='${t.ServiceRequirements}_${t.ServiceRequirementPrice}_subservice_${t.id}' 
                    style='font-size: 5px;'>${t.ServiceRequirements}
                </li>`)})}function a(s,e,t){console.log(s),fe.fire({icon:"error",title:"Fatal Error",text:`Translated: ${s}`})}$(document).on("click",".sub-service-item",function(){var s=$(this).val().split("_"),e=$(this).val(),t=$(this).attr("id"),i=s[0],l=parseFloat(s[1]);if($(this).is(":checked"))$(".client-service-input").append(`<tr id='row-${t}'>
                    <td>${i}</td>
                    <td>${l.toLocaleString()}</td>
                </tr>`),re+=l,se++,W.push({serviceName:e,servicePrice:l,serviceFile:null});else{const m=W.findIndex(v=>v.serviceName===e);console.log(e,"unchecked"),$(`#row-${t}`).remove(),re-=l,se--,m!==-1&&W.splice(m,1)}console.log(W),n()});function n(){$(".totalAmount").text(`Total Amount: ${re.toLocaleString()}`),$(".totalServices").text(`Total Services: ${se}`)}function c(s,e,t){const i=s.replace(/\s+/g,"_");var l=s.split("_");console.log(s),$(".service-input").append(`
            <div class="row">
                <div class="col-sm-12">
                    <div class="row">
                        <table style='font-size: 10px;' class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <td>Service</td>
                                    <td>Amount</td>
                                </tr>
                            </thead>
                            <tbody class='client-service-input'>
                                <tr>
                                    <td>${l[0]}</td>
                                    <td>${e.toLocaleString()}</td>
                                    <td><span class="badge fw-bold text-light bg-danger rounded-1 remove-parent-service" id=${i}><i class="fas fa-trash"></i></span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `)}$(document).on("change",".clientDocument",function(){var s=$(this),e=s.closest("tr"),t=e.find("td").first().text(),i=Array.from(s[0].files);W=W.map(l=>l.serviceName===t?{...l,serviceFile:i.length>0?i[0]:null}:l)}),$(document).on("click",".remove-parent-service",function(){var s=$(this).attr("id"),e=W.findIndex(t=>t.serviceName.replace(/\s+/g,"_")===s);e>-1?(console.log(e),re-=W[e].servicePrice,se--,W.splice(e,1)):console.log("Service not found in servicesData!"),$(this).closest("tr").remove(),n()});function r(){$(".add-client-service-loader").removeClass("visually-hidden");var s=$(".hidden-client-id").attr("id"),e=new FormData;e.append("client_id",s),W.forEach((l,m)=>{e.append(`services[${m}][serviceName]`,l.serviceName),e.append(`services[${m}][servicePrice]`,l.servicePrice),l.serviceFile&&e.append(`services[${m}][serviceFile]`,l.serviceFile)});for(const[l,m]of e.entries())console.log(l,m);be(`client-services-${s}`,e,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},t,i);function t(l){$(".add-client-service-loader").addClass("visually-hidden"),console.log(l),window.location.href="clients",localStorage.setItem("services",!0)}function i(l,m,v){$(".add-client-service-loader").addClass("visually-hidden");try{const x=JSON.parse(l.responseText);console.log("Parsed Response:",x),fe.fire({icon:"warning",title:"Conflict",text:x.Conflict})}catch(x){console.log("Could not parse JSON response:",x)}}}$(".submit-services").on("click",function(){r()});var d=localStorage.getItem("services");d&&(Te.fire({icon:"success",title:"Services Added to Client"}),localStorage.removeItem("services"))});$(document).ready(function(){let o=1;var a=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),n=Swal.mixin({toast:!1,position:"bottom-end"});let c="",r={},d="",s={},e={},t={},i={},l={};$("#expense-category").on("change",function(){c=$("#expense-category").val(),$(".expense-form").removeClass("visually-hidden"),$(".months-container").empty(),$(".save-expense").addClass("visually-hidden")}),$(".start-date, .end-date").on("change",function(){const w=$(".start-date").val(),h=$(".end-date").val();if($("#expense-category").val()===""){a.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(w&&h){const y=new Date(w),C=new Date(h),A=$(".months-container");var S='<div class="row">';if((C.getFullYear()-y.getFullYear())*12+(C.getMonth()-y.getMonth())>12){n.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const I=new Date(y);if(I.setMonth(I.getMonth()+11),C>I){n.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}A.empty(),S+="";let p=new Date(y);for(;p<=C;){const u=p.toLocaleString("default",{month:"long",year:"numeric"});S+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control month-input" name="${u}" id="" placeholder='${u}' value="">
                    </div>
                    </div>`,p.setMonth(p.getMonth()+1)}S+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-months form-control">Save</button>
            </div>`,S+="</div>",A.html(S)}$(".months-container").on("input",".month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-months",function(w){w.preventDefault();let h=[],S=!0;if(r.hasOwnProperty(c))return a.fire({icon:"warning",title:"Account Already Added",text:"You have already added this account."}),$(".end-date").val(""),$(".start-date").val(""),$(".months-container").empty(),!1;if($(".month-input").each(function(){var y=$(this).attr("name"),C=$(this).val();C!==""&&(S=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),h.push({monthName:y,value:$(this).val(),account:c,startDate:$(".start-date").val(),endDate:$(".end-date").val()}))}),S){$(".month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),a.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}r[c]={months:h,startDate:$(".start-date").val(),endDate:$(".end-date").val()},$("#saved-months").empty(),$.each(r,(y,C)=>{var A='<table class="table table-hover client-journal-accounts">',R=y.split("_");A+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${R[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${y}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(C.months,(I,p)=>{A+=`
                    <tr>
                        <td class='text-left'>${p.monthName}</td>
                        <td class='text-left'>${p.value}</td>
                    </tr>
                `}),A+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,A+="</table>",$("#saved-months").append(A)}),$(".months-container").empty(),$("#expense-category").val(""),$(".end-date").val(""),$(".start-date").val(""),c="",S=!0,console.log(r)}),$(document).on("click",".remove-saved-account",function(w){const h=$(this).attr("id");delete r[h],$("#saved-months").empty(),$.each(r,(S,y)=>{var C='<table class="table table-hover client-journal-accounts">',A=S.split("_");C+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${A[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${S}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(y.months,(R,I)=>{C+=`
                    <tr>
                        <td>${I.monthName}</td>
                        <td>${I.value}</td>
                    </tr>
                `}),C+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,C+="</table>",$("#saved-months").append(C)}),console.log(r)}),$("#income-category").on("change",function(){$(".income-form").removeClass("visually-hidden"),d=$("#income-category").val(),$(".income-months-container").empty()}),$(".income-start-date, .income-end-date").on("change",function(){const w=$(".income-start-date").val(),h=$(".income-end-date").val();if($("#income-category").val()===""){a.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(w&&h){const y=new Date(w),C=new Date(h),A=$(".income-months-container");var S='<div class="row">';if((C.getFullYear()-y.getFullYear())*12+(C.getMonth()-y.getMonth())>12){n.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const I=new Date(y);if(I.setMonth(I.getMonth()+11),C>I){n.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}A.empty(),S+="";let p=new Date(y);for(;p<=C;){const u=p.toLocaleString("default",{month:"long",year:"numeric"});S+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control income-month-input" name="${u}" id="" placeholder='${u}' value="">
                    </div>
                    </div>`,p.setMonth(p.getMonth()+1)}S+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-expense-months form-control">Save</button>
            </div>`,S+="</div>",A.html(S)}$(".income-months-container").on("input",".income-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-expense-months",function(w){w.preventDefault();let h=[],S=!0;if(s.hasOwnProperty(d)){a.fire({icon:"warning",title:"Account Already Added",text:"You have already added this account."}),$(".income-end-date").val(""),$(".income-start-date").val(""),$(".income-months-container").empty();return}if($(".income-month-input").each(function(){var y=$(this).attr("name"),C=$(this).val();C!==""&&(S=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),h.push({incomeMonthName:y,value:$(this).val(),account:d,startDate:$(".income-start-date").val(),endDate:$(".income-end-date").val()}))}),S){$(".income-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),a.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}s[d]={months:h,startDate:$(".income-start-date").val(),endDate:$(".income-end-date").val()},console.log(s),$("#saved-income-months").empty(),$.each(s,(y,C)=>{var A='<table class="table table-hover client-journal-accounts">',R=y.split("_");A+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${R[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${y}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(C.months,(I,p)=>{A+=`
                    <tr>
                        <td class='text-left'>${p.incomeMonthName}</td>
                        <td class='text-left'>${p.value}</td>
                    </tr>
                `}),A+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,A+="</table>",$("#saved-income-months").append(A)}),$(".income-months-container").empty(),$("#income-category").val(""),$(".income-end-date").val(""),$(".income-start-date").val(""),c="",S=!0}),$(document).on("click",".remove-saved-account",function(w){const h=$(this).attr("id");delete s[h],$("#saved-income-months").empty(),$.each(s,(S,y)=>{var C='<table class="table table-hover client-journal-accounts">',A=S.split("_");C+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${A[1]} - ${y.startDate} - ${y.endDate}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${S}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(y.months,(R,I)=>{C+=`
                    <tr>
                        <td>${I.incomeMonthName}</td>
                        <td>${I.value}</td>
                    </tr>
                `}),C+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,C+="</table>",$("#saved-income-months").append(C)}),console.log(s)}),$(document).on("change","#asset_account",function(){let w=$(this).val();console.log(w),$.ajax({type:"POST",url:`get-accounts-${w}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(h){console.log(h);let S="";$.each(h,(y,C)=>{$.each(C,(A,R)=>{console.log(R),S+=`
                            <option value="${R.AccountName}_${R.id}">${R.AccountName}</option>
                        `})}),$("#asset_account_name").html(S)},error:function(h,S,y){console.error(h)}})}),$(document).on("change","#liability_account",function(){let w=$(this).val();$.ajax({type:"POST",url:`get-accounts-${w}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(h){let S="";$.each(h,(y,C)=>{$.each(C,(A,R)=>{S+=`
                            <option value="${R.AccountName}_${R.id}">${R.AccountName}</option>
                        `})}),$("#liability_account_name").html(S)},error:function(h,S,y){console.error(h)}})}),$(document).on("change","#oe_account",function(){let w=$(this).val();$.ajax({type:"POST",url:`get-accounts-${w}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(h){let S="";$.each(h,(y,C)=>{$.each(C,(A,R)=>{S+=`
                            <option value="${R.AccountName}_${R.id}">${R.AccountName}</option>
                        `})}),$("#oe_account_name").html(S)},error:function(h,S,y){console.error(h)}})}),$(".save-asset-info").on("click",function(w){w.preventDefault();var h=!1,S=$(".journal-asset-form").serializeArray(),y="",C="",A="";let R=!1;if($(".journal-asset-form input, .journal-asset-form select").removeClass("is-invalid"),$.each(S,function(p,u){u.value===""&&($(`.journal-asset-form [name='${u.name}']`).addClass("is-invalid"),h=!0),u.name==="assetType"?y=u.value:u.name==="assetAccount"?C=u.value:u.name==="assetAmount"&&(A=u.value)}),$.each(e,(p,u)=>{if($.each(u.accounts,(b,f)=>{if(f.assetAccount===C)return R=!0,!1}),R)return!1}),R)return a.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(h){a.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}e[y]||(e[y]={accounts:[]}),e[y].accounts.push({assetAccount:C,amount:A}),console.log("Asset Object:",e);var I="";$.each(e,function(p,u){$.each(u.accounts,function(b,f){I+=`
                <tr>
                    <td style="font-size: 0.8em;">${p.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.assetAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-asset" id="${f.assetAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-asset-accounts").html(I),$(".journal-asset-form")[0].reset(),$("#asset_account_name").html('<option value="" selected hidden>Select an asset type first</option>')}),$(document).on("click",".remove-asset",function(w){w.preventDefault(),$(this).closest("tr").remove();for(let h in e)e[h].accounts&&(e[h].accounts=e[h].accounts.filter(S=>S.assetAccount!==$(this).attr("id"))),e[h].accounts.length===0&&delete e[h];console.log(e)}),$(".save-liability-info").on("click",function(w){w.preventDefault();var h=!1,S=$(".journal-liability-form").serializeArray(),y="",C="",A="";let R=!1;if($(".journal-liability-form input, .journal-liability-form select").removeClass("is-invalid"),$.each(S,function(p,u){u.value===""&&($(`.journal-liability-form [name='${u.name}']`).addClass("is-invalid"),h=!0),u.name==="liability-account"?y=u.value:u.name==="liability-account-name"?C=u.value:u.name==="liability-amount"&&(A=u.value)}),$.each(t,(p,u)=>{if($.each(u.accounts,(b,f)=>{if(f.liabilityAccount===C)return R=!0,!1}),R)return!1}),R)return a.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(h){a.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}t[y]||(t[y]={accounts:[]}),t[y].accounts.push({liabilityAccount:C,amount:A}),console.log("liability Object:",t);var I="";$.each(t,function(p,u){$.each(u.accounts,function(b,f){I+=`
                <tr>
                    <td style="font-size: 0.8em;">${f.liabilityAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-liability" id="${f.liabilityAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-liability-accounts").html(I),$(".journal-liability-form")[0].reset(),$("#liability_account_name").html('<option value="" selected hidden>Select an asset type first</option>')}),$(document).on("click",".remove-liability",function(w){w.preventDefault(),$(this).closest("tr").remove();for(let h in t)t[h].accounts&&(t[h].accounts=t[h].accounts.filter(S=>S.liabilityAccount!==$(this).attr("id")),t[h].accounts.length===0&&delete t[h]);console.log(t)}),$(".save-oe-info").on("click",function(w){w.preventDefault();var h=!1,S=$(".journal-oe-form").serializeArray(),y="",C="",A="",R=!1;if($(".journal-oe-form input, .journal-oe-form select").removeClass("is-invalid"),$.each(S,function(p,u){u.value===""&&($(`.journal-oe-form [name='${u.name}']`).addClass("is-invalid"),h=!0),u.name==="oe-account"?y=u.value:u.name==="oe-account-name"?C=u.value:u.name==="oe-amount"&&(A=u.value)}),$.each(i,(p,u)=>{if($.each(u.accounts,(b,f)=>{if(f.oeAccount===C)return R=!0,!1}),R)return!1}),R)return a.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(h){a.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}i[y]||(i[y]={accounts:[]}),i[y].accounts.push({oeAccount:C,amount:A}),console.log("Asset Object:",i);var I="";$.each(i,function(p,u){$.each(u.accounts,function(b,f){I+=`
                <tr>
                    <td style="font-size: 0.8em;">${f.oeAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-oe" id="${f.oeAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-oe-accounts").html(I),$(".journal-oe-form")[0].reset(),$("#oe_account_name").html('<option value="" selected hidden>Select an account type first</option>'),console.log("oeObj Object:",i)}),$(document).on("click",".remove-oe",function(w){w.preventDefault(),$(this).closest("tr").remove();for(let h in i)i[h].accounts&&(i[h].accounts=i[h].accounts.filter(S=>S.oeAccount!==$(this).attr("id"))),i[h].accounts.length===0&&delete i[h];console.log(i)});var m=0,v=0,x=0,g=0,O=0;$(".next-btn").on("click",function(){if(o===1){if(Object.keys(s).length===0){a.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}$("#append-expenses-choy").empty(),m=0;var w="";$.each(s,function(L,q){var K=L.split("_"),P=0;$.each(q.months,function(T,J){var Y=J.value.replace(/,/g,""),z=parseFloat(Y);P+=z});var E=P.toLocaleString();m+=P,w+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${K[1]}</div>
                        <div class="col-sm-6 text-right">${E}</div>
                    </div>`});var h=parseFloat(m);console.log(typeof h),$("#append-expenses-choy").append(w);var S=`
                <div class="row mt-3">
                    <div class="col-sm-6 text-left"><strong>Total:</strong></div>
                    <div class="col-sm-6 text-right"><strong>${h.toLocaleString()}</strong></div>
                </div>`;$(".append-expense-total").html(S)}if(o===2){$(".append-ldc").empty(),$(".expenses-total").text(""),$(".append-oe").empty(""),$(".oe-total").text("");var y="",C="";if(v=0,x=0,Object.keys(r).length===0){a.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}$.each(r,(L,q)=>{var K=L.split("_"),P=K[2],E=0,T=0;if(P==="Less Direct Cost"){$.each(q.months,(z,Q)=>{var U=Q.value.replace(/,/g,""),ae=parseFloat(U);E+=ae});var J=E.toLocaleString();v+=E,y+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${K[1]}</div>
                        <div class="col-sm-6 text-right">${J}</div>
                    </div>
                    `}else if(P==="Operating Expenses"){$.each(q.months,(z,Q)=>{var U=Q.value.replace(/,/g,""),ae=parseFloat(U);T+=ae});var Y=T.toLocaleString();x+=T,C+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${K[1]}</div>
                        <div class="col-sm-6 text-right">${Y}</div>
                    </div>
                    `}});var A=m-v,R=A-x;g=R,$(".gries-total").text(A.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".tgi").text(A.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".expenses-total").text(v.toLocaleString()),$(".append-ldc").append(y),$(".append-oe").append(C),$(".oe-total").text(x.toLocaleString()),$(".net-amount").text(R.toLocaleString())}if(o===3){var I=0,p=0,u=0,b=0;if($(".append-ca").html(""),$(".append-nca").html(""),$(".append-fa").html(""),Object.keys(e).length===0){a.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(e,(L,q)=>{L.split("_")[0]==="Current Asset"&&$.each(q.accounts,(K,P)=>{var E=P.amount.replace(/,/g,""),T=parseFloat(E);u+=T,$(".total-ca").text(u.toLocaleString()),$(".append-ca").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${P.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${P.amount.toLocaleString()}</span>
                            </div>`)}),L.split("_")[0]==="Non-Current Assets"&&$.each(q.accounts,(K,P)=>{var E=P.amount.replace(/,/g,""),T=parseFloat(E);p+=T,$(".tnca-amount").text(p.toLocaleString()),$(".append-nca").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${P.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${P.amount.toLocaleString()}</span>
                            </div>`)}),L.split("_")[0]==="Fixed Assets"&&$.each(q.accounts,(K,P)=>{var E=P.amount.replace(/,/g,""),T=parseFloat(E);b+=T,$(".append-fa").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${P.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${P.amount.toLocaleString()}</span>
                            </div>`)})}),I=u+p+b,$(".total-assets").text(I.toLocaleString())}if(o===4){console.log(t);var f="",k=0;if(Object.keys(t).length===0){a.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(t,(L,q)=>{$.each(q.accounts,(K,P)=>{var E=P.amount.replace(/,/g,""),T=parseFloat(E);k+=T,console.log(k),f+=`
                    <div class="d-flex justify-content-between">
                        <span class="fw-normal">${P.liabilityAccount.split("_")[0]}</span>
                        <span class="fw-normal">${P.amount}</span>
                    </div>
                    `})}),O+=k,$(".append-cl").html(f)}if(o===5){var D="",N=0;if(Object.keys(i).length===0){a.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(i,(L,q)=>{$.each(q.accounts,(K,P)=>{var E=P.amount.replace(/,/g,""),T=parseFloat(E);N+=T,console.log(N),D+=`
                <div class="d-flex justify-content-between">
                <span class="fw-normal">${P.oeAccount.split("_")[0]}</span>
                <span class="fw-normal">${P.amount}</span>
            </div>
                `})}),O+=N,$(".append-oenw").html(D)}if(o===6){$(".tlc").text(O.toLocaleString());var M=0,_=!0,j=$(".journal-adjustments-form").serializeArray();if($.each(j,(L,q)=>{var K=$(`.journal-adjustments-form [name='${q.name}']`);q.value.trim()===""?(_=!1,K.addClass("is-invalid")):(K.removeClass("is-invalid"),l[q.name]=q.value)}),!_){a.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}$.each(l,(L,q)=>{var K=q.replace(/,/g,""),P=parseFloat(K);L==="owners_withdrawal"&&$(".less-drawings").text(P.toLocaleString()),L==="owners_capital"&&(M+=P),L!=="owners_withdrawal"&&L!=="owners_capital"&&(M+=P)}),$(".additional-capital").text(M.toLocaleString()),$(".fp-nc").text(g.toLocaleString());var Z=M+g;$(".appraisal-capital").text(Z.toLocaleString());var H=Z-parseFloat($(".less-drawings").text().replace(/[^0-9.-]+/g,""));$(".capital-end").text(H.toLocaleString())}o<7&&($(".multi-step-journal").hide(),o++,F(o)),X(o),o===7?($(".next-btn").hide(),$(".save-btn").show()):($(".next-btn").show(),$(".save-btn").hide()),o===1?$(".prev-btn").hide():$(".prev-btn").show()}),$(".prev-btn").on("click",function(){o>1&&($(".multi-step-journal").hide(),o--,F(o)),X(o),$(".next-btn").show(),$(".save-btn").hide(),o===1?$(".prev-btn").hide():$(".prev-btn").show()});function F(w){$(".multi-step-journal").hide(),$(".multi-step-journal").eq(w-1).show()}function X(w){$(".step").removeClass("active"),$(".indicator-line").removeClass("active"),$(".step").each(function(h){h<w&&($(this).addClass("active"),$(this).next(".indicator-line").addClass("active"))})}F(o),X(o),o===1&&$(".prev-btn").hide(),$(".save-journal-btn").click(function(){var w={incomeObj:s,expensesObj:r,assetObj:e,liabilityObj:t,oeObj:i,adjustmentObj:l,client_id:$(this).attr("id").split("_")[1]};Oe("new-client-journal-entry",w,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},h,S);function h(y){console.log(y),localStorage.setItem("journal","created"),window.location.href="clients"}function S(y,C,A){console.log(y)}});var V=localStorage.getItem("journal");V==="created"&&(a.fire({icon:"success",title:"Journal Entry",text:"New Journal Entry Saved"}),localStorage.removeItem("journal"))});var ne=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),ue=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".save-account-type").on("click",function(){var n=$(".new-account-type-form").serializeArray(),c={},r=!0;if($.each(n,(e,t)=>{if(t.value===""){r=!1,$(`.new-account-type-form [name='${t.name}']`).addClass("is-invalid"),ne.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"});return}else c[t.name]=t.value,$(`.new-account-type-form [name='${t.name}']`).removeClass("is-invalid"),console.log(c)}),r){let e=function(i){console.log(i),localStorage.setItem("account-type","created"),location.reload()},t=function(i,l,m){$(".loader-container").addClass("visually-hidden");try{const v=JSON.parse(i.responseText);console.log("Parsed Response:",v),ue.fire({icon:"warning",title:"Conflict",text:v.error})}catch(v){console.log("Could not parse JSON response:",v)}};var d=e,s=t;$(".loader-container").removeClass("visually-hidden"),ye("new-account-type",c,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t)}}),$(".save-account").on("click",function(){var n=$("#account-form").serializeArray(),c={},r=!0;if(console.log(n),$.each(n,(e,t)=>{if($(`#account-form [name='${t.name}']`).addClass("is-invalid"),t.value===""){ne.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"}),r=!1;return}else $(`#account-form [name='${t.name}']`).removeClass("is-invalid"),c[t.name]=t.value}),r){let e=function(i){localStorage.setItem("account","created"),location.reload()},t=function(i,l,m){$(".loader-container").addClass("visually-hidden");try{const v=JSON.parse(i.responseText);console.log("Parsed Response:",v),ue.fire({icon:"warning",title:"Conflict",text:v.error})}catch(v){console.log("Could not parse JSON response:",v)}};var d=e,s=t;$(".loader-container").removeClass("visually-hidden"),Se("new-account",c,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t)}}),$(".edit-coa").click(function(n){n.preventDefault();var c=$(this).attr("id"),r=$(`#edit-coa-form-${c}`).serializeArray(),d=!0,s={};$.each(r,(e,t)=>{if(t.value===""){$(`.edit-coa-form-${c} [name='${t.name}']`).addClass("is-invalild"),d=!1,ne.fire({icon:"warning",title:"Missing Field!",text:"Please fill all fields"});return}$(`.edit-coa-form-${c} [name='${t.name}']`).removeClass("is-invalild"),s[t.name]=t.value}),d&&$.ajax({type:"POST",url:"edit-coa",data:s,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){localStorage.setItem("account","updated"),location.reload()},error:function(e,t,i){try{const l=JSON.parse(e.responseText);console.log("Parsed Response:",l),ue.fire({icon:"warning",title:"Conflict",text:l.message})}catch(l){console.log("Could not parse JSON response:",l)}}})});var o=localStorage.getItem("account-type"),a=localStorage.getItem("account");if(o==="created"){ne.fire({icon:"success",title:"New Account Type created!"}),localStorage.removeItem("account-type");return}if(a==="created"){localStorage.removeItem("account"),ne.fire({icon:"success",title:"New Account created!"}),localStorage.removeItem("account-type");return}if(a==="updated"){localStorage.removeItem("account"),ne.fire({icon:"success",title:"Account updated!"}),localStorage.removeItem("account-type");return}});$(document).ready(function(){var o=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),a=Swal.mixin({toast:!1,position:"bottom-end"});console.log("this is user js"),$(".new-user-save").on("click",function(c){var r=$(".new-user-form").serializeArray(),d={},s=!0;if($.each(r,(i,l)=>{if(l.value===""){s=!1,$(`.new-user-form [name='${l.name}']`).addClass("is-invalid"),o.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}else d[l.name]=l.value,$(`.new-user-form [name='${l.name}']`).removeClass("is-invalid")}),s){let i=function(m){localStorage.setItem("user","created"),location.reload()},l=function(m,v,x){try{const g=JSON.parse(m.responseText);console.log("Parsed Response:",g),a.fire({icon:"warning",title:"Conflict",text:g.message})}catch(g){console.log("Could not parse JSON response:",g)}};var e=i,t=l;we("new-user",d,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},i,l)}}),$(".remove-user").on("click",function(){var c=$(this).attr("id");$.ajax({url:`remove-user-${c}`,type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){console.log(r),localStorage.setItem("user","removed"),location.reload()},error:function(r,d,s){console.log(r)}})}),$(".edit-user-button").on("click",function(){var c=$(this).closest(".modal").find("form").serializeArray();console.log(c);var r=!0,d={};$.each(c,(s,e)=>{if(e.value===""){r=!1,$(`[name='${e.name}']`).addClass("is-invalid"),o.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}else d[e.name]=e.value,$(`[name='${e.name}']`).removeClass("is-invalid")}),r&&$.ajax({url:"update-user",type:"POST",data:d,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(s){localStorage.setItem("user","updated"),location.reload()},error:function(s,e,t){a.fire({icon:"error",title:"Fatal Error!",text:"Try reloading the page, if issue persist contact developer"})}})});var n=localStorage.getItem("user");n==="created"&&(o.fire({icon:"success",title:"User Created!",text:"User created successfuly"}),localStorage.removeItem("user")),n==="removed"&&(o.fire({icon:"success",title:"User Removed!",text:"User removed successfuly"}),localStorage.removeItem("user")),n==="updated"&&(o.fire({icon:"success",title:"User Updated!",text:"User Updated successfuly"}),localStorage.removeItem("user")),$(".search-users").on("keyup",function(){var c=$(this).val().toLowerCase();$(".users-table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(c)>-1)})}),$("#filter-users").on("change",function(){var c=$(this).val();$(".users-table tbody tr").each(function(){var r=$(this).data("category");c==="clear"?$(this).show():c===""||r===c?$(this).show():$(this).hide()})})});$(document).ready(function(){var o=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),a=Swal.mixin({toast:!1,position:"bottom-end"});$("#account-category").on("change",function(i){$("#billing-account-type").prop("disabled",!1),$.ajax({type:"POST",url:`get-account-types-${$(this).val()}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(l){console.log(l);let m='<option value="" selected hidden>Select Type</option>',v=!1;$.each(l,(x,g)=>{$.each(g,(O,F)=>{Object.keys(F).length>0&&(m+=`<option value="${F.id}">${F.ServiceRequirements}</option>`,v=!0)})}),v||(m='<option value="" selected hidden>Category has no type</option>'),$("#billing-account-type").html(m)},error:function(l){console.error(l),a.fire({icon:"error",title:"Error",text:`Could not load account types: ${l.responseText||l.statusText}`})}})}),$(document).on("change",'[id^="edit-account-category-"]',function(i){let l=$(this).attr("id").split("-").pop(),m=`#edit-billing-account-type-${l}`;console.log($(this).val()),console.log("Fetching types for modal:",l),$.ajax({type:"POST",url:`get-account-types-${$(this).val()}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(v){console.log(v);let x='<option value="" selected hidden>Select Type</option>',g=!1;$.each(v,(O,F)=>{$.each(F,(X,V)=>{Object.keys(V).length>0&&(x+=`<option value="${V.id}">${V.ServiceRequirements}</option>`,g=!0)})}),g||(x='<option value="" selected hidden>Category has no type</option>'),$(m).html(x)},error:function(v){console.error(v),a.fire({icon:"error",title:"Error",text:`Could not load account types: ${v.responseText||v.statusText}`})}})}),$(".edit-description").on("click",function(i){var l=$(this).attr("id").split("-").pop();i.preventDefault();var m={},v=$(`.update-description-form-${l}`).serializeArray(),x=!0;$.each(v,(g,O)=>{O.value===""&&(x=!1,o.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"}),$(`.update-description-form-${l} [name='${O.name}']`).addClass("is-invalid")),$(`.update-description-form-${l} [name='${O.name}']`).removeClass("is-invalid"),m[O.name]=O.value}),console.log(m),x&&$.ajax({type:"POST",url:"update/account-description",data:m,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(g){localStorage.setItem("account_description","updated"),location.reload()},error:function(g,O,F){a.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+g.responseText})}})}),$(".remove-description").on("click",function(){$.ajax({type:"POST",url:`remove/account-description/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){localStorage.setItem("account_description","removed"),location.reload()},error:function(i,l,m){a.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+i.responseText})}})}),$(".remove-coa").on("click",function(){$.ajax({type:"POST",url:`remove/coa/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){localStorage.setItem("coa","removed"),location.reload()},error:function(i,l,m){a.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+i.responseText})}})}),$(".save-account-description").on("click",function(i){var l=$(".account-description-form").serializeArray(),m={},v=!0;if($.each(l,(O,F)=>{if(F.value===""){$(`.account-description-form [name="${F.name}"]`).addClass("is-invalid"),o.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),v=!1;return}else m[F.name]=F.value,console.log(m),$(`.account-description-form [name="${F.name}"]`).removeClass("is-invalid")}),v){let O=function(X){localStorage.setItem("account_description","created"),location.reload()},F=function(X,V,w){try{const h=JSON.parse(X.responseText);console.log("Parsed Response:",h),a.fire({icon:"error",title:"Error",text:h.message})}catch(h){console.log("Could not parse JSON response:",h)}};var x=O,g=F;Ce("new-account-description",m,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},O,F)}}),$(".edit-sys-profile").on("click",function(i){i.preventDefault();var l=!0,m={},v=$("#sys-profile-form").serializeArray();$.each(v,(x,g)=>{g.value.trim()===""?(l=!1,$(`.sys-profile-form [name='${g.name}']`).addClass("is-invalid"),o.fire({icon:"warning",title:"Missing fields",text:"Please fill all fields"})):$(`.sys-profile-form [name='${g.name}']`).removeClass("is-invalid"),m[g.name]=g.value}),l&&$.ajax({type:"POST",url:"edit-sys-info",data:m,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(x){localStorage.setItem("system-profile","updated"),location.reload()},error:function(x,g,O){try{const F=JSON.parse(x.responseText);console.log("Parsed Response:",F),a.fire({icon:"error",title:"Error",text:F.message})}catch(F){console.log("Could not parse JSON response:",F)}}})}),$(".edit-user-privilege").on("click",function(i){i.preventDefault();var l=$(this).attr("id");console.log(l),$.ajax({url:`/users/toggle-privilege/${l}`,type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(m){localStorage.setItem("user_privilege_updated",m.message),location.reload()},error:function(m){o.fire({icon:"error",title:"An error occurred while updating the privilege."})}})}),$(".reset-expense").on("click",function(i){i.preventDefault(),$.ajax({type:"POST",url:"reset-expense",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(l){localStorage.setItem("expense","reset"),location.reload()},error:function(l,m,v){a.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+l.responseText})}})}),$(".reset-income").on("click",function(i){i.preventDefault(),$.ajax({type:"POST",url:"reset-income",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(l){localStorage.setItem("income","reset"),location.reload()},error:function(l,m,v){a.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+l.responseText})}})}),$(".reset-sales").on("click",function(i){i.preventDefault(),$.ajax({type:"POST",url:"reset-sales",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(l){localStorage.setItem("income","reset"),location.reload()},error:function(l,m,v){a.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+l.responseText})}})});var n=localStorage.getItem("account_description"),c=localStorage.getItem("system-profile"),r=localStorage.getItem("coa"),d=localStorage.getItem("expense"),s=localStorage.getItem("income"),e=localStorage.getItem("sales"),t=localStorage.getItem("user_privilege_updated");d&&(o.fire({icon:"success",title:"Expense Reset"}),localStorage.removeItem("expense")),s&&(o.fire({icon:"success",title:"Income Reset"}),localStorage.removeItem("income")),e&&(o.fire({icon:"success",title:"Sales Reset"}),localStorage.removeItem("sales")),n==="created"&&(o.fire({icon:"success",title:"Account Description Created!"}),localStorage.removeItem("account_description")),n==="removed"&&(o.fire({icon:"success",title:"Account Description Removed!"}),localStorage.removeItem("account_description")),n==="updated"&&(o.fire({icon:"success",title:"Account Description Updated!"}),localStorage.removeItem("account_description")),c==="updated"&&(o.fire({icon:"success",title:"System Profile Updated"}),localStorage.removeItem("system-profile")),r==="removed"&&(o.fire({icon:"success",title:"Account Removed"}),localStorage.removeItem("coa")),t&&(o.fire({icon:"success",title:t}),localStorage.removeItem("user_privilege_updated"))});var de=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),me=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".update-client-service-progress-btn").on("click",function(){var n=$(this).attr("id"),c=$(`.update-service-progress-${n}`).serializeArray();console.log(c),$.ajax({type:"POST",url:"update-client-service",data:{serviceId:n,serviceVal:c},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){localStorage.setItem("service","updated"),location.reload()},error:function(r,d,s){try{const e=JSON.parse(r.responseText);console.log("Parsed Response:",e),me.fire({icon:"warning",title:"Conflict",text:e.Conflict})}catch(e){console.log("Could not parse JSON response:",e)}}})}),$(".edit-company-info").on("click",function(n){var c=$(`.edit-company-info-${$(this).attr("id")}`).serializeArray(),r=!0,d={};$.each(c,(s,e)=>{e.value===""&&(r=!1,$(`.edit-company-info-${$(this).attr("id")} [name='${e.name}']`).addClass("is-invalid"),de.fire({icon:"warning",title:"Missingg Fields",text:"Please fill all fields"})),d[e.name]=e.value}),r&&$.ajax({type:"POST",url:"update-company-info",data:d,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(s){localStorage.setItem("company-info","updated"),location.reload()},error:function(s,e,t){me.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+s})}})}),$(".remove-client-service").on("click",function(){$.ajax({type:"POST",url:`client-profile/service/remove/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){localStorage.setItem("service","removed"),location.reload()},error:function(n,c,r){me.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+n})}})});var o=localStorage.getItem("company-info"),a=localStorage.getItem("service");a==="updated"&&(de.fire({icon:"success",text:"Client Service Updated"}),localStorage.removeItem("service")),a==="removed"&&(de.fire({icon:"success",text:"Client Service Removed"}),localStorage.removeItem("service")),o==="updated"&&(localStorage.removeItem("company-info"),de.fire({icon:"success",text:"Company Info Updated"}))});$(document).ready(function(){var o=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),a=Swal.mixin({toast:!1,position:"bottom-end"}),n=0,c=window.servicesData;console.log(c);var r={Service:[]},d={SubService:[]},s={accounts:[]};$.each(c,(t,i)=>{$.each(i.Service,(l,m)=>{r.Service.push({Service:{service_name:l,service_id:Object.keys(m.parent_service_id)[0],service_price:m.parent_service_id[Object.keys(m.parent_service_id)[0]].parentServicePrice}}),m.sub_service&&$.each(m.sub_service,(v,x)=>{$.each(x,(g,O)=>{$.each(O,(F,X)=>{$.each(X.account_descriptions,(V,w)=>{s.accounts.push({Accounts:{Account:w.Description,account_id:w.adID.toLocaleString(),price:w.Price}})})})}),$.each(x.sub_service_id,g=>{let O=Object.keys(x.sub_service_id)[0],F=x.sub_service_id[O].sub_service_price;d.SubService.push({SubService:{sub_service_name:v,sub_service_id:g,sub_service_price:F}})})})})}),$(".price").each(function(){var t=$(this).text(),i=t.replace(/[^\d.-]/g,""),l=parseFloat(i);n+=l}),$(".remove-parent-service-billing-action").click(function(){var t=$(this).attr("id").split("_")[1],i=$(this).closest("tr").find("td:nth-last-child(2)").text(),l=i.replace(/[^\d.-]/g,""),m=parseFloat(l);n-=m,$(".overall-due").text(n.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(n.toLocaleString(void 0,{minimumFractionDigits:2}));var v=r.Service.findIndex(x=>x.Service.service_id===t);console.log("Service ID to remove:",t),v!==-1?(r.Service.splice(v,1),$(this).closest("tr").remove()):console.log("Service not found")}),$(".remove-sub-service-billing-action").click(function(){var t=$(this).attr("id").split("_")[1],i=$(this).closest("tr").find("td:nth-last-child(2)").text(),l=i.replace(/[^\d.-]/g,""),m=parseFloat(l);n-=m,$(".overall-due").text(n.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(n.toLocaleString(void 0,{minimumFractionDigits:2}));var v=d.SubService.findIndex(x=>x.SubService.sub_service_id===t);v!==-1&&(d.SubService.splice(v,1),$(this).closest("tr").remove())}),$(document).on("click",".remove-account-description-billing-action",function(){var t=$(this).attr("id").split("_")[1],i=$(this).closest("tr").find("td:nth-last-child(2)").text(),l=i.replace(/[^\d.-]/g,""),m=parseFloat(l),v=0;v=m-m,n-=m,$("#additional-description-subtotal").text(v.toLocaleString(void 0,{minimumFractionDigits:2})),$(".overall-due").text(n.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(n.toLocaleString(void 0,{minimumFractionDigits:2}));var x=s.accounts.findIndex(g=>g.Accounts.account_id===t);x!==-1?(s.accounts.splice(x,1),$(this).closest("tr").remove(),console.log(s)):console.log("Account not found")}),console.log(s),$(".add-description").on("click",function(){var t=0,i=$(this).closest("tr"),l=i.data("service"),m=i.data("requirements"),v=i.data("category"),x=i.data("description"),g=i.data("taxtype"),O=i.data("formtype"),F=i.data("price"),X=i.data("id"),V=F.replace(/[^\d.-]/g,""),w=parseFloat(V),h=w.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"),S=s.accounts.some(C=>C.Accounts.Account===x);if(S)o.fire({icon:"warning",title:"Conflict",text:"Account Description already exists!"});else{s.accounts.push({Accounts:{Account:x,account_id:i.attr("id").toLocaleString(),price:F,isAdded:!0}}),n+=w,t+=w,$("#additional-description-subtotal").text(t.toLocaleString(void 0,{minimumFractionDigits:2})),$(".overall-due").text(n.toLocaleString(void 0,{minimumFractionDigits:2}));var y=`
            <tr>
                <td>${l}</td>
                <td>${m}</td>
                <td>${v}</td>
                <td>${x}</td>
                <td>${g}</td>
                <td>${O}</td>
                <td>${h}</td>
                <td>
                    <span class="badge fw-bold text-light bg-danger remove-account-description-billing-action" id='${X}'><i class="fas fa-trash"></i></span>
                </td>
            </tr>
        `;$(".append-ad").append(y)}}),$(".mail-client-bs").click(function(){var t=$("#dd").val(),i=$(".billing-id").text(),l=$(".date").text(),m=$(this).attr("id");if(console.log(r),t===""||t===void 0){$("#dd").addClass("is-invalid"),o.fire({icon:"warning",title:"Missing Field",text:"Please add due date before proceeding"});return}$("#dd").removeClass("is-invalid");var v={dueDate:t,date:l,serviceObj:r,subServiceObj:d,accountDescriptions:s,refID:m,billingId:i};je("mail-client-billing",v,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},function(x){window.location.href="clients",localStorage.setItem("billing","created")},function(x,g,O){try{const F=JSON.parse(x.responseText);a.fire({icon:"warning",title:"Conflict",text:F.Message})}catch(F){console.log("Could not parse JSON response:",F)}})});var e=localStorage.getItem("billing");e==="created"&&(o.fire({icon:"success",title:"Billing Created",text:"Billing successfully created"}),localStorage.removeItem("billing"))});var le=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),Ae=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".view-journal-btn").on("click",function(o){var a=$(this).attr("id");$.ajax({type:"POST",url:`view-client-journal-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(n){console.log(n);var c=new Blob([n],{type:"application/pdf"}),r=URL.createObjectURL(c);window.open(r,"_blank")},error:function(n,c,r){Ae.fire({icon:"error",title:"Oops Something went wrong!",text:n.responseJSON?n.responseJSON.error:"Unknown error"})}})}),$(".gen-client-billing-pdf").click(function(){$.ajax({type:"POST",url:`client-billing-data_${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var a=new Blob([o],{type:"application/pdf"}),n=URL.createObjectURL(a);window.open(n,"_blank")},error:function(o,a,n){le.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".gen-expense-pdf").on("click",function(){$.ajax({type:"POST",url:"expense/pdf/expense",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var a=new Blob([o],{type:"application/pdf"}),n=URL.createObjectURL(a);window.open(n,"_blank")},error:function(o,a,n){le.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".income-gen-pdf").on("click",function(){$.ajax({type:"POST",url:"income/pdf/income",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var a=new Blob([o],{type:"application/pdf"}),n=URL.createObjectURL(a);window.open(n,"_blank")},error:function(o,a,n){le.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".generate-client-billing-pdf").on("click",function(){$.ajax({type:"POST",url:`client/billing/pdf/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var a=new Blob([o],{type:"application/pdf"}),n=URL.createObjectURL(a);window.open(n,"_blank")},error:function(o,a,n){le.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".gen-billing-pdf").on("click",function(){$.ajax({type:"POST",url:"billing-pdf",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var a=new Blob([o],{type:"application/pdf"}),n=URL.createObjectURL(a);window.open(n,"_blank")},error:function(o,a,n){le.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})})});var ie=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),De=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".journal-pin-entry").on("submit",function(a){a.preventDefault();var n=$(this).serializeArray(),c=!0;$.each(n,(r,d)=>{d.value===""?(ie.fire({icon:"warning",title:"Missing PIN",text:"Please enter PIN"}),c=!1,$(`[name='${d.name}']`).addClass("is-invalid")):$(`[name='${d.name}']`).remove("is-invalid")}),c&&$.ajax({type:"POST",url:"journal-pin-entry",data:n,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(r){var d=new Blob([r],{type:"application/pdf"}),s=URL.createObjectURL(d);window.open(s,"_blank"),console.log("asdasd")},error:function(r,d,s){r.status===400?ie.fire({icon:"error",title:r.statusText,text:"Incorrect PIN"}):ie.fire({icon:"error",title:"Something went wrong",text:"Fatal error. Translated: "+d})}})}),$(".request-journal-pin").click(function(){$.ajax({type:"POST",url:`request-journal-pin_${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){ie.fire({icon:"success",title:"User Notified",text:"Email has been successfully sent to the user."})},error:function(a,n,c){console.error("Error:",c),ie.fire({icon:"error",title:"Notification Failed",text:"Failed to send the email to the user. Please try again later."})}})}),$(".remove-journal-entry").click(function(){$.ajax({type:"POST",url:`archive-journal-entry-${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){localStorage.setItem("journal","Removed"),location.reload()},error:function(a,n,c){De.fire({icon:"error",title:"Oops! Something went wrong",text:"Error Translated: "+a})}})});var o=localStorage.getItem("journal");o==="Removed"&&(localStorage.removeItem("journal"),ie.fire({icon:"success",title:"Journal Update",text:"Journal Successfully removed"}))});var Re=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});$(document).ready(function(){$('select[name="JournalStatus"]').on("change",function(){var o=$(this).closest(".modal"),a=o.find(".journal-draft-note");$(this).val()==="Rejected"||$(this).val()==="Canceled"?a.removeClass("visually-hidden"):a.addClass("visually-hidden").val("")}),$(".update-journal-status").on("click",function(){$(".update-journal-status-loader").removeClass("visually-hidden");var o=$(this).attr("id");console.log(o);var a=$(`#update-journal-status-${o}`),n=a.find(`#serviceprogress-${o}`).val(),c=a.find(`#note-${o}`);if((n==="Canceled"||n==="Rejected")&&c.val().trim()===""){Swal.fire({icon:"error",title:"Validation Error",text:'Please provide a note when the status is "Canceled" or "Rejected".'}),c.addClass("is-invalid");return}var r=$(`.update-journal-status-form-${o}`).serializeArray();$.ajax({type:"POST",url:"/update-journal-status",data:r,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(d){$(".update-journal-status-loader").addClass("visually-hidden"),localStorage.setItem("journal-status","updated"),location.reload()},error:function(d){$(".update-journal-status-loader").addClass("visually-hidden"),console.error(d)}})}),localStorage.getItem("journal-status")==="updated"&&(Re.fire({icon:"success",title:"Journal Status Updated",text:"Journal status updated successfully"}),localStorage.removeItem("journal-status"))});var B=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),ce=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){let o=1;var a=window.journalIncome,n=window.journalExpense,c=window.journalAssets,r=window.journalLiability,d=window.journalOE,s=a,e=n,t={},i={},l={},m={};$.each(c,(p,u)=>{const b=[];b.push({assetAccount:u.account,amount:u.amount}),t[u.asset_category]={accounts:b}}),$.each(r,(p,u)=>{const b=[];var f=u.AccountType;b.push({liabilityAccount:u.account,amount:u.amount}),i[f]={accounts:b}}),$.each(d,(p,u)=>{const b=[];var f=u.AccountType;b.push({oeAccount:u.account,amount:u.amount}),l[f]={accounts:b}});let v="";$("#audit-income-category").on("change",function(){v=$(this).val(),$(".audit-income-form").removeClass("visually-hidden"),$(".saved-audited-income-months").empty()}),$("#audit-expense-category").on("change",function(){v=$(this).val(),$(".audit-expense-form").removeClass("visually-hidden"),$(".saved-audited-expense-months").empty()}),$(".audit-income-start-date, .audit-income-end-date").on("change",function(){const p=$(".audit-income-start-date").val(),u=$(".audit-income-end-date").val();if($("#audit-income-category").val()===""){B.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(p&&u){const f=new Date(p),k=new Date(u),D=$(".audit-income-months-container");var b='<div class="row">';if((k.getFullYear()-f.getFullYear())*12+(k.getMonth()-f.getMonth())>12){ce.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const M=new Date(f);if(M.setMonth(M.getMonth()+11),k>M){ce.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}D.empty(),b+="";let _=new Date(f);for(;_<=k;){const j=_.toLocaleString("default",{month:"long",year:"numeric"});b+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control audit-income-month-input" name="${j}" id="" placeholder='${j}' value="">
                    </div>
                    </div>`,_.setMonth(_.getMonth()+1)}b+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-income-audit-months form-control">Save</button>
            </div>`,b+="</div>",D.html(b)}$(document).on("input",".audit-income-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-income-audit-months",function(p){p.preventDefault();let u=[],b=!0;if(s.hasOwnProperty(v)){B.fire({icon:"warning",title:"Account Already Exists!",text:"You have already added this account."}),$(".audit-income-end-date").val(""),$(".audit-income-start-date").val(""),$(".audit-income-months-container").empty(),console.log(!0);return}if($(".audit-income-month-input").each(function(){var f=$(this).attr("name");console.log(f);var k=$(this).val();k!==""&&(b=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),u.push({incomeMonthName:f,value:$(this).val(),startDate:$(".audit-income-start-date").val(),endDate:$(".audit-income-end-date").val()}))}),b){$(".audit-income-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),B.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}s[v]={months:u,startDate:$(".audit-income-start-date").val(),endDate:$(".audit-income-end-date").val()},$("#saved-audited-income-months").empty(),$.each(s,(f,k)=>{var D='<table class="table table-hover client-journal-accounts">',N=f.split("_");D+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${N[1]}
                        <span class="text-sm fw-bold float-right remove-audit-income" id="${f}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(k.months,(M,_)=>{D+=`
                    <tr>
                        <td class='text-left'>${_.incomeMonthName}</td>
                        <td class='text-left'>${_.value}</td>
                    </tr>
                `}),D+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,D+="</table>",$("#saved-audited-income-months").append(D)}),$(".audit-income-months-container").empty(),$("#audit-income-category").val(""),$(".audit-income-end-date").val(""),$(".audit-income-start-date").val(""),v="",b=!0,console.log(s)}),$(".audit-expense-start-date, .audit-expense-end-date").on("change",function(){const p=$(".audit-expense-start-date").val(),u=$(".audit-expense-end-date").val();if($("#audit-expense-category").val()===""){B.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(p&&u){const f=new Date(p),k=new Date(u),D=$(".audit-expense-months-container");var b='<div class="row">';if((k.getFullYear()-f.getFullYear())*12+(k.getMonth()-f.getMonth())>12){ce.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const M=new Date(f);if(M.setMonth(M.getMonth()+11),k>M){ce.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}D.empty(),b+="";let _=new Date(f);for(;_<=k;){const j=_.toLocaleString("default",{month:"long",year:"numeric"});b+=`<div class="col-sm-6 my-2">
                <div class="input-group">
                <input type="text" class="form-control audit-expense-month-input" name="${j}" id="" placeholder='${j}' value="">
                </div>
                </div>`,_.setMonth(_.getMonth()+1)}b+=`
        <div class="col-sm-6 my-2 text-right">
            <button type='button' class="btn btn-primary save-expense-audit-months form-control">Save</button>
        </div>`,b+="</div>",D.html(b)}$(".audit-expense-months-container").on("input",".audit-expense-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-expense-audit-months",function(p){p.preventDefault();let u=[],b=!0;if(e.hasOwnProperty(v)){B.fire({icon:"warning",title:"Account Already Exists!",text:"You have already added this account."}),$(".audit-iexpensencome-end-date").val(""),$(".audit-expense-start-date").val(""),$(".audit-expense-months-container").empty();return}if($(".audit-expense-month-input").each(function(){var f=$(this).attr("name"),k=$(this).val();k!==""&&(b=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),u.push({expenseMonthName:f,value:$(this).val(),startDate:$(".audit-expense-start-date").val(),endDate:$(".audit-expense-end-date").val()}))}),b){$(".audit-expense-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),B.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}e[v]={months:u,startDate:$(".audit-expense-start-date").val(),endDate:$(".audit-expense-end-date").val()},$("#saved-audited-expense-months").empty(),$.each(e,(f,k)=>{var D='<table class="table table-hover client-journal-accounts">',N=f.split("_");D+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${N[1]}
                        <span class="text-sm fw-bold float-right remove-audit-expense" id="${f}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(k.months,(M,_)=>{D+=`
                    <tr>
                        <td class='text-left'>${_.expenseMonthName}</td>
                        <td class='text-left'>${_.value}</td>
                    </tr>
                `}),D+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,D+="</table>",$("#saved-audited-expense-months").append(D)}),$(".audit-expense-months-container").empty(),$("#audit-expense-category").val(""),$(".audit-expense-end-date").val(""),$(".audit-expense-start-date").val(""),v="",b=!0}),$(".save-audit-asset-info").on("click",function(p){p.preventDefault();var u=$(".journal-audit-asset-form").serializeArray(),b="",f="",k="";let D=!1;if($.each(u,(_,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),B.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="assetType"?b=j.value:j.name==="assetAccount"?f=j.value:j.name==="assetAmount"&&(k=j.value)}),!b||!f||!k){console.error("Required fields are missing.");return}if($.each(t,(_,j)=>{if($.each(j.accounts,(Z,H)=>{if(H.assetAccount===f.split("_")[0])return D=!0,!1}),D)return!1}),D)return B.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var N=b.split("_");t[N[0]]||(t[N[0]]={accounts:[]}),t[N[0]].accounts.push({assetAccount:f.split("_")[0],amount:k}),$(".append-audit-asset-accounts").empty();let M="";$.each(t,(_,j)=>{$.each(j.accounts,(Z,H)=>{var L=H.amount,q=L.toString().replace(/,/g,""),K=parseFloat(q).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});M+=`
            <tr id="${_}">
                <td class='text-sm'>${_}</td>
                <td class='text-sm'>${H.assetAccount}</td>
                <td class='text-sm'>
                    ${K}
                    <span class="badge fw-bold text-dark float-right remove-audited-asset" id="${H.assetAccount}">
                        <i class="fas fa-times"></i>
                    </span>
                </td>
            </tr>`})}),$(".append-audit-asset-accounts").append(M),$("#asset_account").val(""),$("#asset_account_name  option:first").text("Select Account"),$("#assetAmount").val(""),D=!1}),$(".save-audit-liability-info").on("click",function(p){p.preventDefault();var u=$(".journal-audit-liability-form").serializeArray(),b="",f="",k="";let D=!1;if($.each(u,(_,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),B.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="audit-liability-account"?b=j.value:j.name==="audit-liability-account-name"?f=j.value:j.name==="liability-amount"&&(k=j.value)}),!b||!f||!k){console.error("Required fields are missing.");return}if($.each(i,(_,j)=>{if($.each(j.accounts,(Z,H)=>{if(H.liabilityAccount===f.split("_")[0])return D=!0,!1}),D)return!1}),D)return B.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var N=b.split("_");i[N[0]]||(i[N[0]]={accounts:[]}),i[N[0]].accounts.push({liabilityAccount:f.split("_")[0],amount:k}),$(".append-audit-liability-accounts").empty();let M="";$.each(i,(_,j)=>{$.each(j.accounts,(Z,H)=>{var L=H.amount,q=L.toString().replace(/,/g,""),K=parseFloat(q).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});M+=`
                <tr id="${_}">
                    <td class='text-sm'>${_}</td>
                    <td class='text-sm'>${H.liabilityAccount}</td>
                    <td class='text-sm'>
                        ${K}
                        <span class="badge fw-bold text-dark float-right remove-audit-liability" id="${H.liabilityAccount}">
                            <i class="fas fa-times"></i>
                        </span>
                    </td>
                </tr>`})}),$(".append-audit-liability-accounts").append(M),$("#liability_account").val(""),$("#liability_account_name  option:first").text("Select Account"),$("#liabilityAmount").val(""),D=!1}),$(".save-audit-oe-info").on("click",function(p){p.preventDefault();var u=$(".journal-audit-oe-form").serializeArray(),b="",f="",k="";let D=!1;if($.each(u,(_,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),B.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="oe-account"?b=j.value:j.name==="oe-account-name"?f=j.value:j.name==="oe-amount"&&(k=j.value)}),!b||!f||!f){console.error("Required fields are missing.");return}if($.each(l,(_,j)=>{if($.each(j.accounts,(Z,H)=>{if(H.oeAccount===f.split("_")[0])return D=!0,!1}),D)return!1}),D)return B.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var N=b.split("_");l[N[0]]||(l[N[0]]={accounts:[]}),l[N[0]].accounts.push({oeAccount:f.split("_")[0],amount:k}),$(".append-audit-oe-accounts").empty();let M="";$.each(l,(_,j)=>{console.log(_),$.each(j.accounts,(Z,H)=>{var L=H.amount,q=L.toString().replace(/,/g,""),K=parseFloat(q).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});M+=`
            <tr id="${_}">
                <td class='text-sm'>${_}</td>
                <td class='text-sm'>${H.oeAccount}</td>
                <td class='text-sm'>
                    ${K}
                    <span class="badge fw-bold text-dark float-right remove-audit-oe some random stuff" id="${_}">
                        <i class="fas fa-times"></i>
                    </span>
                </td>
            </tr>`})}),$(".append-audit-oe-accounts").append(M),$("#oe-account").val(""),$("#oe-account-name  option:first").text("Select Account"),$("#oeAmount").val(""),D=!1}),$(document).on("click",".remove-audit-income",function(){$(this).closest("tr").remove();var p=$(this).attr("id");delete s[p],$("#saved-audited-income-months").empty(),$.each(s,(u,b)=>{var f='<table class="table table-hover client-journal-accounts">',k=u.split("_");f+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${k[1]}
                        <span class="text-sm fw-bold float-right remove-audit-income" id="${u}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(b.months,(D,N)=>{f+=`
                    <tr>
                        <td>${N.incomeMonthName}</td>
                        <td>${N.value}</td>
                    </tr>
                `}),f+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,f+="</table>",$("#saved-audited-income-months").append(f)}),console.log(s)}),$(document).on("click",".remove-audit-expense",function(p){delete e[$(this).attr("id")],$(this).closest("tr").remove(),$("#saved-audited-expense-months").empty(),$.each(e,(u,b)=>{var f='<table class="table table-hover client-journal-accounts">',k=u.split("_");f+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${k[1]}
                        <span class="text-sm fw-bold float-right remove-audit-expense" id="${u}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(b.months,(D,N)=>{f+=`
                    <tr>
                        <td class='text-left'>${N.expenseMonthName}</td>
                        <td class='text-left'>${N.value}</td>
                    </tr>
                `}),f+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,f+="</table>",$("#saved-audited-expense-months").append(f)})}),$(document).on("click",".remove-audited-asset",function(p){p.preventDefault(),$(this).closest("tr").remove();for(let u in t)t[u].accounts&&(t[u].accounts=t[u].accounts.filter(b=>b.assetAccount!==$(this).attr("id"))),t[u].accounts.length===0&&delete t[u]}),$(document).on("click",".remove-audit-liability",function(p){p.preventDefault(),$(this).closest("tr").remove();for(let u in i)i[u].accounts&&(i[u].accounts=i[u].accounts.filter(b=>b.liabilityAccount!==$(this).attr("id"))),i[u].accounts.length===0&&delete i[u]}),$(document).on("click",".remove-audit-oe",function(p){p.preventDefault();var u=$(this).attr("id");console.log("yawas"),$(this).closest("tr").remove();for(let b in l)l[b].accounts&&(l[b].accounts=l[b].accounts.filter(f=>f.oeAccount!==u)),l[b].accounts.length===0&&(delete l[b],console.log(l));console.log(l)});var x=0,g=0,O=0,F=0,X=0,V=0,w=0,h=0,S=0,y=0,C=0;console.log(e),$(".audit-next-btn").on("click",function(){if(o===1){if($("#append-audit-expenses-choy").empty(),$(".revenue-audit-income-total").empty(),Object.keys(s).length===0){B.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var p='<div class="col-sm-12 ml-3 text-dark" id="append-audit-expenses-choy">',u=0;$.each(s,(E,T)=>{p+='<div class="row mb-2">';const J=E.includes("_")?E.split("_")[1]:E;p+=`<div class="col-6 revenue-audit-accounts">${J}</div>`,console.log(E),$.each(T.months,(Y,z)=>{var Q=z.value.replace(/,/g,""),U=parseFloat(Q);x+=U,u+=U}),p+=`<div class="col-6 text-right revenue-audit-amount">${u.toLocaleString()}</div>`,p+="</div>"}),p+="</div>",$("#append-audit-expenses-choy").html(p),$(".revenue-audit-income-total").text(x.toLocaleString())}if(o===2){if($(".append-audit-oe").empty(),$(".append-audit-ldc").empty(),Object.keys(e).length===0){B.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var b=!1,f=!1;if($.each(e,(E,T)=>{var J=E.split("_"),Y=J[2];Y==="Less Direct Cost"?b=!0:Y==="Operating Expenses"&&(f=!0)}),!b||!f){B.fire({icon:"warning",title:"Missing Data",text:'Both "Less Direct Cost" and "Operating Expenses" entries are required.'});return}X=0,$.each(e,(E,T)=>{var J=E.split("_")[1];if(E.split("_")[2]==="Less Direct Cost"){var Y="";$.each(T.months,(Q,U)=>{var ae=U.value.replace(/,/g,""),oe=parseFloat(ae);O+=oe,Y+=`
                        <div class="row">
                            <div class="col-sm-6 text-left">${J}</div>
                            <div class="col-sm-6 text-right">${oe.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</div>
                        </div>
                        `}),$(".append-audit-ldc").append(Y)}if(E.split("_")[2]==="Operating Expenses"){var z="";$.each(T.months,(Q,U)=>{var ae=U.value.replace(/,/g,""),oe=parseFloat(ae);X+=oe,z+=`
                        <div class="row">
                            <div class="col-sm-6 text-left">${J}</div>
                            <div class="col-sm-6 text-right">${oe.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</div>
                        </div>
                        `}),$(".append-audit-oe").append(z)}}),F=x-O,g=F-X,$(".expenses-ldc-audit-total").text(O.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".gries-audit-total").text(F.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".tgi-audit").text(F.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".oe-audit-total").text(X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".net-audit-amount").text(g.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))}if(o===3){if($(".append-ca-audit").empty(),$(".append-audit-nca").empty(),$(".append-audit-fa").empty(),!Object.keys(t).some(T=>t[T].accounts&&t[T].accounts.length>0)){B.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var k="",D="",N="";$.each(t,(T,J)=>{T==="Current Asset"&&$.each(J.accounts,(Y,z)=>{var Q=z.amount.replace(/,/g,""),U=parseFloat(Q);w+=U,k+=`
                                <div class="row">
                                    <span class="col-sm-6 text-sm text-left">${z.assetAccount}</span>
                                    <span class="col-sm-6 text-sm text-right">${U.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                                </div>
                            `}),T==="Non-Current Assets"&&$.each(J.accounts,(Y,z)=>{var Q=z.amount.replace(/,/g,""),U=parseFloat(Q);V+=U,D+=`
                            <div class="row">
                                <span class="col-sm-6 text-sm text-left">${z.assetAccount}</span>
                                <span class="col-sm-6 text-sm text-right">${U.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                            </div>
                        `}),T==="Fixed Assets"&&$.each(J.accounts,(Y,z)=>{var Q=z.amount.replace(/,/g,""),U=parseFloat(Q);h+=U,N+=`
                        <div class="row">
                            <span class="col-sm-6 text-sm text-left">${z.assetAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${U.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `}),$(".append-ca-audit").html(k),$(".append-audit-nca").html(D),$(".append-audit-fa").html(N),$(".tnca-audit-amount").text(V.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".total-audit-ca").text(w.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),S=w+V+h,$(".total-audit-assets").text(S.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))})}if(o===4){if(y=0,$(".append-audit-cl").empty(),!Object.keys(i).some(T=>i[T].accounts&&i[T].accounts.length>0)){B.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var M="";$.each(i,(T,J)=>{$.each(J.accounts,(Y,z)=>{var Q=z.amount.replace(/,/g,""),U=parseFloat(Q);y+=U,M+=`
                        <div class="row">
                            <span class="col-sm-6 text-sm text-left">${z.liabilityAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${U.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `})}),$(".append-audit-cl").html(M)}if(o===5){console.log("this line"),C=0,$(".append-audit-oenw").empty();var _="";const E=Object.keys(l).some(T=>l[T].accounts&&l[T].accounts.length>0);if(console.log(l),!E){B.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}$.each(l,(T,J)=>{$.each(J.accounts,(Y,z)=>{var Q=z.amount.replace(/,/g,""),U=parseFloat(Q);C+=U,_+=`<div class="row">
                            <span class="col-sm-6 text-sm text-left">${z.oeAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${U.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `})}),$(".append-audit-oenw").html(_)}if(o===6){var j=$(".journal-audit-adjustments-form").serializeArray(),Z=!0;if($.each(j,(E,T)=>{if(T.value===""){Z=!1,$(`[name='${T.name}']`).addClass("is-invalid");return}m[T.name]=T.value,$(`[name='${T.name}']`).removeClass("is-invalid")}),!Z){B.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}var H=0,L=0;$.each(m,(E,T)=>{if(E==="audit-owners_contribution"){var J=T.replace(/,/g,""),Y=parseFloat(J);H+=Y}if(E==="audit-owners_withdrawal"){var J=T.replace(/,/g,""),Y=parseFloat(J);L+=Y}});var q=L+g;$(".additional-audit-capital").text(H.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".audit-less-drawings").text(L.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".fp-audit-nc").text(g.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".appraisal-audit-capital").text(q.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));var K=q-parseFloat($(".audit-less-drawings").text().replace(/[^0-9.-]+/g,""));$(".audit-capital-end").text(K.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));var P=y+C;$(".tlc-audit").text(P.toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}))}o<7&&($(".multi-step-journal-audit").hide(),o++,A(o)),R(o),o===7?($(".audit-next-btn").hide(),$(".audit-save-btn").show()):($(".audit-next-btn").show(),$(".audit-save-btn").hide()),o===1?$(".audit-prev-btn").hide():$(".audit-prev-btn").show()}),$(".audit-prev-btn").on("click",function(){o>1&&($(".multi-step-journal-audit").hide(),o--,A(o)),R(o),$(".audit-next-btn").show(),$(".audit-save-btn").hide(),o===1?$(".audit-prev-btn").hide():$(".audit-prev-btn").show()});function A(p){$(".multi-step-journal-audit").hide(),$(".multi-step-journal-audit").eq(p-1).show()}function R(p){$(".audit-step").removeClass("active"),$(".audit-indicator-line").removeClass("active"),$(".audit-step").each(function(u){u<p&&($(this).addClass("active"),$(this).next(".audit-indicator-line").addClass("active"))})}A(o),R(o),o===1&&$(".audit-prev-btn").hide(),$(".save-audit-journal-btn").on("click",function(){$(".audit-client-journal-loader").removeClass("visually-hidden");var p={incomeObj:s,expenseObj:e,assetObj:t,liabilityObj:i,oeObj:l,adjustmentObj:m,references:$(this).attr("id")};$.ajax({type:"POST",url:"client/journal/audit",data:p,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(u){$(".audit-client-journal-loader").addClass("visually-hidden"),localStorage.setItem("journal","updated"),window.location.href="clients"},error:function(u,b,f){$(".audit-client-journal-loader").addClass("visually-hidden"),ce.fire({icon:"error",title:"Something went wrong",text:`Translated: ${u} 
 if issue persist try reloading the page or contact developer`})}})});var I=localStorage.getItem("journal");I==="updated"&&(B.fire({icon:"success",title:"Journal Update",text:"Journal Updated Successfully"}),localStorage.removeItem("journal"))});var te=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){var o="";$(".add-new-service-req").on("click",function(c){console.log($(this).attr("id")),console.log("this sum bulshit");var r=$(this).attr("id").split("_"),d=r[1],s=$(`.service-req-${r[1]}`).serializeArray(),e=!0;$.each(s,(t,i)=>{if(i.value===""){te.fire({icon:"warning",title:"Missing Entry!",text:"Please Enter Requirement Name"}),e=!1,$('[name="req-name"]').addClass("is-invalid");return}$('[name="req-name"]').removeClass("is-invalid")}),e&&$.ajax({type:"POST",url:"requirement-for-service",data:{form:s,idref:d},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){console.log(t),localStorage.setItem("req","added"),location.reload()},error:function(t,i,l){te.fire({icon:"error",title:"Oops! Something Went wrong",text:"Translated: "+t})}})}),$(".add-new-sub-service-req").on("click",function(c){var r=$("#sub_service_id").val(),d=$("#sub-service-req-id").val();if((r===""||d==="")&&te.fire({icon:"warning",title:"Missing Entry!",text:"Please Enter Requirement Name"}),d===""){$("#sub-service-req-id").addClass("is-invalid");return}else $("#sub-service-req-id").removeClass("is-invalid"),$.ajax({type:"POST",url:"sub-service-requirement",data:{reqName:d,idRef:r},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(s){console.log(s),localStorage.setItem("req","added"),location.reload()},error:function(s,e,t){te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+s})}})}),$(".get-client-service-req").on("click",function(){o="",$(".append-service-req").empty(),console.log($(this).attr("id"));let c=$(this).attr("id");$(".service-reqs-loader").removeClass("visually-hidden");var r="";$.ajax({type:"POST",url:`client/service/requirements/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(d){o=d.category,console.log(d),console.log("this"),$(".service-reqs-loader").addClass("visually-hidden"),$.each(d.serviceReqs,(s,e)=>{let t="";e.gcon?t=`<td>${e.gcon}</td>`:t=`
                        <td><input type="file" class="req-file" id="${e.id}_${c}" data-id="${e.req_name}_${e.id}" name="${e.req_name}_${e.id}"></td>
                    `,r+=`
                        <tr>
                            <td>${e.req_name}</td>
                            ${t}
                        </tr>
                    `}),$(".append-service-req").append(r)},error:function(d,s,e){$(".service-reqs-loader").addClass("visually-hidden"),te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+d})}})}),$(".save-req-files").on("click",function(){let c=[],r=!1,d=new FormData;const s=$(this).attr("id");if($(".req-file").each(function(){if(this.files.length){r=!0;const e=$(this).attr("id"),t=o,i=this.files[0];c.push({service_id:s,sub_service_req_id:e,category:t,file:i.name}),d.append(`files[${e}]`,i)}}),!r){te.fire({icon:"error",title:"Please upload at least one file."});return}d.append("metadata",JSON.stringify(c)),$.ajax({type:"POST",url:"/service/requirement/document",data:d,processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){console.log(e),localStorage.setItem("req-docs","added"),location.reload()},error:function(e,t,i){te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+e})}})}),$(".view-client-service-doc").on("click",function(){$(".service-docs-loader").removeClass("visually-hidden"),console.log($(this).attr("id")),$(".append-service-docs").empty();let c="";$.ajax({type:"POST",url:`/service/requirement/documents/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){$(".service-docs-loader").addClass("visually-hidden"),console.log(r),$.each(r.docsData,(d,s)=>{console.log(s);let e="";s.grp&&s.grp.trim()!==""&&(e=`
                            <a href="storage/${s.grp}" 
                               download="${s.gcon}" 
                               class="badge bg-warning text-dark" 
                               style="font-size: 10px;">
                                <i class="fas fa-cloud-download-alt"></i> Download
                            </a>
                        `),c+=`
                        <tr>
                            <td>${s.req_name}</td>
                            <td>${s.gcon||"No file name"}</td>
                            <td>${s.gcmt}</td>
                            <td>${e}</td>
                        </tr>
                    `}),$(".append-service-docs").html(c)},error:function(r,d,s){$(".service-docs-loader").addClass("visually-hidden"),te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+r})}})});var a=localStorage.getItem("req-docs"),n=localStorage.getItem("req");n==="added"&&(te.fire({icon:"success",title:"Service Requirement",text:"New requirement added"}),localStorage.removeItem("req")),a==="added"&&(te.fire({icon:"success",title:"Service Requirement",text:"New requirement document is added"}),localStorage.removeItem("req-docs"))});$(document).ready(function(){Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});var o=Swal.mixin({toast:!1,position:"bottom-end"});$(".expense-quarter").change(function(){var a=$(this).val();if(!a||!["Q1","Q2","Q3","Q4"].includes(a)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`quarterly-expense-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){var c=n[a];if(c){let r=[],d=[];$.each(c.details,function(s,e){r.push(s),d.push(e.total)}),expenseChart.data.labels=r,expenseChart.data.datasets[0].data=d,expenseChart.update()}else console.error("No data found for quarter: "+a)},error:function(n,c,r){o.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+n})}})}),$(".income-quarter").change(function(){var a=$(this).val();if(!a||!["Q1","Q2","Q3","Q4"].includes(a)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`quarterly-income-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){var c=n[a];if(c){let r=[],d=[];$.each(c.details,function(s,e){r.push(s),d.push(e.total)}),lineChart.data.labels=r,lineChart.data.datasets[0].data=d,lineChart.update()}else console.error("No data found for quarter: "+a)},error:function(n,c,r){o.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+n})}})}),$(".sales-quarter").change(function(){var a=$(this).val();if(!a||!["Q1","Q2","Q3","Q4"].includes(a)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`quarterly-sales-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){var c=n[a];if(c){let r=[],d=[];$.each(c.details,function(s,e){r.push(s),d.push(e.total)}),salesChart.data.labels=r,salesChart.data.datasets[0].data=d,salesChart.update()}else console.error("No data found for quarter: "+a)},error:function(n,c,r){o.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+n})}})}),$(".client-quarter").change(function(){var a=$(this).val();if(!a||!["Q1","Q2","Q3","Q4"].includes(a)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`/quarterly-client-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){var c=n[a];if(c){let r=c.months,d=[];for(let s of r)d.push(c.details[s]?c.details[s].total:0);clientsChart.data.labels=r,clientsChart.data.datasets[0].data=d,clientsChart.update()}else console.error("No data found for quarter: "+a)},error:function(n){o.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+n})}})}),$("#yearInput").change(function(){var a=$(this).val();if(!a||isNaN(a)){console.error("Invalid year entered.");return}$.ajax({method:"POST",url:"filter-by-year-income",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{year:a},success:function(n){console.log("Year Data:",n);let c=Object.keys(n),r=Object.values(n);lineChart.data.labels=c,lineChart.data.datasets[0].data=r,lineChart.update()},error:function(n){console.error("AJAX Error:",n.responseText)}})}),$("#yearInputExpense").change(function(){var a=$(this).val();if(!a||isNaN(a)){console.error("Invalid year entered.");return}$.ajax({method:"POST",url:"filter-by-year-expense",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{year:a},success:function(n){console.log("Year Data:",n);let c=Object.keys(n),r=Object.values(n);expenseChart.data.labels=c,expenseChart.data.datasets[0].data=r,expenseChart.update()},error:function(n){console.error("AJAX Error:",n.responseText)}})}),$("#yearInputClient").change(function(){var a=$(this).val();if(!a||isNaN(a)){console.error("Invalid year entered.");return}$.ajax({method:"POST",url:"filter-by-year-client",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{year:a},success:function(n){console.log("Year Data:",n);let c=Object.keys(n),r=Object.values(n);clientsChart.data.labels=c,clientsChart.data.datasets[0].data=r,clientsChart.update()},error:function(n){console.error("AJAX Error:",n.responseText)}})}),$("#yearlySales").change(function(){var a=$(this).val();if(!a||isNaN(a)){console.error("Invalid year entered.");return}$.ajax({method:"POST",url:"yearly-sales",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{year:a},success:function(n){console.log("success");var c=n.details;if(c){let r=[],d=[];$.each(c,function(s,e){r.push(s),d.push(e.total)}),salesChart.data.labels=r,salesChart.data.datasets[0].data=d,salesChart.update()}else console.error("No data found for year: "+a)},error:function(n,c,r){o.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+n.responseText})}})})});$(document).ready(function(){window.formatValueInput=function(o){var a=o.value.replace(/[^0-9\.]/g,""),n=a.split(".");n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),n.length>1?o.value=n[0]+"."+n[1]:o.value=n[0]},window.previewImage=function(o,a){const c=o.target.files[0];if(c){const r=new FileReader;r.onload=function(d){const s=document.getElementById(a);s?s.src=d.target.result:console.error(`Preview element with ID ${a} not found.`)},r.readAsDataURL(c)}else console.warn("No file selected.")},$(".settings-info-box").hover(function(){$(this).find(".fa-trash").removeClass("visually-hidden")},function(){$(this).find(".fa-trash").addClass("visually-hidden")})});
