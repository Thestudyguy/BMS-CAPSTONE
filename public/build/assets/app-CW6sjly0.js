function pe(o,i,r,l){$.ajax({url:o,type:"POST",data:i,success:function(s){r(s)},error:function(s,c,a){l(s,c,a)}})}function $e(o,i,r,l){$.ajax({url:o,type:"POST",headers:i,success:function(s){r(s)},error:function(s,c,a){l(s,c,a)}})}function he(o,i,r,l,s,c){$.ajax({url:o,type:"POST",data:{...i,id:r},headers:l,success:function(a){s(a)},error:function(a,e,t){c(a,e,t)}}),console.log(i),console.log(r)}function ge(o,i,r,l,s){$.ajax({url:o,type:"POST",data:i,headers:r,success:function(c){l(c)},error:function(c,a,e){s(c,a,e)}})}function xe(o,i,r,l,s,c){var a=new FormData;for(var e in i)i.hasOwnProperty(e)&&a.append(e,i[e]);r&&a.append("profile",r),$.ajax({url:o,type:"POST",data:a,headers:l,processData:!1,contentType:!1,success:function(t){s(t)},error:function(t,n,d){c(t,n,d)}})}function be(o,i,r,l){$.ajax({url:o,type:"POST",headers:i,success:function(s){r(s)},error:function(s,c,a){l(s,c,a)}})}function ye(o,i,r,l,s){$.ajax({url:o,type:"POST",data:i,headers:r,processData:!1,contentType:!1,success:function(c){l(c)},error:function(c,a,e){s(c,a,e)}})}function Se(o,i,r,l,s){$.ajax({url:o,type:"POST",data:i,headers:r,success:function(c){l(c)},error:function(c,a,e){s(c,a,e)}})}function we(o,i,r,l,s){$.ajax({url:o,type:"POST",data:i,headers:r,success:function(c){l(c)},error:function(c,a,e){s(c,a,e)}})}function Ce(o,i,r,l,s){$.ajax({url:o,type:"POST",data:i,headers:r,success:function(c){l(c)},error:function(c,a,e){s(c,a,e)}})}function Fe(o,i,r,l,s){$.ajax({url:o,type:"POST",data:i,headers:r,success:function(c){l(c)},error:function(c,a,e){s(c,a,e)}})}function je(o,i,r,l,s){$.ajax({url:o,type:"POST",data:i,headers:r,success:function(c){l(c)},error:function(c,a,e){s(c,a,e)}})}function Oe(o,i,r,l,s){$.ajax({url:o,type:"POST",data:i,headers:r,success:function(c){l(c)},error:function(c,a,e){s(c,a,e)}})}function Te(o,i,r,l,s){$.ajax({url:o,type:"POST",data:i,headers:r,success:function(c){l(c)},error:function(c,a,e){s(c,a,e)}})}var G=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),W=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".search-coa").on("keyup",function(){var e=$(this).val().toLowerCase();$("#coa-table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(e)>-1)})}),$("#filter-coa").on("change",function(){var e=$(this).val();$(".coa-table tbody tr").each(function(){var t=$(this).data("category");e==="clear"?$(this).show():e===""||t===e?$(this).show():$(this).hide()})}),$(".client-table-data").hover(function(){$(this).find(".action-icons").removeClass("visually-hidden")},function(){$(this).find(".action-icons").addClass("visually-hidden")}),$(".new-sub-service-icon").on("click",function(e){e.stopPropagation()}),$(".edit-service-icon").on("click",function(e){e.stopPropagation()}),$(".view-service-details").on("click",function(e){e.stopPropagation()}),$(".remove-service-icon").on("click",function(e){e.stopPropagation()});function o(e){localStorage.setItem("transaction-status",e),location.reload()}$(".client-sub-table").on("click",function(){console.log($(this).attr("id")),$(this).closest("tr").next(".expandable-body").find(".loader-td")}),$(".external-service").on("click",function(){var e=$(this).next(".expandable-body").find(".loader");e.removeClass("visually-hidden");var t=$(this).attr("id");$.ajax({type:"POST",url:`sub-services-${t}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){e.addClass("visually-hidden");var d=n.services,m='<table class="table table-hover float-left append-sub-services">';m+=`
                <thead class="text-left">
                    <tr>
                        <td>Requirements</td>
                        <td>Price</td>
                    </tr>
                </thead> 
                `,$.each(d,(h,v)=>{var C=parseFloat(v.ServiceRequirementPrice).toFixed(2).toLocaleString(),T=Number(C).toLocaleString();m+=`
                    <tbody class="text-left">
                        <tr class='sub-service' id='${v.id}'>
                            <td>${v.ServiceRequirements}</td>
                            <td>${T}
                            <span id='${v.id}' class="badge mx-2 bg-warning float-right text-sm sub-service-action-icons-remove" data-bs-target='#remove-sub-service' data-bs-toggle='modal' >
                                <i class="fas fa-trash" style="font-size: .8em;"></i>
                            </span>
                            <span id='${v.id}' data-bs-target='#edit-sub-service-modal' data-bs-toggle='modal' class="badge bg-warning float-right text-sm sub-service-action-icons-edit">
                                <i class="fas fa-pen" style="font-size: .8em;"></i>
                            </span>
                            <span id='${v.id}' data-bs-target='#add-sub-service-req' data-bs-toggle='modal' class="mx-2 badge bg-warning float-right text-sm sub-service-action-icons-req">
                                <i class="fas fa-file" style="font-size: .8em;"></i>
                            </span>
                            </td>
                        </tr>
                    </tbody>                    
                    `}),m+="</table>",$(`.append-sub-services-${t}`).html(m)},error:function(n,d,m){W.fire({icon:"error",title:"Fatal Error",text:n})}})}),$(document).on("click",".sub-service-action-icons-req",function(){var e=$(this).attr("id");$.ajax({type:"POST",url:`retrieve-sub-service-data-${e}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){console.log(t.sub_service),$("#sub_service_id").attr("id",t.sub_service.id),$("#sub_service_id").val(t.sub_service.id),$(".sub-service-req-service-name").text(t.sub_service.ServiceRequirements)},error:function(t,n,d){W.fire({icon:"error",title:"Something went wrong",text:`Translated: ${t}`})}})}),$(document).on("click",".sub-service-action-icons-edit",function(e){$(".sub-service-loader").removeClass("visually-hidden");var t=$(this).attr("id");$.ajax({type:"POST",url:`retrieve-sub-service-data-${t}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){$(".sub-service-loader").addClass("visually-hidden"),console.log(n.sub_service.ServiceRequirementPrice),$("#service-edit-field").val(n.sub_service.ServiceRequirements),$("#serviceprice-edit-field").val(n.sub_service.ServiceRequirementPrice),$("#sub-service-edit-id").val(n.sub_service.id)},error:function(n,d,m){W.fire({icon:"error",title:"Something went wrong",text:`Translated: ${n}`})}})}),$(document).on("click",".sub-service-action-icons-remove",function(e){e.preventDefault();var t=$(this).attr("id"),n=$(this).closest("tr").find("td:eq(0)").text().trim();console.log(n),$(".sub-service-app").text(n),$(".remove-sub-service").attr("id",t)}),$(document).on("click",".remove-sub-service",function(){$.ajax({type:"POST",url:`remove-sub-service/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){localStorage.setItem("sub-service","removed"),location.reload()},error:function(e,t,n){W.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+e})}})}),$("#edit-sub-service").on("click",function(e){e.preventDefault();var t=$("#edit-sub-service-form").serializeArray(),n=!0,d={};if($.each(t,(v,C)=>{C.value===""?(n=!1,$(`[name='${C.name}']`).addClass("is-invalid"),G.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"})):($(`[name='${C.name}']`).removeClass("is-invalid"),d[C.name]=C.value)}),n){let v=function(T){console.log(T),localStorage.setItem("sub_service","updated"),location.reload()},C=function(T,E,M){var V=JSON.parse(T.responseText),F=V.error;if(F==="Service already exists"){$(".conflict-warning").removeClass("visually-hidden"),$("#new-service-form [name='Service']").addClass("is-invalid"),$(".conflict-text").text("Service already exists");return}else W.fire({icon:"error",title:"Fatal Error",text:`Translated: ${F}`}),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid")};var m=v,h=C;je("edit-sub-service",d,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},v,C)}}),$("#new-service-form").on("submit",function(e){e.preventDefault(),$(".conflict-text").text("Service already exists"),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid");var t={},n=$(this).serializeArray(),d=!1;if($.each(n,(v,C)=>{if(C.value==="")return $(`#new-service-form [name='${C.name}']`).addClass("is-invalid"),G.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),d=!0,!1;t[C.name]=C.value}),d)return;pe("new-service",t,m,h);function m(v){o("created")}function h(v,C,T){var E=JSON.parse(v.responseText),M=E.error;if(M==="Service already exists"){$(".conflict-warning").removeClass("visually-hidden"),$("#new-service-form [name='Service']").addClass("is-invalid"),$(".conflict-text").text("Service already exists");return}else W.fire({icon:"error",title:"Fatal Error",text:`Translated: ${M}`}),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid")}}),$(".remove-service").on("click",function(){$e(`remove-service-${$(this).attr("id")}`,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t);function e(n){o("removed")}function t(n,d,m){W.fire({icon:"error",title:"Fatal Error",text:n})}}),$(".edit-service").on("click",function(e){e.preventDefault();var t=$(this).attr("id"),n="#edit-service-form-"+t,d=$(n).serializeArray();console.log(d);var m={},h=!1;if($.each(d,(T,E)=>{if(E.value==="")return $(n+" [name='"+E.name+"']").addClass("is-invalid"),G.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),h=!0,!1;m[E.name]=E.value}),h)return;he("update-service",m,t,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},v,C);function v(T){o("updated")}function C(T,E,M){var V=JSON.parse(T.responseText),F=V.error;W.fire({icon:"error",title:"Fatal Error",text:`Translated: ${F}`})}}),$(".submit-new-sub-service").on("click",function(e){e.preventDefault();var t=!0,n={},d=$(this).attr("id"),m=$(`#new-sub-service-${d}`).serializeArray();if(console.log(m),$.each(m,(C,T)=>{T.value===""?($(`[name='${T.name}']`).addClass("is-invalid"),t=!1):(n[T.name]=T.value,$(`[name='${T.name}']`).removeClass("is-invalid"))}),!t){G.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}ge("new-sub-service",n,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},h,v);function h(C){console.log(C),localStorage.setItem("sub_service","created"),location.reload()}function v(C,T,E){console.log(C),C.responseJSON&&C.responseJSON.message?(W.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${C.responseJSON.message}`}),console.log(C.responseJSON.errors)):W.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${C.responseJSON.error}`})}});var i={},r=document.getElementById("fileInput");$(".next-form").on("click",function(){var e=$(".multi-step:visible"),t=e.serializeArray(),n=!1,d=!1;if(e.find(".form-control").removeClass("is-invalid"),$.each(t,(E,M)=>{M.value===""&&($(`[name='${M.name}']`).addClass("is-invalid"),n=!0),i[M.name]=M.value}),e.hasClass("client-profile")&&(!r.files||r.files.length===0?($("#fileInput").addClass("is-invalid"),d=!0):$("#fileInput").removeClass("is-invalid")),n)G.fire({icon:"warning",title:"Missing Fields",text:"Fill all fields to proceed"});else if(d)G.fire({icon:"warning",title:"Missing File",text:"Please upload a profile picture before proceeding."});else{var m=e.next(".multi-step");if(m.hasClass("data-entry-preview")){$(".companyName").text($("[name='CompanyName']").val()),$(".companyEmail").text($("[name='CompanyEmail']").val()),$(".companyAddress").text($("[name='CompanyAddress']").val()),$(".companyCEO").text($("[name='CEO']").val()),$(".companyCEODob").text($("[name='CEODateOfBirth']").val()),$(".companyCEOContact").text($("[name='CEOContactInformation']").val()),$(".representativeName").text($("[name='RepresentativeName']").val()),$(".representativeContact").text($("[name='RepresentativeContactInformation']").val()),$(".representativeDob").text($("[name='RepresentativeDateOfBirth']").val()),$(".representativePosition").text($("[name='RepresentativePosition']").val()),$(".representativeAddress").text($("[name='RepresentativeAddress']").val());var h=document.getElementById("fileInput");if(h.files&&h.files[0]){var v=new FileReader;v.onload=function(E){$("#previewImage").attr("src",E.target.result).show()},v.readAsDataURL(h.files[0])}}m.length&&e.fadeOut(300,function(){$(this).hide(),m.fadeIn(200,function(){$(this).show()})});var C=$(".client-step.active"),T=C.next(".client-form-indicator-line");T.addClass("active"),T.next(".client-step").addClass("active"),$(".previous-form").removeClass("visually-hidden"),e.next(".multi-step").next(".multi-step").length||($(".next-form").addClass("visually-hidden"),$(".save").removeClass("visually-hidden"))}}),$(".previous-form").on("click",function(){var e=$(".multi-step:visible"),t=e.prev(".multi-step");if(t.length){e.fadeOut(300,function(){$(this).hide(),t.fadeIn(300,function(){$(this).show()})});var n=$(".client-step.active"),d=n.prev(".client-form-indicator-line");n.removeClass("active"),d.prev(".client-step").addClass("active"),$(".next-form").removeClass("visually-hidden"),$(".save").addClass("visually-hidden"),t.prev(".multi-step").length||$(".previous-form").addClass("visually-hidden")}}),$(".get-ceo-info").click(function(){$("#repName").val(i.CEO),$("#repcontact").val(i.CEOContactInformation),$("#repdob").val(i.CEODateOfBirth),$("#position").val("CEO"),$("#repaddress").val(i.CompanyAddress)}),$(".save").on("click",function(){new FormData,console.log(i),xe("new-client-record",i,fileInput.files[0],{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},function(t){console.log("Success:",t),o("created"),window.location.href="clients"},function(t,n,d){t.responseJSON&&t.responseJSON.message&&(W.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${t.responseJSON.message}`}),console.log(t.responseJSON.errors))})}),$("#fileInput").on("change",function(e){var t=this.files[0];if(t){var n=new FileReader;n.onload=function(d){$("#imagePreview").attr("src",d.target.result).show(),console.log(d.target.result)},n.readAsDataURL(t)}else $("#imagePreview").attr("src","#").hide()}),$(".pdf-services").on("click",function(e){e.preventDefault();var t=$(this).data("url");window.open(t,"services/pdf")});var l=localStorage.getItem("activeNavItem");l&&$('.nav-item a[href="'+l+'"]').addClass("active"),$(".nav-item a").on("click",function(){$(".nav-item a").removeClass("active"),$(this).addClass("active"),localStorage.setItem("activeNavItem",$(this).attr("href"))});const s=localStorage.getItem("transaction-status");if(s){localStorage.removeItem("transaction-status");const e={created:{icon:"success",title:"New Record",text:"New record added successfully"},removed:{icon:"success",title:"Record Removed!",text:"Record removed successfully"},updated:{icon:"success",title:"Record Updated!",text:"Record updated successfully"}};e[s]&&G.fire(e[s])}var c=localStorage.getItem("sub_service"),a=localStorage.getItem("sub-service");c==="created"&&(G.fire({icon:"success",title:"New Requirement added"}),localStorage.removeItem("sub_service")),c==="updated"&&(G.fire({icon:"success",title:"Service Updated!"}),localStorage.removeItem("sub_service")),a==="removed"&&(G.fire({icon:"success",title:"Service Removed!"}),localStorage.removeItem("sub-service"))});var Ae=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),ve=Swal.mixin({toast:!1,position:"bottom-end"}),re=0,ce=0,ee=[];$(document).ready(function(){$(".services").on("change",function(){var a=$(this).attr("id"),e=$(this).val().split("_"),t=e[0],n=$(this).val(),d=parseFloat(e[1]);ee=[],$(".sub-services-append").html(""),$(".service-input").html(""),$(".sub-services").find(".loader").removeClass("visually-hidden"),$(".services-total").show(),ce=d,re=1,l(t,d),r(),be(`fetch-sub-services-${a}`,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},o,i),ee.push({serviceName:n,servicePrice:d,serviceFile:null}),console.log(ee)});function o(a){$(".sub-services").find(".loader").addClass("visually-hidden"),$.each(a.subServices,(e,t)=>{t!=="id"&&$(".sub-services-append").append(`<li>
                    <input class='sub-service-item' type='checkbox' name='SubService' id='${t.id}' 
                    value='${t.ServiceRequirements}_${t.ServiceRequirementPrice}_subservice_${t.id}' 
                    style='font-size: 5px;'>${t.ServiceRequirements}
                </li>`)})}function i(a,e,t){console.log(a),ve.fire({icon:"error",title:"Fatal Error",text:`Translated: ${a}`})}$(document).on("click",".sub-service-item",function(){var a=$(this).val().split("_"),e=$(this).val(),t=$(this).attr("id"),n=a[0],d=parseFloat(a[1]);if($(this).is(":checked"))$(".client-service-input").append(`<tr id='row-${t}'>
                    <td>${n}</td>
                    <td>${d.toLocaleString()}</td>
                </tr>`),ce+=d,re++,ee.push({serviceName:e,servicePrice:d,serviceFile:null});else{const m=ee.findIndex(h=>h.serviceName===e);console.log(e,"unchecked"),$(`#row-${t}`).remove(),ce-=d,re--,m!==-1&&ee.splice(m,1)}console.log(ee),r()});function r(){$(".totalAmount").text(`Total Amount: ${ce.toLocaleString()}`),$(".totalServices").text(`Total Services: ${re}`)}function l(a,e,t){const n=a.replace(/\s+/g,"_");$(".service-input").append(`
            <div class="row">
                <div class="col-sm-12">
                    <div class="row">
                        <table style='font-size: 10px;' class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <td>Service</td>
                                    <td>Amount</td>
                                </tr>
                            </thead>
                            <tbody class='client-service-input'>
                                <tr>
                                    <td>${a}</td>
                                    <td>${e.toLocaleString()}</td>
                                    <td><span class="badge fw-bold text-light bg-danger rounded-1 remove-parent-service" id=${n}><i class="fas fa-trash"></i></span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `)}$(document).on("change",".clientDocument",function(){var a=$(this),e=a.closest("tr"),t=e.find("td").first().text(),n=Array.from(a[0].files);ee=ee.map(d=>d.serviceName===t?{...d,serviceFile:n.length>0?n[0]:null}:d)}),$(document).on("click",".remove-parent-service",function(){var a=$(this).attr("id");console.log(a),a.replace(/_/g," "),console.log("Prepared Service Ref:",a)});function s(){$(".add-client-service-loader").removeClass("visually-hidden");var a=$(".hidden-client-id").attr("id"),e=new FormData;e.append("client_id",a),ee.forEach((d,m)=>{e.append(`services[${m}][serviceName]`,d.serviceName),e.append(`services[${m}][servicePrice]`,d.servicePrice),d.serviceFile&&e.append(`services[${m}][serviceFile]`,d.serviceFile)});for(const[d,m]of e.entries())console.log(d,m);ye(`client-services-${a}`,e,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},t,n);function t(d){$(".add-client-service-loader").addClass("visually-hidden"),console.log(d),window.location.href="clients",localStorage.setItem("services",!0)}function n(d,m,h){$(".add-client-service-loader").addClass("visually-hidden");try{const v=JSON.parse(d.responseText);console.log("Parsed Response:",v),ve.fire({icon:"warning",title:"Conflict",text:v.Conflict})}catch(v){console.log("Could not parse JSON response:",v)}}}$(".submit-services").on("click",function(){s()});var c=localStorage.getItem("services");c&&(Ae.fire({icon:"success",title:"Services Added to Client"}),localStorage.removeItem("services"))});$(document).ready(function(){let o=1;var i=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),r=Swal.mixin({toast:!1,position:"bottom-end"});let l="",s={},c="",a={},e={},t={},n={},d={};$("#expense-category").on("change",function(){l=$("#expense-category").val(),$(".expense-form").removeClass("visually-hidden"),$(".months-container").empty(),$(".save-expense").addClass("visually-hidden")}),$(".start-date, .end-date").on("change",function(){const F=$(".start-date").val(),g=$(".end-date").val();if($("#expense-category").val()===""){i.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(F&&g){const y=new Date(F),w=new Date(g),O=$(".months-container");var S='<div class="row">';if((w.getFullYear()-y.getFullYear())*12+(w.getMonth()-y.getMonth())>12){r.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const N=new Date(y);if(N.setMonth(N.getMonth()+11),w>N){r.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}O.empty(),S+="";let p=new Date(y);for(;p<=w;){const u=p.toLocaleString("default",{month:"long",year:"numeric"});S+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control month-input" name="${u}" id="" placeholder='${u}' value="">
                    </div>
                    </div>`,p.setMonth(p.getMonth()+1)}S+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-months form-control">Save</button>
            </div>`,S+="</div>",O.html(S)}$(".months-container").on("input",".month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-months",function(F){F.preventDefault();let g=[],S=!0;if(s.hasOwnProperty(l))return i.fire({icon:"warning",title:"Account Already Added",text:"You have already added this account."}),$(".end-date").val(""),$(".start-date").val(""),$(".months-container").empty(),!1;if($(".month-input").each(function(){var y=$(this).attr("name"),w=$(this).val();w!==""&&(S=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),g.push({monthName:y,value:$(this).val(),account:l,startDate:$(".start-date").val(),endDate:$(".end-date").val()}))}),S){$(".month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),i.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}s[l]={months:g,startDate:$(".start-date").val(),endDate:$(".end-date").val()},$("#saved-months").empty(),$.each(s,(y,w)=>{var O='<table class="table table-hover client-journal-accounts">',D=y.split("_");O+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${D[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${y}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(w.months,(N,p)=>{O+=`
                    <tr>
                        <td class='text-left'>${p.monthName}</td>
                        <td class='text-left'>${p.value}</td>
                    </tr>
                `}),O+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,O+="</table>",$("#saved-months").append(O)}),$(".months-container").empty(),$("#expense-category").val(""),$(".end-date").val(""),$(".start-date").val(""),l="",S=!0,console.log(s)}),$(document).on("click",".remove-saved-account",function(F){const g=$(this).attr("id");delete s[g],$("#saved-months").empty(),$.each(s,(S,y)=>{var w='<table class="table table-hover client-journal-accounts">',O=S.split("_");w+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${O[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${S}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(y.months,(D,N)=>{w+=`
                    <tr>
                        <td>${N.monthName}</td>
                        <td>${N.value}</td>
                    </tr>
                `}),w+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,w+="</table>",$("#saved-months").append(w)}),console.log(s)}),$("#income-category").on("change",function(){$(".income-form").removeClass("visually-hidden"),c=$("#income-category").val(),$(".income-months-container").empty()}),$(".income-start-date, .income-end-date").on("change",function(){const F=$(".income-start-date").val(),g=$(".income-end-date").val();if($("#income-category").val()===""){i.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(F&&g){const y=new Date(F),w=new Date(g),O=$(".income-months-container");var S='<div class="row">';if((w.getFullYear()-y.getFullYear())*12+(w.getMonth()-y.getMonth())>12){r.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const N=new Date(y);if(N.setMonth(N.getMonth()+11),w>N){r.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}O.empty(),S+="";let p=new Date(y);for(;p<=w;){const u=p.toLocaleString("default",{month:"long",year:"numeric"});S+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control income-month-input" name="${u}" id="" placeholder='${u}' value="">
                    </div>
                    </div>`,p.setMonth(p.getMonth()+1)}S+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-expense-months form-control">Save</button>
            </div>`,S+="</div>",O.html(S)}$(".income-months-container").on("input",".income-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-expense-months",function(F){F.preventDefault();let g=[],S=!0;if(a.hasOwnProperty(c)){i.fire({icon:"warning",title:"Account Already Added",text:"You have already added this account."}),$(".income-end-date").val(""),$(".income-start-date").val(""),$(".income-months-container").empty();return}if($(".income-month-input").each(function(){var y=$(this).attr("name"),w=$(this).val();w!==""&&(S=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),g.push({incomeMonthName:y,value:$(this).val(),account:c,startDate:$(".income-start-date").val(),endDate:$(".income-end-date").val()}))}),S){$(".income-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),i.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}a[c]={months:g,startDate:$(".income-start-date").val(),endDate:$(".income-end-date").val()},console.log(a),$("#saved-income-months").empty(),$.each(a,(y,w)=>{var O='<table class="table table-hover client-journal-accounts">',D=y.split("_");O+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${D[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${y}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(w.months,(N,p)=>{O+=`
                    <tr>
                        <td class='text-left'>${p.incomeMonthName}</td>
                        <td class='text-left'>${p.value}</td>
                    </tr>
                `}),O+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,O+="</table>",$("#saved-income-months").append(O)}),$(".income-months-container").empty(),$("#income-category").val(""),$(".income-end-date").val(""),$(".income-start-date").val(""),l="",S=!0}),$(document).on("click",".remove-saved-account",function(F){const g=$(this).attr("id");delete a[g],$("#saved-income-months").empty(),$.each(a,(S,y)=>{var w='<table class="table table-hover client-journal-accounts">',O=S.split("_");w+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${O[1]} - ${y.startDate} - ${y.endDate}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${S}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(y.months,(D,N)=>{w+=`
                    <tr>
                        <td>${N.incomeMonthName}</td>
                        <td>${N.value}</td>
                    </tr>
                `}),w+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,w+="</table>",$("#saved-income-months").append(w)}),console.log(a)}),$(document).on("change","#asset_account",function(){let F=$(this).val();console.log(F),$.ajax({type:"POST",url:`get-accounts-${F}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(g){console.log(g);let S="";$.each(g,(y,w)=>{$.each(w,(O,D)=>{console.log(D),S+=`
                            <option value="${D.AccountName}_${D.id}">${D.AccountName}</option>
                        `})}),$("#asset_account_name").html(S)},error:function(g,S,y){console.error(g)}})}),$(document).on("change","#liability_account",function(){let F=$(this).val();$.ajax({type:"POST",url:`get-accounts-${F}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(g){let S="";$.each(g,(y,w)=>{$.each(w,(O,D)=>{S+=`
                            <option value="${D.AccountName}_${D.id}">${D.AccountName}</option>
                        `})}),$("#liability_account_name").html(S)},error:function(g,S,y){console.error(g)}})}),$(document).on("change","#oe_account",function(){let F=$(this).val();$.ajax({type:"POST",url:`get-accounts-${F}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(g){let S="";$.each(g,(y,w)=>{$.each(w,(O,D)=>{S+=`
                            <option value="${D.AccountName}_${D.id}">${D.AccountName}</option>
                        `})}),$("#oe_account_name").html(S)},error:function(g,S,y){console.error(g)}})}),$(".save-asset-info").on("click",function(F){F.preventDefault();var g=!1,S=$(".journal-asset-form").serializeArray(),y="",w="",O="";let D=!1;if($(".journal-asset-form input, .journal-asset-form select").removeClass("is-invalid"),$.each(S,function(p,u){u.value===""&&($(`.journal-asset-form [name='${u.name}']`).addClass("is-invalid"),g=!0),u.name==="assetType"?y=u.value:u.name==="assetAccount"?w=u.value:u.name==="assetAmount"&&(O=u.value)}),$.each(e,(p,u)=>{if($.each(u.accounts,(x,f)=>{if(f.assetAccount===w)return D=!0,!1}),D)return!1}),D)return i.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(g){i.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}e[y]||(e[y]={accounts:[]}),e[y].accounts.push({assetAccount:w,amount:O}),console.log("Asset Object:",e);var N="";$.each(e,function(p,u){$.each(u.accounts,function(x,f){N+=`
                <tr>
                    <td style="font-size: 0.8em;">${p.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.assetAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-asset" id="${f.assetAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-asset-accounts").html(N),$(".journal-asset-form")[0].reset(),$("#asset_account_name").html('<option value="" selected hidden>Select an asset type first</option>')}),$(document).on("click",".remove-asset",function(F){F.preventDefault(),$(this).closest("tr").remove();for(let g in e)e[g].accounts&&(e[g].accounts=e[g].accounts.filter(S=>S.assetAccount!==$(this).attr("id"))),e[g].accounts.length===0&&delete e[g];console.log(e)}),$(".save-liability-info").on("click",function(F){F.preventDefault();var g=!1,S=$(".journal-liability-form").serializeArray(),y="",w="",O="";let D=!1;if($(".journal-liability-form input, .journal-liability-form select").removeClass("is-invalid"),$.each(S,function(p,u){u.value===""&&($(`.journal-liability-form [name='${u.name}']`).addClass("is-invalid"),g=!0),u.name==="liability-account"?y=u.value:u.name==="liability-account-name"?w=u.value:u.name==="liability-amount"&&(O=u.value)}),$.each(t,(p,u)=>{if($.each(u.accounts,(x,f)=>{if(f.liabilityAccount===w)return D=!0,!1}),D)return!1}),D)return i.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(g){i.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}t[y]||(t[y]={accounts:[]}),t[y].accounts.push({liabilityAccount:w,amount:O}),console.log("liability Object:",t);var N="";$.each(t,function(p,u){$.each(u.accounts,function(x,f){N+=`
                <tr>
                    <td style="font-size: 0.8em;">${f.liabilityAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-liability" id="${f.liabilityAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-liability-accounts").html(N),$(".journal-liability-form")[0].reset(),$("#liability_account_name").html('<option value="" selected hidden>Select an asset type first</option>')}),$(document).on("click",".remove-liability",function(F){F.preventDefault(),$(this).closest("tr").remove();for(let g in t)t[g].accounts&&(t[g].accounts=t[g].accounts.filter(S=>S.liabilityAccount!==$(this).attr("id")),t[g].accounts.length===0&&delete t[g]);console.log(t)}),$(".save-oe-info").on("click",function(F){F.preventDefault();var g=!1,S=$(".journal-oe-form").serializeArray(),y="",w="",O="",D=!1;if($(".journal-oe-form input, .journal-oe-form select").removeClass("is-invalid"),$.each(S,function(p,u){u.value===""&&($(`.journal-oe-form [name='${u.name}']`).addClass("is-invalid"),g=!0),u.name==="oe-account"?y=u.value:u.name==="oe-account-name"?w=u.value:u.name==="oe-amount"&&(O=u.value)}),$.each(n,(p,u)=>{if($.each(u.accounts,(x,f)=>{if(f.oeAccount===w)return D=!0,!1}),D)return!1}),D)return i.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(g){i.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}n[y]||(n[y]={accounts:[]}),n[y].accounts.push({oeAccount:w,amount:O}),console.log("Asset Object:",n);var N="";$.each(n,function(p,u){$.each(u.accounts,function(x,f){N+=`
                <tr>
                    <td style="font-size: 0.8em;">${f.oeAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-oe" id="${f.oeAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-oe-accounts").html(N),$(".journal-oe-form")[0].reset(),$("#oe_account_name").html('<option value="" selected hidden>Select an account type first</option>'),console.log("oeObj Object:",n)}),$(document).on("click",".remove-oe",function(F){F.preventDefault(),$(this).closest("tr").remove();for(let g in n)n[g].accounts&&(n[g].accounts=n[g].accounts.filter(S=>S.oeAccount!==$(this).attr("id"))),n[g].accounts.length===0&&delete n[g];console.log(n)});var m=0,h=0,v=0,C=0,T=0;$(".next-btn").on("click",function(){if(o===1){if(Object.keys(a).length===0){i.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}$("#append-expenses-choy").empty(),m=0;var F="";$.each(a,function(L,K){var k=L.split("_"),b=0;$.each(K.months,function(I,z){var B=z.value.replace(/,/g,""),X=parseFloat(B);b+=X});var P=b.toLocaleString();m+=b,F+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${k[1]}</div>
                        <div class="col-sm-6 text-right">${P}</div>
                    </div>`});var g=parseFloat(m);console.log(typeof g),$("#append-expenses-choy").append(F);var S=`
                <div class="row mt-3">
                    <div class="col-sm-6 text-left"><strong>Total:</strong></div>
                    <div class="col-sm-6 text-right"><strong>${g.toLocaleString()}</strong></div>
                </div>`;$(".append-expense-total").html(S)}if(o===2){$(".append-ldc").empty(),$(".expenses-total").text(""),$(".append-oe").empty(""),$(".oe-total").text("");var y="",w="";if(h=0,v=0,Object.keys(s).length===0){i.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var O=!1,D=!1;if($.each(s,(L,K)=>{var k=L.split("_"),b=k[2];b==="Less Direct Cost"?O=!0:b==="Operating Expenses"&&(D=!0)}),!O||!D){i.fire({icon:"warning",title:"Missing Data",text:'Both "Less Direct Cost" and "Operating Expenses" entries are required.'});return}$.each(s,(L,K)=>{var k=L.split("_"),b=k[2],P=0,I=0;if(b==="Less Direct Cost"){$.each(K.months,(X,ne)=>{var ae=ne.value.replace(/,/g,""),ue=parseFloat(ae);P+=ue});var z=P.toLocaleString();h+=P,y+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${k[1]}</div>
                        <div class="col-sm-6 text-right">${z}</div>
                    </div>
                    `}else if(b==="Operating Expenses"){$.each(K.months,(X,ne)=>{var ae=ne.value.replace(/,/g,""),ue=parseFloat(ae);I+=ue});var B=I.toLocaleString();v+=I,w+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${k[1]}</div>
                        <div class="col-sm-6 text-right">${B}</div>
                    </div>
                    `}});var N=m-h,p=N-v;C=p,$(".gries-total").text(N.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".tgi").text(N.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".expenses-total").text(h.toLocaleString()),$(".append-ldc").append(y),$(".append-oe").append(w),$(".oe-total").text(v.toLocaleString()),$(".net-amount").text(p.toLocaleString())}if(o===3){var u=0,x=0,f=0,R=0;if($(".append-ca").html(""),$(".append-nca").html(""),$(".append-fa").html(""),Object.keys(e).length===0){i.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(e,(L,K)=>{L.split("_")[0]==="Current Asset"&&$.each(K.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),I=parseFloat(P);f+=I,$(".total-ca").text(f.toLocaleString()),$(".append-ca").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)}),L.split("_")[0]==="Non-Current Assets"&&$.each(K.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),I=parseFloat(P);x+=I,$(".tnca-amount").text(x.toLocaleString()),$(".append-nca").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)}),L.split("_")[0]==="Fixed Assets"&&$.each(K.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),I=parseFloat(P);R+=I,$(".append-fa").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)})}),u=f+x+R,$(".total-assets").text(u.toLocaleString())}if(o===4){console.log(t);var A="",q=0;if(Object.keys(t).length===0){i.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(t,(L,K)=>{$.each(K.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),I=parseFloat(P);q+=I,console.log(q),A+=`
                    <div class="d-flex justify-content-between">
                        <span class="fw-normal">${b.liabilityAccount.split("_")[0]}</span>
                        <span class="fw-normal">${b.amount}</span>
                    </div>
                    `})}),T+=q,$(".append-cl").html(A)}if(o===5){var U="",_=0;if(Object.keys(n).length===0){i.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(n,(L,K)=>{$.each(K.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),I=parseFloat(P);_+=I,console.log(_),U+=`
                <div class="d-flex justify-content-between">
                <span class="fw-normal">${b.oeAccount.split("_")[0]}</span>
                <span class="fw-normal">${b.amount}</span>
            </div>
                `})}),T+=_,$(".append-oenw").html(U)}if(o===6){$(".tlc").text(T.toLocaleString());var j=0,Q=!0,J=$(".journal-adjustments-form").serializeArray();if($.each(J,(L,K)=>{var k=$(`.journal-adjustments-form [name='${K.name}']`);K.value.trim()===""?(Q=!1,k.addClass("is-invalid")):(k.removeClass("is-invalid"),d[K.name]=K.value)}),!Q){i.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}$.each(d,(L,K)=>{var k=K.replace(/,/g,""),b=parseFloat(k);L==="owners_withdrawal"&&$(".less-drawings").text(b.toLocaleString()),L==="owners_capital"&&(j+=b),L!=="owners_withdrawal"&&L!=="owners_capital"&&(j+=b)}),$(".additional-capital").text(j.toLocaleString()),$(".fp-nc").text(C.toLocaleString());var Y=j+C;$(".appraisal-capital").text(Y.toLocaleString());var Z=Y-parseFloat($(".less-drawings").text().replace(/[^0-9.-]+/g,""));$(".capital-end").text(Z.toLocaleString())}o<7&&($(".multi-step-journal").hide(),o++,E(o)),M(o),o===7?($(".next-btn").hide(),$(".save-btn").show()):($(".next-btn").show(),$(".save-btn").hide()),o===1?$(".prev-btn").hide():$(".prev-btn").show()}),$(".prev-btn").on("click",function(){o>1&&($(".multi-step-journal").hide(),o--,E(o)),M(o),$(".next-btn").show(),$(".save-btn").hide(),o===1?$(".prev-btn").hide():$(".prev-btn").show()});function E(F){$(".multi-step-journal").hide(),$(".multi-step-journal").eq(F-1).show()}function M(F){$(".step").removeClass("active"),$(".indicator-line").removeClass("active"),$(".step").each(function(g){g<F&&($(this).addClass("active"),$(this).next(".indicator-line").addClass("active"))})}E(o),M(o),o===1&&$(".prev-btn").hide(),$(".save-journal-btn").click(function(){var F={incomeObj:a,expensesObj:s,assetObj:e,liabilityObj:t,oeObj:n,adjustmentObj:d,client_id:$(this).attr("id").split("_")[1]};Te("new-client-journal-entry",F,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},g,S);function g(y){console.log(y),localStorage.setItem("journal","created"),window.location.href="clients"}function S(y,w,O){console.log(y)}});var V=localStorage.getItem("journal");V==="created"&&(i.fire({icon:"success",title:"Journal Entry",text:"New Journal Entry Saved"}),localStorage.removeItem("journal"))});var ie=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),me=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".save-account-type").on("click",function(){var r=$(".new-account-type-form").serializeArray(),l={},s=!0;if($.each(r,(e,t)=>{if(t.value===""){s=!1,$(`.new-account-type-form [name='${t.name}']`).addClass("is-invalid"),ie.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"});return}else l[t.name]=t.value,$(`.new-account-type-form [name='${t.name}']`).removeClass("is-invalid"),console.log(l)}),s){let e=function(n){console.log(n),localStorage.setItem("account-type","created"),location.reload()},t=function(n,d,m){$(".loader-container").addClass("visually-hidden");try{const h=JSON.parse(n.responseText);console.log("Parsed Response:",h),me.fire({icon:"warning",title:"Conflict",text:h.error})}catch(h){console.log("Could not parse JSON response:",h)}};var c=e,a=t;$(".loader-container").removeClass("visually-hidden"),Se("new-account-type",l,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t)}}),$(".save-account").on("click",function(){var r=$("#account-form").serializeArray(),l={},s=!0;if(console.log(r),$.each(r,(e,t)=>{if($(`#account-form [name='${t.name}']`).addClass("is-invalid"),t.value===""){ie.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"}),s=!1;return}else $(`#account-form [name='${t.name}']`).removeClass("is-invalid"),l[t.name]=t.value}),s){let e=function(n){localStorage.setItem("account","created"),location.reload()},t=function(n,d,m){$(".loader-container").addClass("visually-hidden");try{const h=JSON.parse(n.responseText);console.log("Parsed Response:",h),me.fire({icon:"warning",title:"Conflict",text:h.error})}catch(h){console.log("Could not parse JSON response:",h)}};var c=e,a=t;$(".loader-container").removeClass("visually-hidden"),we("new-account",l,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t)}}),$(".edit-coa").click(function(r){r.preventDefault();var l=$(this).attr("id"),s=$(`#edit-coa-form-${l}`).serializeArray(),c=!0,a={};$.each(s,(e,t)=>{if(t.value===""){$(`.edit-coa-form-${l} [name='${t.name}']`).addClass("is-invalild"),c=!1,ie.fire({icon:"warning",title:"Missing Field!",text:"Please fill all fields"});return}$(`.edit-coa-form-${l} [name='${t.name}']`).removeClass("is-invalild"),a[t.name]=t.value}),c&&$.ajax({type:"POST",url:"edit-coa",data:a,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){localStorage.setItem("account","updated"),location.reload()},error:function(e,t,n){try{const d=JSON.parse(e.responseText);console.log("Parsed Response:",d),me.fire({icon:"warning",title:"Conflict",text:d.message})}catch(d){console.log("Could not parse JSON response:",d)}}})});var o=localStorage.getItem("account-type"),i=localStorage.getItem("account");if(o==="created"){ie.fire({icon:"success",title:"New Account Type created!"}),localStorage.removeItem("account-type");return}if(i==="created"){localStorage.removeItem("account"),ie.fire({icon:"success",title:"New Account created!"}),localStorage.removeItem("account-type");return}if(i==="updated"){localStorage.removeItem("account"),ie.fire({icon:"success",title:"Account updated!"}),localStorage.removeItem("account-type");return}});$(document).ready(function(){var o=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),i=Swal.mixin({toast:!1,position:"bottom-end"});$(".new-user-save").on("click",function(l){var s=$(".new-user-form").serializeArray(),c={},a=!0;if($.each(s,(n,d)=>{if(d.value===""){a=!1,$(`.new-user-form [name='${d.name}']`).addClass("is-invalid"),o.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}else c[d.name]=d.value,$(`.new-user-form [name='${d.name}']`).removeClass("is-invalid")}),a){let n=function(m){localStorage.setItem("user","created"),location.reload()},d=function(m,h,v){try{const C=JSON.parse(m.responseText);console.log("Parsed Response:",C),i.fire({icon:"warning",title:"Conflict",text:C.message})}catch(C){console.log("Could not parse JSON response:",C)}};var e=n,t=d;Ce("new-user",c,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},n,d)}}),$(".remove-user").on("click",function(){var l=$(this).attr("id");$.ajax({url:`remove-user-${l}`,type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(s){console.log(s),localStorage.setItem("user","removed"),location.reload()},error:function(s,c,a){console.log(s)}})}),$(".edit-user-button").on("click",function(){var l=$(this).closest(".modal").find("form").serializeArray();console.log(l);var s=!0,c={};$.each(l,(a,e)=>{if(e.value===""){s=!1,$(`[name='${e.name}']`).addClass("is-invalid"),o.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}else c[e.name]=e.value,$(`[name='${e.name}']`).removeClass("is-invalid")}),s&&$.ajax({url:"update-user",type:"POST",data:c,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){localStorage.setItem("user","updated"),location.reload()},error:function(a,e,t){i.fire({icon:"error",title:"Fatal Error!",text:"Try reloading the page, if issue persist contact developer"})}})});var r=localStorage.getItem("user");r==="created"&&(o.fire({icon:"success",title:"User Created!",text:"User created successfuly"}),localStorage.removeItem("user")),r==="removed"&&(o.fire({icon:"success",title:"User Removed!",text:"User removed successfuly"}),localStorage.removeItem("user")),r==="updated"&&(o.fire({icon:"success",title:"User Updated!",text:"User Updated successfuly"}),localStorage.removeItem("user")),$(".search-users").on("keyup",function(){var l=$(this).val().toLowerCase();$(".users-table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(l)>-1)})}),$("#filter-users").on("change",function(){var l=$(this).val();$(".users-table tbody tr").each(function(){var s=$(this).data("category");l==="clear"?$(this).show():l===""||s===l?$(this).show():$(this).hide()})})});$(document).ready(function(){var o=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),i=Swal.mixin({toast:!1,position:"bottom-end"});$("#account-category").on("change",function(a){$("#billing-account-type").prop("disabled",!1),$.ajax({type:"POST",url:`get-account-types-${$(this).val()}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){console.log(e);let t='<option value="" selected hidden>Select Type</option>',n=!1;$.each(e,(d,m)=>{$.each(m,(h,v)=>{Object.keys(v).length>0&&(t+=`<option value="${v.id}">${v.ServiceRequirements}</option>`,n=!0)})}),n||(t='<option value="" selected hidden>Category has no type</option>'),$("#billing-account-type").html(t)},error:function(e){console.error(e),i.fire({icon:"error",title:"Error",text:`Could not load account types: ${e.responseText||e.statusText}`})}})}),$(document).on("change",'[id^="edit-account-category-"]',function(a){let e=$(this).attr("id").split("-").pop(),t=`#edit-billing-account-type-${e}`;console.log($(this).val()),console.log("Fetching types for modal:",e),$.ajax({type:"POST",url:`get-account-types-${$(this).val()}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){console.log(n);let d='<option value="" selected hidden>Select Type</option>',m=!1;$.each(n,(h,v)=>{$.each(v,(C,T)=>{Object.keys(T).length>0&&(d+=`<option value="${T.id}">${T.ServiceRequirements}</option>`,m=!0)})}),m||(d='<option value="" selected hidden>Category has no type</option>'),$(t).html(d)},error:function(n){console.error(n),i.fire({icon:"error",title:"Error",text:`Could not load account types: ${n.responseText||n.statusText}`})}})}),$(".edit-description").on("click",function(a){var e=$(this).attr("id").split("-").pop();a.preventDefault();var t={},n=$(`.update-description-form-${e}`).serializeArray(),d=!0;$.each(n,(m,h)=>{h.value===""&&(d=!1,o.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"}),$(`.update-description-form-${e} [name='${h.name}']`).addClass("is-invalid")),$(`.update-description-form-${e} [name='${h.name}']`).removeClass("is-invalid"),t[h.name]=h.value}),console.log(t),d&&$.ajax({type:"POST",url:"update/account-description",data:t,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(m){localStorage.setItem("account_description","updated"),location.reload()},error:function(m,h,v){i.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+m.responseText})}})}),$(".remove-description").on("click",function(){$.ajax({type:"POST",url:`remove/account-description/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){localStorage.setItem("account_description","removed"),location.reload()},error:function(a,e,t){i.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+a.responseText})}})}),$(".remove-coa").on("click",function(){$.ajax({type:"POST",url:`remove/coa/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){localStorage.setItem("coa","removed"),location.reload()},error:function(a,e,t){i.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+a.responseText})}})}),$(".save-account-description").on("click",function(a){var e=$(".account-description-form").serializeArray(),t={},n=!0;if($.each(e,(h,v)=>{if(v.value===""){$(`.account-description-form [name="${v.name}"]`).addClass("is-invalid"),o.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),n=!1;return}else t[v.name]=v.value,console.log(t),$(`.account-description-form [name="${v.name}"]`).removeClass("is-invalid")}),n){let h=function(C){localStorage.setItem("account_description","created"),location.reload()},v=function(C,T,E){try{const M=JSON.parse(C.responseText);console.log("Parsed Response:",M),i.fire({icon:"error",title:"Error",text:M.message})}catch(M){console.log("Could not parse JSON response:",M)}};var d=h,m=v;Fe("new-account-description",t,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},h,v)}}),$(".edit-sys-profile").on("click",function(a){a.preventDefault();var e=!0,t={},n=$("#sys-profile-form").serializeArray();$.each(n,(d,m)=>{m.value.trim()===""?(e=!1,$(`.sys-profile-form [name='${m.name}']`).addClass("is-invalid"),o.fire({icon:"warning",title:"Missing fields",text:"Please fill all fields"})):$(`.sys-profile-form [name='${m.name}']`).removeClass("is-invalid"),t[m.name]=m.value}),e&&$.ajax({type:"POST",url:"edit-sys-info",data:t,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(d){localStorage.setItem("system-profile","updated"),location.reload()},error:function(d,m,h){try{const v=JSON.parse(d.responseText);console.log("Parsed Response:",v),i.fire({icon:"error",title:"Error",text:v.message})}catch(v){console.log("Could not parse JSON response:",v)}}})}),$(".edit-user-privilege").on("click",function(a){a.preventDefault();var e=$(this).attr("id");console.log(e),$.ajax({url:`/users/toggle-privilege/${e}`,type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(t){localStorage.setItem("user_privilege_updated",t.message),location.reload()},error:function(t){o.fire({icon:"error",title:"An error occurred while updating the privilege."})}})});var r=localStorage.getItem("account_description"),l=localStorage.getItem("system-profile"),s=localStorage.getItem("coa"),c=localStorage.getItem("user_privilege_updated");r==="created"&&(o.fire({icon:"success",title:"Account Description Created!"}),localStorage.removeItem("account_description")),r==="removed"&&(o.fire({icon:"success",title:"Account Description Removed!"}),localStorage.removeItem("account_description")),r==="updated"&&(o.fire({icon:"success",title:"Account Description Updated!"}),localStorage.removeItem("account_description")),l==="updated"&&(o.fire({icon:"success",title:"System Profile Updated"}),localStorage.removeItem("system-profile")),s==="removed"&&(o.fire({icon:"success",title:"Account Removed"}),localStorage.removeItem("coa")),c&&(o.fire({icon:"success",title:c}),localStorage.removeItem("user_privilege_updated"))});var le=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),fe=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".update-client-service-progress-btn").on("click",function(){var r=$(this).attr("id"),l=$(`.update-service-progress-${r}`).serializeArray();console.log(l),$.ajax({type:"POST",url:"update-client-service",data:{serviceId:r,serviceVal:l},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(s){localStorage.setItem("service","updated"),location.reload()},error:function(s,c,a){try{const e=JSON.parse(s.responseText);console.log("Parsed Response:",e),fe.fire({icon:"warning",title:"Conflict",text:e.Conflict})}catch(e){console.log("Could not parse JSON response:",e)}}})}),$(".edit-company-info").on("click",function(r){var l=$(`.edit-company-info-${$(this).attr("id")}`).serializeArray(),s=!0,c={};$.each(l,(a,e)=>{e.value===""&&(s=!1,$(`.edit-company-info-${$(this).attr("id")} [name='${e.name}']`).addClass("is-invalid"),le.fire({icon:"warning",title:"Missingg Fields",text:"Please fill all fields"})),c[e.name]=e.value}),s&&$.ajax({type:"POST",url:"update-company-info",data:c,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){localStorage.setItem("company-info","updated"),location.reload()},error:function(a,e,t){fe.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+a})}})}),$(".remove-client-service").on("click",function(){$.ajax({type:"POST",url:`client-profile/service/remove/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){localStorage.setItem("service","removed"),location.reload()},error:function(r,l,s){fe.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+r})}})});var o=localStorage.getItem("company-info"),i=localStorage.getItem("service");i==="updated"&&(le.fire({icon:"success",text:"Client Service Updated"}),localStorage.removeItem("service")),i==="removed"&&(le.fire({icon:"success",text:"Client Service Removed"}),localStorage.removeItem("service")),o==="updated"&&(localStorage.removeItem("company-info"),le.fire({icon:"success",text:"Company Info Updated"}))});$(document).ready(function(){var o=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),i=Swal.mixin({toast:!1,position:"bottom-end"}),r=0,l=window.servicesData;console.log(l);var s={Service:[]},c={SubService:[]},a={accounts:[]};$.each(l,(t,n)=>{$.each(n.Service,(d,m)=>{s.Service.push({Service:{service_name:d,service_id:Object.keys(m.parent_service_id)[0],service_price:m.parent_service_id[Object.keys(m.parent_service_id)[0]].parentServicePrice}}),m.sub_service&&$.each(m.sub_service,(h,v)=>{$.each(v,(C,T)=>{$.each(T,(E,M)=>{$.each(M.account_descriptions,(V,F)=>{a.accounts.push({Accounts:{Account:F.Description,account_id:F.adID.toLocaleString(),price:F.Price}})})})}),$.each(v.sub_service_id,C=>{let T=Object.keys(v.sub_service_id)[0],E=v.sub_service_id[T].sub_service_price;c.SubService.push({SubService:{sub_service_name:h,sub_service_id:C,sub_service_price:E}})})})})}),$(".price").each(function(){var t=$(this).text(),n=t.replace(/[^\d.-]/g,""),d=parseFloat(n);r+=d}),$(".remove-parent-service-billing-action").click(function(){var t=$(this).attr("id").split("_")[1],n=$(this).closest("tr").find("td:nth-last-child(2)").text(),d=n.replace(/[^\d.-]/g,""),m=parseFloat(d);r-=m,$(".overall-due").text(r.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(r.toLocaleString(void 0,{minimumFractionDigits:2}));var h=s.Service.findIndex(v=>v.Service.service_id===t);console.log("Service ID to remove:",t),h!==-1?(s.Service.splice(h,1),$(this).closest("tr").remove()):console.log("Service not found")}),$(".remove-sub-service-billing-action").click(function(){var t=$(this).attr("id").split("_")[1],n=$(this).closest("tr").find("td:nth-last-child(2)").text(),d=n.replace(/[^\d.-]/g,""),m=parseFloat(d);r-=m,$(".overall-due").text(r.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(r.toLocaleString(void 0,{minimumFractionDigits:2}));var h=c.SubService.findIndex(v=>v.SubService.sub_service_id===t);h!==-1&&(c.SubService.splice(h,1),$(this).closest("tr").remove())}),$(document).on("click",".remove-account-description-billing-action",function(){var t=$(this).attr("id").split("_")[1],n=$(this).closest("tr").find("td:nth-last-child(2)").text(),d=n.replace(/[^\d.-]/g,""),m=parseFloat(d),h=0;h=m-m,r-=m,$("#additional-description-subtotal").text(h.toLocaleString(void 0,{minimumFractionDigits:2})),$(".overall-due").text(r.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(r.toLocaleString(void 0,{minimumFractionDigits:2}));var v=a.accounts.findIndex(C=>C.Accounts.account_id===t);v!==-1?(a.accounts.splice(v,1),$(this).closest("tr").remove(),console.log(a)):console.log("Account not found")}),console.log(a),$(".add-description").on("click",function(){var t=0,n=$(this).closest("tr"),d=n.data("service"),m=n.data("requirements"),h=n.data("category"),v=n.data("description"),C=n.data("taxtype"),T=n.data("formtype"),E=n.data("price"),M=n.data("id"),V=E.replace(/[^\d.-]/g,""),F=parseFloat(V),g=F.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"),S=a.accounts.some(w=>w.Accounts.Account===v);if(S)o.fire({icon:"warning",title:"Conflict",text:"Account Description already exists!"});else{a.accounts.push({Accounts:{Account:v,account_id:n.attr("id").toLocaleString(),price:E,isAdded:!0}}),r+=F,t+=F,$("#additional-description-subtotal").text(t.toLocaleString(void 0,{minimumFractionDigits:2})),$(".overall-due").text(r.toLocaleString(void 0,{minimumFractionDigits:2}));var y=`
            <tr>
                <td>${d}</td>
                <td>${m}</td>
                <td>${h}</td>
                <td>${v}</td>
                <td>${C}</td>
                <td>${T}</td>
                <td>${g}</td>
                <td>
                    <span class="badge fw-bold text-light bg-danger remove-account-description-billing-action" id='${M}'><i class="fas fa-trash"></i></span>
                </td>
            </tr>
        `;$(".append-ad").append(y)}}),$(".mail-client-bs").click(function(){var t=$("#dd").val(),n=$(".billing-id").text(),d=$(".date").text(),m=$(this).attr("id");if(console.log(s),t===""||t===void 0){$("#dd").addClass("is-invalid"),o.fire({icon:"warning",title:"Missing Field",text:"Please add due date before proceeding"});return}$("#dd").removeClass("is-invalid");var h={dueDate:t,date:d,serviceObj:s,subServiceObj:c,accountDescriptions:a,refID:m,billingId:n};Oe("mail-client-billing",h,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},function(v){window.location.href="clients",localStorage.setItem("billing","created")},function(v,C,T){try{const E=JSON.parse(v.responseText);i.fire({icon:"warning",title:"Conflict",text:E.Message})}catch(E){console.log("Could not parse JSON response:",E)}})});var e=localStorage.getItem("billing");e==="created"&&(o.fire({icon:"success",title:"Billing Created",text:"Billing successfully created"}),localStorage.removeItem("billing"))});var de=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),De=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".view-journal-btn").on("click",function(o){var i=$(this).attr("id");$.ajax({type:"POST",url:`view-client-journal-${i}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(r){console.log(r);var l=new Blob([r],{type:"application/pdf"}),s=URL.createObjectURL(l);window.open(s,"_blank")},error:function(r,l,s){De.fire({icon:"error",title:"Oops Something went wrong!",text:r.responseJSON?r.responseJSON.error:"Unknown error"})}})}),$(".gen-client-billing-pdf").click(function(){$.ajax({type:"POST",url:`client-billing-data_${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var i=new Blob([o],{type:"application/pdf"}),r=URL.createObjectURL(i);window.open(r,"_blank")},error:function(o,i,r){de.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".gen-expense-pdf").on("click",function(){$.ajax({type:"POST",url:"expense/pdf/expense",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var i=new Blob([o],{type:"application/pdf"}),r=URL.createObjectURL(i);window.open(r,"_blank")},error:function(o,i,r){de.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".income-gen-pdf").on("click",function(){$.ajax({type:"POST",url:"income/pdf/income",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var i=new Blob([o],{type:"application/pdf"}),r=URL.createObjectURL(i);window.open(r,"_blank")},error:function(o,i,r){de.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".generate-client-billing-pdf").on("click",function(){$.ajax({type:"POST",url:`client/billing/pdf/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var i=new Blob([o],{type:"application/pdf"}),r=URL.createObjectURL(i);window.open(r,"_blank")},error:function(o,i,r){de.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})})});var oe=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),Re=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".journal-pin-entry").on("submit",function(i){i.preventDefault();var r=$(this).serializeArray(),l=!0;$.each(r,(s,c)=>{c.value===""?(oe.fire({icon:"warning",title:"Missing PIN",text:"Please enter PIN"}),l=!1,$(`[name='${c.name}']`).addClass("is-invalid")):$(`[name='${c.name}']`).remove("is-invalid")}),l&&$.ajax({type:"POST",url:"journal-pin-entry",data:r,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(s){var c=new Blob([s],{type:"application/pdf"}),a=URL.createObjectURL(c);window.open(a,"_blank"),console.log("asdasd")},error:function(s,c,a){s.status===400?oe.fire({icon:"error",title:s.statusText,text:"Incorrect PIN"}):oe.fire({icon:"error",title:"Something went wrong",text:"Fatal error. Translated: "+c})}})}),$(".request-journal-pin").click(function(){$.ajax({type:"POST",url:`request-journal-pin_${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){oe.fire({icon:"success",title:"User Notified",text:"Email has been successfully sent to the user."})},error:function(i,r,l){console.error("Error:",l),oe.fire({icon:"error",title:"Notification Failed",text:"Failed to send the email to the user. Please try again later."})}})}),$(".remove-journal-entry").click(function(){$.ajax({type:"POST",url:`archive-journal-entry-${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){localStorage.setItem("journal","Removed"),location.reload()},error:function(i,r,l){Re.fire({icon:"error",title:"Oops! Something went wrong",text:"Error Translated: "+i})}})});var o=localStorage.getItem("journal");o==="Removed"&&(localStorage.removeItem("journal"),oe.fire({icon:"success",title:"Journal Update",text:"Journal Successfully removed"}))});var _e=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});$(document).ready(function(){$('select[name="JournalStatus"]').on("change",function(){var o=$(this).closest(".modal"),i=o.find(".journal-draft-note");$(this).val()==="Rejected"||$(this).val()==="Canceled"?i.removeClass("visually-hidden"):i.addClass("visually-hidden").val("")}),$(".update-journal-status").on("click",function(){var o=$(this).attr("id");console.log(o);var i=$(`#update-journal-status-${o}`),r=i.find(`#serviceprogress-${o}`).val(),l=i.find(`#note-${o}`);if((r==="Canceled"||r==="Rejected")&&l.val().trim()===""){Swal.fire({icon:"error",title:"Validation Error",text:'Please provide a note when the status is "Canceled" or "Rejected".'}),l.addClass("is-invalid");return}var s=$(`.update-journal-status-form-${o}`).serializeArray();$.ajax({type:"POST",url:"/update-journal-status",data:s,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(c){localStorage.setItem("journal-status","updated"),location.reload()},error:function(c){console.error(c)}})}),localStorage.getItem("journal-status")==="updated"&&(_e.fire({icon:"success",title:"Journal Status Updated",text:"Journal status updated successfully"}),localStorage.removeItem("journal-status"))});var H=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),se=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){let o=1;var i=window.journalIncome,r=window.journalExpense,l=window.journalAssets,s=window.journalLiability,c=window.journalOE,a=i,e=r,t={},n={},d={},m={};$.each(l,(p,u)=>{const x=[];x.push({assetAccount:u.account,amount:u.amount}),t[u.asset_category]={accounts:x}}),$.each(s,(p,u)=>{const x=[];var f=u.AccountType;x.push({liabilityAccount:u.account,amount:u.amount}),n[f]={accounts:x}}),$.each(c,(p,u)=>{const x=[];var f=u.AccountType;x.push({oeAccount:u.account,amount:u.amount}),d[f]={accounts:x}});let h="";$("#audit-income-category").on("change",function(){h=$(this).val(),$(".audit-income-form").removeClass("visually-hidden"),$(".saved-audited-income-months").empty()}),$("#audit-expense-category").on("change",function(){h=$(this).val(),$(".audit-expense-form").removeClass("visually-hidden"),$(".saved-audited-expense-months").empty()}),$(".audit-income-start-date, .audit-income-end-date").on("change",function(){const p=$(".audit-income-start-date").val(),u=$(".audit-income-end-date").val();if($("#audit-income-category").val()===""){H.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(p&&u){const f=new Date(p),R=new Date(u),A=$(".audit-income-months-container");var x='<div class="row">';if((R.getFullYear()-f.getFullYear())*12+(R.getMonth()-f.getMonth())>12){se.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const U=new Date(f);if(U.setMonth(U.getMonth()+11),R>U){se.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}A.empty(),x+="";let _=new Date(f);for(;_<=R;){const j=_.toLocaleString("default",{month:"long",year:"numeric"});x+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control audit-income-month-input" name="${j}" id="" placeholder='${j}' value="">
                    </div>
                    </div>`,_.setMonth(_.getMonth()+1)}x+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-income-audit-months form-control">Save</button>
            </div>`,x+="</div>",A.html(x)}$(document).on("input",".audit-income-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-income-audit-months",function(p){p.preventDefault();let u=[],x=!0;if(a.hasOwnProperty(h)){H.fire({icon:"warning",title:"Account Already Exists!",text:"You have already added this account."}),$(".audit-income-end-date").val(""),$(".audit-income-start-date").val(""),$(".audit-income-months-container").empty(),console.log(!0);return}if($(".audit-income-month-input").each(function(){var f=$(this).attr("name");console.log(f);var R=$(this).val();R!==""&&(x=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),u.push({incomeMonthName:f,value:$(this).val(),startDate:$(".audit-income-start-date").val(),endDate:$(".audit-income-end-date").val()}))}),x){$(".audit-income-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),H.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}a[h]={months:u,startDate:$(".audit-income-start-date").val(),endDate:$(".audit-income-end-date").val()},$("#saved-audited-income-months").empty(),$.each(a,(f,R)=>{var A='<table class="table table-hover client-journal-accounts">',q=f.split("_");A+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${q[1]}
                        <span class="text-sm fw-bold float-right remove-audit-income" id="${f}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(R.months,(U,_)=>{A+=`
                    <tr>
                        <td class='text-left'>${_.incomeMonthName}</td>
                        <td class='text-left'>${_.value}</td>
                    </tr>
                `}),A+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,A+="</table>",$("#saved-audited-income-months").append(A)}),$(".audit-income-months-container").empty(),$("#audit-income-category").val(""),$(".audit-income-end-date").val(""),$(".audit-income-start-date").val(""),h="",x=!0,console.log(a)}),$(".audit-expense-start-date, .audit-expense-end-date").on("change",function(){const p=$(".audit-expense-start-date").val(),u=$(".audit-expense-end-date").val();if($("#audit-expense-category").val()===""){H.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(p&&u){const f=new Date(p),R=new Date(u),A=$(".audit-expense-months-container");var x='<div class="row">';if((R.getFullYear()-f.getFullYear())*12+(R.getMonth()-f.getMonth())>12){se.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const U=new Date(f);if(U.setMonth(U.getMonth()+11),R>U){se.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}A.empty(),x+="";let _=new Date(f);for(;_<=R;){const j=_.toLocaleString("default",{month:"long",year:"numeric"});x+=`<div class="col-sm-6 my-2">
                <div class="input-group">
                <input type="text" class="form-control audit-expense-month-input" name="${j}" id="" placeholder='${j}' value="">
                </div>
                </div>`,_.setMonth(_.getMonth()+1)}x+=`
        <div class="col-sm-6 my-2 text-right">
            <button type='button' class="btn btn-primary save-expense-audit-months form-control">Save</button>
        </div>`,x+="</div>",A.html(x)}$(".audit-expense-months-container").on("input",".audit-expense-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-expense-audit-months",function(p){p.preventDefault();let u=[],x=!0;if(e.hasOwnProperty(h)){H.fire({icon:"warning",title:"Account Already Exists!",text:"You have already added this account."}),$(".audit-iexpensencome-end-date").val(""),$(".audit-expense-start-date").val(""),$(".audit-expense-months-container").empty();return}if($(".audit-expense-month-input").each(function(){var f=$(this).attr("name"),R=$(this).val();R!==""&&(x=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),u.push({expenseMonthName:f,value:$(this).val(),startDate:$(".audit-expense-start-date").val(),endDate:$(".audit-expense-end-date").val()}))}),x){$(".audit-expense-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),H.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}e[h]={months:u,startDate:$(".audit-expense-start-date").val(),endDate:$(".audit-expense-end-date").val()},$("#saved-audited-expense-months").empty(),$.each(e,(f,R)=>{var A='<table class="table table-hover client-journal-accounts">',q=f.split("_");A+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${q[1]}
                        <span class="text-sm fw-bold float-right remove-audit-expense" id="${f}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(R.months,(U,_)=>{A+=`
                    <tr>
                        <td class='text-left'>${_.expenseMonthName}</td>
                        <td class='text-left'>${_.value}</td>
                    </tr>
                `}),A+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,A+="</table>",$("#saved-audited-expense-months").append(A)}),$(".audit-expense-months-container").empty(),$("#audit-expense-category").val(""),$(".audit-expense-end-date").val(""),$(".audit-expense-start-date").val(""),h="",x=!0}),$(".save-audit-asset-info").on("click",function(p){p.preventDefault();var u=$(".journal-audit-asset-form").serializeArray(),x="",f="",R="";let A=!1;if($.each(u,(_,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="assetType"?x=j.value:j.name==="assetAccount"?f=j.value:j.name==="assetAmount"&&(R=j.value)}),!x||!f||!R){console.error("Required fields are missing.");return}if($.each(t,(_,j)=>{if($.each(j.accounts,(Q,J)=>{if(J.assetAccount===f.split("_")[0])return A=!0,!1}),A)return!1}),A)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var q=x.split("_");t[q[0]]||(t[q[0]]={accounts:[]}),t[q[0]].accounts.push({assetAccount:f.split("_")[0],amount:R}),$(".append-audit-asset-accounts").empty();let U="";$.each(t,(_,j)=>{$.each(j.accounts,(Q,J)=>{var Y=J.amount,Z=Y.toString().replace(/,/g,""),L=parseFloat(Z).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});U+=`
            <tr id="${_}">
                <td class='text-sm'>${_}</td>
                <td class='text-sm'>${J.assetAccount}</td>
                <td class='text-sm'>
                    ${L}
                    <span class="badge fw-bold text-dark float-right remove-audited-asset" id="${J.assetAccount}">
                        <i class="fas fa-times"></i>
                    </span>
                </td>
            </tr>`})}),$(".append-audit-asset-accounts").append(U),$("#asset_account").val(""),$("#asset_account_name  option:first").text("Select Account"),$("#assetAmount").val(""),A=!1}),$(".save-audit-liability-info").on("click",function(p){p.preventDefault();var u=$(".journal-audit-liability-form").serializeArray(),x="",f="",R="";let A=!1;if($.each(u,(_,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="audit-liability-account"?x=j.value:j.name==="audit-liability-account-name"?f=j.value:j.name==="liability-amount"&&(R=j.value)}),!x||!f||!R){console.error("Required fields are missing.");return}if($.each(n,(_,j)=>{if($.each(j.accounts,(Q,J)=>{if(J.liabilityAccount===f.split("_")[0])return A=!0,!1}),A)return!1}),A)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var q=x.split("_");n[q[0]]||(n[q[0]]={accounts:[]}),n[q[0]].accounts.push({liabilityAccount:f.split("_")[0],amount:R}),$(".append-audit-liability-accounts").empty();let U="";$.each(n,(_,j)=>{$.each(j.accounts,(Q,J)=>{var Y=J.amount,Z=Y.toString().replace(/,/g,""),L=parseFloat(Z).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});U+=`
                <tr id="${_}">
                    <td class='text-sm'>${_}</td>
                    <td class='text-sm'>${J.liabilityAccount}</td>
                    <td class='text-sm'>
                        ${L}
                        <span class="badge fw-bold text-dark float-right remove-audit-liability" id="${J.liabilityAccount}">
                            <i class="fas fa-times"></i>
                        </span>
                    </td>
                </tr>`})}),$(".append-audit-liability-accounts").append(U),$("#liability_account").val(""),$("#liability_account_name  option:first").text("Select Account"),$("#liabilityAmount").val(""),A=!1}),$(".save-audit-oe-info").on("click",function(p){p.preventDefault();var u=$(".journal-audit-oe-form").serializeArray(),x="",f="",R="";let A=!1;if($.each(u,(_,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="oe-account"?x=j.value:j.name==="oe-account-name"?f=j.value:j.name==="oe-amount"&&(R=j.value)}),!x||!f||!f){console.error("Required fields are missing.");return}if($.each(d,(_,j)=>{if($.each(j.accounts,(Q,J)=>{if(J.oeAccount===f.split("_")[0])return A=!0,!1}),A)return!1}),A)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var q=x.split("_");d[q[0]]||(d[q[0]]={accounts:[]}),d[q[0]].accounts.push({oeAccount:f.split("_")[0],amount:R}),$(".append-audit-oe-accounts").empty();let U="";$.each(d,(_,j)=>{$.each(j.accounts,(Q,J)=>{var Y=J.amount,Z=Y.toString().replace(/,/g,""),L=parseFloat(Z).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});U+=`
            <tr id="${_}">
                <td class='text-sm'>${_}</td>
                <td class='text-sm'>${J.oeAccount}</td>
                <td class='text-sm'>
                    ${L}
                    <span class="badge fw-bold text-dark float-right remove-audit-oe" id="${_}">
                        <i class="fas fa-times"></i>
                    </span>
                </td>
            </tr>`})}),$(".append-audit-oe-accounts").append(U),$("#oe-account").val(""),$("#oe-account-name  option:first").text("Select Account"),$("#oeAmount").val(""),A=!1}),$(document).on("click",".remove-audit-income",function(){$(this).closest("tr").remove();var p=$(this).attr("id");delete a[p],$("#saved-audited-income-months").empty(),$.each(a,(u,x)=>{var f='<table class="table table-hover client-journal-accounts">',R=u.split("_");f+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${R[1]}
                        <span class="text-sm fw-bold float-right remove-audit-income" id="${u}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(x.months,(A,q)=>{f+=`
                    <tr>
                        <td>${q.incomeMonthName}</td>
                        <td>${q.value}</td>
                    </tr>
                `}),f+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,f+="</table>",$("#saved-audited-income-months").append(f)}),console.log(a)}),$(document).on("click",".remove-audit-expense",function(p){delete e[$(this).attr("id")],$(this).closest("tr").remove(),$("#saved-audited-expense-months").empty(),$.each(e,(u,x)=>{var f='<table class="table table-hover client-journal-accounts">',R=u.split("_");f+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${R[1]}
                        <span class="text-sm fw-bold float-right remove-audit-expense" id="${u}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(x.months,(A,q)=>{f+=`
                    <tr>
                        <td class='text-left'>${q.expenseMonthName}</td>
                        <td class='text-left'>${q.value}</td>
                    </tr>
                `}),f+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,f+="</table>",$("#saved-audited-expense-months").append(f)})}),$(document).on("click",".remove-audited-asset",function(p){p.preventDefault(),$(this).closest("tr").remove();for(let u in t)t[u].accounts&&(t[u].accounts=t[u].accounts.filter(x=>x.assetAccount!==$(this).attr("id"))),t[u].accounts.length===0&&delete t[u]}),$(document).on("click",".remove-audit-liability",function(p){p.preventDefault(),$(this).closest("tr").remove();for(let u in n)n[u].accounts&&(n[u].accounts=n[u].accounts.filter(x=>x.liabilityAccount!==$(this).attr("id"))),n[u].accounts.length===0&&delete n[u]}),$(document).on("click",".remove-audit-oe",function(p){p.preventDefault(),$(this).closest("tr").remove();for(let u in d)d[u].accounts&&(d[u].accounts=d[u].accounts.filter(x=>x.oeAccount!==$(this).attr("id"))),d[u].accounts.length===0&&delete d[u]});var v=0,C=0,T=0,E=0,M=0,V=0,F=0,g=0,S=0,y=0,w=0;console.log(e),$(".audit-next-btn").on("click",function(){if(o===1){if($("#append-audit-expenses-choy").empty(),$(".revenue-audit-income-total").empty(),Object.keys(a).length===0){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var p='<div class="col-sm-12 ml-3 text-dark" id="append-audit-expenses-choy">',u=0;$.each(a,(k,b)=>{p+='<div class="row mb-2">';const P=k.includes("_")?k.split("_")[1]:k;p+=`<div class="col-6 revenue-audit-accounts">${P}</div>`,console.log(k),$.each(b.months,(I,z)=>{var B=z.value.replace(/,/g,""),X=parseFloat(B);v+=X,u+=X}),p+=`<div class="col-6 text-right revenue-audit-amount">${u.toLocaleString()}</div>`,p+="</div>"}),p+="</div>",$("#append-audit-expenses-choy").html(p),$(".revenue-audit-income-total").text(v.toLocaleString())}if(o===2){if($(".append-audit-oe").empty(),$(".append-audit-ldc").empty(),Object.keys(e).length===0){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var x=!1,f=!1;if($.each(e,(k,b)=>{var P=k.split("_"),I=P[2];I==="Less Direct Cost"?x=!0:I==="Operating Expenses"&&(f=!0)}),!x||!f){H.fire({icon:"warning",title:"Missing Data",text:'Both "Less Direct Cost" and "Operating Expenses" entries are required.'});return}M=0,$.each(e,(k,b)=>{var P=k.split("_")[1];if(k.split("_")[2]==="Less Direct Cost"){var I="";$.each(b.months,(B,X)=>{var ne=X.value.replace(/,/g,""),ae=parseFloat(ne);T+=ae,I+=`
                        <div class="row">
                            <div class="col-sm-6 text-left">${P}</div>
                            <div class="col-sm-6 text-right">${ae.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</div>
                        </div>
                        `}),$(".append-audit-ldc").append(I)}if(k.split("_")[2]==="Operating Expenses"){var z="";$.each(b.months,(B,X)=>{var ne=X.value.replace(/,/g,""),ae=parseFloat(ne);M+=ae,z+=`
                        <div class="row">
                            <div class="col-sm-6 text-left">${P}</div>
                            <div class="col-sm-6 text-right">${ae.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</div>
                        </div>
                        `}),$(".append-audit-oe").append(z)}}),E=v-T,C=E-M,$(".expenses-ldc-audit-total").text(T.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".gries-audit-total").text(E.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".tgi-audit").text(E.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".oe-audit-total").text(M.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".net-audit-amount").text(C.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))}if(o===3){if($(".append-ca-audit").empty(),$(".append-audit-nca").empty(),$(".append-audit-fa").empty(),!Object.keys(t).some(b=>t[b].accounts&&t[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var R="",A="",q="";$.each(t,(b,P)=>{b==="Current Asset"&&$.each(P.accounts,(I,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);F+=X,R+=`
                                <div class="row">
                                    <span class="col-sm-6 text-sm text-left">${z.assetAccount}</span>
                                    <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                                </div>
                            `}),b==="Non-Current Assets"&&$.each(P.accounts,(I,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);V+=X,A+=`
                            <div class="row">
                                <span class="col-sm-6 text-sm text-left">${z.assetAccount}</span>
                                <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                            </div>
                        `}),b==="Fixed Assets"&&$.each(P.accounts,(I,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);g+=X,q+=`
                        <div class="row">
                            <span class="col-sm-6 text-sm text-left">${z.assetAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `}),$(".append-ca-audit").html(R),$(".append-audit-nca").html(A),$(".append-audit-fa").html(q),$(".tnca-audit-amount").text(V.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".total-audit-ca").text(F.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),S=F+V+g,$(".total-audit-assets").text(S.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))})}if(o===4){if(y=0,$(".append-audit-cl").empty(),!Object.keys(n).some(b=>n[b].accounts&&n[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var U="";$.each(n,(b,P)=>{$.each(P.accounts,(I,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);y+=X,U+=`
                        <div class="row">
                            <span class="col-sm-6 text-sm text-left">${z.liabilityAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `})}),$(".append-audit-cl").html(U)}if(o===5){w=0,$(".append-audit-oenw").empty();var _="";if(!Object.keys(d).some(b=>d[b].accounts&&d[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}$.each(d,(b,P)=>{$.each(P.accounts,(I,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);w+=X,_+=`<div class="row">
                            <span class="col-sm-6 text-sm text-left">${z.oeAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `})}),$(".append-audit-oenw").html(_)}if(o===6){var j=$(".journal-audit-adjustments-form").serializeArray(),Q=!0;if($.each(j,(k,b)=>{if(b.value===""){Q=!1,$(`[name='${b.name}']`).addClass("is-invalid");return}m[b.name]=b.value,$(`[name='${b.name}']`).removeClass("is-invalid")}),!Q){H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}var J=0,Y=0;$.each(m,(k,b)=>{if(k==="audit-owners_contribution"){var P=b.replace(/,/g,""),I=parseFloat(P);J+=I}if(k==="audit-owners_withdrawal"){var P=b.replace(/,/g,""),I=parseFloat(P);Y+=I}});var Z=Y+C;$(".additional-audit-capital").text(J.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".audit-less-drawings").text(Y.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".fp-audit-nc").text(C.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".appraisal-audit-capital").text(Z.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));var L=Z-parseFloat($(".audit-less-drawings").text().replace(/[^0-9.-]+/g,""));$(".audit-capital-end").text(L.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));var K=y+w;$(".tlc-audit").text(K.toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}))}o<7&&($(".multi-step-journal-audit").hide(),o++,O(o)),D(o),o===7?($(".audit-next-btn").hide(),$(".audit-save-btn").show()):($(".audit-next-btn").show(),$(".audit-save-btn").hide()),o===1?$(".audit-prev-btn").hide():$(".audit-prev-btn").show()}),$(".audit-prev-btn").on("click",function(){o>1&&($(".multi-step-journal-audit").hide(),o--,O(o)),D(o),$(".audit-next-btn").show(),$(".audit-save-btn").hide(),o===1?$(".audit-prev-btn").hide():$(".audit-prev-btn").show()});function O(p){$(".multi-step-journal-audit").hide(),$(".multi-step-journal-audit").eq(p-1).show()}function D(p){$(".audit-step").removeClass("active"),$(".audit-indicator-line").removeClass("active"),$(".audit-step").each(function(u){u<p&&($(this).addClass("active"),$(this).next(".audit-indicator-line").addClass("active"))})}O(o),D(o),o===1&&$(".audit-prev-btn").hide(),$(".save-audit-journal-btn").on("click",function(){$(".audit-client-journal-loader").removeClass("visually-hidden");var p={incomeObj:a,expenseObj:e,assetObj:t,liabilityObj:n,oeObj:d,adjustmentObj:m,references:$(this).attr("id")};$.ajax({type:"POST",url:"client/journal/audit",data:p,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(u){$(".audit-client-journal-loader").addClass("visually-hidden"),localStorage.setItem("journal","updated"),window.location.href="clients"},error:function(u,x,f){$(".audit-client-journal-loader").addClass("visually-hidden"),se.fire({icon:"error",title:"Something went wrong",text:`Translated: ${u} 
 if issue persist try reloading the page or contact developer`})}})});var N=localStorage.getItem("journal");N==="updated"&&(H.fire({icon:"success",title:"Journal Update",text:"Journal Updated Successfully"}),localStorage.removeItem("journal"))});var te=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){var o="";$(".add-new-service-req").on("click",function(l){console.log($(this).attr("id"));var s=$(this).attr("id").split("_"),c=s[1],a=$(`.service-req-${s[1]}`).serializeArray(),e=!0;$.each(a,(t,n)=>{if(n.value===""){te.fire({icon:"warning",title:"Missing Entry!",text:"Please Enter Requirement Name"}),e=!1,$('[name="req-name"]').addClass("is-invalid");return}$('[name="req-name"]').removeClass("is-invalid")}),e&&$.ajax({type:"POST",url:"service/requirement/",data:{form:a,idref:c},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){console.log(t),localStorage.setItem("req","added"),location.reload()},error:function(t,n,d){te.fire({icon:"error",title:"Oops! Something Went wrong",text:"Translated: "+t})}})}),$(".add-new-sub-service-req").on("click",function(l){var s=$("#sub_service_id").val(),c=$("#sub-service-req-id").val();if((s===""||c==="")&&te.fire({icon:"warning",title:"Missing Entry!",text:"Please Enter Requirement Name"}),c===""){$("#sub-service-req-id").addClass("is-invalid");return}else $("#sub-service-req-id").removeClass("is-invalid"),$.ajax({type:"POST",url:"sub-service-requirement",data:{reqName:c,idRef:s},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){console.log(a),localStorage.setItem("req","added"),location.reload()},error:function(a,e,t){te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+a})}})}),$(".get-client-service-req").on("click",function(){o="",$(".append-service-req").empty(),console.log($(this).attr("id"));let l=$(this).attr("id");$(".service-reqs-loader").removeClass("visually-hidden");var s="";$.ajax({type:"POST",url:`client/service/requirements/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(c){o=c.category,console.log(c),console.log("this"),$(".service-reqs-loader").addClass("visually-hidden"),$.each(c.serviceReqs,(a,e)=>{let t="";e.gcon?t=`<td>${e.gcon}</td>`:t=`
                        <td><input type="file" class="req-file" id="${e.id}_${l}" data-id="${e.req_name}_${e.id}" name="${e.req_name}_${e.id}"></td>
                    `,s+=`
                        <tr>
                            <td>${e.req_name}</td>
                            ${t}
                        </tr>
                    `}),$(".append-service-req").append(s)},error:function(c,a,e){$(".service-reqs-loader").addClass("visually-hidden"),te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+c})}})}),$(".save-req-files").on("click",function(){let l=[],s=!1,c=new FormData;const a=$(this).attr("id");if($(".req-file").each(function(){if(this.files.length){s=!0;const e=$(this).attr("id"),t=o,n=this.files[0];l.push({service_id:a,sub_service_req_id:e,category:t,file:n.name}),c.append(`files[${e}]`,n)}}),!s){te.fire({icon:"error",title:"Please upload at least one file."});return}c.append("metadata",JSON.stringify(l)),$.ajax({type:"POST",url:"/service/requirement/document",data:c,processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){console.log(e),localStorage.setItem("req-docs","added"),location.reload()},error:function(e,t,n){te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+e})}})}),$(".view-client-service-doc").on("click",function(){$(".service-docs-loader").removeClass("visually-hidden"),console.log($(this).attr("id")),$(".append-service-req").empty();let l="";$.ajax({type:"POST",url:`/service/requirement/documents/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(s){$(".service-docs-loader").addClass("visually-hidden"),console.log(s),$.each(s.docsData,(c,a)=>{console.log(a);let e="";a.grp&&a.grp.trim()!==""&&(e=`
                            <a href="storage/${a.grp}" 
                               download="${a.gcon}" 
                               class="badge bg-warning text-dark" 
                               style="font-size: 10px;">
                                <i class="fas fa-cloud-download-alt"></i> Download
                            </a>
                        `),l+=`
                        <tr>
                            <td>${a.req_name}</td>
                            <td>${a.gcon||"No file name"}</td>
                            <td>${a.gcmt}</td>
                            <td>${e}</td>
                        </tr>
                    `}),$(".append-service-docs").html(l)},error:function(s,c,a){$(".service-docs-loader").addClass("visually-hidden"),te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+s})}})});var i=localStorage.getItem("req-docs"),r=localStorage.getItem("req");r==="added"&&(te.fire({icon:"success",title:"Service Requirement",text:"New requirement added"}),localStorage.removeItem("req")),i==="added"&&(te.fire({icon:"success",title:"Service Requirement",text:"New requirement document is added"}),localStorage.removeItem("req-docs"))});$(document).ready(function(){Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});var o=Swal.mixin({toast:!1,position:"bottom-end"});$(".expense-quarter").change(function(){var i=$(this).val();if(!i||!["Q1","Q2","Q3","Q4"].includes(i)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`quarterly-expense-${i}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){var l=r[i];if(l){let s=[],c=[];$.each(l.details,function(a,e){s.push(a),c.push(e.total)}),expenseChart.data.labels=s,expenseChart.data.datasets[0].data=c,expenseChart.update()}else console.error("No data found for quarter: "+i)},error:function(r,l,s){o.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+r})}})}),$(".income-quarter").change(function(){var i=$(this).val();if(!i||!["Q1","Q2","Q3","Q4"].includes(i)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`quarterly-income-${i}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){var l=r[i];if(l){let s=[],c=[];$.each(l.details,function(a,e){s.push(a),c.push(e.total)}),lineChart.data.labels=s,lineChart.data.datasets[0].data=c,lineChart.update()}else console.error("No data found for quarter: "+i)},error:function(r,l,s){o.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+r})}})}),$(".sales-quarter").change(function(){var i=$(this).val();if(!i||!["Q1","Q2","Q3","Q4"].includes(i)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`quarterly-sales-${i}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){var l=r[i];if(l){let s=[],c=[];$.each(l.details,function(a,e){s.push(a),c.push(e.total)}),salesChart.data.labels=s,salesChart.data.datasets[0].data=c,salesChart.update()}else console.error("No data found for quarter: "+i)},error:function(r,l,s){o.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+r})}})}),$(".client-quarter").change(function(){var i=$(this).val();if(!i||!["Q1","Q2","Q3","Q4"].includes(i)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`/quarterly-client-${i}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){var l=r[i];if(l){let s=l.months,c=[];for(let a of s)c.push(l.details[a]?l.details[a].total:0);clientsChart.data.labels=s,clientsChart.data.datasets[0].data=c,clientsChart.update()}else console.error("No data found for quarter: "+i)},error:function(r){o.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+r})}})})});$(document).ready(function(){window.formatValueInput=function(o){var i=o.value.replace(/[^0-9\.]/g,""),r=i.split(".");r[0]=r[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),r.length>1?o.value=r[0]+"."+r[1]:o.value=r[0]},window.previewImage=function(o,i){const l=o.target.files[0];if(l){const s=new FileReader;s.onload=function(c){const a=document.getElementById(i);a?a.src=c.target.result:console.error(`Preview element with ID ${i} not found.`)},s.readAsDataURL(l)}else console.warn("No file selected.")}});
