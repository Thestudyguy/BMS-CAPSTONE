function pe(s,a,i,l){$.ajax({url:s,type:"POST",data:a,success:function(o){i(o)},error:function(o,c,n){l(o,c,n)}})}function $e(s,a,i,l){$.ajax({url:s,type:"POST",headers:a,success:function(o){i(o)},error:function(o,c,n){l(o,c,n)}})}function he(s,a,i,l,o,c){$.ajax({url:s,type:"POST",data:{...a,id:i},headers:l,success:function(n){o(n)},error:function(n,e,t){c(n,e,t)}}),console.log(a),console.log(i)}function ge(s,a,i,l,o){$.ajax({url:s,type:"POST",data:a,headers:i,success:function(c){l(c)},error:function(c,n,e){o(c,n,e)}})}function xe(s,a,i,l,o,c){var n=new FormData;for(var e in a)a.hasOwnProperty(e)&&n.append(e,a[e]);i&&n.append("profile",i),$.ajax({url:s,type:"POST",data:n,headers:l,processData:!1,contentType:!1,success:function(t){o(t)},error:function(t,r,d){c(t,r,d)}})}function be(s,a,i,l){$.ajax({url:s,type:"POST",headers:a,success:function(o){i(o)},error:function(o,c,n){l(o,c,n)}})}function ye(s,a,i,l,o){$.ajax({url:s,type:"POST",data:a,headers:i,processData:!1,contentType:!1,success:function(c){l(c)},error:function(c,n,e){o(c,n,e)}})}function Se(s,a,i,l,o){$.ajax({url:s,type:"POST",data:a,headers:i,success:function(c){l(c)},error:function(c,n,e){o(c,n,e)}})}function we(s,a,i,l,o){$.ajax({url:s,type:"POST",data:a,headers:i,success:function(c){l(c)},error:function(c,n,e){o(c,n,e)}})}function Ce(s,a,i,l,o){$.ajax({url:s,type:"POST",data:a,headers:i,success:function(c){l(c)},error:function(c,n,e){o(c,n,e)}})}function Fe(s,a,i,l,o){$.ajax({url:s,type:"POST",data:a,headers:i,success:function(c){l(c)},error:function(c,n,e){o(c,n,e)}})}function je(s,a,i,l,o){$.ajax({url:s,type:"POST",data:a,headers:i,success:function(c){l(c)},error:function(c,n,e){o(c,n,e)}})}function Oe(s,a,i,l,o){$.ajax({url:s,type:"POST",data:a,headers:i,success:function(c){l(c)},error:function(c,n,e){o(c,n,e)}})}function Te(s,a,i,l,o){$.ajax({url:s,type:"POST",data:a,headers:i,success:function(c){l(c)},error:function(c,n,e){o(c,n,e)}})}var ee=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),Z=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".search-coa").on("keyup",function(){var e=$(this).val().toLowerCase();$("#coa-table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(e)>-1)})}),$("#filter-coa").on("change",function(){var e=$(this).val();$(".coa-table tbody tr").each(function(){var t=$(this).data("category");e==="clear"?$(this).show():e===""||t===e?$(this).show():$(this).hide()})}),$(".client-table-data").hover(function(){$(this).find(".action-icons").removeClass("visually-hidden")},function(){$(this).find(".action-icons").addClass("visually-hidden")}),$(".new-sub-service-icon").on("click",function(e){e.stopPropagation()}),$(".edit-service-icon").on("click",function(e){e.stopPropagation()}),$(".view-service-details").on("click",function(e){e.stopPropagation()}),$(".remove-service-icon").on("click",function(e){e.stopPropagation()});function s(e){localStorage.setItem("transaction-status",e),location.reload()}$(".client-sub-table").on("click",function(){console.log($(this).attr("id")),$(this).closest("tr").next(".expandable-body").find(".loader-td")}),$(".external-service").on("click",function(){var e=$(this).next(".expandable-body").find(".loader");e.removeClass("visually-hidden");var t=$(this).attr("id");$.ajax({type:"POST",url:`sub-services-${t}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){e.addClass("visually-hidden");var d=r.services,m='<table class="table table-hover float-left append-sub-services">';m+=`
                <thead class="text-left">
                    <tr>
                        <td>Requirements</td>
                        <td>Price</td>
                    </tr>
                </thead> 
                `,$.each(d,(h,v)=>{var C=parseFloat(v.ServiceRequirementPrice).toFixed(2).toLocaleString(),T=Number(C).toLocaleString();m+=`
                    <tbody class="text-left">
                        <tr class='sub-service' id='${v.id}'>
                            <td>${v.ServiceRequirements}</td>
                            <td>${T}
                            <span id='${v.id}' class="badge mx-2 bg-warning float-right text-sm sub-service-action-icons-remove" data-bs-target='#remove-sub-service' data-bs-toggle='modal' >
                                <i class="fas fa-trash" style="font-size: .8em;"></i>
                            </span>
                            <span id='${v.id}' data-bs-target='#edit-sub-service-modal' data-bs-toggle='modal' class="badge bg-warning float-right text-sm sub-service-action-icons-edit">
                                <i class="fas fa-pen" style="font-size: .8em;"></i>
                            </span>
                            <span id='${v.id}' data-bs-target='#add-sub-service-req' data-bs-toggle='modal' class="mx-2 badge bg-warning float-right text-sm sub-service-action-icons-req">
                                <i class="fas fa-file" style="font-size: .8em;"></i>
                            </span>
                            </td>
                        </tr>
                    </tbody>                    
                    `}),m+="</table>",$(`.append-sub-services-${t}`).html(m)},error:function(r,d,m){Z.fire({icon:"error",title:"Fatal Error",text:r})}})}),$(document).on("click",".sub-service-action-icons-req",function(){var e=$(this).attr("id");$.ajax({type:"POST",url:`retrieve-sub-service-data-${e}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){console.log(t.sub_service),$("#sub_service_id").attr("id",t.sub_service.id),$("#sub_service_id").val(t.sub_service.id),$(".sub-service-req-service-name").text(t.sub_service.ServiceRequirements)},error:function(t,r,d){Z.fire({icon:"error",title:"Something went wrong",text:`Translated: ${t}`})}})}),$(document).on("click",".sub-service-action-icons-edit",function(e){$(".sub-service-loader").removeClass("visually-hidden");var t=$(this).attr("id");$.ajax({type:"POST",url:`retrieve-sub-service-data-${t}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){$(".sub-service-loader").addClass("visually-hidden"),console.log(r.sub_service.ServiceRequirementPrice),$("#service-edit-field").val(r.sub_service.ServiceRequirements),$("#serviceprice-edit-field").val(r.sub_service.ServiceRequirementPrice),$("#sub-service-edit-id").val(r.sub_service.id)},error:function(r,d,m){Z.fire({icon:"error",title:"Something went wrong",text:`Translated: ${r}`})}})}),$(document).on("click",".sub-service-action-icons-remove",function(e){e.preventDefault();var t=$(this).attr("id"),r=$(this).closest("tr").find("td:eq(0)").text().trim();console.log(r),$(".sub-service-app").text(r),$(".remove-sub-service").attr("id",t)}),$(document).on("click",".remove-sub-service",function(){$.ajax({type:"POST",url:`remove-sub-service/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){localStorage.setItem("sub-service","removed"),location.reload()},error:function(e,t,r){Z.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+e})}})}),$("#edit-sub-service").on("click",function(e){e.preventDefault();var t=$("#edit-sub-service-form").serializeArray(),r=!0,d={};if($.each(t,(v,C)=>{C.value===""?(r=!1,$(`[name='${C.name}']`).addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"})):($(`[name='${C.name}']`).removeClass("is-invalid"),d[C.name]=C.value)}),r){let v=function(T){console.log(T),localStorage.setItem("sub_service","updated"),location.reload()},C=function(T,N,M){var V=JSON.parse(T.responseText),F=V.error;if(F==="Service already exists"){$(".conflict-warning").removeClass("visually-hidden"),$("#new-service-form [name='Service']").addClass("is-invalid"),$(".conflict-text").text("Service already exists");return}else Z.fire({icon:"error",title:"Fatal Error",text:`Translated: ${F}`}),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid")};var m=v,h=C;je("edit-sub-service",d,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},v,C)}}),$("#new-service-form").on("submit",function(e){e.preventDefault(),$(".conflict-text").text("Service already exists"),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid");var t={},r=$(this).serializeArray(),d=!1;if($.each(r,(v,C)=>{if(C.value==="")return $(`#new-service-form [name='${C.name}']`).addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),d=!0,!1;t[C.name]=C.value}),d)return;pe("new-service",t,m,h);function m(v){s("created")}function h(v,C,T){var N=JSON.parse(v.responseText),M=N.error;if(M==="Service already exists"){$(".conflict-warning").removeClass("visually-hidden"),$("#new-service-form [name='Service']").addClass("is-invalid"),$(".conflict-text").text("Service already exists");return}else Z.fire({icon:"error",title:"Fatal Error",text:`Translated: ${M}`}),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid")}}),$(".remove-service").on("click",function(){$e(`remove-service-${$(this).attr("id")}`,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t);function e(r){s("removed")}function t(r,d,m){Z.fire({icon:"error",title:"Fatal Error",text:r})}}),$(".edit-service").on("click",function(e){e.preventDefault();var t=$(this).attr("id"),r="#edit-service-form-"+t,d=$(r).serializeArray();console.log(d);var m={},h=!1;if($.each(d,(T,N)=>{if(N.value==="")return $(r+" [name='"+N.name+"']").addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),h=!0,!1;m[N.name]=N.value}),h)return;he("update-service",m,t,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},v,C);function v(T){s("updated")}function C(T,N,M){var V=JSON.parse(T.responseText),F=V.error;Z.fire({icon:"error",title:"Fatal Error",text:`Translated: ${F}`})}}),$(".submit-new-sub-service").on("click",function(e){e.preventDefault();var t=!0,r={},d=$(this).attr("id"),m=$(`#new-sub-service-${d}`).serializeArray();if(console.log(m),$.each(m,(C,T)=>{T.value===""?($(`[name='${T.name}']`).addClass("is-invalid"),t=!1):(r[T.name]=T.value,$(`[name='${T.name}']`).removeClass("is-invalid"))}),!t){ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}ge("new-sub-service",r,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},h,v);function h(C){console.log(C),localStorage.setItem("sub_service","created"),location.reload()}function v(C,T,N){console.log(C),C.responseJSON&&C.responseJSON.message?(Z.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${C.responseJSON.message}`}),console.log(C.responseJSON.errors)):Z.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${C.responseJSON.error}`})}});var a={},i=document.getElementById("fileInput");$(".next-form").on("click",function(){var e=$(".multi-step:visible"),t=e.serializeArray(),r=!1,d=!1;if(e.find(".form-control").removeClass("is-invalid"),$.each(t,(N,M)=>{M.value===""&&($(`[name='${M.name}']`).addClass("is-invalid"),r=!0),a[M.name]=M.value}),e.hasClass("client-profile")&&(!i.files||i.files.length===0?($("#fileInput").addClass("is-invalid"),d=!0):$("#fileInput").removeClass("is-invalid")),r)ee.fire({icon:"warning",title:"Missing Fields",text:"Fill all fields to proceed"});else if(d)ee.fire({icon:"warning",title:"Missing File",text:"Please upload a profile picture before proceeding."});else{var m=e.next(".multi-step");if(m.hasClass("data-entry-preview")){$(".companyName").text($("[name='CompanyName']").val()),$(".companyEmail").text($("[name='CompanyEmail']").val()),$(".companyAddress").text($("[name='CompanyAddress']").val()),$(".companyCEO").text($("[name='CEO']").val()),$(".companyCEODob").text($("[name='CEODateOfBirth']").val()),$(".companyCEOContact").text($("[name='CEOContactInformation']").val()),$(".representativeName").text($("[name='RepresentativeName']").val()),$(".representativeContact").text($("[name='RepresentativeContactInformation']").val()),$(".representativeDob").text($("[name='RepresentativeDateOfBirth']").val()),$(".representativePosition").text($("[name='RepresentativePosition']").val()),$(".representativeAddress").text($("[name='RepresentativeAddress']").val());var h=document.getElementById("fileInput");if(h.files&&h.files[0]){var v=new FileReader;v.onload=function(N){$("#previewImage").attr("src",N.target.result).show()},v.readAsDataURL(h.files[0])}}m.length&&e.fadeOut(300,function(){$(this).hide(),m.fadeIn(200,function(){$(this).show()})});var C=$(".client-step.active"),T=C.next(".client-form-indicator-line");T.addClass("active"),T.next(".client-step").addClass("active"),$(".previous-form").removeClass("visually-hidden"),e.next(".multi-step").next(".multi-step").length||($(".next-form").addClass("visually-hidden"),$(".save").removeClass("visually-hidden"))}}),$(".previous-form").on("click",function(){var e=$(".multi-step:visible"),t=e.prev(".multi-step");if(t.length){e.fadeOut(300,function(){$(this).hide(),t.fadeIn(300,function(){$(this).show()})});var r=$(".client-step.active"),d=r.prev(".client-form-indicator-line");r.removeClass("active"),d.prev(".client-step").addClass("active"),$(".next-form").removeClass("visually-hidden"),$(".save").addClass("visually-hidden"),t.prev(".multi-step").length||$(".previous-form").addClass("visually-hidden")}}),$(".get-ceo-info").click(function(){$("#repName").val(a.CEO),$("#repcontact").val(a.CEOContactInformation),$("#repdob").val(a.CEODateOfBirth),$("#position").val("CEO"),$("#repaddress").val(a.CompanyAddress)}),$(".save").on("click",function(){new FormData,console.log(a),xe("new-client-record",a,fileInput.files[0],{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},function(t){console.log("Success:",t),s("created"),window.location.href="clients"},function(t,r,d){t.responseJSON&&t.responseJSON.message&&(Z.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${t.responseJSON.message}`}),console.log(t.responseJSON.errors))})}),$("#fileInput").on("change",function(e){var t=this.files[0];if(t){var r=new FileReader;r.onload=function(d){$("#imagePreview").attr("src",d.target.result).show(),console.log(d.target.result)},r.readAsDataURL(t)}else $("#imagePreview").attr("src","#").hide()}),$(".pdf-services").on("click",function(e){e.preventDefault();var t=$(this).data("url");window.open(t,"services/pdf")});var l=localStorage.getItem("activeNavItem");l&&$('.nav-item a[href="'+l+'"]').addClass("active"),$(".nav-item a").on("click",function(){$(".nav-item a").removeClass("active"),$(this).addClass("active"),localStorage.setItem("activeNavItem",$(this).attr("href"))});const o=localStorage.getItem("transaction-status");if(o){localStorage.removeItem("transaction-status");const e={created:{icon:"success",title:"New Record",text:"New record added successfully"},removed:{icon:"success",title:"Record Removed!",text:"Record removed successfully"},updated:{icon:"success",title:"Record Updated!",text:"Record updated successfully"}};e[o]&&ee.fire(e[o])}var c=localStorage.getItem("sub_service"),n=localStorage.getItem("sub-service");c==="created"&&(ee.fire({icon:"success",title:"New Requirement added"}),localStorage.removeItem("sub_service")),c==="updated"&&(ee.fire({icon:"success",title:"Service Updated!"}),localStorage.removeItem("sub_service")),n==="removed"&&(ee.fire({icon:"success",title:"Service Removed!"}),localStorage.removeItem("sub-service"))});var Ae=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),ve=Swal.mixin({toast:!1,position:"bottom-end"}),se=0,le=0,Y=[];$(document).ready(function(){$(".services").on("change",function(){var n=$(this).attr("id"),e=$(this).val().split("_"),t=e[0],r=$(this).val(),d=parseFloat(e[1]);Y=[],$(".sub-services-append").html(""),$(".service-input").html(""),$(".sub-services").find(".loader").removeClass("visually-hidden"),$(".services-total").show(),le=d,se=1,l(t,d),i(),be(`fetch-sub-services-${n}`,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},s,a),Y.push({serviceName:r,servicePrice:d,serviceFile:null}),console.log(Y)});function s(n){$(".sub-services").find(".loader").addClass("visually-hidden"),$.each(n.subServices,(e,t)=>{t!=="id"&&$(".sub-services-append").append(`<li>
                    <input class='sub-service-item' type='checkbox' name='SubService' id='${t.id}' 
                    value='${t.ServiceRequirements}_${t.ServiceRequirementPrice}_subservice_${t.id}' 
                    style='font-size: 5px;'>${t.ServiceRequirements}
                </li>`)})}function a(n,e,t){console.log(n),ve.fire({icon:"error",title:"Fatal Error",text:`Translated: ${n}`})}$(document).on("click",".sub-service-item",function(){var n=$(this).val().split("_"),e=$(this).val(),t=$(this).attr("id"),r=n[0],d=parseFloat(n[1]);if($(this).is(":checked"))$(".client-service-input").append(`<tr id='row-${t}'>
                    <td>${r}</td>
                    <td>${d.toLocaleString()}</td>
                </tr>`),le+=d,se++,Y.push({serviceName:e,servicePrice:d,serviceFile:null});else{const m=Y.findIndex(h=>h.serviceName===e);console.log(e,"unchecked"),$(`#row-${t}`).remove(),le-=d,se--,m!==-1&&Y.splice(m,1)}console.log(Y),i()});function i(){$(".totalAmount").text(`Total Amount: ${le.toLocaleString()}`),$(".totalServices").text(`Total Services: ${se}`)}function l(n,e,t){const r=n.replace(/\s+/g,"_");$(".service-input").append(`
            <div class="row">
                <div class="col-sm-12">
                    <div class="row">
                        <table style='font-size: 10px;' class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <td>Service</td>
                                    <td>Amount</td>
                                </tr>
                            </thead>
                            <tbody class='client-service-input'>
                                <tr>
                                    <td>${n}</td>
                                    <td>${e.toLocaleString()}</td>
                                    <td><span class="badge fw-bold text-light bg-danger rounded-1 remove-parent-service" id=${r}><i class="fas fa-trash"></i></span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `)}$(document).on("change",".clientDocument",function(){var n=$(this),e=n.closest("tr"),t=e.find("td").first().text(),r=Array.from(n[0].files);Y=Y.map(d=>d.serviceName===t?{...d,serviceFile:r.length>0?r[0]:null}:d)}),$(document).on("click",".remove-parent-service",function(){var n=$(this).attr("id");console.log(n);var e=n.replace(/_/g," ");console.log("Prepared Service Ref:",n);var t=Y.findIndex(r=>r.serviceName===e);console.log("Service to remove index:",t),t>-1?(console.log("Service to remove:",Y[t]),Y.splice(t,1)):console.log("Service not found in the array!"),$(this).closest("tr").remove(),console.log("Updated Services Data:",Y)});function o(){$(".add-client-service-loader").removeClass("visually-hidden");var n=$(".hidden-client-id").attr("id"),e=new FormData;e.append("client_id",n),Y.forEach((d,m)=>{e.append(`services[${m}][serviceName]`,d.serviceName),e.append(`services[${m}][servicePrice]`,d.servicePrice),d.serviceFile&&e.append(`services[${m}][serviceFile]`,d.serviceFile)});for(const[d,m]of e.entries())console.log(d,m);ye(`client-services-${n}`,e,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},t,r);function t(d){$(".add-client-service-loader").addClass("visually-hidden"),console.log(d),window.location.href="clients",localStorage.setItem("services",!0)}function r(d,m,h){$(".add-client-service-loader").addClass("visually-hidden");try{const v=JSON.parse(d.responseText);console.log("Parsed Response:",v),ve.fire({icon:"warning",title:"Conflict",text:v.Conflict})}catch(v){console.log("Could not parse JSON response:",v)}}}$(".submit-services").on("click",function(){o()});var c=localStorage.getItem("services");c&&(Ae.fire({icon:"success",title:"Services Added to Client"}),localStorage.removeItem("services"))});$(document).ready(function(){let s=1;var a=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),i=Swal.mixin({toast:!1,position:"bottom-end"});let l="",o={},c="",n={},e={},t={},r={},d={};$("#expense-category").on("change",function(){l=$("#expense-category").val(),$(".expense-form").removeClass("visually-hidden"),$(".months-container").empty(),$(".save-expense").addClass("visually-hidden")}),$(".start-date, .end-date").on("change",function(){const F=$(".start-date").val(),g=$(".end-date").val();if($("#expense-category").val()===""){a.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(F&&g){const y=new Date(F),w=new Date(g),O=$(".months-container");var S='<div class="row">';if((w.getFullYear()-y.getFullYear())*12+(w.getMonth()-y.getMonth())>12){i.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const P=new Date(y);if(P.setMonth(P.getMonth()+11),w>P){i.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}O.empty(),S+="";let p=new Date(y);for(;p<=w;){const u=p.toLocaleString("default",{month:"long",year:"numeric"});S+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control month-input" name="${u}" id="" placeholder='${u}' value="">
                    </div>
                    </div>`,p.setMonth(p.getMonth()+1)}S+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-months form-control">Save</button>
            </div>`,S+="</div>",O.html(S)}$(".months-container").on("input",".month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-months",function(F){F.preventDefault();let g=[],S=!0;if(o.hasOwnProperty(l))return a.fire({icon:"warning",title:"Account Already Added",text:"You have already added this account."}),$(".end-date").val(""),$(".start-date").val(""),$(".months-container").empty(),!1;if($(".month-input").each(function(){var y=$(this).attr("name"),w=$(this).val();w!==""&&(S=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),g.push({monthName:y,value:$(this).val(),account:l,startDate:$(".start-date").val(),endDate:$(".end-date").val()}))}),S){$(".month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),a.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}o[l]={months:g,startDate:$(".start-date").val(),endDate:$(".end-date").val()},$("#saved-months").empty(),$.each(o,(y,w)=>{var O='<table class="table table-hover client-journal-accounts">',D=y.split("_");O+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${D[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${y}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(w.months,(P,p)=>{O+=`
                    <tr>
                        <td class='text-left'>${p.monthName}</td>
                        <td class='text-left'>${p.value}</td>
                    </tr>
                `}),O+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,O+="</table>",$("#saved-months").append(O)}),$(".months-container").empty(),$("#expense-category").val(""),$(".end-date").val(""),$(".start-date").val(""),l="",S=!0,console.log(o)}),$(document).on("click",".remove-saved-account",function(F){const g=$(this).attr("id");delete o[g],$("#saved-months").empty(),$.each(o,(S,y)=>{var w='<table class="table table-hover client-journal-accounts">',O=S.split("_");w+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${O[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${S}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(y.months,(D,P)=>{w+=`
                    <tr>
                        <td>${P.monthName}</td>
                        <td>${P.value}</td>
                    </tr>
                `}),w+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,w+="</table>",$("#saved-months").append(w)}),console.log(o)}),$("#income-category").on("change",function(){$(".income-form").removeClass("visually-hidden"),c=$("#income-category").val(),$(".income-months-container").empty()}),$(".income-start-date, .income-end-date").on("change",function(){const F=$(".income-start-date").val(),g=$(".income-end-date").val();if($("#income-category").val()===""){a.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(F&&g){const y=new Date(F),w=new Date(g),O=$(".income-months-container");var S='<div class="row">';if((w.getFullYear()-y.getFullYear())*12+(w.getMonth()-y.getMonth())>12){i.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const P=new Date(y);if(P.setMonth(P.getMonth()+11),w>P){i.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}O.empty(),S+="";let p=new Date(y);for(;p<=w;){const u=p.toLocaleString("default",{month:"long",year:"numeric"});S+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control income-month-input" name="${u}" id="" placeholder='${u}' value="">
                    </div>
                    </div>`,p.setMonth(p.getMonth()+1)}S+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-expense-months form-control">Save</button>
            </div>`,S+="</div>",O.html(S)}$(".income-months-container").on("input",".income-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-expense-months",function(F){F.preventDefault();let g=[],S=!0;if(n.hasOwnProperty(c)){a.fire({icon:"warning",title:"Account Already Added",text:"You have already added this account."}),$(".income-end-date").val(""),$(".income-start-date").val(""),$(".income-months-container").empty();return}if($(".income-month-input").each(function(){var y=$(this).attr("name"),w=$(this).val();w!==""&&(S=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),g.push({incomeMonthName:y,value:$(this).val(),account:c,startDate:$(".income-start-date").val(),endDate:$(".income-end-date").val()}))}),S){$(".income-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),a.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}n[c]={months:g,startDate:$(".income-start-date").val(),endDate:$(".income-end-date").val()},console.log(n),$("#saved-income-months").empty(),$.each(n,(y,w)=>{var O='<table class="table table-hover client-journal-accounts">',D=y.split("_");O+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${D[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${y}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(w.months,(P,p)=>{O+=`
                    <tr>
                        <td class='text-left'>${p.incomeMonthName}</td>
                        <td class='text-left'>${p.value}</td>
                    </tr>
                `}),O+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,O+="</table>",$("#saved-income-months").append(O)}),$(".income-months-container").empty(),$("#income-category").val(""),$(".income-end-date").val(""),$(".income-start-date").val(""),l="",S=!0}),$(document).on("click",".remove-saved-account",function(F){const g=$(this).attr("id");delete n[g],$("#saved-income-months").empty(),$.each(n,(S,y)=>{var w='<table class="table table-hover client-journal-accounts">',O=S.split("_");w+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${O[1]} - ${y.startDate} - ${y.endDate}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${S}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(y.months,(D,P)=>{w+=`
                    <tr>
                        <td>${P.incomeMonthName}</td>
                        <td>${P.value}</td>
                    </tr>
                `}),w+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,w+="</table>",$("#saved-income-months").append(w)}),console.log(n)}),$(document).on("change","#asset_account",function(){let F=$(this).val();console.log(F),$.ajax({type:"POST",url:`get-accounts-${F}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(g){console.log(g);let S="";$.each(g,(y,w)=>{$.each(w,(O,D)=>{console.log(D),S+=`
                            <option value="${D.AccountName}_${D.id}">${D.AccountName}</option>
                        `})}),$("#asset_account_name").html(S)},error:function(g,S,y){console.error(g)}})}),$(document).on("change","#liability_account",function(){let F=$(this).val();$.ajax({type:"POST",url:`get-accounts-${F}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(g){let S="";$.each(g,(y,w)=>{$.each(w,(O,D)=>{S+=`
                            <option value="${D.AccountName}_${D.id}">${D.AccountName}</option>
                        `})}),$("#liability_account_name").html(S)},error:function(g,S,y){console.error(g)}})}),$(document).on("change","#oe_account",function(){let F=$(this).val();$.ajax({type:"POST",url:`get-accounts-${F}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(g){let S="";$.each(g,(y,w)=>{$.each(w,(O,D)=>{S+=`
                            <option value="${D.AccountName}_${D.id}">${D.AccountName}</option>
                        `})}),$("#oe_account_name").html(S)},error:function(g,S,y){console.error(g)}})}),$(".save-asset-info").on("click",function(F){F.preventDefault();var g=!1,S=$(".journal-asset-form").serializeArray(),y="",w="",O="";let D=!1;if($(".journal-asset-form input, .journal-asset-form select").removeClass("is-invalid"),$.each(S,function(p,u){u.value===""&&($(`.journal-asset-form [name='${u.name}']`).addClass("is-invalid"),g=!0),u.name==="assetType"?y=u.value:u.name==="assetAccount"?w=u.value:u.name==="assetAmount"&&(O=u.value)}),$.each(e,(p,u)=>{if($.each(u.accounts,(x,f)=>{if(f.assetAccount===w)return D=!0,!1}),D)return!1}),D)return a.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(g){a.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}e[y]||(e[y]={accounts:[]}),e[y].accounts.push({assetAccount:w,amount:O}),console.log("Asset Object:",e);var P="";$.each(e,function(p,u){$.each(u.accounts,function(x,f){P+=`
                <tr>
                    <td style="font-size: 0.8em;">${p.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.assetAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-asset" id="${f.assetAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-asset-accounts").html(P),$(".journal-asset-form")[0].reset(),$("#asset_account_name").html('<option value="" selected hidden>Select an asset type first</option>')}),$(document).on("click",".remove-asset",function(F){F.preventDefault(),$(this).closest("tr").remove();for(let g in e)e[g].accounts&&(e[g].accounts=e[g].accounts.filter(S=>S.assetAccount!==$(this).attr("id"))),e[g].accounts.length===0&&delete e[g];console.log(e)}),$(".save-liability-info").on("click",function(F){F.preventDefault();var g=!1,S=$(".journal-liability-form").serializeArray(),y="",w="",O="";let D=!1;if($(".journal-liability-form input, .journal-liability-form select").removeClass("is-invalid"),$.each(S,function(p,u){u.value===""&&($(`.journal-liability-form [name='${u.name}']`).addClass("is-invalid"),g=!0),u.name==="liability-account"?y=u.value:u.name==="liability-account-name"?w=u.value:u.name==="liability-amount"&&(O=u.value)}),$.each(t,(p,u)=>{if($.each(u.accounts,(x,f)=>{if(f.liabilityAccount===w)return D=!0,!1}),D)return!1}),D)return a.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(g){a.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}t[y]||(t[y]={accounts:[]}),t[y].accounts.push({liabilityAccount:w,amount:O}),console.log("liability Object:",t);var P="";$.each(t,function(p,u){$.each(u.accounts,function(x,f){P+=`
                <tr>
                    <td style="font-size: 0.8em;">${f.liabilityAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-liability" id="${f.liabilityAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-liability-accounts").html(P),$(".journal-liability-form")[0].reset(),$("#liability_account_name").html('<option value="" selected hidden>Select an asset type first</option>')}),$(document).on("click",".remove-liability",function(F){F.preventDefault(),$(this).closest("tr").remove();for(let g in t)t[g].accounts&&(t[g].accounts=t[g].accounts.filter(S=>S.liabilityAccount!==$(this).attr("id")),t[g].accounts.length===0&&delete t[g]);console.log(t)}),$(".save-oe-info").on("click",function(F){F.preventDefault();var g=!1,S=$(".journal-oe-form").serializeArray(),y="",w="",O="",D=!1;if($(".journal-oe-form input, .journal-oe-form select").removeClass("is-invalid"),$.each(S,function(p,u){u.value===""&&($(`.journal-oe-form [name='${u.name}']`).addClass("is-invalid"),g=!0),u.name==="oe-account"?y=u.value:u.name==="oe-account-name"?w=u.value:u.name==="oe-amount"&&(O=u.value)}),$.each(r,(p,u)=>{if($.each(u.accounts,(x,f)=>{if(f.oeAccount===w)return D=!0,!1}),D)return!1}),D)return a.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(g){a.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}r[y]||(r[y]={accounts:[]}),r[y].accounts.push({oeAccount:w,amount:O}),console.log("Asset Object:",r);var P="";$.each(r,function(p,u){$.each(u.accounts,function(x,f){P+=`
                <tr>
                    <td style="font-size: 0.8em;">${f.oeAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${f.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-oe" id="${f.oeAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-oe-accounts").html(P),$(".journal-oe-form")[0].reset(),$("#oe_account_name").html('<option value="" selected hidden>Select an account type first</option>'),console.log("oeObj Object:",r)}),$(document).on("click",".remove-oe",function(F){F.preventDefault(),$(this).closest("tr").remove();for(let g in r)r[g].accounts&&(r[g].accounts=r[g].accounts.filter(S=>S.oeAccount!==$(this).attr("id"))),r[g].accounts.length===0&&delete r[g];console.log(r)});var m=0,h=0,v=0,C=0,T=0;$(".next-btn").on("click",function(){if(s===1){if(Object.keys(n).length===0){a.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}$("#append-expenses-choy").empty(),m=0;var F="";$.each(n,function(L,K){var _=L.split("_"),b=0;$.each(K.months,function(q,z){var B=z.value.replace(/,/g,""),X=parseFloat(B);b+=X});var E=b.toLocaleString();m+=b,F+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${_[1]}</div>
                        <div class="col-sm-6 text-right">${E}</div>
                    </div>`});var g=parseFloat(m);console.log(typeof g),$("#append-expenses-choy").append(F);var S=`
                <div class="row mt-3">
                    <div class="col-sm-6 text-left"><strong>Total:</strong></div>
                    <div class="col-sm-6 text-right"><strong>${g.toLocaleString()}</strong></div>
                </div>`;$(".append-expense-total").html(S)}if(s===2){$(".append-ldc").empty(),$(".expenses-total").text(""),$(".append-oe").empty(""),$(".oe-total").text("");var y="",w="";if(h=0,v=0,Object.keys(o).length===0){a.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var O=!1,D=!1;if($.each(o,(L,K)=>{var _=L.split("_"),b=_[2];b==="Less Direct Cost"?O=!0:b==="Operating Expenses"&&(D=!0)}),!O||!D){a.fire({icon:"warning",title:"Missing Data",text:'Both "Less Direct Cost" and "Operating Expenses" entries are required.'});return}$.each(o,(L,K)=>{var _=L.split("_"),b=_[2],E=0,q=0;if(b==="Less Direct Cost"){$.each(K.months,(X,ne)=>{var ae=ne.value.replace(/,/g,""),ue=parseFloat(ae);E+=ue});var z=E.toLocaleString();h+=E,y+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${_[1]}</div>
                        <div class="col-sm-6 text-right">${z}</div>
                    </div>
                    `}else if(b==="Operating Expenses"){$.each(K.months,(X,ne)=>{var ae=ne.value.replace(/,/g,""),ue=parseFloat(ae);q+=ue});var B=q.toLocaleString();v+=q,w+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${_[1]}</div>
                        <div class="col-sm-6 text-right">${B}</div>
                    </div>
                    `}});var P=m-h,p=P-v;C=p,$(".gries-total").text(P.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".tgi").text(P.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".expenses-total").text(h.toLocaleString()),$(".append-ldc").append(y),$(".append-oe").append(w),$(".oe-total").text(v.toLocaleString()),$(".net-amount").text(p.toLocaleString())}if(s===3){var u=0,x=0,f=0,R=0;if($(".append-ca").html(""),$(".append-nca").html(""),$(".append-fa").html(""),Object.keys(e).length===0){a.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(e,(L,K)=>{L.split("_")[0]==="Current Asset"&&$.each(K.accounts,(_,b)=>{var E=b.amount.replace(/,/g,""),q=parseFloat(E);f+=q,$(".total-ca").text(f.toLocaleString()),$(".append-ca").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)}),L.split("_")[0]==="Non-Current Assets"&&$.each(K.accounts,(_,b)=>{var E=b.amount.replace(/,/g,""),q=parseFloat(E);x+=q,$(".tnca-amount").text(x.toLocaleString()),$(".append-nca").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)}),L.split("_")[0]==="Fixed Assets"&&$.each(K.accounts,(_,b)=>{var E=b.amount.replace(/,/g,""),q=parseFloat(E);R+=q,$(".append-fa").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)})}),u=f+x+R,$(".total-assets").text(u.toLocaleString())}if(s===4){console.log(t);var A="",I=0;if(Object.keys(t).length===0){a.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(t,(L,K)=>{$.each(K.accounts,(_,b)=>{var E=b.amount.replace(/,/g,""),q=parseFloat(E);I+=q,console.log(I),A+=`
                    <div class="d-flex justify-content-between">
                        <span class="fw-normal">${b.liabilityAccount.split("_")[0]}</span>
                        <span class="fw-normal">${b.amount}</span>
                    </div>
                    `})}),T+=I,$(".append-cl").html(A)}if(s===5){var U="",k=0;if(Object.keys(r).length===0){a.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(r,(L,K)=>{$.each(K.accounts,(_,b)=>{var E=b.amount.replace(/,/g,""),q=parseFloat(E);k+=q,console.log(k),U+=`
                <div class="d-flex justify-content-between">
                <span class="fw-normal">${b.oeAccount.split("_")[0]}</span>
                <span class="fw-normal">${b.amount}</span>
            </div>
                `})}),T+=k,$(".append-oenw").html(U)}if(s===6){$(".tlc").text(T.toLocaleString());var j=0,W=!0,J=$(".journal-adjustments-form").serializeArray();if($.each(J,(L,K)=>{var _=$(`.journal-adjustments-form [name='${K.name}']`);K.value.trim()===""?(W=!1,_.addClass("is-invalid")):(_.removeClass("is-invalid"),d[K.name]=K.value)}),!W){a.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}$.each(d,(L,K)=>{var _=K.replace(/,/g,""),b=parseFloat(_);L==="owners_withdrawal"&&$(".less-drawings").text(b.toLocaleString()),L==="owners_capital"&&(j+=b),L!=="owners_withdrawal"&&L!=="owners_capital"&&(j+=b)}),$(".additional-capital").text(j.toLocaleString()),$(".fp-nc").text(C.toLocaleString());var Q=j+C;$(".appraisal-capital").text(Q.toLocaleString());var G=Q-parseFloat($(".less-drawings").text().replace(/[^0-9.-]+/g,""));$(".capital-end").text(G.toLocaleString())}s<7&&($(".multi-step-journal").hide(),s++,N(s)),M(s),s===7?($(".next-btn").hide(),$(".save-btn").show()):($(".next-btn").show(),$(".save-btn").hide()),s===1?$(".prev-btn").hide():$(".prev-btn").show()}),$(".prev-btn").on("click",function(){s>1&&($(".multi-step-journal").hide(),s--,N(s)),M(s),$(".next-btn").show(),$(".save-btn").hide(),s===1?$(".prev-btn").hide():$(".prev-btn").show()});function N(F){$(".multi-step-journal").hide(),$(".multi-step-journal").eq(F-1).show()}function M(F){$(".step").removeClass("active"),$(".indicator-line").removeClass("active"),$(".step").each(function(g){g<F&&($(this).addClass("active"),$(this).next(".indicator-line").addClass("active"))})}N(s),M(s),s===1&&$(".prev-btn").hide(),$(".save-journal-btn").click(function(){var F={incomeObj:n,expensesObj:o,assetObj:e,liabilityObj:t,oeObj:r,adjustmentObj:d,client_id:$(this).attr("id").split("_")[1]};Te("new-client-journal-entry",F,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},g,S);function g(y){console.log(y),localStorage.setItem("journal","created"),window.location.href="clients"}function S(y,w,O){console.log(y)}});var V=localStorage.getItem("journal");V==="created"&&(a.fire({icon:"success",title:"Journal Entry",text:"New Journal Entry Saved"}),localStorage.removeItem("journal"))});var ie=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),me=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".save-account-type").on("click",function(){var i=$(".new-account-type-form").serializeArray(),l={},o=!0;if($.each(i,(e,t)=>{if(t.value===""){o=!1,$(`.new-account-type-form [name='${t.name}']`).addClass("is-invalid"),ie.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"});return}else l[t.name]=t.value,$(`.new-account-type-form [name='${t.name}']`).removeClass("is-invalid"),console.log(l)}),o){let e=function(r){console.log(r),localStorage.setItem("account-type","created"),location.reload()},t=function(r,d,m){$(".loader-container").addClass("visually-hidden");try{const h=JSON.parse(r.responseText);console.log("Parsed Response:",h),me.fire({icon:"warning",title:"Conflict",text:h.error})}catch(h){console.log("Could not parse JSON response:",h)}};var c=e,n=t;$(".loader-container").removeClass("visually-hidden"),Se("new-account-type",l,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t)}}),$(".save-account").on("click",function(){var i=$("#account-form").serializeArray(),l={},o=!0;if(console.log(i),$.each(i,(e,t)=>{if($(`#account-form [name='${t.name}']`).addClass("is-invalid"),t.value===""){ie.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"}),o=!1;return}else $(`#account-form [name='${t.name}']`).removeClass("is-invalid"),l[t.name]=t.value}),o){let e=function(r){localStorage.setItem("account","created"),location.reload()},t=function(r,d,m){$(".loader-container").addClass("visually-hidden");try{const h=JSON.parse(r.responseText);console.log("Parsed Response:",h),me.fire({icon:"warning",title:"Conflict",text:h.error})}catch(h){console.log("Could not parse JSON response:",h)}};var c=e,n=t;$(".loader-container").removeClass("visually-hidden"),we("new-account",l,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t)}}),$(".edit-coa").click(function(i){i.preventDefault();var l=$(this).attr("id"),o=$(`#edit-coa-form-${l}`).serializeArray(),c=!0,n={};$.each(o,(e,t)=>{if(t.value===""){$(`.edit-coa-form-${l} [name='${t.name}']`).addClass("is-invalild"),c=!1,ie.fire({icon:"warning",title:"Missing Field!",text:"Please fill all fields"});return}$(`.edit-coa-form-${l} [name='${t.name}']`).removeClass("is-invalild"),n[t.name]=t.value}),c&&$.ajax({type:"POST",url:"edit-coa",data:n,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){localStorage.setItem("account","updated"),location.reload()},error:function(e,t,r){try{const d=JSON.parse(e.responseText);console.log("Parsed Response:",d),me.fire({icon:"warning",title:"Conflict",text:d.message})}catch(d){console.log("Could not parse JSON response:",d)}}})});var s=localStorage.getItem("account-type"),a=localStorage.getItem("account");if(s==="created"){ie.fire({icon:"success",title:"New Account Type created!"}),localStorage.removeItem("account-type");return}if(a==="created"){localStorage.removeItem("account"),ie.fire({icon:"success",title:"New Account created!"}),localStorage.removeItem("account-type");return}if(a==="updated"){localStorage.removeItem("account"),ie.fire({icon:"success",title:"Account updated!"}),localStorage.removeItem("account-type");return}});$(document).ready(function(){var s=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),a=Swal.mixin({toast:!1,position:"bottom-end"});$(".new-user-save").on("click",function(l){var o=$(".new-user-form").serializeArray(),c={},n=!0;if($.each(o,(r,d)=>{if(d.value===""){n=!1,$(`.new-user-form [name='${d.name}']`).addClass("is-invalid"),s.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}else c[d.name]=d.value,$(`.new-user-form [name='${d.name}']`).removeClass("is-invalid")}),n){let r=function(m){localStorage.setItem("user","created"),location.reload()},d=function(m,h,v){try{const C=JSON.parse(m.responseText);console.log("Parsed Response:",C),a.fire({icon:"warning",title:"Conflict",text:C.message})}catch(C){console.log("Could not parse JSON response:",C)}};var e=r,t=d;Ce("new-user",c,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},r,d)}}),$(".remove-user").on("click",function(){var l=$(this).attr("id");$.ajax({url:`remove-user-${l}`,type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(o){console.log(o),localStorage.setItem("user","removed"),location.reload()},error:function(o,c,n){console.log(o)}})}),$(".edit-user-button").on("click",function(){var l=$(this).closest(".modal").find("form").serializeArray();console.log(l);var o=!0,c={};$.each(l,(n,e)=>{if(e.value===""){o=!1,$(`[name='${e.name}']`).addClass("is-invalid"),s.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}else c[e.name]=e.value,$(`[name='${e.name}']`).removeClass("is-invalid")}),o&&$.ajax({url:"update-user",type:"POST",data:c,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){localStorage.setItem("user","updated"),location.reload()},error:function(n,e,t){a.fire({icon:"error",title:"Fatal Error!",text:"Try reloading the page, if issue persist contact developer"})}})});var i=localStorage.getItem("user");i==="created"&&(s.fire({icon:"success",title:"User Created!",text:"User created successfuly"}),localStorage.removeItem("user")),i==="removed"&&(s.fire({icon:"success",title:"User Removed!",text:"User removed successfuly"}),localStorage.removeItem("user")),i==="updated"&&(s.fire({icon:"success",title:"User Updated!",text:"User Updated successfuly"}),localStorage.removeItem("user")),$(".search-users").on("keyup",function(){var l=$(this).val().toLowerCase();$(".users-table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(l)>-1)})}),$("#filter-users").on("change",function(){var l=$(this).val();$(".users-table tbody tr").each(function(){var o=$(this).data("category");l==="clear"?$(this).show():l===""||o===l?$(this).show():$(this).hide()})})});$(document).ready(function(){var s=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),a=Swal.mixin({toast:!1,position:"bottom-end"});$("#account-category").on("change",function(n){$("#billing-account-type").prop("disabled",!1),$.ajax({type:"POST",url:`get-account-types-${$(this).val()}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){console.log(e);let t='<option value="" selected hidden>Select Type</option>',r=!1;$.each(e,(d,m)=>{$.each(m,(h,v)=>{Object.keys(v).length>0&&(t+=`<option value="${v.id}">${v.ServiceRequirements}</option>`,r=!0)})}),r||(t='<option value="" selected hidden>Category has no type</option>'),$("#billing-account-type").html(t)},error:function(e){console.error(e),a.fire({icon:"error",title:"Error",text:`Could not load account types: ${e.responseText||e.statusText}`})}})}),$(document).on("change",'[id^="edit-account-category-"]',function(n){let e=$(this).attr("id").split("-").pop(),t=`#edit-billing-account-type-${e}`;console.log($(this).val()),console.log("Fetching types for modal:",e),$.ajax({type:"POST",url:`get-account-types-${$(this).val()}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){console.log(r);let d='<option value="" selected hidden>Select Type</option>',m=!1;$.each(r,(h,v)=>{$.each(v,(C,T)=>{Object.keys(T).length>0&&(d+=`<option value="${T.id}">${T.ServiceRequirements}</option>`,m=!0)})}),m||(d='<option value="" selected hidden>Category has no type</option>'),$(t).html(d)},error:function(r){console.error(r),a.fire({icon:"error",title:"Error",text:`Could not load account types: ${r.responseText||r.statusText}`})}})}),$(".edit-description").on("click",function(n){var e=$(this).attr("id").split("-").pop();n.preventDefault();var t={},r=$(`.update-description-form-${e}`).serializeArray(),d=!0;$.each(r,(m,h)=>{h.value===""&&(d=!1,s.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"}),$(`.update-description-form-${e} [name='${h.name}']`).addClass("is-invalid")),$(`.update-description-form-${e} [name='${h.name}']`).removeClass("is-invalid"),t[h.name]=h.value}),console.log(t),d&&$.ajax({type:"POST",url:"update/account-description",data:t,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(m){localStorage.setItem("account_description","updated"),location.reload()},error:function(m,h,v){a.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+m.responseText})}})}),$(".remove-description").on("click",function(){$.ajax({type:"POST",url:`remove/account-description/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){localStorage.setItem("account_description","removed"),location.reload()},error:function(n,e,t){a.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+n.responseText})}})}),$(".remove-coa").on("click",function(){$.ajax({type:"POST",url:`remove/coa/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){localStorage.setItem("coa","removed"),location.reload()},error:function(n,e,t){a.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+n.responseText})}})}),$(".save-account-description").on("click",function(n){var e=$(".account-description-form").serializeArray(),t={},r=!0;if($.each(e,(h,v)=>{if(v.value===""){$(`.account-description-form [name="${v.name}"]`).addClass("is-invalid"),s.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),r=!1;return}else t[v.name]=v.value,console.log(t),$(`.account-description-form [name="${v.name}"]`).removeClass("is-invalid")}),r){let h=function(C){localStorage.setItem("account_description","created"),location.reload()},v=function(C,T,N){try{const M=JSON.parse(C.responseText);console.log("Parsed Response:",M),a.fire({icon:"error",title:"Error",text:M.message})}catch(M){console.log("Could not parse JSON response:",M)}};var d=h,m=v;Fe("new-account-description",t,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},h,v)}}),$(".edit-sys-profile").on("click",function(n){n.preventDefault();var e=!0,t={},r=$("#sys-profile-form").serializeArray();$.each(r,(d,m)=>{m.value.trim()===""?(e=!1,$(`.sys-profile-form [name='${m.name}']`).addClass("is-invalid"),s.fire({icon:"warning",title:"Missing fields",text:"Please fill all fields"})):$(`.sys-profile-form [name='${m.name}']`).removeClass("is-invalid"),t[m.name]=m.value}),e&&$.ajax({type:"POST",url:"edit-sys-info",data:t,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(d){localStorage.setItem("system-profile","updated"),location.reload()},error:function(d,m,h){try{const v=JSON.parse(d.responseText);console.log("Parsed Response:",v),a.fire({icon:"error",title:"Error",text:v.message})}catch(v){console.log("Could not parse JSON response:",v)}}})}),$(".edit-user-privilege").on("click",function(n){n.preventDefault();var e=$(this).attr("id");console.log(e),$.ajax({url:`/users/toggle-privilege/${e}`,type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(t){localStorage.setItem("user_privilege_updated",t.message),location.reload()},error:function(t){s.fire({icon:"error",title:"An error occurred while updating the privilege."})}})});var i=localStorage.getItem("account_description"),l=localStorage.getItem("system-profile"),o=localStorage.getItem("coa"),c=localStorage.getItem("user_privilege_updated");i==="created"&&(s.fire({icon:"success",title:"Account Description Created!"}),localStorage.removeItem("account_description")),i==="removed"&&(s.fire({icon:"success",title:"Account Description Removed!"}),localStorage.removeItem("account_description")),i==="updated"&&(s.fire({icon:"success",title:"Account Description Updated!"}),localStorage.removeItem("account_description")),l==="updated"&&(s.fire({icon:"success",title:"System Profile Updated"}),localStorage.removeItem("system-profile")),o==="removed"&&(s.fire({icon:"success",title:"Account Removed"}),localStorage.removeItem("coa")),c&&(s.fire({icon:"success",title:c}),localStorage.removeItem("user_privilege_updated"))});var ce=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),fe=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".update-client-service-progress-btn").on("click",function(){var i=$(this).attr("id"),l=$(`.update-service-progress-${i}`).serializeArray();console.log(l),$.ajax({type:"POST",url:"update-client-service",data:{serviceId:i,serviceVal:l},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(o){localStorage.setItem("service","updated"),location.reload()},error:function(o,c,n){try{const e=JSON.parse(o.responseText);console.log("Parsed Response:",e),fe.fire({icon:"warning",title:"Conflict",text:e.Conflict})}catch(e){console.log("Could not parse JSON response:",e)}}})}),$(".edit-company-info").on("click",function(i){var l=$(`.edit-company-info-${$(this).attr("id")}`).serializeArray(),o=!0,c={};$.each(l,(n,e)=>{e.value===""&&(o=!1,$(`.edit-company-info-${$(this).attr("id")} [name='${e.name}']`).addClass("is-invalid"),ce.fire({icon:"warning",title:"Missingg Fields",text:"Please fill all fields"})),c[e.name]=e.value}),o&&$.ajax({type:"POST",url:"update-company-info",data:c,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){localStorage.setItem("company-info","updated"),location.reload()},error:function(n,e,t){fe.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+n})}})}),$(".remove-client-service").on("click",function(){$.ajax({type:"POST",url:`client-profile/service/remove/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){localStorage.setItem("service","removed"),location.reload()},error:function(i,l,o){fe.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+i})}})});var s=localStorage.getItem("company-info"),a=localStorage.getItem("service");a==="updated"&&(ce.fire({icon:"success",text:"Client Service Updated"}),localStorage.removeItem("service")),a==="removed"&&(ce.fire({icon:"success",text:"Client Service Removed"}),localStorage.removeItem("service")),s==="updated"&&(localStorage.removeItem("company-info"),ce.fire({icon:"success",text:"Company Info Updated"}))});$(document).ready(function(){var s=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),a=Swal.mixin({toast:!1,position:"bottom-end"}),i=0,l=window.servicesData;console.log(l);var o={Service:[]},c={SubService:[]},n={accounts:[]};$.each(l,(t,r)=>{$.each(r.Service,(d,m)=>{o.Service.push({Service:{service_name:d,service_id:Object.keys(m.parent_service_id)[0],service_price:m.parent_service_id[Object.keys(m.parent_service_id)[0]].parentServicePrice}}),m.sub_service&&$.each(m.sub_service,(h,v)=>{$.each(v,(C,T)=>{$.each(T,(N,M)=>{$.each(M.account_descriptions,(V,F)=>{n.accounts.push({Accounts:{Account:F.Description,account_id:F.adID.toLocaleString(),price:F.Price}})})})}),$.each(v.sub_service_id,C=>{let T=Object.keys(v.sub_service_id)[0],N=v.sub_service_id[T].sub_service_price;c.SubService.push({SubService:{sub_service_name:h,sub_service_id:C,sub_service_price:N}})})})})}),$(".price").each(function(){var t=$(this).text(),r=t.replace(/[^\d.-]/g,""),d=parseFloat(r);i+=d}),$(".remove-parent-service-billing-action").click(function(){var t=$(this).attr("id").split("_")[1],r=$(this).closest("tr").find("td:nth-last-child(2)").text(),d=r.replace(/[^\d.-]/g,""),m=parseFloat(d);i-=m,$(".overall-due").text(i.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(i.toLocaleString(void 0,{minimumFractionDigits:2}));var h=o.Service.findIndex(v=>v.Service.service_id===t);console.log("Service ID to remove:",t),h!==-1?(o.Service.splice(h,1),$(this).closest("tr").remove()):console.log("Service not found")}),$(".remove-sub-service-billing-action").click(function(){var t=$(this).attr("id").split("_")[1],r=$(this).closest("tr").find("td:nth-last-child(2)").text(),d=r.replace(/[^\d.-]/g,""),m=parseFloat(d);i-=m,$(".overall-due").text(i.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(i.toLocaleString(void 0,{minimumFractionDigits:2}));var h=c.SubService.findIndex(v=>v.SubService.sub_service_id===t);h!==-1&&(c.SubService.splice(h,1),$(this).closest("tr").remove())}),$(document).on("click",".remove-account-description-billing-action",function(){var t=$(this).attr("id").split("_")[1],r=$(this).closest("tr").find("td:nth-last-child(2)").text(),d=r.replace(/[^\d.-]/g,""),m=parseFloat(d),h=0;h=m-m,i-=m,$("#additional-description-subtotal").text(h.toLocaleString(void 0,{minimumFractionDigits:2})),$(".overall-due").text(i.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(i.toLocaleString(void 0,{minimumFractionDigits:2}));var v=n.accounts.findIndex(C=>C.Accounts.account_id===t);v!==-1?(n.accounts.splice(v,1),$(this).closest("tr").remove(),console.log(n)):console.log("Account not found")}),console.log(n),$(".add-description").on("click",function(){var t=0,r=$(this).closest("tr"),d=r.data("service"),m=r.data("requirements"),h=r.data("category"),v=r.data("description"),C=r.data("taxtype"),T=r.data("formtype"),N=r.data("price"),M=r.data("id"),V=N.replace(/[^\d.-]/g,""),F=parseFloat(V),g=F.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"),S=n.accounts.some(w=>w.Accounts.Account===v);if(S)s.fire({icon:"warning",title:"Conflict",text:"Account Description already exists!"});else{n.accounts.push({Accounts:{Account:v,account_id:r.attr("id").toLocaleString(),price:N,isAdded:!0}}),i+=F,t+=F,$("#additional-description-subtotal").text(t.toLocaleString(void 0,{minimumFractionDigits:2})),$(".overall-due").text(i.toLocaleString(void 0,{minimumFractionDigits:2}));var y=`
            <tr>
                <td>${d}</td>
                <td>${m}</td>
                <td>${h}</td>
                <td>${v}</td>
                <td>${C}</td>
                <td>${T}</td>
                <td>${g}</td>
                <td>
                    <span class="badge fw-bold text-light bg-danger remove-account-description-billing-action" id='${M}'><i class="fas fa-trash"></i></span>
                </td>
            </tr>
        `;$(".append-ad").append(y)}}),$(".mail-client-bs").click(function(){var t=$("#dd").val(),r=$(".billing-id").text(),d=$(".date").text(),m=$(this).attr("id");if(console.log(o),t===""||t===void 0){$("#dd").addClass("is-invalid"),s.fire({icon:"warning",title:"Missing Field",text:"Please add due date before proceeding"});return}$("#dd").removeClass("is-invalid");var h={dueDate:t,date:d,serviceObj:o,subServiceObj:c,accountDescriptions:n,refID:m,billingId:r};Oe("mail-client-billing",h,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},function(v){window.location.href="clients",localStorage.setItem("billing","created")},function(v,C,T){try{const N=JSON.parse(v.responseText);a.fire({icon:"warning",title:"Conflict",text:N.Message})}catch(N){console.log("Could not parse JSON response:",N)}})});var e=localStorage.getItem("billing");e==="created"&&(s.fire({icon:"success",title:"Billing Created",text:"Billing successfully created"}),localStorage.removeItem("billing"))});var de=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),De=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".view-journal-btn").on("click",function(s){var a=$(this).attr("id");$.ajax({type:"POST",url:`view-client-journal-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(i){console.log(i);var l=new Blob([i],{type:"application/pdf"}),o=URL.createObjectURL(l);window.open(o,"_blank")},error:function(i,l,o){De.fire({icon:"error",title:"Oops Something went wrong!",text:i.responseJSON?i.responseJSON.error:"Unknown error"})}})}),$(".gen-client-billing-pdf").click(function(){$.ajax({type:"POST",url:`client-billing-data_${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(s){var a=new Blob([s],{type:"application/pdf"}),i=URL.createObjectURL(a);window.open(i,"_blank")},error:function(s,a,i){de.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".gen-expense-pdf").on("click",function(){$.ajax({type:"POST",url:"expense/pdf/expense",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(s){var a=new Blob([s],{type:"application/pdf"}),i=URL.createObjectURL(a);window.open(i,"_blank")},error:function(s,a,i){de.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".income-gen-pdf").on("click",function(){$.ajax({type:"POST",url:"income/pdf/income",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(s){var a=new Blob([s],{type:"application/pdf"}),i=URL.createObjectURL(a);window.open(i,"_blank")},error:function(s,a,i){de.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".generate-client-billing-pdf").on("click",function(){$.ajax({type:"POST",url:`client/billing/pdf/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(s){var a=new Blob([s],{type:"application/pdf"}),i=URL.createObjectURL(a);window.open(i,"_blank")},error:function(s,a,i){de.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})})});var re=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),Re=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".journal-pin-entry").on("submit",function(a){a.preventDefault();var i=$(this).serializeArray(),l=!0;$.each(i,(o,c)=>{c.value===""?(re.fire({icon:"warning",title:"Missing PIN",text:"Please enter PIN"}),l=!1,$(`[name='${c.name}']`).addClass("is-invalid")):$(`[name='${c.name}']`).remove("is-invalid")}),l&&$.ajax({type:"POST",url:"journal-pin-entry",data:i,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var c=new Blob([o],{type:"application/pdf"}),n=URL.createObjectURL(c);window.open(n,"_blank"),console.log("asdasd")},error:function(o,c,n){o.status===400?re.fire({icon:"error",title:o.statusText,text:"Incorrect PIN"}):re.fire({icon:"error",title:"Something went wrong",text:"Fatal error. Translated: "+c})}})}),$(".request-journal-pin").click(function(){$.ajax({type:"POST",url:`request-journal-pin_${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){re.fire({icon:"success",title:"User Notified",text:"Email has been successfully sent to the user."})},error:function(a,i,l){console.error("Error:",l),re.fire({icon:"error",title:"Notification Failed",text:"Failed to send the email to the user. Please try again later."})}})}),$(".remove-journal-entry").click(function(){$.ajax({type:"POST",url:`archive-journal-entry-${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){localStorage.setItem("journal","Removed"),location.reload()},error:function(a,i,l){Re.fire({icon:"error",title:"Oops! Something went wrong",text:"Error Translated: "+a})}})});var s=localStorage.getItem("journal");s==="Removed"&&(localStorage.removeItem("journal"),re.fire({icon:"success",title:"Journal Update",text:"Journal Successfully removed"}))});var ke=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});$(document).ready(function(){$('select[name="JournalStatus"]').on("change",function(){var s=$(this).closest(".modal"),a=s.find(".journal-draft-note");$(this).val()==="Rejected"||$(this).val()==="Canceled"?a.removeClass("visually-hidden"):a.addClass("visually-hidden").val("")}),$(".update-journal-status").on("click",function(){var s=$(this).attr("id");console.log(s);var a=$(`#update-journal-status-${s}`),i=a.find(`#serviceprogress-${s}`).val(),l=a.find(`#note-${s}`);if((i==="Canceled"||i==="Rejected")&&l.val().trim()===""){Swal.fire({icon:"error",title:"Validation Error",text:'Please provide a note when the status is "Canceled" or "Rejected".'}),l.addClass("is-invalid");return}var o=$(`.update-journal-status-form-${s}`).serializeArray();$.ajax({type:"POST",url:"/update-journal-status",data:o,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(c){localStorage.setItem("journal-status","updated"),location.reload()},error:function(c){console.error(c)}})}),localStorage.getItem("journal-status")==="updated"&&(ke.fire({icon:"success",title:"Journal Status Updated",text:"Journal status updated successfully"}),localStorage.removeItem("journal-status"))});var H=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),oe=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){let s=1;var a=window.journalIncome,i=window.journalExpense,l=window.journalAssets,o=window.journalLiability,c=window.journalOE,n=a,e=i,t={},r={},d={},m={};$.each(l,(p,u)=>{const x=[];x.push({assetAccount:u.account,amount:u.amount}),t[u.asset_category]={accounts:x}}),$.each(o,(p,u)=>{const x=[];var f=u.AccountType;x.push({liabilityAccount:u.account,amount:u.amount}),r[f]={accounts:x}}),$.each(c,(p,u)=>{const x=[];var f=u.AccountType;x.push({oeAccount:u.account,amount:u.amount}),d[f]={accounts:x}});let h="";$("#audit-income-category").on("change",function(){h=$(this).val(),$(".audit-income-form").removeClass("visually-hidden"),$(".saved-audited-income-months").empty()}),$("#audit-expense-category").on("change",function(){h=$(this).val(),$(".audit-expense-form").removeClass("visually-hidden"),$(".saved-audited-expense-months").empty()}),$(".audit-income-start-date, .audit-income-end-date").on("change",function(){const p=$(".audit-income-start-date").val(),u=$(".audit-income-end-date").val();if($("#audit-income-category").val()===""){H.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(p&&u){const f=new Date(p),R=new Date(u),A=$(".audit-income-months-container");var x='<div class="row">';if((R.getFullYear()-f.getFullYear())*12+(R.getMonth()-f.getMonth())>12){oe.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const U=new Date(f);if(U.setMonth(U.getMonth()+11),R>U){oe.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}A.empty(),x+="";let k=new Date(f);for(;k<=R;){const j=k.toLocaleString("default",{month:"long",year:"numeric"});x+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control audit-income-month-input" name="${j}" id="" placeholder='${j}' value="">
                    </div>
                    </div>`,k.setMonth(k.getMonth()+1)}x+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-income-audit-months form-control">Save</button>
            </div>`,x+="</div>",A.html(x)}$(document).on("input",".audit-income-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-income-audit-months",function(p){p.preventDefault();let u=[],x=!0;if(n.hasOwnProperty(h)){H.fire({icon:"warning",title:"Account Already Exists!",text:"You have already added this account."}),$(".audit-income-end-date").val(""),$(".audit-income-start-date").val(""),$(".audit-income-months-container").empty(),console.log(!0);return}if($(".audit-income-month-input").each(function(){var f=$(this).attr("name");console.log(f);var R=$(this).val();R!==""&&(x=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),u.push({incomeMonthName:f,value:$(this).val(),startDate:$(".audit-income-start-date").val(),endDate:$(".audit-income-end-date").val()}))}),x){$(".audit-income-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),H.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}n[h]={months:u,startDate:$(".audit-income-start-date").val(),endDate:$(".audit-income-end-date").val()},$("#saved-audited-income-months").empty(),$.each(n,(f,R)=>{var A='<table class="table table-hover client-journal-accounts">',I=f.split("_");A+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${I[1]}
                        <span class="text-sm fw-bold float-right remove-audit-income" id="${f}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(R.months,(U,k)=>{A+=`
                    <tr>
                        <td class='text-left'>${k.incomeMonthName}</td>
                        <td class='text-left'>${k.value}</td>
                    </tr>
                `}),A+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,A+="</table>",$("#saved-audited-income-months").append(A)}),$(".audit-income-months-container").empty(),$("#audit-income-category").val(""),$(".audit-income-end-date").val(""),$(".audit-income-start-date").val(""),h="",x=!0,console.log(n)}),$(".audit-expense-start-date, .audit-expense-end-date").on("change",function(){const p=$(".audit-expense-start-date").val(),u=$(".audit-expense-end-date").val();if($("#audit-expense-category").val()===""){H.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(p&&u){const f=new Date(p),R=new Date(u),A=$(".audit-expense-months-container");var x='<div class="row">';if((R.getFullYear()-f.getFullYear())*12+(R.getMonth()-f.getMonth())>12){oe.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const U=new Date(f);if(U.setMonth(U.getMonth()+11),R>U){oe.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}A.empty(),x+="";let k=new Date(f);for(;k<=R;){const j=k.toLocaleString("default",{month:"long",year:"numeric"});x+=`<div class="col-sm-6 my-2">
                <div class="input-group">
                <input type="text" class="form-control audit-expense-month-input" name="${j}" id="" placeholder='${j}' value="">
                </div>
                </div>`,k.setMonth(k.getMonth()+1)}x+=`
        <div class="col-sm-6 my-2 text-right">
            <button type='button' class="btn btn-primary save-expense-audit-months form-control">Save</button>
        </div>`,x+="</div>",A.html(x)}$(".audit-expense-months-container").on("input",".audit-expense-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-expense-audit-months",function(p){p.preventDefault();let u=[],x=!0;if(e.hasOwnProperty(h)){H.fire({icon:"warning",title:"Account Already Exists!",text:"You have already added this account."}),$(".audit-iexpensencome-end-date").val(""),$(".audit-expense-start-date").val(""),$(".audit-expense-months-container").empty();return}if($(".audit-expense-month-input").each(function(){var f=$(this).attr("name"),R=$(this).val();R!==""&&(x=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),u.push({expenseMonthName:f,value:$(this).val(),startDate:$(".audit-expense-start-date").val(),endDate:$(".audit-expense-end-date").val()}))}),x){$(".audit-expense-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),H.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}e[h]={months:u,startDate:$(".audit-expense-start-date").val(),endDate:$(".audit-expense-end-date").val()},$("#saved-audited-expense-months").empty(),$.each(e,(f,R)=>{var A='<table class="table table-hover client-journal-accounts">',I=f.split("_");A+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${I[1]}
                        <span class="text-sm fw-bold float-right remove-audit-expense" id="${f}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(R.months,(U,k)=>{A+=`
                    <tr>
                        <td class='text-left'>${k.expenseMonthName}</td>
                        <td class='text-left'>${k.value}</td>
                    </tr>
                `}),A+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,A+="</table>",$("#saved-audited-expense-months").append(A)}),$(".audit-expense-months-container").empty(),$("#audit-expense-category").val(""),$(".audit-expense-end-date").val(""),$(".audit-expense-start-date").val(""),h="",x=!0}),$(".save-audit-asset-info").on("click",function(p){p.preventDefault();var u=$(".journal-audit-asset-form").serializeArray(),x="",f="",R="";let A=!1;if($.each(u,(k,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="assetType"?x=j.value:j.name==="assetAccount"?f=j.value:j.name==="assetAmount"&&(R=j.value)}),!x||!f||!R){console.error("Required fields are missing.");return}if($.each(t,(k,j)=>{if($.each(j.accounts,(W,J)=>{if(J.assetAccount===f.split("_")[0])return A=!0,!1}),A)return!1}),A)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var I=x.split("_");t[I[0]]||(t[I[0]]={accounts:[]}),t[I[0]].accounts.push({assetAccount:f.split("_")[0],amount:R}),$(".append-audit-asset-accounts").empty();let U="";$.each(t,(k,j)=>{$.each(j.accounts,(W,J)=>{var Q=J.amount,G=Q.toString().replace(/,/g,""),L=parseFloat(G).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});U+=`
            <tr id="${k}">
                <td class='text-sm'>${k}</td>
                <td class='text-sm'>${J.assetAccount}</td>
                <td class='text-sm'>
                    ${L}
                    <span class="badge fw-bold text-dark float-right remove-audited-asset" id="${J.assetAccount}">
                        <i class="fas fa-times"></i>
                    </span>
                </td>
            </tr>`})}),$(".append-audit-asset-accounts").append(U),$("#asset_account").val(""),$("#asset_account_name  option:first").text("Select Account"),$("#assetAmount").val(""),A=!1}),$(".save-audit-liability-info").on("click",function(p){p.preventDefault();var u=$(".journal-audit-liability-form").serializeArray(),x="",f="",R="";let A=!1;if($.each(u,(k,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="audit-liability-account"?x=j.value:j.name==="audit-liability-account-name"?f=j.value:j.name==="liability-amount"&&(R=j.value)}),!x||!f||!R){console.error("Required fields are missing.");return}if($.each(r,(k,j)=>{if($.each(j.accounts,(W,J)=>{if(J.liabilityAccount===f.split("_")[0])return A=!0,!1}),A)return!1}),A)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var I=x.split("_");r[I[0]]||(r[I[0]]={accounts:[]}),r[I[0]].accounts.push({liabilityAccount:f.split("_")[0],amount:R}),$(".append-audit-liability-accounts").empty();let U="";$.each(r,(k,j)=>{$.each(j.accounts,(W,J)=>{var Q=J.amount,G=Q.toString().replace(/,/g,""),L=parseFloat(G).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});U+=`
                <tr id="${k}">
                    <td class='text-sm'>${k}</td>
                    <td class='text-sm'>${J.liabilityAccount}</td>
                    <td class='text-sm'>
                        ${L}
                        <span class="badge fw-bold text-dark float-right remove-audit-liability" id="${J.liabilityAccount}">
                            <i class="fas fa-times"></i>
                        </span>
                    </td>
                </tr>`})}),$(".append-audit-liability-accounts").append(U),$("#liability_account").val(""),$("#liability_account_name  option:first").text("Select Account"),$("#liabilityAmount").val(""),A=!1}),$(".save-audit-oe-info").on("click",function(p){p.preventDefault();var u=$(".journal-audit-oe-form").serializeArray(),x="",f="",R="";let A=!1;if($.each(u,(k,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="oe-account"?x=j.value:j.name==="oe-account-name"?f=j.value:j.name==="oe-amount"&&(R=j.value)}),!x||!f||!f){console.error("Required fields are missing.");return}if($.each(d,(k,j)=>{if($.each(j.accounts,(W,J)=>{if(J.oeAccount===f.split("_")[0])return A=!0,!1}),A)return!1}),A)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var I=x.split("_");d[I[0]]||(d[I[0]]={accounts:[]}),d[I[0]].accounts.push({oeAccount:f.split("_")[0],amount:R}),$(".append-audit-oe-accounts").empty();let U="";$.each(d,(k,j)=>{$.each(j.accounts,(W,J)=>{var Q=J.amount,G=Q.toString().replace(/,/g,""),L=parseFloat(G).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});U+=`
            <tr id="${k}">
                <td class='text-sm'>${k}</td>
                <td class='text-sm'>${J.oeAccount}</td>
                <td class='text-sm'>
                    ${L}
                    <span class="badge fw-bold text-dark float-right remove-audit-oe" id="${k}">
                        <i class="fas fa-times"></i>
                    </span>
                </td>
            </tr>`})}),$(".append-audit-oe-accounts").append(U),$("#oe-account").val(""),$("#oe-account-name  option:first").text("Select Account"),$("#oeAmount").val(""),A=!1}),$(document).on("click",".remove-audit-income",function(){$(this).closest("tr").remove();var p=$(this).attr("id");delete n[p],$("#saved-audited-income-months").empty(),$.each(n,(u,x)=>{var f='<table class="table table-hover client-journal-accounts">',R=u.split("_");f+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${R[1]}
                        <span class="text-sm fw-bold float-right remove-audit-income" id="${u}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(x.months,(A,I)=>{f+=`
                    <tr>
                        <td>${I.incomeMonthName}</td>
                        <td>${I.value}</td>
                    </tr>
                `}),f+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,f+="</table>",$("#saved-audited-income-months").append(f)}),console.log(n)}),$(document).on("click",".remove-audit-expense",function(p){delete e[$(this).attr("id")],$(this).closest("tr").remove(),$("#saved-audited-expense-months").empty(),$.each(e,(u,x)=>{var f='<table class="table table-hover client-journal-accounts">',R=u.split("_");f+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${R[1]}
                        <span class="text-sm fw-bold float-right remove-audit-expense" id="${u}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(x.months,(A,I)=>{f+=`
                    <tr>
                        <td class='text-left'>${I.expenseMonthName}</td>
                        <td class='text-left'>${I.value}</td>
                    </tr>
                `}),f+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,f+="</table>",$("#saved-audited-expense-months").append(f)})}),$(document).on("click",".remove-audited-asset",function(p){p.preventDefault(),$(this).closest("tr").remove();for(let u in t)t[u].accounts&&(t[u].accounts=t[u].accounts.filter(x=>x.assetAccount!==$(this).attr("id"))),t[u].accounts.length===0&&delete t[u]}),$(document).on("click",".remove-audit-liability",function(p){p.preventDefault(),$(this).closest("tr").remove();for(let u in r)r[u].accounts&&(r[u].accounts=r[u].accounts.filter(x=>x.liabilityAccount!==$(this).attr("id"))),r[u].accounts.length===0&&delete r[u]}),$(document).on("click",".remove-audit-oe",function(p){p.preventDefault(),$(this).closest("tr").remove();for(let u in d)d[u].accounts&&(d[u].accounts=d[u].accounts.filter(x=>x.oeAccount!==$(this).attr("id"))),d[u].accounts.length===0&&delete d[u]});var v=0,C=0,T=0,N=0,M=0,V=0,F=0,g=0,S=0,y=0,w=0;console.log(e),$(".audit-next-btn").on("click",function(){if(s===1){if($("#append-audit-expenses-choy").empty(),$(".revenue-audit-income-total").empty(),Object.keys(n).length===0){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var p='<div class="col-sm-12 ml-3 text-dark" id="append-audit-expenses-choy">',u=0;$.each(n,(_,b)=>{p+='<div class="row mb-2">';const E=_.includes("_")?_.split("_")[1]:_;p+=`<div class="col-6 revenue-audit-accounts">${E}</div>`,console.log(_),$.each(b.months,(q,z)=>{var B=z.value.replace(/,/g,""),X=parseFloat(B);v+=X,u+=X}),p+=`<div class="col-6 text-right revenue-audit-amount">${u.toLocaleString()}</div>`,p+="</div>"}),p+="</div>",$("#append-audit-expenses-choy").html(p),$(".revenue-audit-income-total").text(v.toLocaleString())}if(s===2){if($(".append-audit-oe").empty(),$(".append-audit-ldc").empty(),Object.keys(e).length===0){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var x=!1,f=!1;if($.each(e,(_,b)=>{var E=_.split("_"),q=E[2];q==="Less Direct Cost"?x=!0:q==="Operating Expenses"&&(f=!0)}),!x||!f){H.fire({icon:"warning",title:"Missing Data",text:'Both "Less Direct Cost" and "Operating Expenses" entries are required.'});return}M=0,$.each(e,(_,b)=>{var E=_.split("_")[1];if(_.split("_")[2]==="Less Direct Cost"){var q="";$.each(b.months,(B,X)=>{var ne=X.value.replace(/,/g,""),ae=parseFloat(ne);T+=ae,q+=`
                        <div class="row">
                            <div class="col-sm-6 text-left">${E}</div>
                            <div class="col-sm-6 text-right">${ae.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</div>
                        </div>
                        `}),$(".append-audit-ldc").append(q)}if(_.split("_")[2]==="Operating Expenses"){var z="";$.each(b.months,(B,X)=>{var ne=X.value.replace(/,/g,""),ae=parseFloat(ne);M+=ae,z+=`
                        <div class="row">
                            <div class="col-sm-6 text-left">${E}</div>
                            <div class="col-sm-6 text-right">${ae.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</div>
                        </div>
                        `}),$(".append-audit-oe").append(z)}}),N=v-T,C=N-M,$(".expenses-ldc-audit-total").text(T.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".gries-audit-total").text(N.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".tgi-audit").text(N.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".oe-audit-total").text(M.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".net-audit-amount").text(C.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))}if(s===3){if($(".append-ca-audit").empty(),$(".append-audit-nca").empty(),$(".append-audit-fa").empty(),!Object.keys(t).some(b=>t[b].accounts&&t[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var R="",A="",I="";$.each(t,(b,E)=>{b==="Current Asset"&&$.each(E.accounts,(q,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);F+=X,R+=`
                                <div class="row">
                                    <span class="col-sm-6 text-sm text-left">${z.assetAccount}</span>
                                    <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                                </div>
                            `}),b==="Non-Current Assets"&&$.each(E.accounts,(q,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);V+=X,A+=`
                            <div class="row">
                                <span class="col-sm-6 text-sm text-left">${z.assetAccount}</span>
                                <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                            </div>
                        `}),b==="Fixed Assets"&&$.each(E.accounts,(q,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);g+=X,I+=`
                        <div class="row">
                            <span class="col-sm-6 text-sm text-left">${z.assetAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `}),$(".append-ca-audit").html(R),$(".append-audit-nca").html(A),$(".append-audit-fa").html(I),$(".tnca-audit-amount").text(V.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".total-audit-ca").text(F.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),S=F+V+g,$(".total-audit-assets").text(S.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))})}if(s===4){if(y=0,$(".append-audit-cl").empty(),!Object.keys(r).some(b=>r[b].accounts&&r[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var U="";$.each(r,(b,E)=>{$.each(E.accounts,(q,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);y+=X,U+=`
                        <div class="row">
                            <span class="col-sm-6 text-sm text-left">${z.liabilityAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `})}),$(".append-audit-cl").html(U)}if(s===5){w=0,$(".append-audit-oenw").empty();var k="";if(!Object.keys(d).some(b=>d[b].accounts&&d[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}$.each(d,(b,E)=>{$.each(E.accounts,(q,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);w+=X,k+=`<div class="row">
                            <span class="col-sm-6 text-sm text-left">${z.oeAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `})}),$(".append-audit-oenw").html(k)}if(s===6){var j=$(".journal-audit-adjustments-form").serializeArray(),W=!0;if($.each(j,(_,b)=>{if(b.value===""){W=!1,$(`[name='${b.name}']`).addClass("is-invalid");return}m[b.name]=b.value,$(`[name='${b.name}']`).removeClass("is-invalid")}),!W){H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}var J=0,Q=0;$.each(m,(_,b)=>{if(_==="audit-owners_contribution"){var E=b.replace(/,/g,""),q=parseFloat(E);J+=q}if(_==="audit-owners_withdrawal"){var E=b.replace(/,/g,""),q=parseFloat(E);Q+=q}});var G=Q+C;$(".additional-audit-capital").text(J.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".audit-less-drawings").text(Q.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".fp-audit-nc").text(C.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".appraisal-audit-capital").text(G.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));var L=G-parseFloat($(".audit-less-drawings").text().replace(/[^0-9.-]+/g,""));$(".audit-capital-end").text(L.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));var K=y+w;$(".tlc-audit").text(K.toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}))}s<7&&($(".multi-step-journal-audit").hide(),s++,O(s)),D(s),s===7?($(".audit-next-btn").hide(),$(".audit-save-btn").show()):($(".audit-next-btn").show(),$(".audit-save-btn").hide()),s===1?$(".audit-prev-btn").hide():$(".audit-prev-btn").show()}),$(".audit-prev-btn").on("click",function(){s>1&&($(".multi-step-journal-audit").hide(),s--,O(s)),D(s),$(".audit-next-btn").show(),$(".audit-save-btn").hide(),s===1?$(".audit-prev-btn").hide():$(".audit-prev-btn").show()});function O(p){$(".multi-step-journal-audit").hide(),$(".multi-step-journal-audit").eq(p-1).show()}function D(p){$(".audit-step").removeClass("active"),$(".audit-indicator-line").removeClass("active"),$(".audit-step").each(function(u){u<p&&($(this).addClass("active"),$(this).next(".audit-indicator-line").addClass("active"))})}O(s),D(s),s===1&&$(".audit-prev-btn").hide(),$(".save-audit-journal-btn").on("click",function(){$(".audit-client-journal-loader").removeClass("visually-hidden");var p={incomeObj:n,expenseObj:e,assetObj:t,liabilityObj:r,oeObj:d,adjustmentObj:m,references:$(this).attr("id")};$.ajax({type:"POST",url:"client/journal/audit",data:p,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(u){$(".audit-client-journal-loader").addClass("visually-hidden"),localStorage.setItem("journal","updated"),window.location.href="clients"},error:function(u,x,f){$(".audit-client-journal-loader").addClass("visually-hidden"),oe.fire({icon:"error",title:"Something went wrong",text:`Translated: ${u} 
 if issue persist try reloading the page or contact developer`})}})});var P=localStorage.getItem("journal");P==="updated"&&(H.fire({icon:"success",title:"Journal Update",text:"Journal Updated Successfully"}),localStorage.removeItem("journal"))});var te=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){var s="";$(".add-new-service-req").on("click",function(l){console.log($(this).attr("id"));var o=$(this).attr("id").split("_"),c=o[1],n=$(`.service-req-${o[1]}`).serializeArray(),e=!0;$.each(n,(t,r)=>{if(r.value===""){te.fire({icon:"warning",title:"Missing Entry!",text:"Please Enter Requirement Name"}),e=!1,$('[name="req-name"]').addClass("is-invalid");return}$('[name="req-name"]').removeClass("is-invalid")}),e&&$.ajax({type:"POST",url:"service/requirement/",data:{form:n,idref:c},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){console.log(t),localStorage.setItem("req","added"),location.reload()},error:function(t,r,d){te.fire({icon:"error",title:"Oops! Something Went wrong",text:"Translated: "+t})}})}),$(".add-new-sub-service-req").on("click",function(l){var o=$("#sub_service_id").val(),c=$("#sub-service-req-id").val();if((o===""||c==="")&&te.fire({icon:"warning",title:"Missing Entry!",text:"Please Enter Requirement Name"}),c===""){$("#sub-service-req-id").addClass("is-invalid");return}else $("#sub-service-req-id").removeClass("is-invalid"),$.ajax({type:"POST",url:"sub-service-requirement",data:{reqName:c,idRef:o},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){console.log(n),localStorage.setItem("req","added"),location.reload()},error:function(n,e,t){te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+n})}})}),$(".get-client-service-req").on("click",function(){s="",$(".append-service-req").empty(),console.log($(this).attr("id"));let l=$(this).attr("id");$(".service-reqs-loader").removeClass("visually-hidden");var o="";$.ajax({type:"POST",url:`client/service/requirements/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(c){s=c.category,console.log(c),console.log("this"),$(".service-reqs-loader").addClass("visually-hidden"),$.each(c.serviceReqs,(n,e)=>{let t="";e.gcon?t=`<td>${e.gcon}</td>`:t=`
                        <td><input type="file" class="req-file" id="${e.id}_${l}" data-id="${e.req_name}_${e.id}" name="${e.req_name}_${e.id}"></td>
                    `,o+=`
                        <tr>
                            <td>${e.req_name}</td>
                            ${t}
                        </tr>
                    `}),$(".append-service-req").append(o)},error:function(c,n,e){$(".service-reqs-loader").addClass("visually-hidden"),te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+c})}})}),$(".save-req-files").on("click",function(){let l=[],o=!1,c=new FormData;const n=$(this).attr("id");if($(".req-file").each(function(){if(this.files.length){o=!0;const e=$(this).attr("id"),t=s,r=this.files[0];l.push({service_id:n,sub_service_req_id:e,category:t,file:r.name}),c.append(`files[${e}]`,r)}}),!o){te.fire({icon:"error",title:"Please upload at least one file."});return}c.append("metadata",JSON.stringify(l)),$.ajax({type:"POST",url:"/service/requirement/document",data:c,processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){console.log(e),localStorage.setItem("req-docs","added"),location.reload()},error:function(e,t,r){te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+e})}})}),$(".view-client-service-doc").on("click",function(){$(".service-docs-loader").removeClass("visually-hidden"),console.log($(this).attr("id")),$(".append-service-req").empty();let l="";$.ajax({type:"POST",url:`/service/requirement/documents/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(o){$(".service-docs-loader").addClass("visually-hidden"),console.log(o),$.each(o.docsData,(c,n)=>{console.log(n);let e="";n.grp&&n.grp.trim()!==""&&(e=`
                            <a href="storage/${n.grp}" 
                               download="${n.gcon}" 
                               class="badge bg-warning text-dark" 
                               style="font-size: 10px;">
                                <i class="fas fa-cloud-download-alt"></i> Download
                            </a>
                        `),l+=`
                        <tr>
                            <td>${n.req_name}</td>
                            <td>${n.gcon||"No file name"}</td>
                            <td>${n.gcmt}</td>
                            <td>${e}</td>
                        </tr>
                    `}),$(".append-service-docs").html(l)},error:function(o,c,n){$(".service-docs-loader").addClass("visually-hidden"),te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+o})}})});var a=localStorage.getItem("req-docs"),i=localStorage.getItem("req");i==="added"&&(te.fire({icon:"success",title:"Service Requirement",text:"New requirement added"}),localStorage.removeItem("req")),a==="added"&&(te.fire({icon:"success",title:"Service Requirement",text:"New requirement document is added"}),localStorage.removeItem("req-docs"))});$(document).ready(function(){Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});var s=Swal.mixin({toast:!1,position:"bottom-end"});$(".expense-quarter").change(function(){var a=$(this).val();if(!a||!["Q1","Q2","Q3","Q4"].includes(a)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`quarterly-expense-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){var l=i[a];if(l){let o=[],c=[];$.each(l.details,function(n,e){o.push(n),c.push(e.total)}),expenseChart.data.labels=o,expenseChart.data.datasets[0].data=c,expenseChart.update()}else console.error("No data found for quarter: "+a)},error:function(i,l,o){s.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+i})}})}),$(".income-quarter").change(function(){var a=$(this).val();if(!a||!["Q1","Q2","Q3","Q4"].includes(a)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`quarterly-income-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){var l=i[a];if(l){let o=[],c=[];$.each(l.details,function(n,e){o.push(n),c.push(e.total)}),lineChart.data.labels=o,lineChart.data.datasets[0].data=c,lineChart.update()}else console.error("No data found for quarter: "+a)},error:function(i,l,o){s.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+i})}})}),$(".sales-quarter").change(function(){var a=$(this).val();if(!a||!["Q1","Q2","Q3","Q4"].includes(a)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`quarterly-sales-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){var l=i[a];if(l){let o=[],c=[];$.each(l.details,function(n,e){o.push(n),c.push(e.total)}),salesChart.data.labels=o,salesChart.data.datasets[0].data=c,salesChart.update()}else console.error("No data found for quarter: "+a)},error:function(i,l,o){s.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+i})}})}),$(".client-quarter").change(function(){var a=$(this).val();if(!a||!["Q1","Q2","Q3","Q4"].includes(a)){console.error("Invalid quarter selected.");return}$.ajax({method:"POST",url:`/quarterly-client-${a}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){var l=i[a];if(l){let o=l.months,c=[];for(let n of o)c.push(l.details[n]?l.details[n].total:0);clientsChart.data.labels=o,clientsChart.data.datasets[0].data=c,clientsChart.update()}else console.error("No data found for quarter: "+a)},error:function(i){s.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+i})}})}),$("#yearInput").change(function(){var a=$(this).val();if(!a||isNaN(a)){console.error("Invalid year entered.");return}$.ajax({method:"POST",url:"filter-by-year-income",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{year:a},success:function(i){console.log("Year Data:",i);let l=Object.keys(i),o=Object.values(i);lineChart.data.labels=l,lineChart.data.datasets[0].data=o,lineChart.update()},error:function(i){console.error("AJAX Error:",i.responseText)}})}),$("#yearInputExpense").change(function(){var a=$(this).val();if(!a||isNaN(a)){console.error("Invalid year entered.");return}$.ajax({method:"POST",url:"filter-by-year-expense",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{year:a},success:function(i){console.log("Year Data:",i);let l=Object.keys(i),o=Object.values(i);expenseChart.data.labels=l,expenseChart.data.datasets[0].data=o,expenseChart.update()},error:function(i){console.error("AJAX Error:",i.responseText)}})}),$("#yearInputClient").change(function(){var a=$(this).val();if(!a||isNaN(a)){console.error("Invalid year entered.");return}$.ajax({method:"POST",url:"filter-by-year-client",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{year:a},success:function(i){console.log("Year Data:",i);let l=Object.keys(i),o=Object.values(i);clientsChart.data.labels=l,clientsChart.data.datasets[0].data=o,clientsChart.update()},error:function(i){console.error("AJAX Error:",i.responseText)}})}),$("#yearlySales").change(function(){var a=$(this).val();if(!a||isNaN(a)){console.error("Invalid year entered.");return}$.ajax({method:"POST",url:"yearly-sales",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{year:a},success:function(i){console.log("success");var l=i.details;if(l){let o=[],c=[];$.each(l,function(n,e){o.push(n),c.push(e.total)}),salesChart.data.labels=o,salesChart.data.datasets[0].data=c,salesChart.update()}else console.error("No data found for year: "+a)},error:function(i,l,o){s.fire({icon:"error",title:"Fatal Error",text:"Oops! Something went wrong: "+i.responseText})}})})});$(document).ready(function(){window.formatValueInput=function(s){var a=s.value.replace(/[^0-9\.]/g,""),i=a.split(".");i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),i.length>1?s.value=i[0]+"."+i[1]:s.value=i[0]},window.previewImage=function(s,a){const l=s.target.files[0];if(l){const o=new FileReader;o.onload=function(c){const n=document.getElementById(a);n?n.src=c.target.result:console.error(`Preview element with ID ${a} not found.`)},o.readAsDataURL(l)}else console.warn("No file selected.")}});
