function pe(n,r,c,u){$.ajax({url:n,type:"POST",data:r,success:function(o){c(o)},error:function(o,l,i){u(o,l,i)}})}function $e(n,r,c,u){$.ajax({url:n,type:"POST",headers:r,success:function(o){c(o)},error:function(o,l,i){u(o,l,i)}})}function he(n,r,c,u,o,l){$.ajax({url:n,type:"POST",data:{...r,id:c},headers:u,success:function(i){o(i)},error:function(i,e,t){l(i,e,t)}}),console.log(r),console.log(c)}function ge(n,r,c,u,o){$.ajax({url:n,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,i,e){o(l,i,e)}})}function xe(n,r,c,u,o,l){var i=new FormData;for(var e in r)r.hasOwnProperty(e)&&i.append(e,r[e]);c&&i.append("profile",c),$.ajax({url:n,type:"POST",data:i,headers:u,processData:!1,contentType:!1,success:function(t){o(t)},error:function(t,a,s){l(t,a,s)}})}function be(n,r,c,u){$.ajax({url:n,type:"POST",headers:r,success:function(o){c(o)},error:function(o,l,i){u(o,l,i)}})}function ye(n,r,c,u,o){$.ajax({url:n,type:"POST",data:r,headers:c,processData:!1,contentType:!1,success:function(l){u(l)},error:function(l,i,e){o(l,i,e)}})}function Se(n,r,c,u,o){$.ajax({url:n,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,i,e){o(l,i,e)}})}function we(n,r,c,u,o){$.ajax({url:n,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,i,e){o(l,i,e)}})}function Ce(n,r,c,u,o){$.ajax({url:n,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,i,e){o(l,i,e)}})}function Fe(n,r,c,u,o){$.ajax({url:n,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,i,e){o(l,i,e)}})}function je(n,r,c,u,o){$.ajax({url:n,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,i,e){o(l,i,e)}})}function Te(n,r,c,u,o){$.ajax({url:n,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,i,e){o(l,i,e)}})}function Ae(n,r,c,u,o){$.ajax({url:n,type:"POST",data:r,headers:c,success:function(l){u(l)},error:function(l,i,e){o(l,i,e)}})}var ee=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),Z=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".search-coa").on("keyup",function(){var e=$(this).val().toLowerCase();$("#coa-table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(e)>-1)})}),$("#filter-coa").on("change",function(){var e=$(this).val();$(".coa-table tbody tr").each(function(){var t=$(this).data("category");e==="clear"?$(this).show():e===""||t===e?$(this).show():$(this).hide()})}),$(".client-table-data").hover(function(){$(this).find(".action-icons").removeClass("visually-hidden")},function(){$(this).find(".action-icons").addClass("visually-hidden")}),$(".new-sub-service-icon").on("click",function(e){e.stopPropagation()}),$(".edit-service-icon").on("click",function(e){e.stopPropagation()}),$(".view-service-details").on("click",function(e){e.stopPropagation()}),$(".remove-service-icon").on("click",function(e){e.stopPropagation()});function n(e){localStorage.setItem("transaction-status",e),location.reload()}$(".client-sub-table").on("click",function(){console.log($(this).attr("id")),$(this).closest("tr").next(".expandable-body").find(".loader-td")}),$(".external-service").on("click",function(){var e=$(this).next(".expandable-body").find(".loader");e.removeClass("visually-hidden");var t=$(this).attr("id");$.ajax({type:"POST",url:`sub-services-${t}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){e.addClass("visually-hidden");var s=a.services,m='<table class="table table-hover float-left append-sub-services">';m+=`
                <thead class="text-left">
                    <tr>
                        <td>Requirements</td>
                        <td>Price</td>
                    </tr>
                </thead> 
                `,$.each(s,(h,f)=>{var C=parseFloat(f.ServiceRequirementPrice).toFixed(2).toLocaleString(),A=Number(C).toLocaleString();m+=`
                    <tbody class="text-left">
                        <tr class='sub-service' id='${f.id}'>
                            <td>${f.ServiceRequirements}</td>
                            <td>${A}
                            <span id='${f.id}' class="badge mx-2 bg-warning float-right text-sm sub-service-action-icons-remove" data-bs-target='#remove-sub-service' data-bs-toggle='modal' >
                                <i class="fas fa-trash" style="font-size: .8em;"></i>
                            </span>
                            <span id='${f.id}' data-bs-target='#edit-sub-service-modal' data-bs-toggle='modal' class="badge bg-warning float-right text-sm sub-service-action-icons-edit">
                                <i class="fas fa-pen" style="font-size: .8em;"></i>
                            </span>
                            <span id='${f.id}' data-bs-target='#add-sub-service-req' data-bs-toggle='modal' class="mx-2 badge bg-warning float-right text-sm sub-service-action-icons-req">
                                <i class="fas fa-file" style="font-size: .8em;"></i>
                            </span>
                            </td>
                        </tr>
                    </tbody>                    
                    `}),m+="</table>",$(`.append-sub-services-${t}`).html(m)},error:function(a,s,m){Z.fire({icon:"error",title:"Fatal Error",text:a})}})}),$(document).on("click",".sub-service-action-icons-req",function(){var e=$(this).attr("id");$.ajax({type:"POST",url:`retrieve-sub-service-data-${e}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){console.log(t.sub_service),$("#sub_service_id").attr("id",t.sub_service.id),$("#sub_service_id").val(t.sub_service.id),$(".sub-service-req-service-name").text(t.sub_service.ServiceRequirements)},error:function(t,a,s){Z.fire({icon:"error",title:"Something went wrong",text:`Translated: ${t}`})}})}),$(document).on("click",".sub-service-action-icons-edit",function(e){$(".sub-service-loader").removeClass("visually-hidden");var t=$(this).attr("id");$.ajax({type:"POST",url:`retrieve-sub-service-data-${t}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){$(".sub-service-loader").addClass("visually-hidden"),console.log(a.sub_service.ServiceRequirementPrice),$("#service-edit-field").val(a.sub_service.ServiceRequirements),$("#serviceprice-edit-field").val(a.sub_service.ServiceRequirementPrice),$("#sub-service-edit-id").val(a.sub_service.id)},error:function(a,s,m){Z.fire({icon:"error",title:"Something went wrong",text:`Translated: ${a}`})}})}),$(document).on("click",".sub-service-action-icons-remove",function(e){e.preventDefault();var t=$(this).attr("id"),a=$(this).closest("tr").find("td:eq(0)").text().trim();console.log(a),$(".sub-service-app").text(a),$(".remove-sub-service").attr("id",t)}),$(document).on("click",".remove-sub-service",function(){$.ajax({type:"POST",url:`remove-sub-service/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){localStorage.setItem("sub-service","removed"),location.reload()},error:function(e,t,a){Z.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+e})}})}),$("#edit-sub-service").on("click",function(e){e.preventDefault();var t=$("#edit-sub-service-form").serializeArray(),a=!0,s={};if($.each(t,(f,C)=>{C.value===""?(a=!1,$(`[name='${C.name}']`).addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"})):($(`[name='${C.name}']`).removeClass("is-invalid"),s[C.name]=C.value)}),a){let f=function(A){console.log(A),localStorage.setItem("sub_service","updated"),location.reload()},C=function(A,E,M){var Y=JSON.parse(A.responseText),F=Y.error;if(F==="Service already exists"){$(".conflict-warning").removeClass("visually-hidden"),$("#new-service-form [name='Service']").addClass("is-invalid"),$(".conflict-text").text("Service already exists");return}else Z.fire({icon:"error",title:"Fatal Error",text:`Translated: ${F}`}),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid")};var m=f,h=C;je("edit-sub-service",s,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},f,C)}}),$("#new-service-form").on("submit",function(e){e.preventDefault(),$(".conflict-text").text("Service already exists"),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid");var t={},a=$(this).serializeArray(),s=!1;if($.each(a,(f,C)=>{if(C.value==="")return $(`#new-service-form [name='${C.name}']`).addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),s=!0,!1;t[C.name]=C.value}),s)return;pe("new-service",t,m,h);function m(f){n("created")}function h(f,C,A){var E=JSON.parse(f.responseText),M=E.error;if(M==="Service already exists"){$(".conflict-warning").removeClass("visually-hidden"),$("#new-service-form [name='Service']").addClass("is-invalid"),$(".conflict-text").text("Service already exists");return}else Z.fire({icon:"error",title:"Fatal Error",text:`Translated: ${M}`}),$(".conflict-warning").addClass("visually-hidden"),$("#new-service-form [name='Service']").removeClass("is-invalid")}}),$(".remove-service").on("click",function(){$e(`remove-service-${$(this).attr("id")}`,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t);function e(a){n("removed")}function t(a,s,m){Z.fire({icon:"error",title:"Fatal Error",text:a})}}),$(".edit-service").on("click",function(e){e.preventDefault();var t=$(this).attr("id"),a="#edit-service-form-"+t,s=$(a).serializeArray();console.log(s);var m={},h=!1;if($.each(s,(A,E)=>{if(E.value==="")return $(a+" [name='"+E.name+"']").addClass("is-invalid"),ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),h=!0,!1;m[E.name]=E.value}),h)return;he("update-service",m,t,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},f,C);function f(A){n("updated")}function C(A,E,M){var Y=JSON.parse(A.responseText),F=Y.error;Z.fire({icon:"error",title:"Fatal Error",text:`Translated: ${F}`})}}),$(".submit-new-sub-service").on("click",function(e){e.preventDefault();var t=!0,a={},s=$(this).attr("id"),m=$(`#new-sub-service-${s}`).serializeArray();if(console.log(m),$.each(m,(C,A)=>{A.value===""?($(`[name='${A.name}']`).addClass("is-invalid"),t=!1):(a[A.name]=A.value,$(`[name='${A.name}']`).removeClass("is-invalid"))}),!t){ee.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}ge("new-sub-service",a,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},h,f);function h(C){console.log(C),localStorage.setItem("sub_service","created"),location.reload()}function f(C,A,E){console.log(C),C.responseJSON&&C.responseJSON.message?(Z.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${C.responseJSON.message}`}),console.log(C.responseJSON.errors)):Z.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${C.responseJSON.error}`})}});var r={},c=document.getElementById("fileInput");$(".next-form").on("click",function(){var e=$(".multi-step:visible"),t=e.serializeArray(),a=!1,s=!1;if(e.find(".form-control").removeClass("is-invalid"),$.each(t,(E,M)=>{M.value===""&&($(`[name='${M.name}']`).addClass("is-invalid"),a=!0),r[M.name]=M.value}),e.hasClass("client-profile")&&(!c.files||c.files.length===0?($("#fileInput").addClass("is-invalid"),s=!0):$("#fileInput").removeClass("is-invalid")),a)ee.fire({icon:"warning",title:"Missing Fields",text:"Fill all fields to proceed"});else if(s)ee.fire({icon:"warning",title:"Missing File",text:"Please upload a profile picture before proceeding."});else{var m=e.next(".multi-step");if(m.hasClass("data-entry-preview")){$(".companyName").text($("[name='CompanyName']").val()),$(".companyEmail").text($("[name='CompanyEmail']").val()),$(".companyAddress").text($("[name='CompanyAddress']").val()),$(".companyCEO").text($("[name='CEO']").val()),$(".companyCEODob").text($("[name='CEODateOfBirth']").val()),$(".companyCEOContact").text($("[name='CEOContactInformation']").val()),$(".representativeName").text($("[name='RepresentativeName']").val()),$(".representativeContact").text($("[name='RepresentativeContactInformation']").val()),$(".representativeDob").text($("[name='RepresentativeDateOfBirth']").val()),$(".representativePosition").text($("[name='RepresentativePosition']").val()),$(".representativeAddress").text($("[name='RepresentativeAddress']").val());var h=document.getElementById("fileInput");if(h.files&&h.files[0]){var f=new FileReader;f.onload=function(E){$("#previewImage").attr("src",E.target.result).show()},f.readAsDataURL(h.files[0])}}m.length&&e.fadeOut(300,function(){$(this).hide(),m.fadeIn(200,function(){$(this).show()})});var C=$(".client-step.active"),A=C.next(".client-form-indicator-line");A.addClass("active"),A.next(".client-step").addClass("active"),$(".previous-form").removeClass("visually-hidden"),e.next(".multi-step").next(".multi-step").length||($(".next-form").addClass("visually-hidden"),$(".save").removeClass("visually-hidden"))}}),$(".previous-form").on("click",function(){var e=$(".multi-step:visible"),t=e.prev(".multi-step");if(t.length){e.fadeOut(300,function(){$(this).hide(),t.fadeIn(300,function(){$(this).show()})});var a=$(".client-step.active"),s=a.prev(".client-form-indicator-line");a.removeClass("active"),s.prev(".client-step").addClass("active"),$(".next-form").removeClass("visually-hidden"),$(".save").addClass("visually-hidden"),t.prev(".multi-step").length||$(".previous-form").addClass("visually-hidden")}}),$(".save").on("click",function(){new FormData,console.log(r),xe("new-client-record",r,fileInput.files[0],{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},function(t){console.log("Success:",t),n("created"),window.location.href="clients"},function(t,a,s){t.responseJSON&&t.responseJSON.message&&(Z.fire({icon:"warning",title:"Oops Something went wrong!",text:`Translated: ${t.responseJSON.message}`}),console.log(t.responseJSON.errors))})}),$("#fileInput").on("change",function(e){var t=this.files[0];if(t){var a=new FileReader;a.onload=function(s){$("#imagePreview").attr("src",s.target.result).show(),console.log(s.target.result)},a.readAsDataURL(t)}else $("#imagePreview").attr("src","#").hide()}),$(".pdf-services").on("click",function(e){e.preventDefault();var t=$(this).data("url");window.open(t,"services/pdf")});var u=localStorage.getItem("activeNavItem");u&&$('.nav-item a[href="'+u+'"]').addClass("active"),$(".nav-item a").on("click",function(){$(".nav-item a").removeClass("active"),$(this).addClass("active"),localStorage.setItem("activeNavItem",$(this).attr("href"))});const o=localStorage.getItem("transaction-status");if(o){localStorage.removeItem("transaction-status");const e={created:{icon:"success",title:"New Record",text:"New record added successfully"},removed:{icon:"success",title:"Record Removed!",text:"Record removed successfully"},updated:{icon:"success",title:"Record Updated!",text:"Record updated successfully"}};e[o]&&ee.fire(e[o])}var l=localStorage.getItem("sub_service"),i=localStorage.getItem("sub-service");l==="created"&&(ee.fire({icon:"success",title:"New Requirement added"}),localStorage.removeItem("sub_service")),l==="updated"&&(ee.fire({icon:"success",title:"Service Updated!"}),localStorage.removeItem("sub_service")),i==="removed"&&(ee.fire({icon:"success",title:"Service Removed!"}),localStorage.removeItem("sub-service"))});var Oe=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),fe=Swal.mixin({toast:!1,position:"bottom-end"}),se=0,re=0,V=[];$(document).ready(function(){$(".services").on("change",function(){var i=$(this).attr("id"),e=$(this).val().split("_"),t=e[0],a=$(this).val(),s=parseFloat(e[1]);V=[],$(".sub-services-append").html(""),$(".service-input").html(""),$(".sub-services").find(".loader").removeClass("visually-hidden"),$(".services-total").show(),re=s,se=1,u(t,s),c(),be(`fetch-sub-services-${i}`,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},n,r),V.push({serviceName:a,servicePrice:s,serviceFile:null}),console.log(V)});function n(i){$(".sub-services").find(".loader").addClass("visually-hidden"),$.each(i.subServices,(e,t)=>{t!=="id"&&$(".sub-services-append").append(`<li>
                    <input class='sub-service-item' type='checkbox' name='SubService' id='${t.id}' 
                    value='${t.ServiceRequirements}_${t.ServiceRequirementPrice}_subservice_${t.id}' 
                    style='font-size: 5px;'>${t.ServiceRequirements}
                </li>`)})}function r(i,e,t){console.log(i),fe.fire({icon:"error",title:"Fatal Error",text:`Translated: ${i}`})}$(document).on("click",".sub-service-item",function(){var i=$(this).val().split("_"),e=$(this).val(),t=$(this).attr("id"),a=i[0],s=parseFloat(i[1]);if($(this).is(":checked"))$(".client-service-input").append(`<tr id='row-${t}'>
                    <td>${a}</td>
                    <td>${s.toLocaleString()}</td>
                </tr>`),re+=s,se++,V.push({serviceName:e,servicePrice:s,serviceFile:null});else{const m=V.findIndex(h=>h.serviceName===e);console.log(e,"unchecked"),$(`#row-${t}`).remove(),re-=s,se--,m!==-1&&V.splice(m,1)}console.log(V),c()});function c(){$(".totalAmount").text(`Total Amount: ${re.toLocaleString()}`),$(".totalServices").text(`Total Services: ${se}`)}function u(i,e,t){const a=i.replace(/\s+/g,"_");$(".service-input").append(`
            <div class="row">
                <div class="col-sm-12">
                    <div class="row">
                        <table style='font-size: 10px;' class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <td>Service</td>
                                    <td>Amount</td>
                                </tr>
                            </thead>
                            <tbody class='client-service-input'>
                                <tr>
                                    <td>${i}</td>
                                    <td>${e.toLocaleString()}</td>
                                    <td><span class="badge fw-bold text-light bg-danger rounded-1 remove-parent-service" id=${a}><i class="fas fa-trash"></i></span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `)}$(document).on("change",".clientDocument",function(){var i=$(this),e=i.closest("tr"),t=e.find("td").first().text(),a=Array.from(i[0].files);V=V.map(s=>s.serviceName===t?{...s,serviceFile:a.length>0?a[0]:null}:s)}),$(document).on("click",".remove-parent-service",function(){var i=$(this).attr("id"),e=i.replace(/_/g," "),t=V.findIndex(a=>a.serviceName==e);t>-1&&V.splice(t,1),$(this).closest("tr").remove(),console.log(V)});function o(){$(".add-client-service-loader").removeClass("visually-hidden");var i=$(".hidden-client-id").attr("id"),e=new FormData;e.append("client_id",i),V.forEach((s,m)=>{e.append(`services[${m}][serviceName]`,s.serviceName),e.append(`services[${m}][servicePrice]`,s.servicePrice),s.serviceFile&&e.append(`services[${m}][serviceFile]`,s.serviceFile)});for(const[s,m]of e.entries())console.log(s,m);ye(`client-services-${i}`,e,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},t,a);function t(s){$(".add-client-service-loader").addClass("visually-hidden"),console.log(s),window.location.href="clients",localStorage.setItem("services",!0)}function a(s,m,h){$(".add-client-service-loader").addClass("visually-hidden");try{const f=JSON.parse(s.responseText);console.log("Parsed Response:",f),fe.fire({icon:"warning",title:"Conflict",text:f.Conflict})}catch(f){console.log("Could not parse JSON response:",f)}}}$(".submit-services").on("click",function(){o()});var l=localStorage.getItem("services");l&&(Oe.fire({icon:"success",title:"Services Added to Client"}),localStorage.removeItem("services"))});$(document).ready(function(){let n=1;var r=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),c=Swal.mixin({toast:!1,position:"bottom-end"});let u="",o={},l="",i={},e={},t={},a={},s={};$("#expense-category").on("change",function(){u=$("#expense-category").val(),$(".expense-form").removeClass("visually-hidden"),$(".months-container").empty(),$(".save-expense").addClass("visually-hidden")}),$(".start-date, .end-date").on("change",function(){const F=$(".start-date").val(),g=$(".end-date").val();if($("#expense-category").val()===""){r.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(F&&g){const y=new Date(F),w=new Date(g),T=$(".months-container");var S='<div class="row">';if((w.getFullYear()-y.getFullYear())*12+(w.getMonth()-y.getMonth())>12){c.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const N=new Date(y);if(N.setMonth(N.getMonth()+11),w>N){c.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}T.empty(),S+="";let p=new Date(y);for(;p<=w;){const d=p.toLocaleString("default",{month:"long",year:"numeric"});S+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control month-input" name="${d}" id="" placeholder='${d}' value="">
                    </div>
                    </div>`,p.setMonth(p.getMonth()+1)}S+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-months form-control">Save</button>
            </div>`,S+="</div>",T.html(S)}$(".months-container").on("input",".month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-months",function(F){F.preventDefault();let g=[],S=!0;if(o.hasOwnProperty(u))return r.fire({icon:"warning",title:"Account Already Added",text:"You have already added this account."}),$(".end-date").val(""),$(".start-date").val(""),$(".months-container").empty(),!1;if($(".month-input").each(function(){var y=$(this).attr("name"),w=$(this).val();w!==""&&(S=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),g.push({monthName:y,value:$(this).val(),account:u,startDate:$(".start-date").val(),endDate:$(".end-date").val()}))}),S){$(".month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),r.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}o[u]={months:g,startDate:$(".start-date").val(),endDate:$(".end-date").val()},$("#saved-months").empty(),$.each(o,(y,w)=>{var T='<table class="table table-hover client-journal-accounts">',D=y.split("_");T+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${D[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${y}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(w.months,(N,p)=>{T+=`
                    <tr>
                        <td class='text-left'>${p.monthName}</td>
                        <td class='text-left'>${p.value}</td>
                    </tr>
                `}),T+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,T+="</table>",$("#saved-months").append(T)}),$(".months-container").empty(),$("#expense-category").val(""),$(".end-date").val(""),$(".start-date").val(""),u="",S=!0,console.log(o)}),$(document).on("click",".remove-saved-account",function(F){const g=$(this).attr("id");delete o[g],$("#saved-months").empty(),$.each(o,(S,y)=>{var w='<table class="table table-hover client-journal-accounts">',T=S.split("_");w+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${T[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${S}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(y.months,(D,N)=>{w+=`
                    <tr>
                        <td>${N.monthName}</td>
                        <td>${N.value}</td>
                    </tr>
                `}),w+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,w+="</table>",$("#saved-months").append(w)}),console.log(o)}),$("#income-category").on("change",function(){$(".income-form").removeClass("visually-hidden"),l=$("#income-category").val(),$(".income-months-container").empty()}),$(".income-start-date, .income-end-date").on("change",function(){const F=$(".income-start-date").val(),g=$(".income-end-date").val();if($("#income-category").val()===""){r.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(F&&g){const y=new Date(F),w=new Date(g),T=$(".income-months-container");var S='<div class="row">';if((w.getFullYear()-y.getFullYear())*12+(w.getMonth()-y.getMonth())>12){c.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const N=new Date(y);if(N.setMonth(N.getMonth()+11),w>N){c.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}T.empty(),S+="";let p=new Date(y);for(;p<=w;){const d=p.toLocaleString("default",{month:"long",year:"numeric"});S+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control income-month-input" name="${d}" id="" placeholder='${d}' value="">
                    </div>
                    </div>`,p.setMonth(p.getMonth()+1)}S+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-expense-months form-control">Save</button>
            </div>`,S+="</div>",T.html(S)}$(".income-months-container").on("input",".income-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-expense-months",function(F){F.preventDefault();let g=[],S=!0;if(i.hasOwnProperty(l)){r.fire({icon:"warning",title:"Account Already Added",text:"You have already added this account."}),$(".income-end-date").val(""),$(".income-start-date").val(""),$(".income-months-container").empty();return}if($(".income-month-input").each(function(){var y=$(this).attr("name"),w=$(this).val();w!==""&&(S=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),g.push({incomeMonthName:y,value:$(this).val(),account:l,startDate:$(".income-start-date").val(),endDate:$(".income-end-date").val()}))}),S){$(".income-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),r.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}i[l]={months:g,startDate:$(".income-start-date").val(),endDate:$(".income-end-date").val()},console.log(i),$("#saved-income-months").empty(),$.each(i,(y,w)=>{var T='<table class="table table-hover client-journal-accounts">',D=y.split("_");T+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${D[1]}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${y}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(w.months,(N,p)=>{T+=`
                    <tr>
                        <td class='text-left'>${p.incomeMonthName}</td>
                        <td class='text-left'>${p.value}</td>
                    </tr>
                `}),T+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,T+="</table>",$("#saved-income-months").append(T)}),$(".income-months-container").empty(),$("#income-category").val(""),$(".income-end-date").val(""),$(".income-start-date").val(""),u="",S=!0}),$(document).on("click",".remove-saved-account",function(F){const g=$(this).attr("id");delete i[g],$("#saved-income-months").empty(),$.each(i,(S,y)=>{var w='<table class="table table-hover client-journal-accounts">',T=S.split("_");w+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${T[1]} - ${y.startDate} - ${y.endDate}
                        <span class="text-sm fw-bold float-right remove-saved-account" id="${S}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0 text-center">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(y.months,(D,N)=>{w+=`
                    <tr>
                        <td>${N.incomeMonthName}</td>
                        <td>${N.value}</td>
                    </tr>
                `}),w+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,w+="</table>",$("#saved-income-months").append(w)}),console.log(i)}),$(document).on("change","#asset_account",function(){let F=$(this).val();console.log(F),$.ajax({type:"POST",url:`get-accounts-${F}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(g){console.log(g);let S="";$.each(g,(y,w)=>{$.each(w,(T,D)=>{console.log(D),S+=`
                            <option value="${D.AccountName}_${D.id}">${D.AccountName}</option>
                        `})}),$("#asset_account_name").html(S)},error:function(g,S,y){console.error(g)}})}),$(document).on("change","#liability_account",function(){let F=$(this).val();$.ajax({type:"POST",url:`get-accounts-${F}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(g){let S="";$.each(g,(y,w)=>{$.each(w,(T,D)=>{S+=`
                            <option value="${D.AccountName}_${D.id}">${D.AccountName}</option>
                        `})}),$("#liability_account_name").html(S)},error:function(g,S,y){console.error(g)}})}),$(document).on("change","#oe_account",function(){let F=$(this).val();$.ajax({type:"POST",url:`get-accounts-${F}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(g){let S="";$.each(g,(y,w)=>{$.each(w,(T,D)=>{S+=`
                            <option value="${D.AccountName}_${D.id}">${D.AccountName}</option>
                        `})}),$("#oe_account_name").html(S)},error:function(g,S,y){console.error(g)}})}),$(".save-asset-info").on("click",function(F){F.preventDefault();var g=!1,S=$(".journal-asset-form").serializeArray(),y="",w="",T="";let D=!1;if($(".journal-asset-form input, .journal-asset-form select").removeClass("is-invalid"),$.each(S,function(p,d){d.value===""&&($(`.journal-asset-form [name='${d.name}']`).addClass("is-invalid"),g=!0),d.name==="assetType"?y=d.value:d.name==="assetAccount"?w=d.value:d.name==="assetAmount"&&(T=d.value)}),$.each(e,(p,d)=>{if($.each(d.accounts,(x,v)=>{if(v.assetAccount===w)return D=!0,!1}),D)return!1}),D)return r.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(g){r.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}e[y]||(e[y]={accounts:[]}),e[y].accounts.push({assetAccount:w,amount:T}),console.log("Asset Object:",e);var N="";$.each(e,function(p,d){$.each(d.accounts,function(x,v){N+=`
                <tr>
                    <td style="font-size: 0.8em;">${p.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${v.assetAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${v.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-asset" id="${v.assetAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-asset-accounts").html(N),$(".journal-asset-form")[0].reset(),$("#asset_account_name").html('<option value="" selected hidden>Select an asset type first</option>')}),$(document).on("click",".remove-asset",function(F){F.preventDefault(),$(this).closest("tr").remove();for(let g in e)e[g].accounts&&(e[g].accounts=e[g].accounts.filter(S=>S.assetAccount!==$(this).attr("id"))),e[g].accounts.length===0&&delete e[g];console.log(e)}),$(".save-liability-info").on("click",function(F){F.preventDefault();var g=!1,S=$(".journal-liability-form").serializeArray(),y="",w="",T="";let D=!1;if($(".journal-liability-form input, .journal-liability-form select").removeClass("is-invalid"),$.each(S,function(p,d){d.value===""&&($(`.journal-liability-form [name='${d.name}']`).addClass("is-invalid"),g=!0),d.name==="liability-account"?y=d.value:d.name==="liability-account-name"?w=d.value:d.name==="liability-amount"&&(T=d.value)}),$.each(t,(p,d)=>{if($.each(d.accounts,(x,v)=>{if(v.liabilityAccount===w)return D=!0,!1}),D)return!1}),D)return r.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(g){r.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}t[y]||(t[y]={accounts:[]}),t[y].accounts.push({liabilityAccount:w,amount:T}),console.log("liability Object:",t);var N="";$.each(t,function(p,d){$.each(d.accounts,function(x,v){N+=`
                <tr>
                    <td style="font-size: 0.8em;">${v.liabilityAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${v.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-liability" id="${v.liabilityAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-liability-accounts").html(N),$(".journal-liability-form")[0].reset(),$("#liability_account_name").html('<option value="" selected hidden>Select an asset type first</option>')}),$(document).on("click",".remove-liability",function(F){F.preventDefault(),$(this).closest("tr").remove();for(let g in t)t[g].accounts&&(t[g].accounts=t[g].accounts.filter(S=>S.liabilityAccount!==$(this).attr("id")),t[g].accounts.length===0&&delete t[g]);console.log(t)}),$(".save-oe-info").on("click",function(F){F.preventDefault();var g=!1,S=$(".journal-oe-form").serializeArray(),y="",w="",T="",D=!1;if($(".journal-oe-form input, .journal-oe-form select").removeClass("is-invalid"),$.each(S,function(p,d){d.value===""&&($(`.journal-oe-form [name='${d.name}']`).addClass("is-invalid"),g=!0),d.name==="oe-account"?y=d.value:d.name==="oe-account-name"?w=d.value:d.name==="oe-amount"&&(T=d.value)}),$.each(a,(p,d)=>{if($.each(d.accounts,(x,v)=>{if(v.oeAccount===w)return D=!0,!1}),D)return!1}),D)return r.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;if(g){r.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}a[y]||(a[y]={accounts:[]}),a[y].accounts.push({oeAccount:w,amount:T}),console.log("Asset Object:",a);var N="";$.each(a,function(p,d){$.each(d.accounts,function(x,v){N+=`
                <tr>
                    <td style="font-size: 0.8em;">${v.oeAccount.split("_")[0]}</td>
                    <td style="font-size: 0.8em;">${v.amount}</td>
                    <td style="font-size: 0.8em;">
                        <span class="badge fw-normal text-danger remove-oe" id="${v.oeAccount}" data-type="${p}">
                            <div class="fas fa-times"></div>
                        </span>
                    </td>
                </tr>
            `})}),$(".append-oe-accounts").html(N),$(".journal-oe-form")[0].reset(),$("#oe_account_name").html('<option value="" selected hidden>Select an account type first</option>'),console.log("oeObj Object:",a)}),$(document).on("click",".remove-oe",function(F){F.preventDefault(),$(this).closest("tr").remove();for(let g in a)a[g].accounts&&(a[g].accounts=a[g].accounts.filter(S=>S.oeAccount!==$(this).attr("id"))),a[g].accounts.length===0&&delete a[g];console.log(a)});var m=0,h=0,f=0,C=0,A=0;$(".next-btn").on("click",function(){if(n===1){if(Object.keys(i).length===0){r.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}$("#append-expenses-choy").empty(),m=0;var F="";$.each(i,function(L,K){var k=L.split("_"),b=0;$.each(K.months,function(q,z){var B=z.value.replace(/,/g,""),X=parseFloat(B);b+=X});var P=b.toLocaleString();m+=b,F+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${k[1]}</div>
                        <div class="col-sm-6 text-right">${P}</div>
                    </div>`});var g=parseFloat(m);console.log(typeof g),$("#append-expenses-choy").append(F);var S=`
                <div class="row mt-3">
                    <div class="col-sm-6 text-left"><strong>Total:</strong></div>
                    <div class="col-sm-6 text-right"><strong>${g.toLocaleString()}</strong></div>
                </div>`;$(".append-expense-total").html(S)}if(n===2){$(".append-ldc").empty(),$(".expenses-total").text(""),$(".append-oe").empty(""),$(".oe-total").text("");var y="",w="";if(h=0,f=0,Object.keys(o).length===0){r.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var T=!1,D=!1;if($.each(o,(L,K)=>{var k=L.split("_"),b=k[2];b==="Less Direct Cost"?T=!0:b==="Operating Expenses"&&(D=!0)}),!T||!D){r.fire({icon:"warning",title:"Missing Data",text:'Both "Less Direct Cost" and "Operating Expenses" entries are required.'});return}$.each(o,(L,K)=>{var k=L.split("_"),b=k[2],P=0,q=0;if(b==="Less Direct Cost"){$.each(K.months,(X,ie)=>{var ae=ie.value.replace(/,/g,""),ue=parseFloat(ae);P+=ue});var z=P.toLocaleString();h+=P,y+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${k[1]}</div>
                        <div class="col-sm-6 text-right">${z}</div>
                    </div>
                    `}else if(b==="Operating Expenses"){$.each(K.months,(X,ie)=>{var ae=ie.value.replace(/,/g,""),ue=parseFloat(ae);q+=ue});var B=q.toLocaleString();f+=q,w+=`
                    <div class="row">
                        <div class="col-sm-6 text-left">${k[1]}</div>
                        <div class="col-sm-6 text-right">${B}</div>
                    </div>
                    `}});var N=m-h,p=N-f;C=p,$(".gries-total").text(N.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".tgi").text(N.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".expenses-total").text(h.toLocaleString()),$(".append-ldc").append(y),$(".append-oe").append(w),$(".oe-total").text(f.toLocaleString()),$(".net-amount").text(p.toLocaleString())}if(n===3){var d=0,x=0,v=0,_=0;if($(".append-ca").html(""),$(".append-nca").html(""),$(".append-fa").html(""),Object.keys(e).length===0){r.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(e,(L,K)=>{L.split("_")[0]==="Current Asset"&&$.each(K.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),q=parseFloat(P);v+=q,$(".total-ca").text(v.toLocaleString()),$(".append-ca").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)}),L.split("_")[0]==="Non-Current Assets"&&$.each(K.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),q=parseFloat(P);x+=q,$(".tnca-amount").text(x.toLocaleString()),$(".append-nca").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)}),L.split("_")[0]==="Fixed Assets"&&$.each(K.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),q=parseFloat(P);_+=q,$(".append-fa").append(`<div class="d-flex justify-content-between">
                            <span class='fw-normal float-left'>${b.assetAccount.split("_")[0]}</span>
                            <span class='fw-normal float-right'>${b.amount.toLocaleString()}</span>
                            </div>`)})}),d=v+x+_,$(".total-assets").text(d.toLocaleString())}if(n===4){console.log(t);var O="",I=0;if(Object.keys(t).length===0){r.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(t,(L,K)=>{$.each(K.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),q=parseFloat(P);I+=q,console.log(I),O+=`
                    <div class="d-flex justify-content-between">
                        <span class="fw-normal">${b.liabilityAccount.split("_")[0]}</span>
                        <span class="fw-normal">${b.amount}</span>
                    </div>
                    `})}),A+=I,$(".append-cl").html(O)}if(n===5){var U="",R=0;if(Object.keys(a).length===0){r.fire({icon:"warning",title:"Empty Field",text:"Please fill and save data for at least one entry."});return}$.each(a,(L,K)=>{$.each(K.accounts,(k,b)=>{var P=b.amount.replace(/,/g,""),q=parseFloat(P);R+=q,console.log(R),U+=`
                <div class="d-flex justify-content-between">
                <span class="fw-normal">${b.oeAccount.split("_")[0]}</span>
                <span class="fw-normal">${b.amount}</span>
            </div>
                `})}),A+=R,$(".append-oenw").html(U)}if(n===6){$(".tlc").text(A.toLocaleString());var j=0,Q=!0,J=$(".journal-adjustments-form").serializeArray();if($.each(J,(L,K)=>{var k=$(`.journal-adjustments-form [name='${K.name}']`);K.value.trim()===""?(Q=!1,k.addClass("is-invalid")):(k.removeClass("is-invalid"),s[K.name]=K.value)}),!Q){r.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}$.each(s,(L,K)=>{var k=K.replace(/,/g,""),b=parseFloat(k);L==="owners_withdrawal"&&$(".less-drawings").text(b.toLocaleString()),L==="owners_capital"&&(j+=b),L!=="owners_withdrawal"&&L!=="owners_capital"&&(j+=b)}),$(".additional-capital").text(j.toLocaleString()),$(".fp-nc").text(C.toLocaleString());var W=j+C;$(".appraisal-capital").text(W.toLocaleString());var G=W-parseFloat($(".less-drawings").text().replace(/[^0-9.-]+/g,""));$(".capital-end").text(G.toLocaleString())}n<7&&($(".multi-step-journal").hide(),n++,E(n)),M(n),n===7?($(".next-btn").hide(),$(".save-btn").show()):($(".next-btn").show(),$(".save-btn").hide()),n===1?$(".prev-btn").hide():$(".prev-btn").show()}),$(".prev-btn").on("click",function(){n>1&&($(".multi-step-journal").hide(),n--,E(n)),M(n),$(".next-btn").show(),$(".save-btn").hide(),n===1?$(".prev-btn").hide():$(".prev-btn").show()});function E(F){$(".multi-step-journal").hide(),$(".multi-step-journal").eq(F-1).show()}function M(F){$(".step").removeClass("active"),$(".indicator-line").removeClass("active"),$(".step").each(function(g){g<F&&($(this).addClass("active"),$(this).next(".indicator-line").addClass("active"))})}E(n),M(n),n===1&&$(".prev-btn").hide(),$(".save-journal-btn").click(function(){var F={incomeObj:i,expensesObj:o,assetObj:e,liabilityObj:t,oeObj:a,adjustmentObj:s,client_id:$(this).attr("id").split("_")[1]};Ae("new-client-journal-entry",F,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},g,S);function g(y){console.log(y),localStorage.setItem("journal","created"),window.location.href="clients"}function S(y,w,T){console.log(y)}});var Y=localStorage.getItem("journal");Y==="created"&&(r.fire({icon:"success",title:"Journal Entry",text:"New Journal Entry Saved"}),localStorage.removeItem("journal"))});var ne=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),me=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".save-account-type").on("click",function(){var c=$(".new-account-type-form").serializeArray(),u={},o=!0;if($.each(c,(e,t)=>{if(t.value===""){o=!1,$(`.new-account-type-form [name='${t.name}']`).addClass("is-invalid"),ne.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"});return}else u[t.name]=t.value,$(`.new-account-type-form [name='${t.name}']`).removeClass("is-invalid"),console.log(u)}),o){let e=function(a){console.log(a),localStorage.setItem("account-type","created"),location.reload()},t=function(a,s,m){$(".loader-container").addClass("visually-hidden");try{const h=JSON.parse(a.responseText);console.log("Parsed Response:",h),me.fire({icon:"warning",title:"Conflict",text:h.error})}catch(h){console.log("Could not parse JSON response:",h)}};var l=e,i=t;$(".loader-container").removeClass("visually-hidden"),Se("new-account-type",u,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t)}}),$(".save-account").on("click",function(){var c=$("#account-form").serializeArray(),u={},o=!0;if(console.log(c),$.each(c,(e,t)=>{if($(`#account-form [name='${t.name}']`).addClass("is-invalid"),t.value===""){ne.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"}),o=!1;return}else $(`#account-form [name='${t.name}']`).removeClass("is-invalid"),u[t.name]=t.value}),o){let e=function(a){localStorage.setItem("account","created"),location.reload()},t=function(a,s,m){$(".loader-container").addClass("visually-hidden");try{const h=JSON.parse(a.responseText);console.log("Parsed Response:",h),me.fire({icon:"warning",title:"Conflict",text:h.error})}catch(h){console.log("Could not parse JSON response:",h)}};var l=e,i=t;$(".loader-container").removeClass("visually-hidden"),we("new-account",u,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},e,t)}}),$(".edit-coa").click(function(c){c.preventDefault();var u=$(this).attr("id"),o=$(`#edit-coa-form-${u}`).serializeArray(),l=!0,i={};$.each(o,(e,t)=>{if(t.value===""){$(`.edit-coa-form-${u} [name='${t.name}']`).addClass("is-invalild"),l=!1,ne.fire({icon:"warning",title:"Missing Field!",text:"Please fill all fields"});return}$(`.edit-coa-form-${u} [name='${t.name}']`).removeClass("is-invalild"),i[t.name]=t.value}),l&&$.ajax({type:"POST",url:"edit-coa",data:i,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){localStorage.setItem("account","updated"),location.reload()},error:function(e,t,a){try{const s=JSON.parse(e.responseText);console.log("Parsed Response:",s),me.fire({icon:"warning",title:"Conflict",text:s.message})}catch(s){console.log("Could not parse JSON response:",s)}}})});var n=localStorage.getItem("account-type"),r=localStorage.getItem("account");if(n==="created"){ne.fire({icon:"success",title:"New Account Type created!"}),localStorage.removeItem("account-type");return}if(r==="created"){localStorage.removeItem("account"),ne.fire({icon:"success",title:"New Account created!"}),localStorage.removeItem("account-type");return}if(r==="updated"){localStorage.removeItem("account"),ne.fire({icon:"success",title:"Account updated!"}),localStorage.removeItem("account-type");return}});$(document).ready(function(){var n=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),r=Swal.mixin({toast:!1,position:"bottom-end"});$(".new-user-save").on("click",function(u){var o=$(".new-user-form").serializeArray(),l={},i=!0;if($.each(o,(a,s)=>{if(s.value===""){i=!1,$(`.new-user-form [name='${s.name}']`).addClass("is-invalid"),n.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}else l[s.name]=s.value,$(`.new-user-form [name='${s.name}']`).removeClass("is-invalid")}),i){let a=function(m){localStorage.setItem("user","created"),location.reload()},s=function(m,h,f){try{const C=JSON.parse(m.responseText);console.log("Parsed Response:",C),r.fire({icon:"warning",title:"Conflict",text:C.message})}catch(C){console.log("Could not parse JSON response:",C)}};var e=a,t=s;Ce("new-user",l,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},a,s)}}),$(".remove-user").on("click",function(){var u=$(this).attr("id");$.ajax({url:`remove-user-${u}`,type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(o){console.log(o),localStorage.setItem("user","removed"),location.reload()},error:function(o,l,i){console.log(o)}})}),$(".edit-user-button").on("click",function(){var u=$(".edit-user-form").serializeArray(),o=!0,l={};$.each(u,(i,e)=>{if(e.value===""){o=!1,$(`[name='${e.name}']`).addClass("is-invalid"),n.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}else l[e.name]=e.value,$(`[name='${e.name}']`).removeClass("is-invalid")}),o&&$.ajax({url:"update-user",type:"POST",data:l,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){localStorage.setItem("user","updated"),location.reload()},error:function(i,e,t){r.fire({icon:"error",title:"Fatal Error!",text:"Try reloading the page, if issue persist contact developer"})}})});var c=localStorage.getItem("user");c==="created"&&(n.fire({icon:"success",title:"User Created!",text:"User created successfuly"}),localStorage.removeItem("user")),c==="removed"&&(n.fire({icon:"success",title:"User Removed!",text:"User removed successfuly"}),localStorage.removeItem("user")),c==="updated"&&(n.fire({icon:"success",title:"User Updated!",text:"User Updated successfuly"}),localStorage.removeItem("user")),$(".search-users").on("keyup",function(){var u=$(this).val().toLowerCase();$(".users-table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(u)>-1)})}),$("#filter-users").on("change",function(){var u=$(this).val();$(".users-table tbody tr").each(function(){var o=$(this).data("category");u==="clear"?$(this).show():u===""||o===u?$(this).show():$(this).hide()})})});$(document).ready(function(){var n=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),r=Swal.mixin({toast:!1,position:"bottom-end"});$("#account-category").on("change",function(i){$("#billing-account-type").prop("disabled",!1),$.ajax({type:"POST",url:`get-account-types-${$(this).val()}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){console.log(e);let t='<option value="" selected hidden>Select Type</option>',a=!1;$.each(e,(s,m)=>{$.each(m,(h,f)=>{Object.keys(f).length>0&&(t+=`<option value="${f.id}">${f.ServiceRequirements}</option>`,a=!0)})}),a||(t='<option value="" selected hidden>Category has no type</option>'),$("#billing-account-type").html(t)},error:function(e){console.error(e),r.fire({icon:"error",title:"Error",text:`Could not load account types: ${e.responseText||e.statusText}`})}})}),$(document).on("change",'[id^="edit-account-category-"]',function(i){let e=$(this).attr("id").split("-").pop(),t=`#edit-billing-account-type-${e}`;console.log($(this).val()),console.log("Fetching types for modal:",e),$.ajax({type:"POST",url:`get-account-types-${$(this).val()}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){console.log(a);let s='<option value="" selected hidden>Select Type</option>',m=!1;$.each(a,(h,f)=>{$.each(f,(C,A)=>{Object.keys(A).length>0&&(s+=`<option value="${A.id}">${A.ServiceRequirements}</option>`,m=!0)})}),m||(s='<option value="" selected hidden>Category has no type</option>'),$(t).html(s)},error:function(a){console.error(a),r.fire({icon:"error",title:"Error",text:`Could not load account types: ${a.responseText||a.statusText}`})}})}),$(".edit-description").on("click",function(i){var e=$(this).attr("id").split("-").pop();i.preventDefault();var t={},a=$(`.update-description-form-${e}`).serializeArray(),s=!0;$.each(a,(m,h)=>{h.value===""&&(s=!1,n.fire({icon:"warning",title:"Missing Fields!",text:"Please fill all fields"}),$(`.update-description-form-${e} [name='${h.name}']`).addClass("is-invalid")),$(`.update-description-form-${e} [name='${h.name}']`).removeClass("is-invalid"),t[h.name]=h.value}),console.log(t),s&&$.ajax({type:"POST",url:"update/account-description",data:t,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(m){localStorage.setItem("account_description","updated"),location.reload()},error:function(m,h,f){r.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+m.responseText})}})}),$(".remove-description").on("click",function(){$.ajax({type:"POST",url:`remove/account-description/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){localStorage.setItem("account_description","removed"),location.reload()},error:function(i,e,t){r.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+i.responseText})}})}),$(".remove-coa").on("click",function(){$.ajax({type:"POST",url:`remove/coa/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){localStorage.setItem("coa","removed"),location.reload()},error:function(i,e,t){r.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+i.responseText})}})}),$(".save-account-description").on("click",function(i){var e=$(".account-description-form").serializeArray(),t={},a=!0;if($.each(e,(h,f)=>{if(f.value===""){$(`.account-description-form [name="${f.name}"]`).addClass("is-invalid"),n.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),a=!1;return}else t[f.name]=f.value,console.log(t),$(`.account-description-form [name="${f.name}"]`).removeClass("is-invalid")}),a){let h=function(C){localStorage.setItem("account_description","created"),location.reload()},f=function(C,A,E){try{const M=JSON.parse(C.responseText);console.log("Parsed Response:",M),r.fire({icon:"error",title:"Error",text:M.message})}catch(M){console.log("Could not parse JSON response:",M)}};var s=h,m=f;Fe("new-account-description",t,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},h,f)}}),$(".edit-sys-profile").on("click",function(i){i.preventDefault();var e=!0,t={},a=$("#sys-profile-form").serializeArray();$.each(a,(s,m)=>{m.value.trim()===""?(e=!1,$(`.sys-profile-form [name='${m.name}']`).addClass("is-invalid"),n.fire({icon:"warning",title:"Missing fields",text:"Please fill all fields"})):$(`.sys-profile-form [name='${m.name}']`).removeClass("is-invalid"),t[m.name]=m.value}),e&&$.ajax({type:"POST",url:"edit-sys-info",data:t,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(s){localStorage.setItem("system-profile","updated"),location.reload()},error:function(s,m,h){try{const f=JSON.parse(s.responseText);console.log("Parsed Response:",f),r.fire({icon:"error",title:"Error",text:f.message})}catch(f){console.log("Could not parse JSON response:",f)}}})}),$(".edit-user-privilege").on("click",function(i){i.preventDefault();var e=$(this).attr("id");console.log(e),$.ajax({url:`/users/toggle-privilege/${e}`,type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(t){localStorage.setItem("user_privilege_updated",t.message),location.reload()},error:function(t){n.fire({icon:"error",title:"An error occurred while updating the privilege."})}})});var c=localStorage.getItem("account_description"),u=localStorage.getItem("system-profile"),o=localStorage.getItem("coa"),l=localStorage.getItem("user_privilege_updated");c==="created"&&(n.fire({icon:"success",title:"Account Description Created!"}),localStorage.removeItem("account_description")),c==="removed"&&(n.fire({icon:"success",title:"Account Description Removed!"}),localStorage.removeItem("account_description")),c==="updated"&&(n.fire({icon:"success",title:"Account Description Updated!"}),localStorage.removeItem("account_description")),u==="updated"&&(n.fire({icon:"success",title:"System Profile Updated"}),localStorage.removeItem("system-profile")),o==="removed"&&(n.fire({icon:"success",title:"Account Removed"}),localStorage.removeItem("coa")),l&&(n.fire({icon:"success",title:l}),localStorage.removeItem("user_privilege_updated"))});var ce=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),ve=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".update-client-service-progress-btn").on("click",function(){var c=$(this).attr("id"),u=$(`.update-service-progress-${c}`).serializeArray();console.log(u),$.ajax({type:"POST",url:"update-client-service",data:{serviceId:c,serviceVal:u},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(o){localStorage.setItem("service","updated"),location.reload()},error:function(o,l,i){try{const e=JSON.parse(o.responseText);console.log("Parsed Response:",e),ve.fire({icon:"warning",title:"Conflict",text:e.Conflict})}catch(e){console.log("Could not parse JSON response:",e)}}})}),$(".edit-company-info").on("click",function(c){var u=$(`.edit-company-info-${$(this).attr("id")}`).serializeArray(),o=!0,l={};$.each(u,(i,e)=>{e.value===""&&(o=!1,$(`.edit-company-info-${$(this).attr("id")} [name='${e.name}']`).addClass("is-invalid"),ce.fire({icon:"warning",title:"Missingg Fields",text:"Please fill all fields"})),l[e.name]=e.value}),o&&$.ajax({type:"POST",url:"update-company-info",data:l,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){localStorage.setItem("company-info","updated"),location.reload()},error:function(i,e,t){ve.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+i})}})}),$(".remove-client-service").on("click",function(){$.ajax({type:"POST",url:`client-profile/service/remove/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(c){localStorage.setItem("service","removed"),location.reload()},error:function(c,u,o){ve.fire({icon:"error",title:"Oops! Something went wrong",text:"Translated: "+c})}})});var n=localStorage.getItem("company-info"),r=localStorage.getItem("service");r==="updated"&&(ce.fire({icon:"success",text:"Client Service Updated"}),localStorage.removeItem("service")),r==="removed"&&(ce.fire({icon:"success",text:"Client Service Removed"}),localStorage.removeItem("service")),n==="updated"&&(localStorage.removeItem("company-info"),ce.fire({icon:"success",text:"Company Info Updated"}))});$(document).ready(function(){var n=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),r=Swal.mixin({toast:!1,position:"bottom-end"}),c=0,u=window.servicesData;console.log(u);var o={Service:[]},l={SubService:[]},i={accounts:[]};$.each(u,(t,a)=>{$.each(a.Service,(s,m)=>{o.Service.push({Service:{service_name:s,service_id:Object.keys(m.parent_service_id)[0],service_price:m.parent_service_id[Object.keys(m.parent_service_id)[0]].parentServicePrice}}),m.sub_service&&$.each(m.sub_service,(h,f)=>{$.each(f,(C,A)=>{$.each(A,(E,M)=>{$.each(M.account_descriptions,(Y,F)=>{i.accounts.push({Accounts:{Account:F.Description,account_id:F.adID.toLocaleString(),price:F.Price}})})})}),$.each(f.sub_service_id,C=>{let A=Object.keys(f.sub_service_id)[0],E=f.sub_service_id[A].sub_service_price;l.SubService.push({SubService:{sub_service_name:h,sub_service_id:C,sub_service_price:E}})})})})}),$(".price").each(function(){var t=$(this).text(),a=t.replace(/[^\d.-]/g,""),s=parseFloat(a);c+=s}),$(".remove-parent-service-billing-action").click(function(){var t=$(this).attr("id").split("_")[1],a=$(this).closest("tr").find("td:nth-last-child(2)").text(),s=a.replace(/[^\d.-]/g,""),m=parseFloat(s);c-=m,$(".overall-due").text(c.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(c.toLocaleString(void 0,{minimumFractionDigits:2}));var h=o.Service.findIndex(f=>f.Service.service_id===t);console.log("Service ID to remove:",t),h!==-1?(o.Service.splice(h,1),$(this).closest("tr").remove()):console.log("Service not found")}),$(".remove-sub-service-billing-action").click(function(){var t=$(this).attr("id").split("_")[1],a=$(this).closest("tr").find("td:nth-last-child(2)").text(),s=a.replace(/[^\d.-]/g,""),m=parseFloat(s);c-=m,$(".overall-due").text(c.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(c.toLocaleString(void 0,{minimumFractionDigits:2}));var h=l.SubService.findIndex(f=>f.SubService.sub_service_id===t);h!==-1&&(l.SubService.splice(h,1),$(this).closest("tr").remove())}),$(document).on("click",".remove-account-description-billing-action",function(){var t=$(this).attr("id").split("_")[1],a=$(this).closest("tr").find("td:nth-last-child(2)").text(),s=a.replace(/[^\d.-]/g,""),m=parseFloat(s),h=0;h=m-m,c-=m,$("#additional-description-subtotal").text(h.toLocaleString(void 0,{minimumFractionDigits:2})),$(".overall-due").text(c.toLocaleString(void 0,{minimumFractionDigits:2})),$(".total-printed-price").text(c.toLocaleString(void 0,{minimumFractionDigits:2}));var f=i.accounts.findIndex(C=>C.Accounts.account_id===t);f!==-1?(i.accounts.splice(f,1),$(this).closest("tr").remove(),console.log(i)):console.log("Account not found")}),console.log(i),$(".add-description").on("click",function(){var t=0,a=$(this).closest("tr"),s=a.data("service"),m=a.data("requirements"),h=a.data("category"),f=a.data("description"),C=a.data("taxtype"),A=a.data("formtype"),E=a.data("price"),M=a.data("id"),Y=E.replace(/[^\d.-]/g,""),F=parseFloat(Y),g=F.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"),S=i.accounts.some(w=>w.Accounts.Account===f);if(S)n.fire({icon:"warning",title:"Conflict",text:"Account Description already exists!"});else{i.accounts.push({Accounts:{Account:f,account_id:a.attr("id").toLocaleString(),price:E,isAdded:!0}}),c+=F,t+=F,$("#additional-description-subtotal").text(t.toLocaleString(void 0,{minimumFractionDigits:2})),$(".overall-due").text(c.toLocaleString(void 0,{minimumFractionDigits:2}));var y=`
            <tr>
                <td>${s}</td>
                <td>${m}</td>
                <td>${h}</td>
                <td>${f}</td>
                <td>${C}</td>
                <td>${A}</td>
                <td>₱${g}</td>
                <td>
                    <span class="badge fw-bold text-light bg-danger remove-account-description-billing-action" id='${M}'><i class="fas fa-trash"></i></span>
                </td>
            </tr>
        `;$(".append-ad").append(y)}}),$(".mail-client-bs").click(function(){var t=$("#dd").val(),a=$(".billing-id").text(),s=$(".date").text(),m=$(this).attr("id");if(console.log(o),t===""||t===void 0){$("#dd").addClass("is-invalid"),n.fire({icon:"warning",title:"Missing Field",text:"Please add due date before proceeding"});return}$("#dd").removeClass("is-invalid");var h={dueDate:t,date:s,serviceObj:o,subServiceObj:l,accountDescriptions:i,refID:m,billingId:a};Te("mail-client-billing",h,{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},function(f){window.location.href="clients",localStorage.setItem("billing","created")},function(f,C,A){try{const E=JSON.parse(f.responseText);r.fire({icon:"warning",title:"Conflict",text:E.Message})}catch(E){console.log("Could not parse JSON response:",E)}})});var e=localStorage.getItem("billing");e==="created"&&(n.fire({icon:"success",title:"Billing Created",text:"Billing successfully created"}),localStorage.removeItem("billing"))});var le=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),De=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".view-journal-btn").on("click",function(n){var r=$(this).attr("id");$.ajax({type:"POST",url:`view-client-journal-${r}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(c){console.log(c);var u=new Blob([c],{type:"application/pdf"}),o=URL.createObjectURL(u);window.open(o,"_blank")},error:function(c,u,o){De.fire({icon:"error",title:"Oops Something went wrong!",text:c.responseJSON?c.responseJSON.error:"Unknown error"})}})}),$(".gen-client-billing-pdf").click(function(){$.ajax({type:"POST",url:`client-billing-data_${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(n){var r=new Blob([n],{type:"application/pdf"}),c=URL.createObjectURL(r);window.open(c,"_blank")},error:function(n,r,c){le.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".gen-expense-pdf").on("click",function(){$.ajax({type:"POST",url:"expense/pdf/expense",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(n){var r=new Blob([n],{type:"application/pdf"}),c=URL.createObjectURL(r);window.open(c,"_blank")},error:function(n,r,c){le.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".income-gen-pdf").on("click",function(){$.ajax({type:"POST",url:"income/pdf/income",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(n){var r=new Blob([n],{type:"application/pdf"}),c=URL.createObjectURL(r);window.open(c,"_blank")},error:function(n,r,c){le.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})}),$(".generate-client-billing-pdf").on("click",function(){$.ajax({type:"POST",url:`client/billing/pdf/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(n){var r=new Blob([n],{type:"application/pdf"}),c=URL.createObjectURL(r);window.open(c,"_blank")},error:function(n,r,c){le.fire({icon:"error",title:"Fatal Error",text:"Something went wrong"})}})})});var de=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),_e=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){$(".journal-pin-entry").on("submit",function(r){r.preventDefault();var c=$(this).serializeArray(),u=!0;$.each(c,(o,l)=>{l.value===""?(de.fire({icon:"warning",title:"Missing PIN",text:"Please enter PIN"}),u=!1,$(`[name='${l.name}']`).addClass("is-invalid")):$(`[name='${l.name}']`).remove("is-invalid")}),u&&$.ajax({type:"POST",url:"journal-pin-entry",data:c,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},xhrFields:{responseType:"blob"},success:function(o){var l=new Blob([o],{type:"application/pdf"}),i=URL.createObjectURL(l);window.open(i,"_blank"),console.log("asdasd")},error:function(o,l,i){o.status===400?de.fire({icon:"error",title:o.statusText,text:"Incorrect PIN"}):de.fire({icon:"error",title:"Something went wrong",text:"Fatal error. Translated: "+l})}})}),$(".request-journal-pin").click(function(){$.ajax({type:"POST",url:`request-journal-pin_${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){console.log(r)},error:function(r,c,u){console.log(r)}})}),$(".remove-journal-entry").click(function(){$.ajax({type:"POST",url:`archive-journal-entry-${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){localStorage.setItem("journal","Removed"),location.reload()},error:function(r,c,u){_e.fire({icon:"error",title:"Oops! Something went wrong",text:"Error Translated: "+r})}})});var n=localStorage.getItem("journal");n==="Removed"&&(localStorage.removeItem("journal"),de.fire({icon:"success",title:"Journal Update",text:"Journal Successfully removed"}))});var Re=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});$(document).ready(function(){$('select[name="JournalStatus"]').on("change",function(){var n=$(this).closest(".modal"),r=n.find(".journal-draft-note");$(this).val()==="Rejected"||$(this).val()==="Canceled"?r.removeClass("visually-hidden"):r.addClass("visually-hidden").val("")}),$(".update-journal-status").on("click",function(){var n=$(this).attr("id");console.log(n);var r=$(`#update-journal-status-${n}`),c=r.find(`#serviceprogress-${n}`).val(),u=r.find(`#note-${n}`);if((c==="Canceled"||c==="Rejected")&&u.val().trim()===""){Swal.fire({icon:"error",title:"Validation Error",text:'Please provide a note when the status is "Canceled" or "Rejected".'}),u.addClass("is-invalid");return}var o=$(`.update-journal-status-form-${n}`).serializeArray();$.ajax({type:"POST",url:"/update-journal-status",data:o,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(l){localStorage.setItem("journal-status","updated"),location.reload()},error:function(l){console.error(l)}})}),localStorage.getItem("journal-status")==="updated"&&(Re.fire({icon:"success",title:"Journal Status Updated",text:"Journal status updated successfully"}),localStorage.removeItem("journal-status"))});var H=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3}),oe=Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){let n=1;var r=window.journalIncome,c=window.journalExpense,u=window.journalAssets,o=window.journalLiability,l=window.journalOE,i=r,e=c,t={},a={},s={},m={};$.each(u,(p,d)=>{const x=[];x.push({assetAccount:d.account,amount:d.amount}),t[d.asset_category]={accounts:x}}),$.each(o,(p,d)=>{const x=[];var v=d.AccountType;x.push({liabilityAccount:d.account,amount:d.amount}),a[v]={accounts:x}}),$.each(l,(p,d)=>{const x=[];var v=d.AccountType;x.push({oeAccount:d.account,amount:d.amount}),s[v]={accounts:x}});let h="";$("#audit-income-category").on("change",function(){h=$(this).val(),$(".audit-income-form").removeClass("visually-hidden"),$(".saved-audited-income-months").empty()}),$("#audit-expense-category").on("change",function(){h=$(this).val(),$(".audit-expense-form").removeClass("visually-hidden"),$(".saved-audited-expense-months").empty()}),$(".audit-income-start-date, .audit-income-end-date").on("change",function(){const p=$(".audit-income-start-date").val(),d=$(".audit-income-end-date").val();if($("#audit-income-category").val()===""){H.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(p&&d){const v=new Date(p),_=new Date(d),O=$(".audit-income-months-container");var x='<div class="row">';if((_.getFullYear()-v.getFullYear())*12+(_.getMonth()-v.getMonth())>12){oe.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const U=new Date(v);if(U.setMonth(U.getMonth()+11),_>U){oe.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}O.empty(),x+="";let R=new Date(v);for(;R<=_;){const j=R.toLocaleString("default",{month:"long",year:"numeric"});x+=`<div class="col-sm-6 my-2">
                    <div class="input-group">
                    <input type="text" class="form-control audit-income-month-input" name="${j}" id="" placeholder='${j}' value="">
                    </div>
                    </div>`,R.setMonth(R.getMonth()+1)}x+=`
            <div class="col-sm-6 my-2 text-right">
                <button type='button' class="btn btn-primary save-income-audit-months form-control">Save</button>
            </div>`,x+="</div>",O.html(x)}$(document).on("input",".audit-income-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-income-audit-months",function(p){p.preventDefault();let d=[],x=!0;if(i.hasOwnProperty(h)){H.fire({icon:"warning",title:"Account Already Exists!",text:"You have already added this account."}),$(".audit-income-end-date").val(""),$(".audit-income-start-date").val(""),$(".audit-income-months-container").empty(),console.log(!0);return}if($(".audit-income-month-input").each(function(){var v=$(this).attr("name");console.log(v);var _=$(this).val();_!==""&&(x=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),d.push({incomeMonthName:v,value:$(this).val(),startDate:$(".audit-income-start-date").val(),endDate:$(".audit-income-end-date").val()}))}),x){$(".audit-income-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),H.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}i[h]={months:d,startDate:$(".audit-income-start-date").val(),endDate:$(".audit-income-end-date").val()},$("#saved-audited-income-months").empty(),$.each(i,(v,_)=>{var O='<table class="table table-hover client-journal-accounts">',I=v.split("_");O+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${I[1]}
                        <span class="text-sm fw-bold float-right remove-audit-income" id="${v}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(_.months,(U,R)=>{O+=`
                    <tr>
                        <td class='text-left'>${R.incomeMonthName}</td>
                        <td class='text-left'>${R.value}</td>
                    </tr>
                `}),O+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,O+="</table>",$("#saved-audited-income-months").append(O)}),$(".audit-income-months-container").empty(),$("#audit-income-category").val(""),$(".audit-income-end-date").val(""),$(".audit-income-start-date").val(""),h="",x=!0,console.log(i)}),$(".audit-expense-start-date, .audit-expense-end-date").on("change",function(){const p=$(".audit-expense-start-date").val(),d=$(".audit-expense-end-date").val();if($("#audit-expense-category").val()===""){H.fire({icon:"warning",title:"Missing account",text:"Please select an account"});return}if(p&&d){const v=new Date(p),_=new Date(d),O=$(".audit-expense-months-container");var x='<div class="row">';if((_.getFullYear()-v.getFullYear())*12+(_.getMonth()-v.getMonth())>12){oe.fire({icon:"error",title:"The selected period exceeds 12 months."});return}const U=new Date(v);if(U.setMonth(U.getMonth()+11),_>U){oe.fire({icon:"error",title:"The selected period must not exceed the fiscal year based on the start date."});return}O.empty(),x+="";let R=new Date(v);for(;R<=_;){const j=R.toLocaleString("default",{month:"long",year:"numeric"});x+=`<div class="col-sm-6 my-2">
                <div class="input-group">
                <input type="text" class="form-control audit-expense-month-input" name="${j}" id="" placeholder='${j}' value="">
                </div>
                </div>`,R.setMonth(R.getMonth()+1)}x+=`
        <div class="col-sm-6 my-2 text-right">
            <button type='button' class="btn btn-primary save-expense-audit-months form-control">Save</button>
        </div>`,x+="</div>",O.html(x)}$(".audit-expense-months-container").on("input",".audit-expense-month-input",function(){formatValueInput(this)})}),$(document).on("click",".save-expense-audit-months",function(p){p.preventDefault();let d=[],x=!0;if(e.hasOwnProperty(h)){H.fire({icon:"warning",title:"Account Already Exists!",text:"You have already added this account."}),$(".audit-iexpensencome-end-date").val(""),$(".audit-expense-start-date").val(""),$(".audit-expense-months-container").empty();return}if($(".audit-expense-month-input").each(function(){var v=$(this).attr("name"),_=$(this).val();_!==""&&(x=!1,$(`[name='${$(this).attr("name")}']`).addClass("is-invalid"),d.push({expenseMonthName:v,value:$(this).val(),startDate:$(".audit-expense-start-date").val(),endDate:$(".audit-expense-end-date").val()}))}),x){$(".audit-expense-month-input").each(function(){$(`[name='${$(this).attr("name")}']`).addClass("is-invalid")}),H.fire({icon:"warning",title:"Missing fields",text:"Please fill in at least one month input."});return}e[h]={months:d,startDate:$(".audit-expense-start-date").val(),endDate:$(".audit-expense-end-date").val()},$("#saved-audited-expense-months").empty(),$.each(e,(v,_)=>{var O='<table class="table table-hover client-journal-accounts">',I=v.split("_");O+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${I[1]}
                        <span class="text-sm fw-bold float-right remove-audit-expense" id="${v}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(_.months,(U,R)=>{O+=`
                    <tr>
                        <td class='text-left'>${R.expenseMonthName}</td>
                        <td class='text-left'>${R.value}</td>
                    </tr>
                `}),O+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,O+="</table>",$("#saved-audited-expense-months").append(O)}),$(".audit-expense-months-container").empty(),$("#audit-expense-category").val(""),$(".audit-expense-end-date").val(""),$(".audit-expense-start-date").val(""),h="",x=!0}),$(".save-audit-asset-info").on("click",function(p){p.preventDefault();var d=$(".journal-audit-asset-form").serializeArray(),x="",v="",_="";let O=!1;if($.each(d,(R,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="assetType"?x=j.value:j.name==="assetAccount"?v=j.value:j.name==="assetAmount"&&(_=j.value)}),!x||!v||!_){console.error("Required fields are missing.");return}if($.each(t,(R,j)=>{if($.each(j.accounts,(Q,J)=>{if(J.assetAccount===v.split("_")[0])return O=!0,!1}),O)return!1}),O)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var I=x.split("_");t[I[0]]||(t[I[0]]={accounts:[]}),t[I[0]].accounts.push({assetAccount:v.split("_")[0],amount:_}),$(".append-audit-asset-accounts").empty();let U="";$.each(t,(R,j)=>{$.each(j.accounts,(Q,J)=>{var W=J.amount,G=W.toString().replace(/,/g,""),L=parseFloat(G).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});U+=`
            <tr id="${R}">
                <td class='text-sm'>${R}</td>
                <td class='text-sm'>${J.assetAccount}</td>
                <td class='text-sm'>
                    ${L}
                    <span class="badge fw-bold text-dark float-right remove-audited-asset" id="${J.assetAccount}">
                        <i class="fas fa-times"></i>
                    </span>
                </td>
            </tr>`})}),$(".append-audit-asset-accounts").append(U),$("#asset_account").val(""),$("#asset_account_name  option:first").text("Select Account"),$("#assetAmount").val(""),O=!1}),$(".save-audit-liability-info").on("click",function(p){p.preventDefault();var d=$(".journal-audit-liability-form").serializeArray(),x="",v="",_="";let O=!1;if($.each(d,(R,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="audit-liability-account"?x=j.value:j.name==="audit-liability-account-name"?v=j.value:j.name==="liability-amount"&&(_=j.value)}),!x||!v||!_){console.error("Required fields are missing.");return}if($.each(a,(R,j)=>{if($.each(j.accounts,(Q,J)=>{if(J.liabilityAccount===v.split("_")[0])return O=!0,!1}),O)return!1}),O)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var I=x.split("_");a[I[0]]||(a[I[0]]={accounts:[]}),a[I[0]].accounts.push({liabilityAccount:v.split("_")[0],amount:_}),$(".append-audit-liability-accounts").empty();let U="";$.each(a,(R,j)=>{$.each(j.accounts,(Q,J)=>{var W=J.amount,G=W.toString().replace(/,/g,""),L=parseFloat(G).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});U+=`
                <tr id="${R}">
                    <td class='text-sm'>${R}</td>
                    <td class='text-sm'>${J.liabilityAccount}</td>
                    <td class='text-sm'>
                        ${L}
                        <span class="badge fw-bold text-dark float-right remove-audit-liability" id="${J.liabilityAccount}">
                            <i class="fas fa-times"></i>
                        </span>
                    </td>
                </tr>`})}),$(".append-audit-liability-accounts").append(U),$("#liability_account").val(""),$("#liability_account_name  option:first").text("Select Account"),$("#liabilityAmount").val(""),O=!1}),$(".save-audit-oe-info").on("click",function(p){p.preventDefault();var d=$(".journal-audit-oe-form").serializeArray(),x="",v="",_="";let O=!1;if($.each(d,(R,j)=>{if(j.value==="")return $(`[name='${j.name}']`).addClass("is-invalid"),H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"}),!1;$(`[name='${j.name}']`).removeClass("is-invalid"),j.name==="oe-account"?x=j.value:j.name==="oe-account-name"?v=j.value:j.name==="oe-amount"&&(_=j.value)}),!x||!v||!v){console.error("Required fields are missing.");return}if($.each(s,(R,j)=>{if($.each(j.accounts,(Q,J)=>{if(J.oeAccount===v.split("_")[0])return O=!0,!1}),O)return!1}),O)return H.fire({icon:"warning",title:"Existing Account",text:"Account Already Exists!"}),!1;var I=x.split("_");s[I[0]]||(s[I[0]]={accounts:[]}),s[I[0]].accounts.push({oeAccount:v.split("_")[0],amount:_}),$(".append-audit-oe-accounts").empty();let U="";$.each(s,(R,j)=>{$.each(j.accounts,(Q,J)=>{var W=J.amount,G=W.toString().replace(/,/g,""),L=parseFloat(G).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});U+=`
            <tr id="${R}">
                <td class='text-sm'>${R}</td>
                <td class='text-sm'>${J.oeAccount}</td>
                <td class='text-sm'>
                    ${L}
                    <span class="badge fw-bold text-dark float-right remove-audit-oe" id="${R}">
                        <i class="fas fa-times"></i>
                    </span>
                </td>
            </tr>`})}),$(".append-audit-oe-accounts").append(U),$("#oe-account").val(""),$("#oe-account-name  option:first").text("Select Account"),$("#oeAmount").val(""),O=!1}),$(document).on("click",".remove-audit-income",function(){$(this).closest("tr").remove();var p=$(this).attr("id");delete i[p],$("#saved-audited-income-months").empty(),$.each(i,(d,x)=>{var v='<table class="table table-hover client-journal-accounts">',_=d.split("_");v+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${_[1]}
                        <span class="text-sm fw-bold float-right remove-audit-income" id="${d}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                                <td>Month</td>
                                <td>Amount</td>
                             </tr>
                            </thead>
            `,$.each(x.months,(O,I)=>{v+=`
                    <tr>
                        <td>${I.incomeMonthName}</td>
                        <td>${I.value}</td>
                    </tr>
                `}),v+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,v+="</table>",$("#saved-audited-income-months").append(v)}),console.log(i)}),$(document).on("click",".remove-audit-expense",function(p){delete e[$(this).attr("id")],$(this).closest("tr").remove(),$("#saved-audited-expense-months").empty(),$.each(e,(d,x)=>{var v='<table class="table table-hover client-journal-accounts">',_=d.split("_");v+=`
                <tr class="client-journal-accounts" data-widget="expandable-table" aria-expanded="false">
                    <td>
                        ${_[1]}
                        <span class="text-sm fw-bold float-right remove-audit-expense" id="${d}"><i class="fas fa-times"></i></span>
                    </td>
                </tr>
                <tr class="expandable-body bg-light client-journal-accounts">
                    <td>
                        <div class="p-0">
                            <table class="table table-hover float-left">
                            <thead>
                             <tr>
                            <td class='text-left'>Month</td>
                            <td class='text-left'>Amount</td>
                           </tr>
                            </thead>
            `,$.each(x.months,(O,I)=>{v+=`
                    <tr>
                        <td class='text-left'>${I.expenseMonthName}</td>
                        <td class='text-left'>${I.value}</td>
                    </tr>
                `}),v+=`
                            </table>
                        </div>
                    </td>
                </tr>
            `,v+="</table>",$("#saved-audited-expense-months").append(v)})}),$(document).on("click",".remove-audited-asset",function(p){p.preventDefault(),$(this).closest("tr").remove();for(let d in t)t[d].accounts&&(t[d].accounts=t[d].accounts.filter(x=>x.assetAccount!==$(this).attr("id"))),t[d].accounts.length===0&&delete t[d]}),$(document).on("click",".remove-audit-liability",function(p){p.preventDefault(),$(this).closest("tr").remove();for(let d in a)a[d].accounts&&(a[d].accounts=a[d].accounts.filter(x=>x.liabilityAccount!==$(this).attr("id"))),a[d].accounts.length===0&&delete a[d]}),$(document).on("click",".remove-audit-oe",function(p){p.preventDefault(),$(this).closest("tr").remove();for(let d in s)s[d].accounts&&(s[d].accounts=s[d].accounts.filter(x=>x.oeAccount!==$(this).attr("id"))),s[d].accounts.length===0&&delete s[d]});var f=0,C=0,A=0,E=0,M=0,Y=0,F=0,g=0,S=0,y=0,w=0;console.log(e),$(".audit-next-btn").on("click",function(){if(n===1){if($("#append-audit-expenses-choy").empty(),$(".revenue-audit-income-total").empty(),Object.keys(i).length===0){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var p='<div class="col-sm-12 ml-3 text-dark" id="append-audit-expenses-choy">',d=0;$.each(i,(k,b)=>{p+='<div class="row mb-2">';const P=k.includes("_")?k.split("_")[1]:k;p+=`<div class="col-6 revenue-audit-accounts">${P}</div>`,console.log(k),$.each(b.months,(q,z)=>{var B=z.value.replace(/,/g,""),X=parseFloat(B);f+=X,d+=X}),p+=`<div class="col-6 text-right revenue-audit-amount">${d.toLocaleString()}</div>`,p+="</div>"}),p+="</div>",$("#append-audit-expenses-choy").html(p),$(".revenue-audit-income-total").text(f.toLocaleString())}if(n===2){if($(".append-audit-oe").empty(),$(".append-audit-ldc").empty(),Object.keys(e).length===0){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var x=!1,v=!1;if($.each(e,(k,b)=>{var P=k.split("_"),q=P[2];q==="Less Direct Cost"?x=!0:q==="Operating Expenses"&&(v=!0)}),!x||!v){H.fire({icon:"warning",title:"Missing Data",text:'Both "Less Direct Cost" and "Operating Expenses" entries are required.'});return}M=0,$.each(e,(k,b)=>{var P=k.split("_")[1];if(k.split("_")[2]==="Less Direct Cost"){var q="";$.each(b.months,(B,X)=>{var ie=X.value.replace(/,/g,""),ae=parseFloat(ie);A+=ae,q+=`
                        <div class="row">
                            <div class="col-sm-6 text-left">${P}</div>
                            <div class="col-sm-6 text-right">${ae.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</div>
                        </div>
                        `}),$(".append-audit-ldc").append(q)}if(k.split("_")[2]==="Operating Expenses"){var z="";$.each(b.months,(B,X)=>{var ie=X.value.replace(/,/g,""),ae=parseFloat(ie);M+=ae,z+=`
                        <div class="row">
                            <div class="col-sm-6 text-left">${P}</div>
                            <div class="col-sm-6 text-right">${ae.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</div>
                        </div>
                        `}),$(".append-audit-oe").append(z)}}),E=f-A,C=E-M,$(".expenses-ldc-audit-total").text(A.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".gries-audit-total").text(E.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".tgi-audit").text(E.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".oe-audit-total").text(M.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".net-audit-amount").text(C.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))}if(n===3){if($(".append-ca-audit").empty(),$(".append-audit-nca").empty(),$(".append-audit-fa").empty(),!Object.keys(t).some(b=>t[b].accounts&&t[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var _="",O="",I="";$.each(t,(b,P)=>{b==="Current Asset"&&$.each(P.accounts,(q,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);F+=X,_+=`
                                <div class="row">
                                    <span class="col-sm-6 text-sm text-left">${z.assetAccount}</span>
                                    <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                                </div>
                            `}),b==="Non-Current Assets"&&$.each(P.accounts,(q,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);Y+=X,O+=`
                            <div class="row">
                                <span class="col-sm-6 text-sm text-left">${z.assetAccount}</span>
                                <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                            </div>
                        `}),b==="Fixed Assets"&&$.each(P.accounts,(q,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);g+=X,I+=`
                        <div class="row">
                            <span class="col-sm-6 text-sm text-left">${z.assetAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `}),$(".append-ca-audit").html(_),$(".append-audit-nca").html(O),$(".append-audit-fa").html(I),$(".tnca-audit-amount").text(Y.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".total-audit-ca").text(F.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),S=F+Y+g,$(".total-audit-assets").text(S.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))})}if(n===4){if(y=0,$(".append-audit-cl").empty(),!Object.keys(a).some(b=>a[b].accounts&&a[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}var U="";$.each(a,(b,P)=>{$.each(P.accounts,(q,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);y+=X,U+=`
                        <div class="row">
                            <span class="col-sm-6 text-sm text-left">${z.liabilityAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `})}),$(".append-audit-cl").html(U)}if(n===5){w=0,$(".append-audit-oenw").empty();var R="";if(!Object.keys(s).some(b=>s[b].accounts&&s[b].accounts.length>0)){H.fire({icon:"warning",title:"Missing Data",text:"Please fill and save data for at least one entry."});return}$.each(s,(b,P)=>{$.each(P.accounts,(q,z)=>{var B=z.amount.replace(/,/g,""),X=parseFloat(B);w+=X,R+=`<div class="row">
                            <span class="col-sm-6 text-sm text-left">${z.oeAccount}</span>
                            <span class="col-sm-6 text-sm text-right">${X.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                        </div>
                    `})}),$(".append-audit-oenw").html(R)}if(n===6){var j=$(".journal-audit-adjustments-form").serializeArray(),Q=!0;if($.each(j,(k,b)=>{if(b.value===""){Q=!1,$(`[name='${b.name}']`).addClass("is-invalid");return}m[b.name]=b.value,$(`[name='${b.name}']`).removeClass("is-invalid")}),!Q){H.fire({icon:"warning",title:"Missing Fields",text:"Please fill all fields"});return}var J=0,W=0;$.each(m,(k,b)=>{if(k==="audit-owners_contribution"){var P=b.replace(/,/g,""),q=parseFloat(P);J+=q}if(k==="audit-owners_withdrawal"){var P=b.replace(/,/g,""),q=parseFloat(P);W+=q}});var G=W+C;$(".additional-audit-capital").text(J.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".audit-less-drawings").text(W.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".fp-audit-nc").text(C.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),$(".appraisal-audit-capital").text(G.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));var L=G-parseFloat($(".audit-less-drawings").text().replace(/[^0-9.-]+/g,""));$(".audit-capital-end").text(L.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));var K=y+w;$(".tlc-audit").text(K.toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}))}n<7&&($(".multi-step-journal-audit").hide(),n++,T(n)),D(n),n===7?($(".audit-next-btn").hide(),$(".audit-save-btn").show()):($(".audit-next-btn").show(),$(".audit-save-btn").hide()),n===1?$(".audit-prev-btn").hide():$(".audit-prev-btn").show()}),$(".audit-prev-btn").on("click",function(){n>1&&($(".multi-step-journal-audit").hide(),n--,T(n)),D(n),$(".audit-next-btn").show(),$(".audit-save-btn").hide(),n===1?$(".audit-prev-btn").hide():$(".audit-prev-btn").show()});function T(p){$(".multi-step-journal-audit").hide(),$(".multi-step-journal-audit").eq(p-1).show()}function D(p){$(".audit-step").removeClass("active"),$(".audit-indicator-line").removeClass("active"),$(".audit-step").each(function(d){d<p&&($(this).addClass("active"),$(this).next(".audit-indicator-line").addClass("active"))})}T(n),D(n),n===1&&$(".audit-prev-btn").hide(),$(".save-audit-journal-btn").on("click",function(){$(".audit-client-journal-loader").removeClass("visually-hidden");var p={incomeObj:i,expenseObj:e,assetObj:t,liabilityObj:a,oeObj:s,adjustmentObj:m,references:$(this).attr("id")};$.ajax({type:"POST",url:"client/journal/audit",data:p,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(d){$(".audit-client-journal-loader").addClass("visually-hidden"),localStorage.setItem("journal","updated"),window.location.href="clients"},error:function(d,x,v){$(".audit-client-journal-loader").addClass("visually-hidden"),oe.fire({icon:"error",title:"Something went wrong",text:`Translated: ${d} 
 if issue persist try reloading the page or contact developer`})}})});var N=localStorage.getItem("journal");N==="updated"&&(H.fire({icon:"success",title:"Journal Update",text:"Journal Updated Successfully"}),localStorage.removeItem("journal"))});var te=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3});Swal.mixin({toast:!1,position:"bottom-end"});$(document).ready(function(){var n="";$(".add-new-service-req").on("click",function(u){console.log($(this).attr("id"));var o=$(this).attr("id").split("_"),l=o[1],i=$(`.service-req-${o[1]}`).serializeArray(),e=!0;$.each(i,(t,a)=>{if(a.value===""){te.fire({icon:"warning",title:"Missing Entry!",text:"Please Enter Requirement Name"}),e=!1,$('[name="req-name"]').addClass("is-invalid");return}$('[name="req-name"]').removeClass("is-invalid")}),e&&$.ajax({type:"POST",url:"service/requirement/",data:{form:i,idref:l},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){console.log(t),localStorage.setItem("req","added"),location.reload()},error:function(t,a,s){te.fire({icon:"error",title:"Oops! Something Went wrong",text:"Translated: "+t})}})}),$(".add-new-sub-service-req").on("click",function(u){var o=$("#sub_service_id").val(),l=$("#sub-service-req-id").val();if((o===""||l==="")&&te.fire({icon:"warning",title:"Missing Entry!",text:"Please Enter Requirement Name"}),l===""){$("#sub-service-req-id").addClass("is-invalid");return}else $("#sub-service-req-id").removeClass("is-invalid"),$.ajax({type:"POST",url:"sub-service/requirement/",data:{reqName:l,idRef:o},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){console.log(i),localStorage.setItem("req","added"),location.reload()},error:function(i,e,t){te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+i})}})}),$(".get-client-service-req").on("click",function(){n="",$(".append-service-req").empty(),console.log($(this).attr("id"));let u=$(this).attr("id");$(".service-reqs-loader").removeClass("visually-hidden");var o="";$.ajax({type:"POST",url:`client/service/requirements/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(l){n=l.category,console.log(l),console.log("this"),$(".service-reqs-loader").addClass("visually-hidden"),$.each(l.serviceReqs,(i,e)=>{let t="";e.gcon?t=`<td>${e.gcon}</td>`:t=`
                        <td><input type="file" class="req-file" id="${e.id}_${u}" data-id="${e.req_name}_${e.id}" name="${e.req_name}_${e.id}"></td>
                    `,o+=`
                        <tr>
                            <td>${e.req_name}</td>
                            ${t}
                        </tr>
                    `}),$(".append-service-req").append(o)},error:function(l,i,e){$(".service-reqs-loader").addClass("visually-hidden"),te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+l})}})}),$(".save-req-files").on("click",function(){let u=[],o=!1,l=new FormData;const i=$(this).attr("id");if($(".req-file").each(function(){if(this.files.length){o=!0;const e=$(this).attr("id"),t=n,a=this.files[0];u.push({service_id:i,sub_service_req_id:e,category:t,file:a.name}),l.append(`files[${e}]`,a)}}),!o){te.fire({icon:"error",title:"Please upload at least one file."});return}l.append("metadata",JSON.stringify(u)),$.ajax({type:"POST",url:"/service/requirement/document",data:l,processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){console.log(e),localStorage.setItem("req-docs","added"),location.reload()},error:function(e,t,a){te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+e})}})}),$(".view-client-service-doc").on("click",function(){$(".service-docs-loader").removeClass("visually-hidden"),console.log($(this).attr("id")),$(".append-service-docs").empty();let u="";$.ajax({type:"POST",url:`/service/requirement/documents/${$(this).attr("id")}`,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(o){$(".service-docs-loader").addClass("visually-hidden"),console.log(o),$.each(o.docsData,(l,i)=>{console.log(i);let e="";i.grp&&i.grp.trim()!==""&&(e=`
                            <a href="storage/${i.grp}" 
                               download="${i.gcon}" 
                               class="badge bg-warning text-dark" 
                               style="font-size: 10px;">
                                <i class="fas fa-cloud-download-alt"></i> Download
                            </a>
                        `),u+=`
                        <tr>
                            <td>${i.req_name}</td>
                            <td>${i.gcon||"No file name"}</td>
                            <td>${i.gcmt}</td>
                            <td>${e}</td>
                        </tr>
                    `}),$(".append-service-docs").html(u)},error:function(o,l,i){$(".service-docs-loader").addClass("visually-hidden"),te.fire({icon:"error",title:"Oops! Something Went Wrong",text:"Translated: "+o})}})});var r=localStorage.getItem("req-docs"),c=localStorage.getItem("req");c==="added"&&(te.fire({icon:"success",title:"Service Requirement",text:"New requirement added"}),localStorage.removeItem("req")),r==="added"&&(te.fire({icon:"success",title:"Service Requirement",text:"New requirement document is added"}),localStorage.removeItem("req-docs"))});$(document).ready(function(){window.formatValueInput=function(n){var r=n.value.replace(/[^0-9\.]/g,""),c=r.split(".");c[0]=c[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),c.length>1?n.value=c[0]+"."+c[1]:n.value=c[0]},window.previewImage=function(n,r){const u=n.target.files[0];if(u){const o=new FileReader;o.onload=function(l){const i=document.getElementById(r);i?i.src=l.target.result:console.error(`Preview element with ID ${r} not found.`)},o.readAsDataURL(u)}else console.warn("No file selected.")}});
